function UUID(){}!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function noConflict(){try{Promise===bluebird&&(Promise=old)}catch(e){}return bluebird}var old;"undefined"!=typeof Promise&&(old=Promise);var bluebird=require("./promise.js")();bluebird.noConflict=noConflict,module.exports=bluebird},{"./promise.js":19}],2:[function(require,module,exports){"use strict";module.exports=function(Promise){function any(promises){var ret=new SomePromiseArray(promises),promise=ret.promise();return promise.isRejected()?promise:(ret.setHowMany(1),ret.setUnwrap(),ret.init(),promise)}var SomePromiseArray=Promise._SomePromiseArray;Promise.any=function(promises){return any(promises)},Promise.prototype.any=function(){return any(this)}}},{}],3:[function(require,module,exports){"use strict";function Async(){this._isTickUsed=!1,this._lateQueue=new Queue(16),this._normalQueue=new Queue(16);var self=this;this.drainQueues=function(){self._drainQueues()},this._schedule=schedule.isStatic?schedule(this.drainQueues):schedule}var firstLineError;try{throw new Error}catch(e){firstLineError=e}var schedule=require("./schedule.js"),Queue=require("./queue.js"),_process="undefined"!=typeof process?process:void 0;Async.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},Async.prototype._withDomain=function(fn){return void 0===_process||null==_process.domain||fn.domain||(fn=_process.domain.bind(fn)),fn},Async.prototype.throwLater=function(fn,arg){if(1===arguments.length&&(arg=fn,fn=function(){throw arg}),fn=this._withDomain(fn),"undefined"!=typeof setTimeout)setTimeout(function(){fn(arg)},0);else try{this._schedule(function(){fn(arg)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},Async.prototype.invokeLater=function(fn,receiver,arg){fn=this._withDomain(fn),this._lateQueue.push(fn,receiver,arg),this._queueTick()},Async.prototype.invokeFirst=function(fn,receiver,arg){fn=this._withDomain(fn),this._normalQueue.unshift(fn,receiver,arg),this._queueTick()},Async.prototype.invoke=function(fn,receiver,arg){fn=this._withDomain(fn),this._normalQueue.push(fn,receiver,arg),this._queueTick()},Async.prototype.settlePromises=function(promise){this._normalQueue._pushOne(promise),this._queueTick()},Async.prototype._drainQueue=function(queue){for(;queue.length()>0;){var fn=queue.shift();if("function"==typeof fn){var receiver=queue.shift(),arg=queue.shift();fn.call(receiver,arg)}else fn._settlePromises()}},Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},Async.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},Async.prototype._reset=function(){this._isTickUsed=!1},module.exports=new Async,module.exports.firstLineError=firstLineError},{"./queue.js":24,"./schedule.js":27}],4:[function(require,module,exports){"use strict";var cr=Object.create;if(cr){var callerCache=cr(null),getterCache=cr(null);callerCache[" size"]=getterCache[" size"]=0}module.exports=function(Promise){function makeMethodCaller(methodName){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,methodName))}function makeGetter(propertyName){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",propertyName))}function getCompiled(name,compiler,cache){var ret=cache[name];if("function"!=typeof ret){if(!isIdentifier(name))return null;if(ret=compiler(name),cache[name]=ret,cache[" size"]++,cache[" size"]>512){for(var keys=Object.keys(cache),i=0;256>i;++i)delete cache[keys[i]];cache[" size"]=keys.length-256}}return ret}function getMethodCaller(name){return getCompiled(name,makeMethodCaller,callerCache)}function getGetter(name){return getCompiled(name,makeGetter,getterCache)}function caller(obj){return obj[this.pop()].apply(obj,this)}function namedGetter(obj){return obj[this]}function indexedGetter(obj){var index=+this;return 0>index&&(index=Math.max(0,index+obj.length)),obj[index]}var util=require("./util.js"),canEvaluate=util.canEvaluate,isIdentifier=util.isIdentifier;Promise.prototype.call=function(methodName){for(var $_len=arguments.length,args=new Array($_len-1),$_i=1;$_len>$_i;++$_i)args[$_i-1]=arguments[$_i];if(canEvaluate){var maybeCaller=getMethodCaller(methodName);if(null!==maybeCaller)return this._then(maybeCaller,void 0,void 0,args,void 0)}return args.push(methodName),this._then(caller,void 0,void 0,args,void 0)},Promise.prototype.get=function(propertyName){var getter,isIndex="number"==typeof propertyName;if(isIndex)getter=indexedGetter;else if(canEvaluate){var maybeGetter=getGetter(propertyName);getter=null!==maybeGetter?maybeGetter:namedGetter}else getter=namedGetter;return this._then(getter,void 0,void 0,propertyName,void 0)}}},{"./util.js":34}],5:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var errors=require("./errors.js"),async=require("./async.js"),CancellationError=errors.CancellationError;Promise.prototype._cancel=function(reason){if(!this.isCancellable())return this;for(var parent,promiseToReject=this;void 0!==(parent=promiseToReject._cancellationParent)&&parent.isCancellable();)promiseToReject=parent;this._unsetCancellable(),promiseToReject._target()._rejectCallback(reason,!1,!0)},Promise.prototype.cancel=function(reason){return this.isCancellable()?(void 0===reason&&(reason=new CancellationError),async.invokeLater(this._cancel,this,reason),this):this},Promise.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},Promise.prototype.uncancellable=function(){var ret=new Promise(INTERNAL);return ret._propagateFrom(this,4),ret._follow(this),ret._unsetCancellable(),ret},Promise.prototype.fork=function(didFulfill,didReject,didProgress){var ret=this._then(didFulfill,didReject,didProgress,void 0,void 0);return ret._setCancellable(),ret._cancellationParent=void 0,ret}}},{"./async.js":3,"./errors.js":10}],6:[function(require,module,exports){"use strict";module.exports=function(){function CapturedTrace(parent){this._parent=parent;var length=this._length=1+(void 0===parent?0:parent._length);captureStackTrace(this,CapturedTrace),length>32&&this.uncycle()}function reconstructStack(message,stacks){for(var i=0;i<stacks.length-1;++i)stacks[i].push("From previous event:"),stacks[i]=stacks[i].join("\n");return stacks[i]=stacks[i].join("\n"),message+"\n"+stacks.join("\n")}function removeDuplicateOrEmptyJumps(stacks){for(var i=0;i<stacks.length;++i)(0===stacks[i].length||i+1<stacks.length&&stacks[i][0]===stacks[i+1][0])&&(stacks.splice(i,1),i--)}function removeCommonRoots(stacks){for(var current=stacks[0],i=1;i<stacks.length;++i){for(var prev=stacks[i],currentLastIndex=current.length-1,currentLastLine=current[currentLastIndex],commonRootMeetPoint=-1,j=prev.length-1;j>=0;--j)if(prev[j]===currentLastLine){commonRootMeetPoint=j;break}for(var j=commonRootMeetPoint;j>=0;--j){var line=prev[j];if(current[currentLastIndex]!==line)break;current.pop(),currentLastIndex--}current=prev}}function protectErrorMessageNewlines(stack){for(var i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line))break}if(1>=i)return 1;for(var errorMessageLines=[],j=0;i>j;++j)errorMessageLines.push(stack.shift());return stack.unshift(errorMessageLines.join("\x00")),i}function unProtectNewlines(stack){return stack.length>0&&(stack[0]=stack[0].split("\x00").join("\n")),stack}function cleanStack(stack,initialIndex){for(var ret=stack.slice(0,initialIndex),i=initialIndex;i<stack.length;++i){var line=stack[i],isTraceLine=stackFramePattern.test(line)||"    (No stack trace)"===line,isInternalFrame=isTraceLine&&shouldIgnore(line);isTraceLine&&!isInternalFrame&&ret.push(line)}return ret}function formatNonError(obj){var str;if("function"==typeof obj)str="[function "+(obj.name||"anonymous")+"]";else{str=obj.toString();var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str))try{var newStr=JSON.stringify(obj);str=newStr}catch(e){}0===str.length&&(str="(empty array)")}return"(<"+snip(str)+">, no stack trace)"}function snip(str){var maxChars=41;return str.length<maxChars?str:str.substr(0,maxChars-3)+"..."}function parseLineInfo(line){var matches=line.match(parseLineInfoRegex);return matches?{fileName:matches[1],line:parseInt(matches[2],10)}:void 0}var async=require("./async.js"),inherits=require("./util.js").inherits,bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo)/,stackFramePattern=null,formatStack=null;inherits(CapturedTrace,Error),CapturedTrace.prototype.uncycle=function(){var length=this._length;if(!(2>length)){for(var nodes=[],stackToIndex={},i=0,node=this;void 0!==node;++i)nodes.push(node),node=node._parent;length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;void 0===stackToIndex[stack]&&(stackToIndex[stack]=i)}for(var i=0;length>i;++i){var currentStack=nodes[i].stack,index=stackToIndex[currentStack];if(void 0!==index&&index!==i){index>0&&(nodes[index-1]._parent=void 0,nodes[index-1]._length=1),nodes[i]._parent=void 0,nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;length-1>index?(cycleEdgeNode._parent=nodes[index+1],cycleEdgeNode._parent.uncycle(),cycleEdgeNode._length=cycleEdgeNode._parent._length+1):(cycleEdgeNode._parent=void 0,cycleEdgeNode._length=1);for(var currentChildLength=cycleEdgeNode._length+1,j=i-2;j>=0;--j)nodes[j]._length=currentChildLength,currentChildLength++;return}}}},CapturedTrace.prototype.parent=function(){return this._parent},CapturedTrace.prototype.hasParent=function(){return void 0!==this._parent},CapturedTrace.prototype.attachExtraTrace=function(error){if(!error.__stackCleaned__){this.uncycle();for(var header=CapturedTrace.cleanHeaderStack(error,!1),stacks=[header.slice(1)],trace=this;void 0!==trace;)stacks.push(cleanStack(trace.stack.split("\n"),0)),trace=trace._parent;removeCommonRoots(stacks),removeDuplicateOrEmptyJumps(stacks);var message=header[0].split("\x00").join("\n");error.stack=reconstructStack(message,stacks)}},CapturedTrace.cleanHeaderStack=function(error,shouldUnProtectNewlines){if(!error.__stackCleaned__){error.__stackCleaned__=!0;var stack=error.stack;stack="string"==typeof stack?stack.split("\n"):[error.toString(),"    (No stack trace)"];var initialIndex=protectErrorMessageNewlines(stack);return stack=cleanStack(stack,initialIndex),shouldUnProtectNewlines&&(stack=unProtectNewlines(stack)),error.stack=stack.join("\n"),stack}},CapturedTrace.formatAndLogError=function(error,title){if("object"==typeof console){var message;if("object"==typeof error||"function"==typeof error){var stack=error.stack;message=title+formatStack(stack,error)}else message=title+String(error);"function"==typeof console.warn||"object"==typeof console.warn?console.warn(message):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(message)}},CapturedTrace.unhandledRejection=function(reason){CapturedTrace.formatAndLogError(reason,"^--- With additional stack trace: ")},CapturedTrace.isSupported=function(){return"function"==typeof captureStackTrace},CapturedTrace.fireRejectionEvent=function(name,localHandler,reason,promise){var localEventFired=!1;try{"function"==typeof localHandler&&(localEventFired=!0,"rejectionHandled"===name?localHandler(promise):localHandler(reason,promise))}catch(e){async.throwLater(e)}var globalEventFired=!1;try{globalEventFired=fireGlobalEvent(name,reason,promise)}catch(e){globalEventFired=!0,async.throwLater(e)}var domEventFired=!1;if(fireDomEvent)try{domEventFired=fireDomEvent(name.toLowerCase(),{reason:reason,promise:promise})}catch(e){domEventFired=!0,async.throwLater(e)}globalEventFired||localEventFired||domEventFired||"unhandledRejection"!==name||CapturedTrace.formatAndLogError(reason,"Possibly unhandled ")};var shouldIgnore=function(){return!1},parseLineInfoRegex=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;CapturedTrace.setBounds=function(firstLineError,lastLineError){if(CapturedTrace.isSupported()){for(var firstFileName,lastFileName,firstStackLines=firstLineError.stack.split("\n"),lastStackLines=lastLineError.stack.split("\n"),firstIndex=-1,lastIndex=-1,i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName,firstIndex=result.line;break}}for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName,lastIndex=result.line;break}}0>firstIndex||0>lastIndex||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex||(shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return!0;var info=parseLineInfo(line);return!!(info&&info.fileName===firstFileName&&firstIndex<=info.line&&info.line<=lastIndex)})}};var fireDomEvent,captureStackTrace=function stackDetection(){var v8stackFramePattern=/^\s*at\s*/,v8stackFormatter=function(stack,error){return"string"==typeof stack?stack:void 0!==error.name&&void 0!==error.message?error.name+". "+error.message:formatNonError(error)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,stackFramePattern=v8stackFramePattern,formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;return shouldIgnore=function(line){return bluebirdFramePattern.test(line)},function(receiver,ignoreUntil){Error.stackTraceLimit=Error.stackTraceLimit+6,captureStackTrace(receiver,ignoreUntil),Error.stackTraceLimit=Error.stackTraceLimit-6}}var err=new Error;if("string"==typeof err.stack&&"function"==typeof"".startsWith&&err.stack.startsWith("stackDetection@")&&"stackDetection"===stackDetection.name){stackFramePattern=/@/;var rline=/[@\n]/;return formatStack=function(stack,error){return"string"==typeof stack?error.name+". "+error.message+"\n"+stack:void 0!==error.name&&void 0!==error.message?error.name+". "+error.message:formatNonError(error)},function(o){for(var stack=(new Error).stack,split=stack.split(rline),len=split.length,ret="",i=0;len>i;i+=2)ret+=split[i],ret+="@",ret+=split[i+1],ret+="\n";o.stack=ret}}var hasStackAfterThrow;try{throw new Error}catch(e){hasStackAfterThrow="stack"in e}return"stack"in err||!hasStackAfterThrow?(formatStack=function(stack,error){return"string"==typeof stack?stack:"object"!=typeof error&&"function"!=typeof error||void 0===error.name||void 0===error.message?formatNonError(error):error.name+". "+error.message},null):(stackFramePattern=v8stackFramePattern,formatStack=v8stackFormatter,function(o){try{throw new Error}catch(e){o.stack=e.stack}})}(),fireGlobalEvent=function(){if("undefined"!=typeof process&&"string"==typeof process.version&&"undefined"==typeof window)return function(name,reason,promise){return"rejectionHandled"===name?process.emit(name,promise):process.emit(name,reason,promise)};var customEventWorks=!1;try{var ev=new self.CustomEvent("test");customEventWorks=ev instanceof CustomEvent}catch(e){}fireDomEvent=function(type,detail){var event;return customEventWorks?event=new self.CustomEvent(type,{detail:detail,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(event=document.createEvent("CustomEvent"),event.initCustomEvent(type,!1,!0,detail)),event?!self.dispatchEvent(event):!1};var toWindowMethodNameMap={};return toWindowMethodNameMap.unhandledRejection="onunhandledRejection".toLowerCase(),toWindowMethodNameMap.rejectionHandled="onrejectionHandled".toLowerCase(),function(name,reason,promise){var methodName=toWindowMethodNameMap[name],method=self[methodName];return method?("rejectionHandled"===name?method.call(self,promise):method.call(self,reason,promise),!0):!1}}();return CapturedTrace}},{"./async.js":3,"./util.js":34}],7:[function(require,module,exports){"use strict";module.exports=function(NEXT_FILTER){function CatchFilter(instances,callback,promise){this._instances=instances,this._callback=callback,this._promise=promise}function safePredicate(predicate,e){var safeObject={},retfilter=tryCatch(predicate).call(safeObject,e);if(retfilter===errorObj)return retfilter;var safeKeys=keys(safeObject);return safeKeys.length?(errorObj.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),errorObj):retfilter}var util=require("./util.js"),errors=require("./errors.js"),tryCatch=util.tryCatch,errorObj=util.errorObj,keys=require("./es5.js").keys,TypeError=errors.TypeError;return CatchFilter.prototype.doFilter=function(e){for(var cb=this._callback,promise=this._promise,boundTo=promise._boundTo,i=0,len=this._instances.length;len>i;++i){var item=this._instances[i],itemIsErrorType=item===Error||null!=item&&item.prototype instanceof Error;if(itemIsErrorType&&e instanceof item){var ret=tryCatch(cb).call(boundTo,e);return ret===errorObj?(NEXT_FILTER.e=ret.e,NEXT_FILTER):ret}if("function"==typeof item&&!itemIsErrorType){var shouldHandle=safePredicate(item,e);if(shouldHandle===errorObj){e=errorObj.e;break}if(shouldHandle){var ret=tryCatch(cb).call(boundTo,e);return ret===errorObj?(NEXT_FILTER.e=ret.e,NEXT_FILTER):ret}}}return NEXT_FILTER.e=e,NEXT_FILTER},CatchFilter}},{"./errors.js":10,"./es5.js":11,"./util.js":34}],8:[function(require,module,exports){"use strict";var util=require("./util.js"),isPrimitive=util.isPrimitive,wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver;module.exports=function(Promise){var returner=function(){return this},thrower=function(){throw this},wrapper=function(value,action){return 1===action?function(){throw value}:2===action?function(){return value}:void 0};Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){return wrapsPrimitiveReceiver&&isPrimitive(value)?this._then(wrapper(value,2),void 0,void 0,void 0,void 0):this._then(returner,void 0,void 0,value,void 0)},Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){return wrapsPrimitiveReceiver&&isPrimitive(reason)?this._then(wrapper(reason,1),void 0,void 0,void 0,void 0):this._then(thrower,void 0,void 0,reason,void 0)}}},{"./util.js":34}],9:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseReduce=Promise.reduce;Promise.prototype.each=function(fn){return PromiseReduce(this,fn,null,INTERNAL)},Promise.each=function(promises,fn){return PromiseReduce(promises,fn,null,INTERNAL)}}},{}],10:[function(require,module,exports){"use strict";function subError(nameProperty,defaultMessage){function SubError(message){return this instanceof SubError?(notEnumerableProp(this,"message","string"==typeof message?message:defaultMessage),notEnumerableProp(this,"name",nameProperty),void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new SubError(message)}return inherits(SubError,Error),SubError}function OperationalError(message){notEnumerableProp(this,"name","OperationalError"),notEnumerableProp(this,"message",message),this.cause=message,this.isOperational=!0,message instanceof Error?(notEnumerableProp(this,"message",message.message),notEnumerableProp(this,"stack",message.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var _TypeError,_RangeError,Objectfreeze=require("./es5.js").freeze,util=require("./util.js"),inherits=util.inherits,notEnumerableProp=util.notEnumerableProp,CancellationError=subError("CancellationError","cancellation error"),TimeoutError=subError("TimeoutError","timeout error"),AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError,_RangeError=RangeError}catch(e){_TypeError=subError("TypeError","type error"),_RangeError=subError("RangeError","range error")}for(var methods="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),i=0;i<methods.length;++i)"function"==typeof Array.prototype[methods[i]]&&(AggregateError.prototype[methods[i]]=Array.prototype[methods[i]]);AggregateError.prototype.length=0,AggregateError.prototype.isOperational=!0;var level=0;AggregateError.prototype.toString=function(){var indent=Array(4*level+1).join(" "),ret="\n"+indent+"AggregateError of:\n";level++,indent=Array(4*level+1).join(" ");for(var i=0;i<this.length;++i){for(var str=this[i]===this?"[Circular AggregateError]":this[i]+"",lines=str.split("\n"),j=0;j<lines.length;++j)lines[j]=indent+lines[j];str=lines.join("\n"),ret+=str+"\n"}return level--,ret},inherits(OperationalError,Error);var errorTypes=Error.__BluebirdErrorTypes__;errorTypes||(errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError}),notEnumerableProp(Error,"__BluebirdErrorTypes__",errorTypes)),module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError}},{"./es5.js":11,"./util.js":34}],11:[function(require,module,exports){var isES5=function(){"use strict";return void 0===this}();if(isES5)module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!(descriptor&&!descriptor.writable&&!descriptor.set)}};else{var has={}.hasOwnProperty,str={}.toString,proto={}.constructor.prototype,ObjectKeys=function(o){var ret=[];for(var key in o)has.call(o,key)&&ret.push(key);return ret},ObjectDefineProperty=function(o,key,desc){return o[key]=desc.value,o},ObjectFreeze=function(obj){return obj},ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}},ArrayIsArray=function(obj){try{return"[object Array]"===str.call(obj)}catch(e){return!1}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,defineProperty:ObjectDefineProperty,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return!0}}}},{}],12:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseMap=Promise.map;Promise.prototype.filter=function(fn,options){return PromiseMap(this,fn,options,INTERNAL)},Promise.filter=function(promises,fn,options){return PromiseMap(promises,fn,options,INTERNAL)}}},{}],13:[function(require,module,exports){"use strict";module.exports=function(Promise,NEXT_FILTER,tryConvertToPromise){function returnThis(){return this}function throwThis(){throw this}function return$(r){return function(){return r}}function throw$(r){return function(){throw r}}function promisedFinally(ret,reasonOrValue,isFulfilled){var then;return then=wrapsPrimitiveReceiver&&isPrimitive(reasonOrValue)?isFulfilled?return$(reasonOrValue):throw$(reasonOrValue):isFulfilled?returnThis:throwThis,ret._then(then,thrower,void 0,reasonOrValue,void 0)}function finallyHandler(reasonOrValue){var promise=this.promise,handler=this.handler,ret=promise._isBound()?handler.call(promise._boundTo):handler();if(void 0!==ret){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise)return maybePromise=maybePromise._target(),promisedFinally(maybePromise,reasonOrValue,promise.isFulfilled())}return promise.isRejected()?(NEXT_FILTER.e=reasonOrValue,NEXT_FILTER):reasonOrValue}function tapHandler(value){var promise=this.promise,handler=this.handler,ret=promise._isBound()?handler.call(promise._boundTo,value):handler(value);if(void 0!==ret){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise)return maybePromise=maybePromise._target(),promisedFinally(maybePromise,value,!0)}return value}var util=require("./util.js"),wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver,isPrimitive=util.isPrimitive,thrower=util.thrower;Promise.prototype._passThroughHandler=function(handler,isFinally){if("function"!=typeof handler)return this.then();var promiseAndHandler={promise:this,handler:handler};return this._then(isFinally?finallyHandler:tapHandler,isFinally?finallyHandler:void 0,void 0,promiseAndHandler,void 0)},Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThroughHandler(handler,!0)},Promise.prototype.tap=function(handler){return this._passThroughHandler(handler,!1)}}},{"./util.js":34}],14:[function(require,module,exports){"use strict";module.exports=function(Promise,apiRejection,INTERNAL,tryConvertToPromise){function promiseFromYieldHandler(value,yieldHandlers,traceParent){for(var i=0;i<yieldHandlers.length;++i){traceParent._pushContext();var result=tryCatch(yieldHandlers[i])(value);if(traceParent._popContext(),result===errorObj){traceParent._pushContext();var ret=Promise.reject(errorObj.e);return traceParent._popContext(),ret}var maybePromise=tryConvertToPromise(result,traceParent);if(maybePromise instanceof Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,yieldHandler,stack){var promise=this._promise=new Promise(INTERNAL);promise._captureStackTrace(),this._stack=stack,this._generatorFunction=generatorFunction,this._receiver=receiver,this._generator=void 0,this._yieldHandlers="function"==typeof yieldHandler?[yieldHandler].concat(yieldHandlers):yieldHandlers}var errors=require("./errors.js"),TypeError=errors.TypeError,deprecated=require("./util.js").deprecated,util=require("./util.js"),errorObj=util.errorObj,tryCatch=util.tryCatch,yieldHandlers=[];PromiseSpawn.prototype.promise=function(){return this._promise},PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},PromiseSpawn.prototype._continue=function(result){if(result===errorObj){this._generator=void 0;var trace=util.canAttachTrace(result.e)?result.e:new Error(util.toString(result.e));return this._promise._attachExtraTrace(trace),void this._promise._reject(result.e,trace)}var value=result.value;if(result.done===!0)this._generator=void 0,this._promise._tryFollow(value)||this._promise._fulfill(value);else{var maybePromise=tryConvertToPromise(value,this._promise);if(!(maybePromise instanceof Promise)&&(maybePromise=promiseFromYieldHandler(maybePromise,this._yieldHandlers,this._promise),null===maybePromise))return void this._throw(new TypeError("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",value)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));maybePromise._then(this._next,this._throw,void 0,this,null)}},PromiseSpawn.prototype._throw=function(reason){util.canAttachTrace(reason)&&this._promise._attachExtraTrace(reason),this._promise._pushContext();var result=tryCatch(this._generator["throw"]).call(this._generator,reason);this._promise._popContext(),this._continue(result)},PromiseSpawn.prototype._next=function(value){this._promise._pushContext();var result=tryCatch(this._generator.next).call(this._generator,value);this._promise._popContext(),this._continue(result)},Promise.coroutine=function(generatorFunction,options){if("function"!=typeof generatorFunction)throw new TypeError("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var yieldHandler=Object(options).yieldHandler,PromiseSpawn$=PromiseSpawn,stack=(new Error).stack;return function(){var generator=generatorFunction.apply(this,arguments),spawn=new PromiseSpawn$(void 0,void 0,yieldHandler,stack);return spawn._generator=generator,spawn._next(void 0),spawn.promise()}},Promise.coroutine.addYieldHandler=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");yieldHandlers.push(fn)},Promise.spawn=function(generatorFunction){if(deprecated("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof generatorFunction)return apiRejection("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var spawn=new PromiseSpawn(generatorFunction,this),ret=spawn.promise();return spawn._run(Promise.spawn),ret}}},{"./errors.js":10,"./util.js":34}],15:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL){function reject(reason){this._reject(reason)}var util=require("./util.js"),canEvaluate=util.canEvaluate,tryCatch=util.tryCatch,errorObj=util.errorObj;if(canEvaluate){for(var thenCallback=function(i){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,i))},caller=function(count){for(var values=[],i=1;count>=i;++i)values.push("holder.p"+i);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,values.join(", ")))},thenCallbacks=[],callers=[void 0],i=1;5>=i;++i)thenCallbacks.push(thenCallback(i)),callers.push(caller(i));var Holder=function(total,fn){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=fn,this.total=total,this.now=0};Holder.prototype.callers=callers,Holder.prototype.checkFulfillment=function(promise){var now=this.now;now++;var total=this.total;if(now>=total){var handler=this.callers[total];promise._pushContext();var ret=tryCatch(handler)(this);promise._popContext(),ret===errorObj?promise._rejectCallback(ret.e,!1,!0):promise._tryFollow(ret)||promise._fulfillUnchecked(ret)}else this.now=now}}Promise.join=function(){var fn,last=arguments.length-1;if(last>0&&"function"==typeof arguments[last]&&(fn=arguments[last],6>last&&canEvaluate)){var ret=new Promise(INTERNAL);ret._captureStackTrace();for(var holder=new Holder(last,fn),callbacks=thenCallbacks,i=0;last>i;++i){var maybePromise=tryConvertToPromise(arguments[i],ret);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),maybePromise._isPending()?maybePromise._then(callbacks[i],reject,void 0,ret,holder):maybePromise._isFulfilled()?callbacks[i].call(ret,maybePromise._value(),holder):ret._reject(maybePromise._reason())):callbacks[i].call(ret,maybePromise,holder);
}return ret}for(var $_len=arguments.length,args=new Array($_len),$_i=0;$_len>$_i;++$_i)args[$_i]=arguments[$_i];var ret=new PromiseArray(args).promise();return void 0!==fn?ret.spread(fn):ret}}},{"./util.js":34}],16:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){function MappingPromiseArray(promises,fn,limit,_filter){this.constructor$(promises),this._promise._setIsSpreadable(),this._promise._captureStackTrace(),this._callback=fn,this._preservedValues=_filter===INTERNAL?new Array(this.length()):null,this._limit=limit,this._inFlight=0,this._queue=limit>=1?[]:EMPTY_ARRAY,this._init$(void 0,-2)}function map(promises,fn,options,_filter){var limit="object"==typeof options&&null!==options?options.concurrency:0;return limit="number"==typeof limit&&isFinite(limit)&&limit>=1?limit:0,new MappingPromiseArray(promises,fn,limit,_filter)}var util=require("./util.js"),tryCatch=util.tryCatch,errorObj=util.errorObj,PENDING={},EMPTY_ARRAY=[];util.inherits(MappingPromiseArray,PromiseArray),MappingPromiseArray.prototype._init=function(){},MappingPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values,length=this.length(),preservedValues=this._preservedValues,limit=this._limit;if(values[index]===PENDING){if(values[index]=value,limit>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(limit>=1&&this._inFlight>=limit)return values[index]=value,void this._queue.push(index);null!==preservedValues&&(preservedValues[index]=value);var callback=this._callback,receiver=this._promise._boundTo;this._promise._pushContext();var ret=tryCatch(callback).call(receiver,value,index,length);if(this._promise._popContext(),ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){if(maybePromise=maybePromise._target(),maybePromise._isPending())return limit>=1&&this._inFlight++,values[index]=PENDING,maybePromise._proxyPromiseArray(this,index);if(!maybePromise._isFulfilled())return this._reject(maybePromise._reason());ret=maybePromise._value()}values[index]=ret}var totalResolved=++this._totalResolved;totalResolved>=length&&(null!==preservedValues?this._filter(values,preservedValues):this._resolve(values))},MappingPromiseArray.prototype._drainQueue=function(){for(var queue=this._queue,limit=this._limit,values=this._values;queue.length>0&&this._inFlight<limit;){if(this._isResolved())return;var index=queue.pop();this._promiseFulfilled(values[index],index)}},MappingPromiseArray.prototype._filter=function(booleans,values){for(var len=values.length,ret=new Array(len),j=0,i=0;len>i;++i)booleans[i]&&(ret[j++]=values[i]);ret.length=j,this._resolve(ret)},MappingPromiseArray.prototype.preservedValues=function(){return this._preservedValues},Promise.prototype.map=function(fn,options){return"function"!=typeof fn?apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):map(this,fn,options,null).promise()},Promise.map=function(promises,fn,options,_filter){return"function"!=typeof fn?apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):map(promises,fn,options,_filter).promise()}}},{"./util.js":34}],17:[function(require,module,exports){"use strict";module.exports=function(Promise){function spreadAdapter(val,nodeback){var promise=this;if(!util.isArray(val))return successAdapter.call(promise,val,nodeback);var ret=tryCatch(nodeback).apply(promise._boundTo,[null].concat(val));ret===errorObj&&async.throwLater(ret.e)}function successAdapter(val,nodeback){var promise=this,receiver=promise._boundTo,ret=void 0===val?tryCatch(nodeback).call(receiver,null):tryCatch(nodeback).call(receiver,null,val);ret===errorObj&&async.throwLater(ret.e)}function errorAdapter(reason,nodeback){var promise=this;if(!reason){var target=promise._target(),newReason=target._getCarriedStackTrace();newReason.cause=reason,reason=newReason}var ret=tryCatch(nodeback).call(promise._boundTo,reason);ret===errorObj&&async.throwLater(ret.e)}var util=require("./util.js"),async=require("./async.js"),tryCatch=util.tryCatch,errorObj=util.errorObj;Promise.prototype.nodeify=function(nodeback,options){if("function"==typeof nodeback){var adapter=successAdapter;void 0!==options&&Object(options).spread&&(adapter=spreadAdapter),this._then(adapter,errorAdapter,void 0,this,nodeback)}return this}}},{"./async.js":3,"./util.js":34}],18:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var util=require("./util.js"),async=require("./async.js"),tryCatch=util.tryCatch,errorObj=util.errorObj;Promise.prototype.progressed=function(handler){return this._then(void 0,void 0,handler,void 0,void 0)},Promise.prototype._progress=function(progressValue){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(progressValue)},Promise.prototype._progressHandlerAt=function(index){return 0===index?this._progressHandler0:this[(index<<2)+index-5+2]},Promise.prototype._doProgressWith=function(progression){var progressValue=progression.value,handler=progression.handler,promise=progression.promise,receiver=progression.receiver,ret=tryCatch(handler).call(receiver,progressValue);if(ret===errorObj){if(null!=ret.e&&"StopProgressPropagation"!==ret.e.name){var trace=util.canAttachTrace(ret.e)?ret.e:new Error(util.toString(ret.e));promise._attachExtraTrace(trace),promise._progress(ret.e)}}else ret instanceof Promise?ret._then(promise._progress,null,null,promise,void 0):promise._progress(ret)},Promise.prototype._progressUnchecked=function(progressValue){for(var len=this._length(),progress=this._progress,i=0;len>i;i++){var handler=this._progressHandlerAt(i),promise=this._promiseAt(i);if(promise instanceof Promise)"function"==typeof handler?async.invoke(this._doProgressWith,this,{handler:handler,promise:promise,receiver:this._receiverAt(i),value:progressValue}):async.invoke(progress,promise,progressValue);else{var receiver=this._receiverAt(i);"function"==typeof handler?handler.call(receiver,progressValue,promise):receiver instanceof PromiseArray&&!receiver._isResolved()&&receiver._promiseProgressed(progressValue,promise)}}}}},{"./async.js":3,"./util.js":34}],19:[function(require,module,exports){"use strict";module.exports=function(){function Promise(resolver){if("function"!=typeof resolver)throw new TypeError("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==Promise)throw new TypeError("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,resolver!==INTERNAL&&this._resolveFromResolver(resolver)}function Context(){this._trace=new CapturedTrace(peekContext())}function createContext(){return debugging?new Context:void 0}function peekContext(){var lastIndex=contextStack.length-1;return lastIndex>=0?contextStack[lastIndex]:void 0}var unhandledRejectionHandled,possiblyUnhandledRejection,makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},reflect=function(){return new Promise.PromiseInspection(this._target())},apiRejection=function(msg){return Promise.reject(new TypeError(msg))},util=require("./util.js"),async=require("./async.js"),errors=require("./errors.js"),RangeError=errors.RangeError,TypeError=errors.TypeError,CancellationError=errors.CancellationError,TimeoutError=errors.TimeoutError,OperationalError=errors.OperationalError,INTERNAL=function(){},APPLY={},NEXT_FILTER={e:null},tryConvertToPromise=require("./thenables.js")(Promise,INTERNAL),PromiseArray=require("./promise_array.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection),CapturedTrace=require("./captured_trace.js")(),CatchFilter=require("./catch_filter.js")(NEXT_FILTER),PromiseResolver=require("./promise_resolver.js"),isArray=util.isArray,errorObj=util.errorObj,tryCatch=util.tryCatch,originatesFromRejection=util.originatesFromRejection,markAsOriginatingFromRejection=util.markAsOriginatingFromRejection,canAttachTrace=util.canAttachTrace,debugging=!("undefined"==typeof process||"string"!=typeof process.execPath||"object"!=typeof process.env||!process.env.BLUEBIRD_DEBUG&&"development"!==process.env.NODE_ENV);Promise.prototype.bind=function(thisArg){var maybePromise=tryConvertToPromise(thisArg),ret=new Promise(INTERNAL);ret._propagateFrom(this,1);var target=this._target();return maybePromise instanceof Promise?(target._then(INTERNAL,ret._reject,ret._progress,ret,null),maybePromise._then(function(thisArg){ret._isPending()&&(ret._setBoundTo(thisArg),ret._follow(target))},ret._reject,ret._progress,ret,null)):(ret._setBoundTo(thisArg),ret._follow(target)),ret},Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var i,catchInstances=new Array(len-1),j=0;for(i=0;len-1>i;++i){var item=arguments[i];if("function"!=typeof item)return Promise.reject(new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));catchInstances[j++]=item}catchInstances.length=j,fn=arguments[i];var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(void 0,catchFilter.doFilter,void 0,catchFilter,void 0)}return this._then(void 0,fn,void 0,void 0,void 0)},Promise.prototype.reflect=function(){return this._then(reflect,reflect,void 0,this,void 0)},Promise.prototype.then=function(didFulfill,didReject,didProgress){return this._then(didFulfill,didReject,didProgress,void 0,void 0)},Promise.prototype.done=function(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,void 0,void 0);promise._setIsFinal()},Promise.prototype.spread=function(didFulfill,didReject){var followee=this._target(),target=followee._isSpreadable()?followee===this?this:this.then():this.all();return target._then(didFulfill,didReject,void 0,APPLY,void 0)},Promise.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},Promise.prototype.toJSON=function(){var ret={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(ret.fulfillmentValue=this.value(),ret.isFulfilled=!0):this.isRejected()&&(ret.rejectionReason=this.reason(),ret.isRejected=!0),ret},Promise.prototype.all=function(){var ret=new PromiseArray(this).promise();return ret._setIsSpreadable(),ret},Promise.prototype.error=function(fn){return this.caught(originatesFromRejection,fn)},Promise.is=function(val){return val instanceof Promise},Promise.all=function(promises){var ret=new PromiseArray(promises).promise();return ret._setIsSpreadable(),ret},Promise.method=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value=tryCatch(fn).apply(this,arguments);return ret._popContext(),ret._resolveFromSyncValue(value),ret}},Promise.attempt=Promise["try"]=function(fn,args,ctx){if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value=isArray(args)?tryCatch(fn).apply(ctx,args):tryCatch(fn).call(ctx,args);return ret._popContext(),ret._resolveFromSyncValue(value),ret},Promise.defer=Promise.pending=function(){var promise=new Promise(INTERNAL);return new PromiseResolver(promise)},Promise.bind=function(thisArg){var maybePromise=tryConvertToPromise(thisArg),ret=new Promise(INTERNAL);return maybePromise instanceof Promise?maybePromise._then(function(thisArg){ret._setBoundTo(thisArg),ret._fulfill(void 0)},ret._reject,ret._progress,ret,null):(ret._setBoundTo(thisArg),ret._setFulfilled()),ret},Promise.cast=function(obj){var ret=tryConvertToPromise(obj);if(!(ret instanceof Promise)){var val=ret;ret=new Promise(INTERNAL),ret._setFulfilled(),ret._settledValue=val,ret._cleanValues()}return ret},Promise.resolve=Promise.fulfilled=Promise.cast,Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);return ret._captureStackTrace(),ret._rejectCallback(reason,!0),ret},Promise.onPossiblyUnhandledRejection=function(fn){possiblyUnhandledRejection="function"==typeof fn?fn:void 0},Promise.onUnhandledRejectionHandled=function(fn){unhandledRejectionHandled="function"==typeof fn?fn:void 0},Promise.longStackTraces=function(){if(async.haveItemsQueued()&&debugging===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");debugging=CapturedTrace.isSupported()},Promise.hasLongStackTraces=function(){return debugging&&CapturedTrace.isSupported()},Promise.setScheduler=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");async._schedule=fn},Promise.prototype._then=function(didFulfill,didReject,didProgress,receiver,internalData){var haveInternalData=void 0!==internalData,ret=haveInternalData?internalData:new Promise(INTERNAL);haveInternalData||(ret._propagateFrom(this,5),ret._captureStackTrace());var target=this._target();target!==this&&(void 0===receiver&&(receiver=this._boundTo),haveInternalData||ret._setIsMigrated());var callbackIndex=target._addCallbacks(didFulfill,didReject,didProgress,ret,receiver);return target._isResolved()&&!target._isSettlePromisesQueued()&&async.invoke(target._settlePromiseAtPostResolution,target,callbackIndex),ret},Promise.prototype._settlePromiseAtPostResolution=function(index){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(index)},Promise.prototype._length=function(){return 131071&this._bitField},Promise.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},Promise.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},Promise.prototype._setLength=function(len){this._bitField=-131072&this._bitField|131071&len},Promise.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},Promise.prototype._setRejected=function(){this._bitField=134217728|this._bitField},Promise.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},Promise.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},Promise.prototype._isFinal=function(){return(33554432&this._bitField)>0},Promise.prototype._cancellable=function(){return(67108864&this._bitField)>0},Promise.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},Promise.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},Promise.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},Promise.prototype._isSpreadable=function(){return(131072&this._bitField)>0},Promise.prototype._setIsSpreadable=function(){this._bitField=131072|this._bitField},Promise.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},Promise.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},Promise.prototype._isMigrated=function(){return(4194304&this._bitField)>0},Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},Promise.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},Promise.prototype._setCarriedStackTrace=function(capturedTrace){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=capturedTrace},Promise.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},Promise.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},Promise.prototype._receiverAt=function(index){var ret=0===index?this._receiver0:this[5*index-5+4];return this._isBound()&&void 0===ret?this._boundTo:ret},Promise.prototype._promiseAt=function(index){return 0===index?this._promise0:this[5*index-5+3]},Promise.prototype._fulfillmentHandlerAt=function(index){return 0===index?this._fulfillmentHandler0:this[5*index-5+0]},Promise.prototype._rejectionHandlerAt=function(index){return 0===index?this._rejectionHandler0:this[5*index-5+1]},Promise.prototype._migrateCallbacks=function(fulfill,reject,progress,promise,receiver){promise instanceof Promise&&promise._setIsMigrated(),this._addCallbacks(fulfill,reject,progress,promise,receiver)},Promise.prototype._addCallbacks=function(fulfill,reject,progress,promise,receiver){var index=this._length();if(index>=131066&&(index=0,this._setLength(0)),0===index)this._promise0=promise,void 0!==receiver&&(this._receiver0=receiver),"function"!=typeof fulfill||this._isCarryingStackTrace()||(this._fulfillmentHandler0=fulfill),"function"==typeof reject&&(this._rejectionHandler0=reject),"function"==typeof progress&&(this._progressHandler0=progress);else{var base=5*index-5;this[base+3]=promise,this[base+4]=receiver,"function"==typeof fulfill&&(this[base+0]=fulfill),"function"==typeof reject&&(this[base+1]=reject),"function"==typeof progress&&(this[base+2]=progress)}return this._setLength(index+1),index},Promise.prototype._setProxyHandlers=function(receiver,promiseSlotValue){var index=this._length();if(index>=131066&&(index=0,this._setLength(0)),0===index)this._promise0=promiseSlotValue,this._receiver0=receiver;else{var base=5*index-5;this[base+3]=promiseSlotValue,this[base+4]=receiver}this._setLength(index+1)},Promise.prototype._proxyPromiseArray=function(promiseArray,index){this._setProxyHandlers(promiseArray,index)},Promise.prototype._setBoundTo=function(obj){void 0!==obj?(this._bitField=8388608|this._bitField,this._boundTo=obj):this._bitField=-8388609&this._bitField},Promise.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},Promise.prototype._resolveCallback=function(value){this._tryFollow(value)||this._fulfill(value)},Promise.prototype._rejectCallback=function(reason,synchronous,shouldNotMarkOriginatingFromRejection){shouldNotMarkOriginatingFromRejection||markAsOriginatingFromRejection(reason);var trace=util.ensureErrorObject(reason),hasStack=canAttachTrace(reason)&&"string"==typeof trace.stack;this._attachExtraTrace(trace,synchronous?hasStack:!1),this._reject(reason,trace===reason?void 0:trace)},Promise.prototype._resolveFromResolver=function(resolver){var promise=this;this._captureStackTrace(),this._pushContext();var synchronous=!0,r=tryCatch(resolver)(function(value){promise._resolveCallback(value)},function(reason){promise._rejectCallback(reason,synchronous)});synchronous=!1,this._popContext(),void 0!==r&&r===errorObj&&promise._rejectCallback(r.e,!0,!0)},Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){if(!promise._isRejected()){promise._pushContext();var x;if(x=receiver!==APPLY||this._isRejected()?tryCatch(handler).call(receiver,value):tryCatch(handler).apply(this._boundTo,value),promise._popContext(),x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e;promise._rejectCallback(err,!1,!0)}else promise._resolveCallback(x)}},Promise.prototype._target=function(){for(var ret=this;ret._isFollowing();)ret=ret._followee();return ret},Promise.prototype._followee=function(){return this._rejectionHandler0},Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise},Promise.prototype._follow=function(promise){if(promise._isPending()){for(var len=this._length(),i=0;len>i;++i)promise._migrateCallbacks(this._fulfillmentHandlerAt(i),this._rejectionHandlerAt(i),this._progressHandlerAt(i),this._promiseAt(i),this._receiverAt(i));this._setFollowing(),this._setLength(0),this._setFollowee(promise),this._propagateFrom(promise,1)}else promise._isFulfilled()?this._fulfillUnchecked(promise._value()):this._rejectUnchecked(promise._reason(),promise._getCarriedStackTrace());promise._isRejectionUnhandled()&&promise._unsetRejectionIsUnhandled()},Promise.prototype._tryFollow=function(value){if(this._isFollowingOrFulfilledOrRejected()||value===this)return!1;var maybePromise=tryConvertToPromise(value,this);return maybePromise instanceof Promise?(this._follow(maybePromise._target()),!0):!1},Promise.prototype._captureStackTrace=function(){return debugging&&(this._trace=new CapturedTrace(this._peekContext())),this},Promise.prototype._canAttachTrace=function(error){return debugging&&canAttachTrace(error)},Promise.prototype._attachExtraTraceIgnoreSelf=function(error){this._canAttachTrace(error)&&void 0!==this._trace._parent&&this._trace._parent.attachExtraTrace(error)},Promise.prototype._attachExtraTrace=function(error,ignoreSelf){if(debugging&&canAttachTrace(error)){var trace=this._trace;void 0!==trace&&ignoreSelf&&(trace=trace._parent),void 0!==trace?trace.attachExtraTrace(error):CapturedTrace.cleanHeaderStack(error,!0)}},Promise.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},Promise.prototype._propagateFrom=function(parent,flags){(1&flags)>0&&parent._cancellable()&&(this._setCancellable(),this._cancellationParent=parent),(4&flags)>0&&this._setBoundTo(parent._boundTo)},Promise.prototype._fulfill=function(value){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(value)},Promise.prototype._reject=function(reason,carriedStackTrace){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(reason,carriedStackTrace)},Promise.prototype._settlePromiseAt=function(index){var promise=this._promiseAt(index),isPromise=promise instanceof Promise;if(isPromise&&promise._isMigrated())return promise._unsetIsMigrated(),async.invoke(this._settlePromiseAt,this,index);var handler=this._isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index),carriedStackTrace=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,value=this._settledValue,receiver=this._receiverAt(index);this._clearCallbackDataAtIndex(index),"function"==typeof handler?isPromise?this._settlePromiseFromHandler(handler,receiver,value,promise):handler.call(receiver,value,promise):receiver instanceof PromiseArray?receiver._isResolved()||(this._isFulfilled()?receiver._promiseFulfilled(value,promise):receiver._promiseRejected(value,promise)):isPromise&&(this._isFulfilled()?promise._fulfill(value):promise._reject(value,carriedStackTrace)),index>=4&&4===(31&index)&&async.invokeLater(this._setLength,this,0)},Promise.prototype._clearCallbackDataAtIndex=function(index){if(0===index)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var base=5*index-5;this[base+3]=this[base+4]=this[base+0]=this[base+1]=this[base+2]=void 0}},Promise.prototype._isSettlePromisesQueued=function(){return-1073741824===(-1073741824&this._bitField)},Promise.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},Promise.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},Promise.prototype._queueSettlePromises=function(){this._isSettlePromisesQueued()||(async.settlePromises(this),this._setSettlePromisesQueued())},Promise.prototype._fulfillUnchecked=function(value){if(value===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._rejectUnchecked(err,void 0)}this._setFulfilled(),this._settledValue=value,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},Promise.prototype._rejectUncheckedCheckError=function(reason){var trace=util.ensureErrorObject(reason);this._rejectUnchecked(reason,trace===reason?void 0:trace)},Promise.prototype._rejectUnchecked=function(reason,trace){if(reason===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._rejectUnchecked(err)}return this._setRejected(),this._settledValue=reason,this._cleanValues(),this._isFinal()?void async.throwLater(function(e){throw"stack"in e&&async.invokeFirst(CapturedTrace.unhandledRejection,void 0,e),e},void 0===trace?reason:trace):(void 0!==trace&&trace!==reason&&this._setCarriedStackTrace(trace),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},Promise.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var len=this._length(),i=0;len>i;i++)this._settlePromiseAt(i)},Promise.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),async.invokeLater(this._notifyUnhandledRejection,this,void 0)},Promise.prototype._notifyUnhandledRejectionIsHandled=function(){CapturedTrace.fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,void 0,this)},Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),CapturedTrace.fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this)}};var contextStack=[];return Context.prototype._pushContext=function(){debugging&&void 0!==this._trace&&contextStack.push(this._trace)},Context.prototype._popContext=function(){debugging&&void 0!==this._trace&&contextStack.pop()},Promise.prototype._peekContext=peekContext,Promise.prototype._pushContext=Context.prototype._pushContext,Promise.prototype._popContext=Context.prototype._popContext,Promise.prototype._resolveFromSyncValue=function(value){if(value===errorObj){this._setRejected();var reason=value.e;this._settledValue=reason,this._cleanValues(),this._attachExtraTrace(reason),this._ensurePossibleRejectionHandled()}else{var maybePromise=tryConvertToPromise(value,this);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),this._follow(maybePromise)):(this._setFulfilled(),this._settledValue=value,this._cleanValues())}},CapturedTrace.isSupported()||(Promise.longStackTraces=function(){},debugging=!1),Promise._makeSelfResolutionError=makeSelfResolutionError,require("./finally.js")(Promise,NEXT_FILTER,tryConvertToPromise),require("./direct_resolve.js")(Promise),require("./synchronous_inspection.js")(Promise),require("./join.js")(Promise,PromiseArray,tryConvertToPromise,INTERNAL),Promise.RangeError=RangeError,Promise.CancellationError=CancellationError,Promise.TimeoutError=TimeoutError,Promise.TypeError=TypeError,Promise.OperationalError=OperationalError,Promise.RejectionError=OperationalError,Promise.AggregateError=errors.AggregateError,util.toFastProperties(Promise),util.toFastProperties(Promise.prototype),Promise.Promise=Promise,CapturedTrace.setBounds(async.firstLineError,util.lastLineError),require("./nodeify.js")(Promise),require("./using.js")(Promise,apiRejection,tryConvertToPromise,createContext),require("./generators.js")(Promise,apiRejection,INTERNAL,tryConvertToPromise),require("./map.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL),require("./cancel.js")(Promise,INTERNAL),require("./promisify.js")(Promise,INTERNAL),require("./props.js")(Promise,PromiseArray,tryConvertToPromise,apiRejection),require("./race.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection),require("./reduce.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL),require("./settle.js")(Promise,PromiseArray),require("./call_get.js")(Promise),require("./some.js")(Promise,PromiseArray,apiRejection),require("./progress.js")(Promise,PromiseArray),require("./any.js")(Promise),require("./each.js")(Promise,INTERNAL),require("./timers.js")(Promise,INTERNAL,tryConvertToPromise),require("./filter.js")(Promise,INTERNAL),Promise.prototype=Promise.prototype,Promise}},{"./any.js":2,"./async.js":3,"./call_get.js":4,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./direct_resolve.js":8,"./each.js":9,"./errors.js":10,"./filter.js":12,"./finally.js":13,"./generators.js":14,"./join.js":15,"./map.js":16,"./nodeify.js":17,"./progress.js":18,"./promise_array.js":20,"./promise_resolver.js":21,"./promisify.js":22,"./props.js":23,"./race.js":25,"./reduce.js":26,"./settle.js":28,"./some.js":29,"./synchronous_inspection.js":30,"./thenables.js":31,"./timers.js":32,"./using.js":33,"./util.js":34}],20:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){function toResolutionValue(val){switch(val){case-1:return;case-2:return[];case-3:return{}}}function PromiseArray(values){var parent,promise=this._promise=new Promise(INTERNAL);values instanceof Promise&&(parent=values,promise._propagateFrom(parent,5)),this._values=values,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var util=require("./util.js"),isArray=util.isArray;return PromiseArray.prototype.length=function(){return this._length},PromiseArray.prototype.promise=function(){return this._promise},PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,this._promise);if(values instanceof Promise){if(values._setBoundTo(this._promise._boundTo),values=values._target(),this._values=values,!values._isFulfilled())return values._isPending()?void values._then(init,this._reject,void 0,this,resolveValueIfEmpty):void this._reject(values._reason());if(values=values._value(),!isArray(values)){var err=new Promise.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(err)}}else if(!isArray(values))return void this._promise._follow(apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n"));if(0===values.length)return void(-5===resolveValueIfEmpty?this._resolveEmptyArray():this._resolve(toResolutionValue(resolveValueIfEmpty)));var len=this.getActualLength(values.length);this._length=len,this._values=this.shouldCopyValues()?new Array(len):this._values;for(var promise=this._promise,i=0;len>i;++i){var isResolved=this._isResolved(),maybePromise=tryConvertToPromise(values[i],promise);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),isResolved?maybePromise._unsetRejectionIsUnhandled():maybePromise._isPending()?maybePromise._proxyPromiseArray(this,i):maybePromise._isFulfilled()?this._promiseFulfilled(maybePromise._value(),i):this._promiseRejected(maybePromise._reason(),i)):isResolved||this._promiseFulfilled(maybePromise,i)}},PromiseArray.prototype._isResolved=function(){return null===this._values},PromiseArray.prototype._resolve=function(value){this._values=null,this._promise._fulfill(value)},PromiseArray.prototype.__hardReject__=PromiseArray.prototype._reject=function(reason){this._values=null,this._promise._rejectCallback(reason,!1,!0)},PromiseArray.prototype._promiseProgressed=function(progressValue,index){this._promise._progress({index:index,value:progressValue})},PromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;totalResolved>=this._length&&this._resolve(this._values)},PromiseArray.prototype._promiseRejected=function(reason,index){this._totalResolved++,this._reject(reason)},PromiseArray.prototype.shouldCopyValues=function(){return!0},PromiseArray.prototype.getActualLength=function(len){return len},PromiseArray}},{"./util.js":34}],21:[function(require,module,exports){"use strict";function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj),ret.name=obj.name,ret.message=obj.message,
ret.stack=obj.stack;for(var keys=es5.keys(obj),i=0;i<keys.length;++i){var key=keys[i];rErrorKey.test(key)||(ret[key]=obj[key])}return ret}return util.markAsOriginatingFromRejection(obj),obj}function nodebackForPromise(promise){return function(err,value){if(null!==promise){if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped),promise._reject(wrapped)}else if(arguments.length>2){for(var $_len=arguments.length,args=new Array($_len-1),$_i=1;$_len>$_i;++$_i)args[$_i-1]=arguments[$_i];promise._fulfill(args)}else promise._fulfill(value);promise=null}}}var PromiseResolver,util=require("./util.js"),maybeWrapAsError=util.maybeWrapAsError,errors=require("./errors.js"),TimeoutError=errors.TimeoutError,OperationalError=errors.OperationalError,haveGetters=util.haveGetters,es5=require("./es5.js"),rErrorKey=/^(?:name|message|stack|cause)$/;if(PromiseResolver=haveGetters?function(promise){this.promise=promise}:function(promise){this.promise=promise,this.asCallback=nodebackForPromise(promise),this.callback=this.asCallback},haveGetters){var prop={get:function(){return nodebackForPromise(this.promise)}};es5.defineProperty(PromiseResolver.prototype,"asCallback",prop),es5.defineProperty(PromiseResolver.prototype,"callback",prop)}PromiseResolver._nodebackForPromise=nodebackForPromise,PromiseResolver.prototype.toString=function(){return"[object PromiseResolver]"},PromiseResolver.prototype.resolve=PromiseResolver.prototype.fulfill=function(value){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._resolveCallback(value)},PromiseResolver.prototype.reject=function(reason){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._rejectCallback(reason)},PromiseResolver.prototype.progress=function(value){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._progress(value)},PromiseResolver.prototype.cancel=function(){this.promise.cancel()},PromiseResolver.prototype.timeout=function(){this.reject(new TimeoutError("timeout"))},PromiseResolver.prototype.isResolved=function(){return this.promise.isResolved()},PromiseResolver.prototype.toJSON=function(){return this.promise.toJSON()},module.exports=PromiseResolver},{"./errors.js":10,"./es5.js":11,"./util.js":34}],22:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function escapeIdentRegex(str){return str.replace(/([$])/,"\\$")}function isPromisified(fn){try{return fn.__isPromisified__===!0}catch(e){return!1}}function hasPromisified(obj,key,suffix){var val=util.getDataPropertyOrDefault(obj,key+suffix,defaultPromisified);return val?isPromisified(val):!1}function checkValid(ret,suffix,suffixRegexp){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(suffixRegexp.test(key))for(var keyWithoutAsyncSuffix=key.replace(suffixRegexp,""),j=0;j<ret.length;j+=2)if(ret[j]===keyWithoutAsyncSuffix)throw new TypeError("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",suffix))}}function promisifiableMethods(obj,suffix,suffixRegexp,filter){for(var keys=util.inheritedDataKeys(obj),ret=[],i=0;i<keys.length;++i){var key=keys[i],value=obj[key],passesDefaultFilter=filter===defaultFilter?!0:defaultFilter(key,value,obj);"function"!=typeof value||isPromisified(value)||hasPromisified(obj,key,suffix)||!filter(key,value,obj,passesDefaultFilter)||ret.push(key,value)}return checkValid(ret,suffix,suffixRegexp),ret}function switchCaseArgumentOrder(likelyArgumentCount){for(var ret=[likelyArgumentCount],min=Math.max(0,likelyArgumentCount-1-5),i=likelyArgumentCount-1;i>=min;--i)i!==likelyArgumentCount&&ret.push(i);for(var i=likelyArgumentCount+1;5>=i;++i)ret.push(i);return ret}function argumentSequence(argumentCount){return util.filledRange(argumentCount,"arguments[","]")}function parameterDeclaration(parameterCount){return util.filledRange(parameterCount,"_arg","")}function parameterCount(fn){return"number"==typeof fn.length?Math.max(Math.min(fn.length,1024),0):0}function generatePropertyAccess(key){return util.isIdentifier(key)?"."+key:"['"+key.replace(/(['\\])/g,"\\$1")+"']"}function makeNodePromisifiedEval(callback,receiver,originalName,fn,suffix){function generateCallForArgumentCount(count){var ret,args=argumentSequence(count).join(", "),comma=count>0?", ":"";return ret="string"==typeof callback?"                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",generatePropertyAccess(callback)):receiver===THIS?"                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":void 0!==receiver?"                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":"                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",ret.replace("{{args}}",args).replace(", ",comma)}function generateArgumentSwitchCase(){for(var ret="",i=0;i<argumentOrder.length;++i)ret+="case "+argumentOrder[i]+":"+generateCallForArgumentCount(argumentOrder[i]);var codeForCall;return codeForCall="string"==typeof callback?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",generatePropertyAccess(callback)):receiver===THIS?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",ret+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",codeForCall)}var newParameterCount=Math.max(0,parameterCount(fn)-1),argumentOrder=switchCaseArgumentOrder(newParameterCount),callbackName="string"==typeof originalName&&util.isIdentifier(originalName)?originalName+suffix:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function (Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            promise._setIsSpreadable();                                      \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",callbackName).replace("Parameters",parameterDeclaration(newParameterCount)).replace("[CodeForSwitchCase]",generateArgumentSwitchCase()))(Promise,callback,receiver,withAppended,maybeWrapAsError,nodebackForPromise,INTERNAL)}function makeNodePromisifiedClosure(callback,receiver){function promisified(){var _receiver=receiver;receiver===THIS&&(_receiver=this),"string"==typeof callback&&(callback=_receiver[callback]);var promise=new Promise(INTERNAL);promise._captureStackTrace(),promise._setIsSpreadable();var fn=nodebackForPromise(promise);try{callback.apply(_receiver,withAppended(arguments,fn))}catch(e){var wrapped=maybeWrapAsError(e);promise._attachExtraTrace(wrapped),promise._reject(wrapped)}return promise}return promisified.__isPromisified__=!0,promisified}function promisifyAll(obj,suffix,filter,promisifier){for(var suffixRegexp=new RegExp(escapeIdentRegex(suffix)+"$"),methods=promisifiableMethods(obj,suffix,suffixRegexp,filter),i=0,len=methods.length;len>i;i+=2){var key=methods[i],fn=methods[i+1],promisifiedKey=key+suffix;obj[promisifiedKey]=promisifier===makeNodePromisified?makeNodePromisified(key,THIS,key,fn,suffix):promisifier(fn,function(){return makeNodePromisified(key,THIS,key,fn,suffix)})}return util.toFastProperties(obj),obj}function promisify(callback,receiver){return makeNodePromisified(callback,receiver,void 0,callback)}var THIS={},util=require("./util.js"),nodebackForPromise=require("./promise_resolver.js")._nodebackForPromise,withAppended=util.withAppended,maybeWrapAsError=util.maybeWrapAsError,canEvaluate=util.canEvaluate,TypeError=require("./errors").TypeError,defaultSuffix="Async",defaultFilter=function(name,func){return util.isIdentifier(name)&&"_"!==name.charAt(0)&&!util.isClass(func)},defaultPromisified={__isPromisified__:!0},makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;Promise.promisify=function(fn,receiver){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return isPromisified(fn)?fn:promisify(fn,arguments.length<2?THIS:receiver)},Promise.promisifyAll=function(target,options){if("function"!=typeof target&&"object"!=typeof target)throw new TypeError("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");options=Object(options);var suffix=options.suffix;"string"!=typeof suffix&&(suffix=defaultSuffix);var filter=options.filter;"function"!=typeof filter&&(filter=defaultFilter);var promisifier=options.promisifier;if("function"!=typeof promisifier&&(promisifier=makeNodePromisified),!util.isIdentifier(suffix))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var keys=util.inheritedDataKeys(target,{includeHidden:!0}),i=0;i<keys.length;++i){var value=target[keys[i]];"constructor"!==keys[i]&&util.isClass(value)&&(promisifyAll(value.prototype,suffix,filter,promisifier),promisifyAll(value,suffix,filter,promisifier))}return promisifyAll(target,suffix,filter,promisifier)}}},{"./errors":10,"./promise_resolver.js":21,"./util.js":34}],23:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,apiRejection){function PropertiesPromiseArray(obj){for(var keys=es5.keys(obj),len=keys.length,values=new Array(2*len),i=0;len>i;++i){var key=keys[i];values[i]=obj[key],values[i+len]=key}this.constructor$(values)}function props(promises){var ret,castValue=tryConvertToPromise(promises);return isObject(castValue)?(ret=castValue instanceof Promise?castValue._then(Promise.props,void 0,void 0,void 0,void 0):new PropertiesPromiseArray(castValue).promise(),castValue instanceof Promise&&ret._propagateFrom(castValue,4),ret):apiRejection("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var util=require("./util.js"),isObject=util.isObject,es5=require("./es5.js");util.inherits(PropertiesPromiseArray,PromiseArray),PropertiesPromiseArray.prototype._init=function(){this._init$(void 0,-3)},PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){for(var val={},keyOffset=this.length(),i=0,len=this.length();len>i;++i)val[this._values[i+keyOffset]]=this._values[i];this._resolve(val)}},PropertiesPromiseArray.prototype._promiseProgressed=function(value,index){this._promise._progress({key:this._values[index+this.length()],value:value})},PropertiesPromiseArray.prototype.shouldCopyValues=function(){return!1},PropertiesPromiseArray.prototype.getActualLength=function(len){return len>>1},Promise.prototype.props=function(){return props(this)},Promise.props=function(promises){return props(promises)}}},{"./es5.js":11,"./util.js":34}],24:[function(require,module,exports){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;len>j;++j)dst[j+dstIndex]=src[j+srcIndex],src[j+srcIndex]=void 0}function Queue(capacity){this._capacity=capacity,this._length=0,this._front=0}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size},Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1);var i=this._front+length&this._capacity-1;this[i]=arg,this._length=length+1},Queue.prototype._unshiftOne=function(value){var capacity=this._capacity;this._checkCapacity(this.length()+1);var front=this._front,i=(front-1&capacity-1^capacity)-capacity;this[i]=value,this._front=i,this._length=this.length()+1},Queue.prototype.unshift=function(fn,receiver,arg){this._unshiftOne(arg),this._unshiftOne(receiver),this._unshiftOne(fn)},Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length))return this._pushOne(fn),this._pushOne(receiver),void this._pushOne(arg);var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn,this[j+1&wrapMask]=receiver,this[j+2&wrapMask]=arg,this._length=length},Queue.prototype.shift=function(){var front=this._front,ret=this[front];return this[front]=void 0,this._front=front+1&this._capacity-1,this._length--,ret},Queue.prototype.length=function(){return this._length},Queue.prototype._checkCapacity=function(size){this._capacity<size&&this._resizeTo(this._capacity<<1)},Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity;var front=this._front,length=this._length;if(front+length>oldCapacity){var moveItemsCount=front+length&oldCapacity-1;arrayMove(this,0,this,oldCapacity,moveItemsCount)}},module.exports=Queue},{}],25:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){function race(promises,parent){var maybePromise=tryConvertToPromise(promises);if(maybePromise instanceof Promise)return raceLater(maybePromise);if(!isArray(promises))return apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var ret=new Promise(INTERNAL);void 0!==parent&&ret._propagateFrom(parent,5);for(var fulfill=ret._fulfill,reject=ret._reject,i=0,len=promises.length;len>i;++i){var val=promises[i];(void 0!==val||i in promises)&&Promise.cast(val)._then(fulfill,reject,void 0,ret,null)}return ret}var isArray=require("./util.js").isArray,raceLater=function(promise){return promise.then(function(array){return race(array,promise)})};Promise.race=function(promises){return race(promises,void 0)},Promise.prototype.race=function(){return race(this,void 0)}}},{"./util.js":34}],26:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){function ReductionPromiseArray(promises,fn,accum,_each){this.constructor$(promises),this._promise._captureStackTrace(),this._preservedValues=_each===INTERNAL?[]:null,this._zerothIsAccum=void 0===accum,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var maybePromise=tryConvertToPromise(accum,this._promise),rejected=!1,isPromise=maybePromise instanceof Promise;isPromise&&(maybePromise=maybePromise._target(),maybePromise._isPending()?maybePromise._proxyPromiseArray(this,-1):maybePromise._isFulfilled()?(accum=maybePromise._value(),this._gotAccum=!0):(this._reject(maybePromise._reason()),rejected=!0)),isPromise||this._zerothIsAccum||(this._gotAccum=!0),this._callback=fn,this._accum=accum,rejected||this._init$(void 0,-5)}function reduce(promises,fn,initialValue,_each){if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var array=new ReductionPromiseArray(promises,fn,initialValue,_each);return array.promise()}var util=require("./util.js"),tryCatch=util.tryCatch,errorObj=util.errorObj;util.inherits(ReductionPromiseArray,PromiseArray),ReductionPromiseArray.prototype._init=function(){},ReductionPromiseArray.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},ReductionPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values;values[index]=value;var valuesPhaseIndex,length=this.length(),preservedValues=this._preservedValues,isEach=null!==preservedValues,gotAccum=this._gotAccum,valuesPhase=this._valuesPhase;if(!valuesPhase)for(valuesPhase=this._valuesPhase=Array(length),valuesPhaseIndex=0;length>valuesPhaseIndex;++valuesPhaseIndex)valuesPhase[valuesPhaseIndex]=0;if(valuesPhaseIndex=valuesPhase[index],0===index&&this._zerothIsAccum?(gotAccum||(this._accum=value,this._gotAccum=gotAccum=!0),valuesPhase[index]=0===valuesPhaseIndex?1:2):-1===index?gotAccum||(this._accum=value,this._gotAccum=gotAccum=!0):0===valuesPhaseIndex?valuesPhase[index]=1:(valuesPhase[index]=2,gotAccum&&(this._accum=value)),gotAccum){for(var ret,callback=this._callback,receiver=this._promise._boundTo,i=this._reducingIndex;length>i;++i)if(valuesPhaseIndex=valuesPhase[i],2!==valuesPhaseIndex){if(1!==valuesPhaseIndex)return;if(value=values[i],value instanceof Promise){if(value=value._target(),!value._isFulfilled())return value._isPending()?void 0:this._reject(value._reason());value=value._value()}if(this._promise._pushContext(),isEach?(preservedValues.push(value),ret=tryCatch(callback).call(receiver,value,i,length)):ret=tryCatch(callback).call(receiver,this._accum,value,i,length),this._promise._popContext(),ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){if(maybePromise=maybePromise._target(),maybePromise._isPending())return valuesPhase[i]=4,maybePromise._proxyPromiseArray(this,i);if(!maybePromise._isFulfilled())return this._reject(maybePromise._reason());ret=maybePromise._value()}this._reducingIndex=i+1,this._accum=ret}else this._reducingIndex=i+1;this._reducingIndex<length||this._resolve(isEach?preservedValues:this._accum)}},Promise.prototype.reduce=function(fn,initialValue){return reduce(this,fn,initialValue,null)},Promise.reduce=function(promises,fn,initialValue,_each){return reduce(promises,fn,initialValue,_each)}}},{"./util.js":34}],27:[function(require,module,exports){"use strict";var schedule;"object"==typeof process&&"string"==typeof process.version?schedule=parseInt(process.version.split(".")[1],10)>10?setImmediate:process.nextTick:"undefined"!=typeof MutationObserver?(schedule=function(fn){var div=document.createElement("div"),observer=new MutationObserver(fn);return observer.observe(div,{attributes:!0}),function(){div.classList.toggle("foo")}},schedule.isStatic=!0):schedule="undefined"!=typeof setTimeout?function(fn){setTimeout(fn,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")},module.exports=schedule},{}],28:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray){function SettledPromiseArray(values){this.constructor$(values),this._promise._setIsSpreadable()}var PromiseInspection=Promise.PromiseInspection,util=require("./util.js");util.inherits(SettledPromiseArray,PromiseArray),SettledPromiseArray.prototype._promiseResolved=function(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;totalResolved>=this._length&&this._resolve(this._values)},SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection;ret._bitField=268435456,ret._settledValue=value,this._promiseResolved(index,ret)},SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection;ret._bitField=134217728,ret._settledValue=reason,this._promiseResolved(index,ret)},Promise.settle=function(promises){return new SettledPromiseArray(promises).promise()},Promise.prototype.settle=function(){return new SettledPromiseArray(this).promise()}}},{"./util.js":34}],29:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){function SomePromiseArray(values){this.constructor$(values),this._howMany=0,this._unwrap=!1,this._initialized=!1}function some(promises,howMany){if((0|howMany)!==howMany||0>howMany)return apiRejection("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var ret=new SomePromiseArray(promises),promise=ret.promise();return promise.isRejected()?promise:(ret.setHowMany(howMany),ret.init(),promise)}var util=require("./util.js"),RangeError=require("./errors.js").RangeError,AggregateError=require("./errors.js").AggregateError,isArray=util.isArray;util.inherits(SomePromiseArray,PromiseArray),SomePromiseArray.prototype._init=function(){if(this._initialized){if(this._promise._setIsSpreadable(),0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var isArrayResolved=isArray(this._values);!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},SomePromiseArray.prototype.init=function(){this._initialized=!0,this._init()},SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=!0},SomePromiseArray.prototype.howMany=function(){return this._howMany},SomePromiseArray.prototype.setHowMany=function(count){this._isResolved()||(this._howMany=count)},SomePromiseArray.prototype._promiseFulfilled=function(value){this._addFulfilled(value),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},SomePromiseArray.prototype._promiseRejected=function(reason){if(this._addRejected(reason),this.howMany()>this._canPossiblyFulfill()){for(var e=new AggregateError,i=this.length();i<this._values.length;++i)e.push(this._values[i]);this._reject(e)}},SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved},SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()},SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)},SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value},SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},SomePromiseArray.prototype._getRangeError=function(count){var message="Input array must contain at least "+this._howMany+" items but contains only "+count+" items";return new RangeError(message)},SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},Promise.some=function(promises,howMany){return some(promises,howMany)},Promise.prototype.some=function(howMany){return some(this,howMany)},Promise._SomePromiseArray=SomePromiseArray}},{"./errors.js":10,"./util.js":34}],30:[function(require,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){void 0!==promise?(promise=promise._target(),this._bitField=promise._bitField,this._settledValue=promise._settledValue):(this._bitField=0,this._settledValue=void 0)}PromiseInspection.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},PromiseInspection.prototype.isFulfilled=Promise.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},PromiseInspection.prototype.isRejected=Promise.prototype._isRejected=function(){return(134217728&this._bitField)>0},PromiseInspection.prototype.isPending=Promise.prototype._isPending=function(){return 0===(402653184&this._bitField)},PromiseInspection.prototype.isResolved=Promise.prototype._isResolved=function(){return(402653184&this._bitField)>0},Promise.prototype.isPending=function(){return this._target()._isPending()},Promise.prototype.isRejected=function(){return this._target()._isRejected()},Promise.prototype.isFulfilled=function(){return this._target()._isFulfilled()},Promise.prototype.isResolved=function(){return this._target()._isResolved()},Promise.prototype._value=function(){return this._settledValue},Promise.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},Promise.prototype.value=function(){var target=this._target();if(!target.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return target._settledValue},Promise.prototype.reason=function(){var target=this._target();if(!target.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return target._settledValue},Promise.PromiseInspection=PromiseInspection}},{}],31:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function tryConvertToPromise(obj,context){if(isObject(obj)){if(obj instanceof Promise)return obj;if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);return obj._then(ret._fulfillUnchecked,ret._rejectUncheckedCheckError,ret._progressUnchecked,ret,null),ret}var then=util.tryCatch(getThen)(obj);if(then===errorObj){context&&context._pushContext();var ret=Promise.reject(then.e);return context&&context._popContext(),ret}if("function"==typeof then)return doThenable(obj,then,context)}return obj}function getThen(obj){return obj.then}function isAnyBluebirdPromise(obj){return hasProp.call(obj,"_promise0")}function doThenable(x,then,context){function resolveFromThenable(value){return x===value?promise._rejectCallback(Promise._makeSelfResolutionError(),!1,!0):void promise._resolveCallback(value)}function rejectFromThenable(reason){promise._rejectCallback(reason,synchronous,!0)}function progressFromThenable(value){"function"==typeof promise._progress&&promise._progress(value)}var promise=new Promise(INTERNAL);context&&context._pushContext(),promise._captureStackTrace(),context&&context._popContext();var synchronous=!0,result=util.tryCatch(then).call(x,resolveFromThenable,rejectFromThenable,progressFromThenable);return synchronous=!1,result===errorObj&&promise._rejectCallback(result.e,!0,!0),promise}var util=require("./util.js"),errorObj=util.errorObj,isObject=util.isObject,hasProp={}.hasOwnProperty;return tryConvertToPromise}},{"./util.js":34}],32:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise){function successClear(value){var handle=this;return handle instanceof Number&&(handle=+handle),clearTimeout(handle),value}function failureClear(reason){var handle=this;throw handle instanceof Number&&(handle=+handle),clearTimeout(handle),reason}var util=require("./util.js"),TimeoutError=Promise.TimeoutError,afterTimeout=function(promise,message){if(promise.isPending()){"string"!=typeof message&&(message="operation timed out");var err=new TimeoutError(message);util.markAsOriginatingFromRejection(err),promise._attachExtraTrace(err),promise._cancel(err)}},afterDelay=function(value,promise){promise._fulfill(value)},delay=Promise.delay=function(value,ms){void 0===ms&&(ms=value,value=void 0),ms=+ms;var maybePromise=tryConvertToPromise(value),promise=new Promise(INTERNAL);return maybePromise instanceof Promise?(promise._propagateFrom(maybePromise,5),promise._follow(maybePromise._target()),promise.then(function(value){return Promise.delay(value,ms)})):(setTimeout(function(){afterDelay(value,promise)},ms),promise)};Promise.prototype.delay=function(ms){return delay(this,ms)},Promise.prototype.timeout=function(ms,message){var target=this._target();ms=+ms;var ret=new Promise(INTERNAL).cancellable();ret._propagateFrom(this,5),ret._follow(target);var handle=setTimeout(function(){afterTimeout(ret,message)},ms);return ret._then(successClear,failureClear,void 0,handle,void 0)}}},{"./util.js":34}],33:[function(require,module,exports){"use strict";module.exports=function(Promise,apiRejection,tryConvertToPromise,createContext){function inspectionMapper(inspections){for(var len=inspections.length,i=0;len>i;++i){var inspection=inspections[i];if(inspection.isRejected())return Promise.reject(inspection.error());inspections[i]=inspection._settledValue}return inspections}function thrower(e){setTimeout(function(){throw e},0)}function castPreservingDisposable(thenable){var maybePromise=tryConvertToPromise(thenable);return maybePromise!==thenable&&"function"==typeof thenable._isDisposable&&"function"==typeof thenable._getDisposer&&thenable._isDisposable()&&maybePromise._setDisposable(thenable._getDisposer()),maybePromise}function dispose(resources,inspection){function iterator(){if(i>=len)return ret.resolve();var maybePromise=castPreservingDisposable(resources[i++]);if(maybePromise instanceof Promise&&maybePromise._isDisposable()){try{maybePromise=tryConvertToPromise(maybePromise._getDisposer().tryDispose(inspection),resources.promise)}catch(e){return thrower(e)}if(maybePromise instanceof Promise)return maybePromise._then(iterator,thrower,null,null,null)}iterator()}var i=0,len=resources.length,ret=Promise.defer();return iterator(),ret.promise}function disposerSuccess(value){var inspection=new PromiseInspection;return inspection._settledValue=value,inspection._bitField=268435456,dispose(this,inspection).thenReturn(value)}function disposerFail(reason){var inspection=new PromiseInspection;return inspection._settledValue=reason,inspection._bitField=134217728,dispose(this,inspection).thenThrow(reason)}function Disposer(data,promise,context){
this._data=data,this._promise=promise,this._context=context}function FunctionDisposer(fn,promise){this.constructor$(fn,promise)}function maybeUnwrapDisposer(value){return Disposer.isDisposer(value)?(this.resources[this.index]._setDisposable(value),value.promise()):value}var TypeError=require("./errors.js").TypeError,inherits=require("./util.js").inherits,PromiseInspection=Promise.PromiseInspection;Disposer.prototype.data=function(){return this._data},Disposer.prototype.promise=function(){return this._promise},Disposer.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},Disposer.prototype.tryDispose=function(inspection){var resource=this.resource(),context=this._context;void 0!==context&&context._pushContext();var ret=null!==resource?this.doDispose(resource,inspection):null;return void 0!==context&&context._popContext(),this._promise._unsetDisposable(),this._data=null,ret},Disposer.isDisposer=function(d){return null!=d&&"function"==typeof d.resource&&"function"==typeof d.tryDispose},inherits(FunctionDisposer,Disposer),FunctionDisposer.prototype.doDispose=function(resource,inspection){var fn=this.data();return fn.call(resource,resource,inspection)},Promise.using=function(){var len=arguments.length;if(2>len)return apiRejection("you must pass at least 2 arguments to Promise.using");var fn=arguments[len-1];if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");len--;for(var resources=new Array(len),i=0;len>i;++i){var resource=arguments[i];if(Disposer.isDisposer(resource)){var disposer=resource;resource=resource.promise(),resource._setDisposable(disposer)}else{var maybePromise=tryConvertToPromise(resource);maybePromise instanceof Promise&&(resource=maybePromise._then(maybeUnwrapDisposer,null,null,{resources:resources,index:i},void 0))}resources[i]=resource}var promise=Promise.settle(resources).then(inspectionMapper).then(function(vals){promise._pushContext();var ret;try{ret=fn.apply(void 0,vals)}finally{promise._popContext()}return ret})._then(disposerSuccess,disposerFail,void 0,resources,void 0);return resources.promise=promise,promise},Promise.prototype._setDisposable=function(disposer){this._bitField=262144|this._bitField,this._disposer=disposer},Promise.prototype._isDisposable=function(){return(262144&this._bitField)>0},Promise.prototype._getDisposer=function(){return this._disposer},Promise.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},Promise.prototype.disposer=function(fn){if("function"==typeof fn)return new FunctionDisposer(fn,this,createContext());throw new TypeError}}},{"./errors.js":10,"./util.js":34}],34:[function(require,module,exports){"use strict";function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){return errorObj.e=e,errorObj}}function tryCatch(fn){return tryCatchTarget=fn,tryCatcher}function asString(val){return"string"==typeof val?val:""+val}function isPrimitive(val){return null==val||val===!0||val===!1||"string"==typeof val||"number"==typeof val}function isObject(value){return!isPrimitive(value)}function maybeWrapAsError(maybeError){return isPrimitive(maybeError)?new Error(asString(maybeError)):maybeError}function withAppended(target,appendee){var i,len=target.length,ret=new Array(len+1);for(i=0;len>i;++i)ret[i]=target[i];return ret[i]=appendee,ret}function getDataPropertyOrDefault(obj,key,defaultValue){if(!es5.isES5)return{}.hasOwnProperty.call(obj,key)?obj[key]:void 0;var desc=Object.getOwnPropertyDescriptor(obj,key);return null!=desc?null==desc.get&&null==desc.set?desc.value:defaultValue:void 0}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(obj,name,descriptor),obj}function thrower(r){throw r}function isClass(fn){try{if("function"==typeof fn){var keys=es5.keys(fn.prototype);return keys.length>0&&!(1===keys.length&&"constructor"===keys[0])}return!1}catch(e){return!1}}function toFastProperties(obj){function f(){}return f.prototype=obj,f}function isIdentifier(str){return rident.test(str)}function filledRange(count,prefix,suffix){for(var ret=new Array(count),i=0;count>i;++i)ret[i]=prefix+i+suffix;return ret}function safeToString(obj){try{return obj+""}catch(e){return"[no string representation]"}}function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",!0)}catch(ignore){}}function originatesFromRejection(e){return null==e?!1:e instanceof Error.__BluebirdErrorTypes__.OperationalError||e.isOperational===!0}function canAttachTrace(obj){return obj instanceof Error&&es5.propertyIsWritable(obj,"stack")}var es5=require("./es5.js"),canEvaluate="undefined"==typeof navigator,haveGetters=function(){try{var o={};return es5.defineProperty(o,"f",{get:function(){return 3}}),3===o.f}catch(e){return!1}}(),errorObj={e:{}},tryCatchTarget,inherits=function(Child,Parent){function T(){this.constructor=Child,this.constructor$=Parent;for(var propertyName in Parent.prototype)hasProp.call(Parent.prototype,propertyName)&&"$"!==propertyName.charAt(propertyName.length-1)&&(this[propertyName+"$"]=Parent.prototype[propertyName])}var hasProp={}.hasOwnProperty;return T.prototype=Parent.prototype,Child.prototype=new T,Child.prototype},wrapsPrimitiveReceiver=function(){return"string"!==this}.call("string"),inheritedDataKeys=function(){return es5.isES5?function(obj,opts){for(var ret=[],visitedKeys=Object.create(null),getKeys=Object(opts).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=obj;){var keys;try{keys=getKeys(obj)}catch(e){return ret}for(var i=0;i<keys.length;++i){var key=keys[i];if(!visitedKeys[key]){visitedKeys[key]=!0;var desc=Object.getOwnPropertyDescriptor(obj,key);null!=desc&&null==desc.get&&null==desc.set&&ret.push(key)}}obj=es5.getPrototypeOf(obj)}return ret}:function(obj){var ret=[];for(var key in obj)ret.push(key);return ret}}(),rident=/^[a-z$_][a-z$_0-9]*$/i,ensureErrorObject=function(){return"stack"in new Error?function(value){return canAttachTrace(value)?value:new Error(safeToString(value))}:function(value){if(canAttachTrace(value))return value;try{throw new Error(safeToString(value))}catch(err){return err}}}(),ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,asString:asString,maybeWrapAsError:maybeWrapAsError,wrapsPrimitiveReceiver:wrapsPrimitiveReceiver,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection};try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5.js":11}]},{},[1])(1)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise),function(){var bluebird=window.Promise;window.Promise!==window.P&&console.warn("Bluebird is not available, cancel and progress will not work");var bluebird_extended,bower_components_wixmp_manager_src_utils_mappers,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_events_notifier,bower_components_wixmp_manager_src_sources_Source,bower_components_wixmp_manager_src_sources_private_mappers_folder,bower_components_wixmp_manager_src_sources_private_parsers_error,bower_components_wixmp_manager_src_sources_private_folders,bower_components_wixmp_manager_src_sources_private_validators_new_props,bower_components_wixmp_manager_src_sources_private_folder,bower_components_wixmp_manager_src_utils_images_generators,bower_components_wixmp_manager_src_sources_private_mappers_item,bower_components_wixmp_manager_src_sources_private_items,bower_components_wixmp_manager_src_sources_private_item,bower_components_wixmp_manager_src_sources_private_trash,bower_components_wixmp_manager_src_sources_private_itemstrash,bower_components_wixmp_manager_src_sources_private_folderstrash,bower_components_wixmp_manager_src_sources_private_settings,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list,bower_components_wixmp_manager_src_services_channel_channel,bower_components_wixmp_manager_src_sources_private_refresh_token_wrapper,bower_components_wixmp_manager_src_sources_private_Private,bower_components_wixmp_manager_src_sources_picasa_settings,bower_components_wixmp_manager_src_sources_picasa_mappers_folder,bower_components_wixmp_manager_src_sources_picasa_parsers_folders,bower_components_wixmp_manager_src_sources_picasa_parsers_error,bower_components_wixmp_manager_src_sources_picasa_folders,bower_components_wixmp_manager_src_sources_picasa_mappers_item,bower_components_wixmp_manager_src_sources_picasa_parsers_items,bower_components_wixmp_manager_src_sources_picasa_items,bower_components_wixmp_manager_src_sources_picasa_Picasa,bower_components_wixmp_manager_src_sources_drive_settings,bower_components_wixmp_manager_src_sources_drive_mappers_folder,bower_components_wixmp_manager_src_sources_drive_parsers_folders,bower_components_wixmp_manager_src_sources_drive_parsers_error,bower_components_wixmp_manager_src_sources_drive_folders,bower_components_wixmp_manager_src_sources_drive_mappers_item,bower_components_wixmp_manager_src_sources_drive_parsers_items,bower_components_wixmp_manager_src_sources_drive_items,bower_components_wixmp_manager_src_sources_drive_Drive,bower_components_wixmp_manager_src_sources_dropbox_settings,bower_components_wixmp_manager_src_sources_dropbox_mappers_folder,bower_components_wixmp_manager_src_sources_dropbox_parsers_folders,bower_components_wixmp_manager_src_sources_dropbox_parsers_error,bower_components_wixmp_manager_src_sources_dropbox_folders,bower_components_wixmp_manager_src_sources_dropbox_mappers_item,bower_components_wixmp_manager_src_sources_dropbox_parsers_items,bower_components_wixmp_manager_src_sources_dropbox_items,bower_components_wixmp_manager_src_sources_dropbox_Dropbox,bower_components_wixmp_manager_src_sources_instagram_settings,bower_components_wixmp_manager_src_sources_instagram_mappers_folder,bower_components_wixmp_manager_src_sources_instagram_parsers_folders,bower_components_wixmp_manager_src_sources_instagram_parsers_error,bower_components_wixmp_manager_src_sources_instagram_folders,bower_components_wixmp_manager_src_sources_instagram_mappers_item,bower_components_wixmp_manager_src_sources_instagram_parsers_items,bower_components_wixmp_manager_src_sources_instagram_items,bower_components_wixmp_manager_src_sources_instagram_Instagram,bower_components_wixmp_manager_src_sources_facebook_settings,bower_components_wixmp_manager_src_sources_facebook_mappers_folder,bower_components_wixmp_manager_src_sources_facebook_parsers_folders,bower_components_wixmp_manager_src_sources_facebook_parsers_error,bower_components_wixmp_manager_src_sources_facebook_folders,bower_components_wixmp_manager_src_sources_facebook_mappers_item,bower_components_wixmp_manager_src_sources_facebook_parsers_items,bower_components_wixmp_manager_src_sources_facebook_items,bower_components_wixmp_manager_src_sources_facebook_Facebook,bower_components_wixmp_manager_src_sources_flickr_settings,bower_components_wixmp_manager_src_sources_flickr_mappers_folder,bower_components_wixmp_manager_src_sources_flickr_parsers_folders,bower_components_wixmp_manager_src_sources_flickr_parsers_error,bower_components_wixmp_manager_src_sources_flickr_folders,bower_components_wixmp_manager_src_sources_flickr_mappers_item,bower_components_wixmp_manager_src_sources_flickr_parsers_items,bower_components_wixmp_manager_src_sources_flickr_items,bower_components_wixmp_manager_src_sources_flickr_Flickr,bower_components_wixmp_manager_src_sources_flickr_search_settings,bower_components_wixmp_manager_src_sources_flickr_search_mappers_item,bower_components_wixmp_manager_src_sources_flickr_search_parsers_items,bower_components_wixmp_manager_src_sources_flickr_search_parsers_error,bower_components_wixmp_manager_src_sources_flickr_search_items,bower_components_wixmp_manager_src_sources_flickr_search_FlickrSearch,bower_components_wixmp_manager_src_sources_google_search_settings,bower_components_wixmp_manager_src_sources_google_search_mappers_item,bower_components_wixmp_manager_src_sources_google_search_parsers_items,bower_components_wixmp_manager_src_sources_google_search_parsers_error,bower_components_wixmp_manager_src_sources_google_search_items,bower_components_wixmp_manager_src_sources_google_search_GoogleSearch,bower_components_wixmp_manager_src_sources_collection_settings,bower_components_wixmp_manager_src_sources_collection_mappers_folder,bower_components_wixmp_manager_src_sources_collection_parsers_selector,bower_components_wixmp_manager_src_sources_collection_parsers_folders,bower_components_wixmp_manager_src_sources_collection_parsers_error,bower_components_wixmp_manager_src_sources_collection_folders,bower_components_wixmp_manager_src_sources_collection_mappers_item,bower_components_wixmp_manager_src_sources_collection_parsers_items,bower_components_wixmp_manager_src_sources_collection_items,bower_components_wixmp_manager_src_sources_collection_Collection,bower_components_wixmp_manager_src_sources_list,bower_components_wixmp_manager_src_events_events,bower_components_wixmp_manager_src_connector_connector_settings,bower_components_wixmp_manager_src_connector_connector,bower_components_wixmp_manager_src_services_bi_events_ids,bower_components_wixmp_manager_src_services_bi_send_request,bower_components_wixmp_manager_src_services_bi_benchmarks,bower_components_wixmp_manager_src_services_bi_errors,bower_components_wixmp_manager_src_services_upload_file_to_upload,bower_components_wixmp_manager_src_services_upload_upload_collection,bower_components_wixmp_manager_src_services_bi_upload_queue,bower_components_wixmp_manager_src_services_bi_bi,bower_components_wixmp_manager_src_wixmp,src_sources_bigstock_settings,src_sources_bigstock_mappers_folder,src_sources_bigstock_parsers_folders,src_sources_bigstock_folders,src_sources_bigstock_mappers_item,src_sources_bigstock_parsers_items,src_sources_bigstock_parsers_error,src_sources_bigstock_items,src_sources_bigstock_BigStock,src_sources_public_mappers_folder,src_sources_public_parsers_folders,src_sources_public_parsers_error,src_sources_public_folders,src_sources_public_mappers_item,src_sources_public_parsers_items,src_sources_public_items,src_sources_public_settings,src_sources_public_Public,wixmp;!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e(P);else{bluebird_extended=function(bluebird){return"function"==typeof e?e(bluebird):e}(bluebird)}}(function(Promise){return Promise.newAbortable=function(func){var reject,promise=new Promise(function(){return reject=arguments[1],func.apply(this,arguments)});return promise.cancellable?(promise=promise.cancellable(),promise.abort=function(){this.cancel(new Promise.CancellationError)}):promise.abort=function(){reject(new Promise.CancellationError)},promise},Promise.defer=function(){var resolve,reject,promise=Promise.newAbortable(function(){resolve=arguments[0],reject=arguments[1]});return{resolve:resolve,reject:reject,promise:promise}},Promise.CancellationError||(Promise.CancellationError=function(){Error.apply(this,arguments)},Promise.CancellationError.prototype=Object.create(Error)),["then","catch"].forEach(function(name){var original=Promise.prototype[name];Promise.prototype[name]=function(){var promise=original.apply(this,arguments);return promise.abort||(promise.abort=this.abort),promise}}),Promise.prototype.progress=function(callback){return this._progressCallback=callback,this},Promise.prototype.notify=function(message){return"function"==typeof this._progressCallback&&this._progressCallback(message),this},Promise}),bower_components_wixmp_manager_src_utils_mappers={toObject:function(data){if(!data)return null;if("string"==typeof data){if(["{","["].indexOf(data[0])>=0)try{return JSON.parse(data)}catch(err){return{error_code:-100,error_description:"Can`t parse JSON"}}return{message:data}}return data},toError:function(error){var errorObject=new Error;return errorObject.code=error.status||error.code,errorObject.message=error.statusText||error.message||error.data.message||error.data.error&&error.data.error.message||"",errorObject.data=error.data&&(error.data.errors||error.data.error||error.data),errorObject}},bower_components_wixmp_manager_src_utils_utils=function(Promise,mappers){function minMaxFinder(method,arr,predicate){var mappedArr;return predicate?(mappedArr=arr.map(predicate),arr[mappedArr.indexOf(Math[method].apply(null,mappedArr))]):Math[method].apply(this,arr)}var utils={extend:function(dest){var sources=Array.prototype.slice.call(arguments,1);return sources.forEach(function(source){"object"==typeof source&&null!==source&&Object.keys(source).forEach(function(key){dest[key]=source[key]})}),dest},merge:function(){var hop=Object.prototype.hasOwnProperty;return Array.prototype.reduce.call(arguments,function(result,source){return Object.keys(result).forEach(function(key){hop.call(source,key)&&(result[key]=source[key])}),Object.keys(source).forEach(function(key){result[key]=source[key]}),result},{})},bytesToSize:function(bytes){if(0===bytes)return"0 Byte";var k=1024,sizes=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(bytes)/Math.log(k));return(bytes/Math.pow(k,i)).toPrecision(3)+" "+sizes[i]},partial:function(func){var partialArguments=Array.prototype.slice.call(arguments,1);return function(){var args=Array.prototype.slice.call(arguments);return func.apply(this,partialArguments.concat(args))}},getParameterByName:function(searchString,name){var regex,results;return name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(searchString),results?decodeURIComponent(results[1].replace(/\+/g," ")):""},snakeToCamel:function(string){return string.replace(/(\_[a-z])/g,function($1){return $1.toUpperCase().replace("_","")})},find:function(arr,predicate){var found;return arr.some(function(el){return predicate(el)===!0?(found=el,!0):void 0}),found},encodeParams:function(a){var s=[],add=function(key,value){s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};return Object.keys(a).forEach(function(entity){add(entity,a[entity])}),s.join("&").replace(/%20/g,"+")},splitTags:function(tags){return tags?Array.isArray(tags)?tags:tags.split(/\s*,\s*/):[]},normalizeUri:function(uri){if("string"!=typeof uri)throw new Error("URI is not a string");return uri.replace(/([a-z\-_0-9]+)\/\//gi,"$1/")},getScript:function(src){return Promise.newAbortable(function(resolve,reject){var head=document.getElementsByTagName("head")[0],script=document.createElement("script"),done=!1;script.src=src,script.onload=script.onreadystatechange=function(){done||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState?reject(mappers.toError()):(done=!0,resolve(),script.onload=script.onreadystatechange=null,head&&script.parentNode&&head.removeChild(script))},head.insertBefore(script,head.firstChild)})},isGuid:function(guid){return/^\w{8}-(\w{4}-){3}\w{12}(:\w+)?$/.test(guid)}};return utils.min=utils.partial(minMaxFinder,"min"),utils.max=utils.partial(minMaxFinder,"max"),utils}(bluebird_extended,bower_components_wixmp_manager_src_utils_mappers),bower_components_wixmp_manager_src_utils_http=function(Promise,utils,mappers){function parseResponseData(response){return"string"==typeof response&&(response=["{","["].indexOf(response[0])>=0?JSON.parse(response):{message:response}),response}function parseResponse(request){return{status:request.status,statusText:request.statusText,responseSize:request.responseText.length,data:parseResponseData(request.responseText)}}function encode(val){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function wrapRequestWithPromise(request,callSend,hasProgress){var promise=Promise.newAbortable(function(resolve,reject){request.addEventListener("error",function(){reject(mappers.toError(utils.extend({},request,{message:"error",code:-201})))},!1),request.addEventListener("timeout",function(){reject(mappers.toError(utils.extend({},request,{message:"timeout_has_exceeded",code:408})))},!1),request.addEventListener("load",function(){request.status.toString().match(/^2\d+/i)?resolve(parseResponse(request)):reject(mappers.toError(utils.extend({},request,{message:"error",code:request.status,data:mappers.toObject(request.responseText)})))},!1)});return hasProgress?request.upload.onprogress=function(event){var progress=Math.round(event.lengthComputable?100*event.loaded/event.total:0),status=99>=progress?"uploading":"processing";promise.notify({status:status,total:event.total,loaded:event.loaded})}:(request.addEventListener("loadstart",function(event){event&&promise.notify({status:"uploading",total:event.total,loaded:event.loaded})},!1),request.addEventListener("loadend",function(event){event&&promise.notify({status:"processing",total:event.total,loaded:event.loaded})},!1)),promise["catch"](function(err){err instanceof Promise.CancellationError&&request.abort()}),callSend(),promise}function buildUrl(url,params){if(!params)return url;var parts=[];return Object.keys(params).forEach(function(key){var val=params[key];null!==val&&"undefined"!=typeof val&&(val instanceof Array||(val=[val]),val.forEach(function(v){v instanceof Date&&!isNaN(v.valueOf())?v=v.toISOString():"object"==typeof v&&(v=JSON.stringify(v)),parts.push(encode(key)+"="+encode(v))}))}),parts.length>0&&(url+=(-1===url.indexOf("?")?"?":"&")+parts.join("&")),url}function openRequest(method,url,options){var request=new XMLHttpRequest;return options.cache===!1&&(url+=(-1===url.indexOf("?")?"?":"&")+"_="+Date.now()),request.open(method.toUpperCase(),utils.normalizeUri(url)),options.responseType&&(request.responseType=options.responseType),request.withCredentials=options.withCredentials,Object.keys(options.headers).forEach(function(name){request.setRequestHeader(name,options.headers[name])}),request}function get(url,data,options){var request=openRequest("get",buildUrl(url,data),utils.extend({},defaultOptions,options));return wrapRequestWithPromise(request,function(){request.send(null)})}function post(url,data,options){var request=openRequest("post",url,utils.extend({},defaultOptions,{headers:{"Content-Type":"application/json;charset=UTF-8"}},options));return wrapRequestWithPromise(request,function(){data&&"object"==typeof data&&data instanceof FormData==!1&&(data=JSON.stringify(data)),request.send(data)})}function upload(url,multipart,options){var fd,request=openRequest("post",url,utils.extend({},defaultOptions,options));return fd=new FormData,Object.keys(multipart).forEach(function(name){var value=multipart[name],args="file"===name?[name,value,value.name]:[name,value];return fd.append.apply(fd,args)}),wrapRequestWithPromise(request,function(){request.send(fd)},!0)}function catchError(method,onError){return function(){function callOriginalMethod(){return method.apply(self,args)}var firstPromise,self=this,args=arguments;firstPromise=callOriginalMethod();var promise=Promise.newAbortable(function(resolve,reject){firstPromise.then(resolve,function(reason){return void 0!==onError?onError.call(this,reason,callOriginalMethod):reason}).then(resolve,reject)});return firstPromise.progress(function(progress){promise.notify(progress)}),promise["catch"](function(err){err instanceof Promise.CancellationError&&firstPromise.abort()}),promise}}function makeRetriable(method){return catchError(method,function(reason,callOriginalMethod){return reason instanceof Promise.CancellationError||406===reason.code||403===reason.code?Promise.reject(reason):callOriginalMethod()})}var defaultOptions={withCredentials:!1,cache:!0,headers:{Accept:"application/json, text/plain, */*"}};return{get:makeRetriable(get),post:makeRetriable(post),upload:makeRetriable(upload),catchError:catchError}}(bluebird_extended,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_utils_mappers),bower_components_wixmp_manager_src_events_notifier=function(Promise){function noop(){}function callEach(functions,data){functions.forEach(function(currentFunction){currentFunction(data)})}function callEachAtIndex(functions,index,data){functions.forEach(function(functions){functions[index](data)})}function emitWithArrayOfPromises(eventTarget,eventName,params){if("undefined"==typeof listeners[eventName])return{resolveAt:noop,rejectAt:noop};var resolvers=[],rejectors=[];return listeners[eventName].forEach(function(listener){var thisEventResolvers=[],thisEventRejectors=[],eventPromises=params.promises.map(function(){return new Promise(function(resolve,reject){thisEventResolvers.push(resolve),thisEventRejectors.push(reject)})});resolvers.push(thisEventResolvers),rejectors.push(thisEventRejectors),listener(eventPromises,params)}),{resolveAt:function(index,data){callEachAtIndex(resolvers,index,data)},rejectAt:function(index,data){callEachAtIndex(rejectors,index,data)}}}function emit(eventTarget,eventName,params){if("object"!=typeof eventTarget||null===eventTarget)throw new Error("target should be a function");if("string"!=typeof eventName)throw new Error("eventName should be a string");if(params=params||{},params.eventTarget=eventTarget,params.eventName=eventName,params.promises&&params.promises.length)return emitWithArrayOfPromises(eventTarget,eventName,params);if("undefined"==typeof listeners[eventName])return{resolve:noop,reject:noop};var resolvers=[],rejectors=[];return listeners[eventName].forEach(function(listener){var promise=new Promise(function(resolveCurrent,rejectCurrent){resolvers.push(resolveCurrent),rejectors.push(rejectCurrent)});listener(promise,params)}),{resolve:function(data){callEach(resolvers,data)},reject:function(reason){callEach(rejectors,reason)}}}function addListener(eventName,listener){"undefined"==typeof listeners[eventName]&&(listeners[eventName]=[]),listeners[eventName].push(listener)}function removeListener(eventName,listener){if(listeners[eventName]){var index=listeners[eventName].indexOf(listener);listeners[eventName].splice(index,1)}}var listeners={};return{emit:emit,addListener:addListener,removeListener:removeListener}}(bluebird_extended),bower_components_wixmp_manager_src_sources_Source=function(http,notifier){return function(SourceConstructor,settings){if("function"!=typeof SourceConstructor)throw new Error("Source constructor should be a function");if("undefined"!=typeof settings&&("object"!=typeof settings||null===settings))throw new Error("Source settings should be an object");return new SourceConstructor(settings,notifier.emit,http)}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_events_notifier),bower_components_wixmp_manager_src_sources_private_mappers_folder=function(folderData){return{id:folderData.folder_id,parentId:folderData.parent_folder_id||null,name:folderData.folder_name,mediaType:folderData.media_type,filesCount:folderData.files_count,createdAt:folderData.created_ts}},bower_components_wixmp_manager_src_sources_private_parsers_error=function(Promise){return function(response){return 403===response.status&&"Missing Wix session"===response.data.error_description&&(response.status=401,response.data.message="Wix Session required"),Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_private_folders=function(toFolder,toError){return function(settings,http){function mapFolderList(res){return res.data=(res.data.folders||[]).map(toFolder),res}function failHandler(reason){return toError(reason)}function list(folderId,options){return options=options||{},http.get(settings.apiUrl+"/folders",{media_type:options.mediaType||"picture",folder_id:folderId||null},{withCredentials:!0,headers:options.headers||{}}).then(mapFolderList)["catch"](failHandler)}function removeFolder(folderId,options){return http.post(settings.apiUrl+"/folders/"+folderId+"/delete",null,{withCredentials:!0,headers:options.headers||{}}).then(function(res){return res.data={id:folderId},res})["catch"](failHandler)}function remove(folderIds,options){return options=options||{},folderIds.map(function(folderId){return removeFolder(folderId,options)})}return{list:list,remove:remove}}}(bower_components_wixmp_manager_src_sources_private_mappers_folder,bower_components_wixmp_manager_src_sources_private_parsers_error),bower_components_wixmp_manager_src_sources_private_validators_new_props=function(newProps){return"object"!=typeof newProps||null===newProps?{valid:!1,message:"Please specify new props"}:"undefined"==typeof newProps.name||newProps.name?"undefined"==typeof newProps.folderId||newProps.folderId?"undefined"==typeof newProps.parentId||newProps.parentId?"undefined"==typeof newProps.tags||Array.isArray(newProps.tags)?{valid:!0}:{valid:!1,message:"Tags should be an array"}:{valid:!1,message:"Please specify parent folder id"}:{valid:!1,message:"Please specify folder id"}:{valid:!1,message:"Please specify name"}},bower_components_wixmp_manager_src_sources_private_folder=function(mappers,utils,toFolder,toError,validateNewProps){return function(settings,http){function failHandler(reason){return toError(reason)}function mapFolder(res){return res.data=toFolder(res.data),res}function create(folderName,options){return folderName?(options=options||{},http.post(settings.apiUrl+"/folders",{folder_name:folderName,media_type:options.mediaType||"picture",parent_folder_id:options.parentId||null},{withCredentials:!0,headers:options.headers||{}}).then(mapFolder)["catch"](failHandler)):failHandler(mappers.toError({status:-200,statusText:"Internal JS Error",data:{message:"Please specify name"}}))}function update(folder,newFolderProps,options){var arePropsValid=validateNewProps(newFolderProps);if(arePropsValid.valid===!1)return failHandler(mappers.toError({status:-200,statusText:"Internal JS Error",data:{message:arePropsValid.message}}));var propsToUpdate={};return newFolderProps.name&&(propsToUpdate.folder_name=newFolderProps.name),newFolderProps.parentId&&(propsToUpdate.parent_folder_id=newFolderProps.parentId),options=options||{},http.post(settings.apiUrl+"/folders/"+folder.id+"/put",propsToUpdate,{withCredentials:!0,headers:options.headers||{}}).then(function(res){return res.data=utils.extend({},folder,newFolderProps),res})["catch"](failHandler)}return{create:create,update:update}}}(bower_components_wixmp_manager_src_utils_mappers,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_private_mappers_folder,bower_components_wixmp_manager_src_sources_private_parsers_error,bower_components_wixmp_manager_src_sources_private_validators_new_props),bower_components_wixmp_manager_src_utils_images_generators=function(utils){function insertDataInTemplate(template,data){function createRegexp(t,options){return t=t.replace(/[()\[\]\.^$|?+]/g,"\\$&"),new RegExp(t,options)}return Object.keys(data).forEach(function(key){template=template.replace(createRegexp("#"+key+"#","g"),data[key])}),template}function isResizable(url){return/\.(png|jpe?g|gif)/i.test(url)}function getFullName(url){var path=url.split("/");return path[path.length-1]}function getPath(url){return url.replace(/\/file\.[a-z0-9]+$/,"")}function transformModeToVangogh(mode){return vangoghModes[mode]}function rembrandtCompile(item,settings){var templates={};if(item.fileUrl&&(templates.original=normalizeUri(settings.filesUrl+"/"+item.fileUrl)),item.thumbnailUrl)return isResizable(item.thumbnailUrl)?templates.thumbnail=normalizeUri(settings.filesUrl+"/"+getPath(item.thumbnailUrl)+"/v1/#mode#/w_#width#,h_#height#/"+getFullName(item.thumbnailUrl)):templates.thumbnail=normalizeUri(settings.filesUrl+"/"+item.thumbnailUrl),
templates;switch(item.mediaType){case"picture":case"site_icon":case"watermark":case"secure_picture":item.fileUrl&&(templates.thumbnail=normalizeUri(settings.filesUrl+"/"+getPath(item.fileUrl)+"/v1/#mode#/w_#width#,h_#height#/"+getFullName(item.fileUrl)));break;case"video":case"secure_video":item.fileOutput&&item.fileOutput.image&&item.fileOutput.image[2]&&item.fileOutput.image[2].url&&(templates.thumbnail=normalizeUri(settings.filesUrl+"/"+getPath(item.fileOutput.image[2].url)+"/v1/#mode#/w_#width#,h_#height#/"+getFullName(item.fileOutput.image[2].url)));break;case"ufont":item.fileUrl&&(templates.thumbnail=normalizeUri(settings.filesUrl+"/"+getPath(item.fileOutput.image[0].url)+"/v1/#mode#/w_#width#,h_#height#/"+getFullName(item.fileOutput.image[0].url)))}return templates}function vangoghCompile(item,settings){var templates={};if(item.fileUrl&&(templates.original=normalizeUri(settings.filesUrl+"/"+item.fileUrl)),item.thumbnailUrl)return isResizable(item.thumbnailUrl)?templates.thumbnail=normalizeUri(settings.filesUrl+"/"+getPath(item.thumbnailUrl)+"_#mode#_#width#_#height#_75_22_0.5_1.20_0.00_jpg_#mode#"):templates.thumbnail=normalizeUri(settings.filesUrl+"/"+item.thumbnailUrl),templates;switch(item.mediaType){case"picture":case"site_icon":case"watermark":case"secure_picture":item.fileUrl&&(templates.thumbnail=normalizeUri(settings.filesUrl+"/"+getPath(item.fileUrl)+"_#mode#_#width#_#height#_75_22_0.5_1.20_0.00_jpg_#mode#"));break;case"video":case"secure_video":item.fileOutput&&item.fileOutput.image&&item.fileOutput.image[2]&&item.fileOutput.image[2].url&&(templates.thumbnail=normalizeUri(settings.filesUrl+"/"+getPath(item.fileOutput.image[2].url)+"_#mode#_#width#_#height#_75_22_0.5_1.20_0.00_jpg_#mode#"));break;case"ufont":item.fileUrl&&(templates.preview=normalizeUri(settings.filesUrl+"/"+getPath(item.fileOutput.image[0].url)+"_#mode#_#width#_#height#_75_22_0.5_1.20_0.00_jpg_#mode#"))}return templates}function compileUrlsTemplate(item,settings){return"vangogh"===settings.imageOperationsApi?vangoghCompile(item,settings):rembrandtCompile(item,settings)}var generators={},normalizeUri=utils.normalizeUri,vangoghModes={fill:"srz",fit:"srb"};return generators.insertSizes=function(item,thumbnailSizes,settings){var urlsTemplate=compileUrlsTemplate(item,settings);return Object.keys(thumbnailSizes).reduce(function(compiledUrls,thumbType){var compiledUrlKey=thumbType+"Url",thumbSizeData=utils.extend({},thumbnailSizes[thumbType]),urlTemplate=urlsTemplate[thumbType]||urlsTemplate.thumbnail;return urlTemplate?("vangogh"===settings.imageOperationsApi&&(thumbSizeData.mode=transformModeToVangogh(thumbSizeData.mode)),compiledUrls[compiledUrlKey]=insertDataInTemplate(urlTemplate,thumbSizeData),compiledUrls):compiledUrls},{})},generators.getVideoPreviewUrl=function(item,settings){return item.fileOutput&&item.fileOutput.video?item.fileOutput.video.filter(function(video){return video.quality<=settings.videoPreviewQuality}).map(function(video){return normalizeUri(settings.videoFilesUrl+"/"+video.url)}):null},generators}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_private_mappers_item=function(mappers,utils,imagesGenerators){return function(itemData,settings,thumbnailSizes){var normalizeUri=utils.normalizeUri,item={id:itemData.file_name,folderId:itemData.parent_folder_id||null,name:itemData.original_file_name,mediaType:itemData.media_type,fileUrl:itemData.file_url?normalizeUri(itemData.file_url):null,createdAt:itemData.created_ts,labels:itemData.labels||[],tags:utils.splitTags(itemData.tags),width:itemData.width||null,height:itemData.height||null,fileInfo:itemData.file_info?mappers.toObject(itemData.file_info):null,fileInput:itemData.file_input?mappers.toObject(itemData.file_input):null,fileOutput:itemData.file_output?mappers.toObject(itemData.file_output):null,transcodingStatus:itemData.op_status};item.videoPreviewUrl=imagesGenerators.getVideoPreviewUrl(item,settings)||null;var sizes=utils.extend({},settings.thumbnailSizes,thumbnailSizes);return utils.extend(item,imagesGenerators.insertSizes(item,sizes,settings)),sizes.thumbnail&&!item.thumbnailUrl&&itemData.icon_url&&(item.thumbnailUrl=normalizeUri(settings.filesUrl+"/"+itemData.icon_url)),Object.keys(sizes).forEach(function(thumbType){item[thumbType+"Url"]||(item[thumbType+"Url"]=item.thumbnailUrl)}),Object.keys(item).forEach(function(prop){void 0===item[prop]&&delete item[prop]}),item}}(bower_components_wixmp_manager_src_utils_mappers,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_utils_images_generators),bower_components_wixmp_manager_src_sources_private_items=function(Promise,utils,toItem,toError){return function(settings,http){function failHandler(reason){return toError(reason)}function mapItemList(res,thumbnailSizes){return res.data=(res.data.files||[]).map(function(data){return toItem(data,settings,thumbnailSizes)}),res}function list(folderId,options){options=options||{};var sort=utils.extend({},defaultSort,options.sort),paging=utils.extend({},defaultPaging,options.paging),queryParams={page_size:paging.size,cursor:paging.cursor,parent_folder_id:folderId,media_type:options.mediaType||"picture"};return queryParams.order="desc"===sort.direction?"-"+sort.order:sort.order,http.get(settings.apiUrl+"/files/getpage",queryParams,{withCredentials:!0,headers:options.headers||{}}).then(function(response){return response.paging={size:paging.size,cursor:response.data.cursor},mapItemList(response,options.thumbnails)})["catch"](failHandler)}function removeItem(itemId,options){return http.post(settings.apiUrl+"/files/"+itemId+"/delete",null,{withCredentials:!0,headers:options.headers||{}}).then(function(res){return res.data={id:itemId},res})["catch"](failHandler)}function remove(itemsId,options){return options=options||{},itemsId.map(function(itemId){return removeItem(itemId,options)})}function searchByTag(tag,options){options=options||{};var sort=utils.extend({},defaultSort,options.sort),paging=utils.extend({},defaultPaging,options.paging),queryParams={page_size:paging.size,cursor:paging.cursor,media_type:options.mediaType||"picture",order:"desc"===sort.direction?"-"+sort.order:sort.order};return http.get(settings.apiUrl+"/files/get?tag="+tag,queryParams,{withCredentials:!0,cache:!1,headers:options.headers||{}}).then(function(response){return response.paging={size:paging.size,cursor:response.data.cursor},mapItemList(response,options.thumbnails)})["catch"](failHandler)}function search(folderId,query,options){options=options||{};var sort=utils.extend({},defaultSort,options.sort),paging=utils.extend({},defaultPaging,options.paging),queryParams={page_size:paging.size,cursor:paging.cursor,media_type:options.mediaType||"picture",parent_folder_id:folderId,order:"desc"===sort.direction?"-"+sort.order:sort.order};return http.get(settings.apiUrl+"/files/search/getpage?query="+query,queryParams,{withCredentials:!0,cache:!1,headers:options.headers||{}}).then(function(response){return response.paging={size:paging.size,cursor:response.data.cursor},mapItemList(response,options.thumbnails)})["catch"](failHandler)}var defaultPaging={size:50,cursor:null},defaultSort={order:"date",direction:"desc"};return{list:list,remove:remove,searchByTag:searchByTag,search:search}}}(bluebird_extended,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_private_mappers_item,bower_components_wixmp_manager_src_sources_private_parsers_error),bower_components_wixmp_manager_src_sources_private_item=function(Promise,utils,toItem,toError,validateNewProps,mappers){return function(settings,http){function getFilesSizeLimit(mediaType){return settings.uploadLimits[utils.snakeToCamel(mediaType)]}function fileSizeIsInvalid(fileSource){return fileSource.file.size>=getFilesSizeLimit(fileSource.mediaType)}function onItemUploadProgress(callback){"function"==typeof callback&&uploadProgressEvents.push(callback)}function failHandler(reason){return toError(reason)}function mapItem(res,thumbnailsSizes){return res.data=toItem(res.data,settings,thumbnailsSizes),res}function getUploadUrl(fileSource){function getEndpoint(mediaType){return"secure_music"===mediaType?"music-goods/upload":"video"===mediaType?"video/upload":"upload"}return http.get(settings.apiUrl+"/files/"+getEndpoint(fileSource.mediaType)+"/url",{media_type:fileSource.mediaType,file_name:"_."+fileSource.name.split(".").pop(),file_size:fileSource.size,content_type:fileSource.file.type},{withCredentials:!0})}function uploadByUrl(fileSource,options){options=options||{};var params={url:utils.normalizeUri(fileSource.url),media_type:fileSource.mediaType,name:fileSource.name||"Untitled",tags:(fileSource.tags||[]).join(",")||null,parent_folder_id:fileSource.folderId||null},apiUrl=settings.apiUrl+"/files/upload/external",uploadPromise=http.get(apiUrl,params,{withCredentials:!0,headers:options.headers||{}}).progress(function(progress){uploadPromise.notify(progress)}).then(function(res){return mapItem(res,options.thumbnails)});return uploadPromise}function upload(fileSource,options){options=options||{};var fileToUpload={parent_folder_id:fileSource.folderId||null,file:fileSource.file,media_type:fileSource.mediaType};if(fileSource.encodingOptions&&(fileToUpload.encoding_options=JSON.stringify(fileSource.encodingOptions)),fileSizeIsInvalid(fileSource))return Promise.reject(mappers.toError({status:-406,statusText:"Not Acceptable",data:{error_description:"File size is bigger than "+utils.bytesToSize(getFilesSizeLimit(fileSource.mediaType))}}));var uploadPromiseChain=getUploadUrl(fileSource).then(function(response){return fileToUpload.upload_token=response.data.upload_token,http.upload(response.data.upload_url,fileToUpload,{withCredentials:!0,headers:options.headers||{}}).progress(function(progress){uploadPromiseChain.notify(progress)})}).then(function(response){return response.data=toItem(response.data[0],settings),response});return uploadPromiseChain}function get(itemId,options){return options=options||{},http.get(settings.apiUrl+"/files/"+itemId,null,{withCredentials:!0,cache:!1,headers:options.headers||{}}).then(function(res){return mapItem(res,options.thumbnails)})["catch"](failHandler)}function update(item,newItemProps,options){var arePropsValid=validateNewProps(newItemProps);if(arePropsValid.valid===!1)return failHandler(mappers.toError({status:-200,statusText:"Internal JS Error",data:{message:arePropsValid.message}}));var propsToUpdate={};return newItemProps.name&&(propsToUpdate.original_file_name=newItemProps.name),newItemProps.folderId&&(propsToUpdate.parent_folder_id=newItemProps.folderId),newItemProps.tags&&(propsToUpdate.tags=newItemProps.tags.join(",")),options=options||{},http.post(settings.apiUrl+"/files/"+item.id+"/put",propsToUpdate,{withCredentials:!0,headers:options.headers||{}}).then(function(res){return res.data=utils.extend({},item,newItemProps),res})["catch"](failHandler)}var uploadProgressEvents=[];return{onItemUploadProgress:onItemUploadProgress,upload:upload,uploadByUrl:uploadByUrl,get:get,update:update}}}(bluebird_extended,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_private_mappers_item,bower_components_wixmp_manager_src_sources_private_parsers_error,bower_components_wixmp_manager_src_sources_private_validators_new_props,bower_components_wixmp_manager_src_utils_mappers),bower_components_wixmp_manager_src_sources_private_trash=function(toError){return function(settings,http){function failHandler(reason){return toError(reason)}function remove(options){return http.post(settings.apiUrl+"/trash/remove",{media_type:options.mediaType||"picture",all_files:!0},{withCredentials:!0})["catch"](failHandler)}function restore(options){return http.post(settings.apiUrl+"/trash/restore",{media_type:options.mediaType||"picture",all_files:!0},{withCredentials:!0})["catch"](failHandler)}return{remove:remove,restore:restore}}}(bower_components_wixmp_manager_src_sources_private_parsers_error),bower_components_wixmp_manager_src_sources_private_itemstrash=function(Promise,utils,toItem,toError){return function(settings,http){function failHandler(reason){return toError(reason)}function mapItemList(res,thumbnailSizes){return res.data=(res.data.trash_files||[]).map(function(_item){var item=toItem(_item,settings,thumbnailSizes);return item.isInTrash=!0,item}),res}function list(folderId,options){options=options||{};var sort=utils.extend({},defaultSort,options.sort),paging=utils.extend({},defaultPaging,options.paging),queryParams={page_size:paging.size,cursor:paging.cursor,parent_folder_id:folderId,media_type:options.mediaType||"picture"};return queryParams.order="desc"===sort.direction?"-"+sort.order:sort.order,http.get(settings.apiUrl+"/files/getpage/trash",queryParams,{withCredentials:!0,headers:options.headers||{}}).then(function(response){return response.paging={size:paging.size,cursor:response.data.cursor},mapItemList(response,options.thumbnails)})["catch"](failHandler)}function removeItem(itemId,options){return http.post(settings.apiUrl+"/trash/files/"+itemId+"/delete",null,{withCredentials:!0,headers:options.headers||{}}).then(function(res){return res.data={id:itemId},res})["catch"](failHandler)}function remove(itemsId,options){return options=options||{},itemsId.map(function(itemId){return removeItem(itemId,options)})}function restoreItem(itemId,options){return http.post(settings.apiUrl+"/trash/files/"+itemId+"/restore",null,{withCredentials:!0,headers:options.headers||{}}).then(function(res){return res.data={id:itemId},res})["catch"](failHandler)}function restore(itemsId,options){return options=options||{},itemsId.map(function(itemId){return restoreItem(itemId,options)})}var defaultPaging={size:50,cursor:null},defaultSort={order:"date",direction:"desc"};return{list:list,remove:remove,restore:restore}}}(bluebird_extended,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_private_mappers_item,bower_components_wixmp_manager_src_sources_private_parsers_error),bower_components_wixmp_manager_src_sources_private_folderstrash=function(Promise,utils,toFolder,toError){return function(settings,http){function failHandler(reason){return toError(reason)}function mapFolderList(res){return res.data=(res.data.trash_folders||[]).map(function(_folder){var folder=toFolder(_folder);return folder.isInTrash=!0,folder}),res}function list(folderId,options){return options=options||{},http.get(settings.apiUrl+"/files/getpage/trash",{media_type:options.mediaType||"picture",folder_id:folderId||null,trash_type:"folder"},{withCredentials:!0,headers:options.headers||{}}).then(mapFolderList)["catch"](failHandler)}function removeFolder(folderId,options){return http.post(settings.apiUrl+"/trash/folders/"+folderId+"/delete",null,{withCredentials:!0,headers:options.headers||{}}).then(function(res){return res.data={id:folderId},res})["catch"](failHandler)}function remove(folderIds,options){return options=options||{},folderIds.map(function(folderId){return removeFolder(folderId,options)})}function restoreFolder(folderId,options){return http.post(settings.apiUrl+"/trash/folders/"+folderId+"/restore",null,{withCredentials:!0,headers:options.headers||{}}).then(function(res){return res.data={id:folderId},res})["catch"](failHandler)}function restore(folderIds,options){return options=options||{},folderIds.map(function(folderId){return restoreFolder(folderId,options)})}return{list:list,remove:remove,restore:restore}}}(bluebird_extended,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_private_mappers_folder,bower_components_wixmp_manager_src_sources_private_parsers_error),bower_components_wixmp_manager_src_sources_private_settings={apiUrl:"//files.wix.com",imageOperationsApi:"vangogh",filesUrl:"//static.wixstatic.com",videoFilesUrl:"//video.wixstatic.com",refreshTokenUrl:null,uploadLimits:{"default":15728640,document:15728640,picture:15728640,music:52428800,video:524288e3,secureMusic:377487360},thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"},original:{width:1e3,height:1e3,mode:"fit"}},channel:{withCredentials:!0,jsapiUrl:"/_ah/channel/jsapi",tokenUrl:"/users/channel"},videoPreviewQuality:"480p"},bower_components_wixmp_manager_src_sources_decorators=function(Promise,notifier,utils){function addEvents(eventsTarget,events,methods){var methodsWithEvents={};return Object.keys(events).forEach(function(eventKey){var methodName=utils.snakeToCamel(eventKey.toLowerCase());return"object"==typeof methods[methodName]&&null!==methods[methodName]&&"object"==typeof events[eventKey]&&null!==events[eventKey]?void(methodsWithEvents[methodName]=addEvents(eventsTarget,events[eventKey],methods[methodName])):void("function"==typeof methods[methodName]&&(methodsWithEvents[methodName]=function(){var event,wrapped,args=arguments,promise=methods[methodName].apply(methods,args),params={arguments:args};return Array.isArray(promise)?(params.promises=promise,event=notifier.emit(eventsTarget,events[eventKey],params),promise.forEach(function(promise,index){var wrappedInner=promise.then(function(data){event.resolveAt(index,data)},function(reason){event.rejectAt(index,reason)});promise.progress(function(progress){wrappedInner.notify(progress)})}),promise):(event=notifier.emit(eventsTarget,events[eventKey],params),wrapped=promise.then(function(data){return event.resolve(data),data},function(reason){return event.reject(reason),Promise.reject(reason)}),promise.progress(function(progress){wrapped.notify(progress)}),wrapped)}))}),methodsWithEvents}return{addEvents:addEvents}}(bluebird_extended,bower_components_wixmp_manager_src_events_notifier,bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_events_list={FOLDERS:{LIST:"folders.list",REMOVE:"folders.remove",TRASH:{LIST:"folders.trash.list",RESTORE:"folders.trash.restore",REMOVE:"folders.trash.remove"}},FOLDER:{CREATE:"folder.create",UPDATE:"folder.update",REMOVE:"folder.remove"},ITEMS:{LIST:"items.list",SEARCH:"items.search",REMOVE:"items.remove",UPLOAD:"items.upload",UPLOAD_BY_URL:"items.uploadByUrl",SEARCH_BY_TAG:"items.searchByTag",TRASH:{LIST:"items.trash.list",RESTORE:"items.trash.restore",REMOVE:"items.trash.remove"}},ITEM:{GET:"item.get",UPDATE:"item.update",REMOVE:"item.remove",UPLOAD:"item.upload",UPLOAD_BY_URL:"item.uploadByUrl"},TRASH:{REMOVE:"trash.remove",RESTORE:"trash.restore"}},bower_components_wixmp_manager_src_services_channel_channel=function(Promise,http,utils,notifier,eventsList){return function(settings,adapter,itemMapper){function emitEvent(result){var event=notifier.emit(adapter,eventsList.ITEM.UPDATE,{arguments:[result.data,result.data]});event.resolve(result)}function open(){function onMessage(message){if(console.log("message received:",message),"server connected"!==message.data)try{if(message=JSON.parse(message.data),console.log(message),"status_update"===message.type)if("READY"===message.file.op_status)adapter.item.get(message.file.file_name).then(emitEvent);else{var result=itemMapper(message.file,settings,{},!0);emitEvent({data:result})}}catch(reason){console.log("something is wrong:",reason,reason.stack)}}function onClose(){console.log("socket is closing"),channel=null,socket=null}var def=Promise.defer();if(channel&&socket)def.resolve();else{var jsApiLoadPromise;jsApiLoadPromise=jsApiAlreadyLoaded?Promise.resolve():utils.getScript(settings.apiUrl+settings.channel.jsapiUrl).then(function(){jsApiAlreadyLoaded=!0}),jsApiLoadPromise.then(function(){return http.get(settings.apiUrl+settings.channel.tokenUrl,null,{withCredentials:settings.channel.withCredentials})}).then(function(tokenData){channel=new goog.appengine.Channel(tokenData.data.token),socket=channel.open(),socket.onmessage=onMessage,socket.onclose=onClose,def.resolve()})["catch"](function(reason){console.log("something is wrong:",reason),def.reject(reason)})}return def.promise}function close(){socket&&(socket.close(),channel=null,socket=null)}var channel=null,socket=null,jsApiAlreadyLoaded=!1;return{open:open,close:close}}}(bluebird_extended,bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_events_notifier,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_private_refresh_token_wrapper=function(Promise,http,utils){return function(refreshTokenUrl){function isRecentlyRefreshed(){return(new Date).valueOf()-refreshedAt<1e4}var authHeaders={},refreshedAt=0;return function(method){var methodWithAuthHeaders=function(){var originalHeaders=(arguments[2]||{}).headers||{};return method.call(this,arguments[0],arguments[1]||{},utils.merge(arguments[2]||{},{headers:utils.merge(authHeaders,originalHeaders)}))};return http.catchError(methodWithAuthHeaders,function(reason,callMethod){return 403!==reason.code||isRecentlyRefreshed()?Promise.reject(reason):http.post(refreshTokenUrl).then(function(response){return authHeaders=response.data.set_headers||{},refreshedAt=(new Date).valueOf(),callMethod()})})}}}(bluebird_extended,bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_private_Private=function(initFolders,initFolder,initItems,initItem,initTrash,initItemsTrash,initFoldersTrash,itemMapper,defaultSettings,utils,decorators,eventsList,initChannel,initRefreshTokenWrapper,http){return function(userSettings){var settings=utils.extend({},defaultSettings,userSettings),withRefreshToken=initRefreshTokenWrapper(settings.refreshTokenUrl),httpWithRefreshToken=settings.refreshTokenUrl?{get:withRefreshToken(http.get),post:withRefreshToken(http.post),upload:withRefreshToken(http.upload)}:http,folders=initFolders(settings,httpWithRefreshToken),folder=initFolder(settings,httpWithRefreshToken),items=initItems(settings,httpWithRefreshToken),item=initItem(settings,httpWithRefreshToken),trash=initTrash(settings,httpWithRefreshToken),itemsTrash=initItemsTrash(settings,httpWithRefreshToken),foldersTrash=initFoldersTrash(settings,httpWithRefreshToken),channel=initChannel(settings,this,itemMapper);folders.trash=foldersTrash,items.trash=itemsTrash,this.name="private",this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.folder=decorators.addEvents(this,eventsList.FOLDER,folder),this.item=decorators.addEvents(this,eventsList.ITEM,item),this.items=decorators.addEvents(this,eventsList.ITEMS,items),this.trash=decorators.addEvents(this,eventsList.TRASH,trash),this.channel=channel}}(bower_components_wixmp_manager_src_sources_private_folders,bower_components_wixmp_manager_src_sources_private_folder,bower_components_wixmp_manager_src_sources_private_items,bower_components_wixmp_manager_src_sources_private_item,bower_components_wixmp_manager_src_sources_private_trash,bower_components_wixmp_manager_src_sources_private_itemstrash,bower_components_wixmp_manager_src_sources_private_folderstrash,bower_components_wixmp_manager_src_sources_private_mappers_item,bower_components_wixmp_manager_src_sources_private_settings,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list,bower_components_wixmp_manager_src_services_channel_channel,bower_components_wixmp_manager_src_sources_private_refresh_token_wrapper,bower_components_wixmp_manager_src_utils_http),bower_components_wixmp_manager_src_sources_picasa_settings={apiUrl:"//pix.wix.com/services/google",foldersLimit:500,itemsLimit:50},bower_components_wixmp_manager_src_sources_picasa_mappers_folder=function(data){return{id:data.gphoto$id.$t,name:data.title.$t,mediaType:"picture",thumbnailUrl:data.media$group.media$thumbnail[0].url,parentId:null,filesCount:data.gphoto$numphotos.$t,createdAt:data.published.$t}},bower_components_wixmp_manager_src_sources_picasa_parsers_folders=function(toFolder){return function(res){return res.data=(res.data.feed.entry||[]).map(toFolder),res}}(bower_components_wixmp_manager_src_sources_picasa_mappers_folder),bower_components_wixmp_manager_src_sources_picasa_parsers_error=function(Promise){return function(response){return Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_picasa_folders=function(http,mapFolderList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={thumbsize:"150c","max-results":options.paging.pageSize||settings.foldersLimit,"start-index":options.paging.cursor||1};return http.get(settings.apiUrl+"/albums",requestOptions,{withCredentials:!0,headers:options.headers||{}}).then(mapFolderList)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_picasa_parsers_folders,bower_components_wixmp_manager_src_sources_picasa_parsers_error),bower_components_wixmp_manager_src_sources_picasa_mappers_item=function(utils){function getLastImage(mediaGroup){var images=mediaGroup.media$thumbnail.filter(function(item){return!item.medium||"video"!==item.medium});return images[images.length-1].url||""}return function(data){var lastImage,width,height,bigImage,preview;return lastImage=getLastImage(data.media$group),width=+data.gphoto$width.$t||1024,height=+data.gphoto$height.$t||768,bigImage=lastImage.replace(/\/s[0-9]+/,"/w"+width+"-h"+height+"-no"),preview=width>400?lastImage.replace(/\/s[0-9]+(-c)?/,"/s400"):bigImage,{id:data.id.$t,name:data.summary.$t||data.title.$t,mediaType:"picture",fileUrl:utils.normalizeUri(bigImage),thumbnailUrl:utils.normalizeUri(lastImage),previewUrl:utils.normalizeUri(preview),createdAt:data.published.$t,tags:[],width:width,height:height}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_picasa_parsers_items=function(toItem){return function(res){var paging={cursor:res.data.feed.openSearch$startIndex.$t+res.data.feed.openSearch$itemsPerPage.$t,pageSize:res.data.feed.openSearch$itemsPerPage.$t};return res.data=(res.data.feed.entry||[]).map(toItem),res.paging=paging,res}}(bower_components_wixmp_manager_src_sources_picasa_mappers_item),bower_components_wixmp_manager_src_sources_picasa_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={album_id:folderId||null,kind:"photo",thumbsize:"150c","max-results":options.paging.pageSize||settings.itemsLimit,"start-index":options.paging.cursor||1};return http.get(settings.apiUrl+"/photos",requestOptions,{withCredentials:!0,headers:options.headers||{}}).then(mapItemList)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_picasa_parsers_items,bower_components_wixmp_manager_src_sources_picasa_parsers_error),bower_components_wixmp_manager_src_sources_picasa_Picasa=function(settings,initFolders,initItems,decorators,eventsList){return function(){var folders=initFolders(settings),items=initItems(settings);this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items),this.name="picasa"}}(bower_components_wixmp_manager_src_sources_picasa_settings,bower_components_wixmp_manager_src_sources_picasa_folders,bower_components_wixmp_manager_src_sources_picasa_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_drive_settings={apiUrl:"//pix.wix.com/services/gdrive",foldersLimit:500,itemsLimit:50},bower_components_wixmp_manager_src_sources_drive_mappers_folder=function(data){return{id:data.id,name:data.title,mediaType:"picture",parentId:data.parents[0].id,filesCount:1,createdAt:data.createdDate}},bower_components_wixmp_manager_src_sources_drive_parsers_folders=function(toFolder){return function(res){return res.data=(res.data.items||[]).map(toFolder),res}}(bower_components_wixmp_manager_src_sources_drive_mappers_folder),bower_components_wixmp_manager_src_sources_drive_parsers_error=function(Promise){return function(response){return Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_drive_folders=function(http,mapFolderList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={"max-results":options.paging.pageSize||settings.foldersLimit,"start-index":options.paging.cursor||1};return folderId&&(requestOptions.album_id=folderId),http.get(settings.apiUrl+"/albums",requestOptions,{withCredentials:!0}).then(mapFolderList)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_drive_parsers_folders,bower_components_wixmp_manager_src_sources_drive_parsers_error),bower_components_wixmp_manager_src_sources_drive_mappers_item=function(utils){return function(data){return{id:data.id,name:data.title,mediaType:"picture",fileUrl:utils.normalizeUri(data.fixedDownloadUrl||data.webContentLink),thumbnailUrl:data.thumbnailLink?utils.normalizeUri(data.thumbnailLink):null,previewUrl:data.thumbnailLink?utils.normalizeUri(data.thumbnailLink):null,createdAt:data.createdDate,tags:[],width:data.imageMediaMetadata.width,height:data.imageMediaMetadata.height}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_drive_parsers_items=function(toItem){return function(res){return res.data=(res.data.items||[]).map(toItem),res.paging={},res}}(bower_components_wixmp_manager_src_sources_drive_mappers_item),bower_components_wixmp_manager_src_sources_drive_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={album_id:folderId||null,"max-results":options.paging.pageSize||settings.itemsLimit,"start-index":options.paging.cursor||1};return http.get(settings.apiUrl+"/photos",requestOptions,{withCredentials:!0}).then(mapItemList,failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_drive_parsers_items,bower_components_wixmp_manager_src_sources_drive_parsers_error),bower_components_wixmp_manager_src_sources_drive_Drive=function(settings,initFolders,initItems,decorators,eventsList){return function(){var folders=initFolders(settings),items=initItems(settings);this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items),this.name="drive"}}(bower_components_wixmp_manager_src_sources_drive_settings,bower_components_wixmp_manager_src_sources_drive_folders,bower_components_wixmp_manager_src_sources_drive_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_dropbox_settings={apiUrl:"//pix.wix.com/services/dropbox",foldersLimit:500,itemsLimit:50},bower_components_wixmp_manager_src_sources_dropbox_mappers_folder=function(data){return{id:data.path,name:data.path.substr(data.path.lastIndexOf("/")+1),mediaType:"picture",parentId:null,filesCount:1,createdAt:data.modified}},bower_components_wixmp_manager_src_sources_dropbox_parsers_folders=function(toFolder){return function(res){return res.data=(res.data||[]).map(toFolder),res}}(bower_components_wixmp_manager_src_sources_dropbox_mappers_folder),bower_components_wixmp_manager_src_sources_dropbox_parsers_error=function(Promise){return function(response){return Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_dropbox_folders=function(http,mapFolderList,toError){
return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={"max-results":options.paging.pageSize||settings.foldersLimit,"start-index":options.paging.cursor||1};return folderId&&(requestOptions.album_id=folderId),http.get(settings.apiUrl+"/albums",requestOptions,{withCredentials:!0}).then(mapFolderList)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_dropbox_parsers_folders,bower_components_wixmp_manager_src_sources_dropbox_parsers_error),bower_components_wixmp_manager_src_sources_dropbox_mappers_item=function(utils){return function(data){var fileName=data.path.substr(data.path.lastIndexOf("/")+1);return{id:data.path,name:fileName,mediaType:"picture",fileUrl:utils.normalizeUri(data.fixedDownloadUrl),thumbnailUrl:null,previewUrl:utils.normalizeUri("http://pix.wix.com/services/dropbox/thumb?path="+data.path+"&size=l"),createdAt:data.client_mtime,tags:[]}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_dropbox_parsers_items=function(toItem){return function(res){return res.data=(res.data||[]).map(toItem),res.paging={},res}}(bower_components_wixmp_manager_src_sources_dropbox_mappers_item),bower_components_wixmp_manager_src_sources_dropbox_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={album_id:folderId||null,"max-results":options.paging.pageSize||settings.itemsLimit,"start-index":options.paging.cursor||1};return http.get(settings.apiUrl+"/photos",requestOptions,{withCredentials:!0}).then(mapItemList,failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_dropbox_parsers_items,bower_components_wixmp_manager_src_sources_dropbox_parsers_error),bower_components_wixmp_manager_src_sources_dropbox_Dropbox=function(settings,initFolders,initItems,decorators,eventsList){return function(){var folders=initFolders(settings),items=initItems(settings);this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items),this.name="dropbox"}}(bower_components_wixmp_manager_src_sources_dropbox_settings,bower_components_wixmp_manager_src_sources_dropbox_folders,bower_components_wixmp_manager_src_sources_dropbox_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_instagram_settings={apiUrl:"//pix.wix.com/services/instagram",api2Url:"//pix.wix.com/services/instagram2"},bower_components_wixmp_manager_src_sources_instagram_mappers_folder=function(data){return{id:"Instagram",name:"Instagram",mediaType:"picture",parentId:null,filesCount:data.counts.media,createdAt:null}},bower_components_wixmp_manager_src_sources_instagram_parsers_folders=function(toFolder){return function(data){return{data:[toFolder(data)]}}}(bower_components_wixmp_manager_src_sources_instagram_mappers_folder),bower_components_wixmp_manager_src_sources_instagram_parsers_error=function(Promise){return function(response){return 500===response.code&&(response.code=403,response.data={message:"Unauthorized",result:"error"}),Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_instagram_folders=function(http,toFolders,toError){return function(settings){function successHandler(response){return toFolders(response.data)}function failHandler(reason){return toError(reason)}function list(folderId,options){return options=options||{},http.get(settings.apiUrl+"/user",null,{withCredentials:!0,headers:options.headers||{}}).then(successHandler)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_instagram_parsers_folders,bower_components_wixmp_manager_src_sources_instagram_parsers_error),bower_components_wixmp_manager_src_sources_instagram_mappers_item=function(utils){return function(data){return data.caption||(data.caption={text:""}),{id:data.id,name:data.caption.text,mediaType:"picture",fileUrl:utils.normalizeUri(data.images.standard_resolution.url),thumbnailUrl:utils.normalizeUri(data.images.low_resolution.url),previewUrl:utils.normalizeUri(data.images.standard_resolution.url),createdAt:1e3*+data.created_time,tags:utils.splitTags(data.tags),width:data.images.standard_resolution.width,height:data.images.standard_resolution.height}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_instagram_parsers_items=function(toItem){return function(res){res.data.next=res.data.next||{};var cursor=res.data.next.max_id||null,pageSize=res.data.next.count||null;return res.data=(res.data.photos||[]).map(toItem),res.paging={cursor:cursor,pageSize:pageSize},res}}(bower_components_wixmp_manager_src_sources_instagram_mappers_item),bower_components_wixmp_manager_src_sources_instagram_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={count:options.paging.pageSize||50,max_id:options.paging.cursor||null};return http.get(settings.api2Url+"/photos",requestOptions,{withCredentials:!0,headers:options.headers||{}}).then(mapItemList)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_instagram_parsers_items,bower_components_wixmp_manager_src_sources_instagram_parsers_error),bower_components_wixmp_manager_src_sources_instagram_Instagram=function(settings,initFolders,initItems,decorators,eventsList){return function(){var folders=initFolders(settings),items=initItems(settings);this.name="instagram",this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items)}}(bower_components_wixmp_manager_src_sources_instagram_settings,bower_components_wixmp_manager_src_sources_instagram_folders,bower_components_wixmp_manager_src_sources_instagram_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_facebook_settings={apiUrl:"//pix.wix.com/services/facebook2",foldersLimit:50,itemsLimit:50},bower_components_wixmp_manager_src_sources_facebook_mappers_folder=function(utils){return function(data,settings){return{id:data.id,name:data.name,mediaType:"picture",parentId:null,thumbnailUrl:utils.normalizeUri(settings.apiUrl+"/picture?type=album&album_id="+data.id),filesCount:data.count,createdAt:data.created_time}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_facebook_parsers_folders=function(toFolder){return function(settings,res){return res.data=(res.data.data||[]).map(function(data){return toFolder(data,settings)}),res}}(bower_components_wixmp_manager_src_sources_facebook_mappers_folder),bower_components_wixmp_manager_src_sources_facebook_parsers_error=function(Promise){return function(response){return 400===response.code&&190===response.data.code&&(response.code=403),Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_facebook_folders=function(http,utils,mapFolderList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderID,options){options=options||{},options.paging=options.paging||{};var requestOptions={limit:options.paging.pageSize||settings.foldersLimit,after:options.paging.cursor||null};return http.get(settings.apiUrl+"/albums",requestOptions,{withCredentials:!0,headers:options.headers||{}}).then(utils.partial(mapFolderList,settings))["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_facebook_parsers_folders,bower_components_wixmp_manager_src_sources_facebook_parsers_error),bower_components_wixmp_manager_src_sources_facebook_mappers_item=function(utils){function findThumbnailUrl(images,minWidth,minHeight){minHeight=minHeight||190,minWidth=minWidth||190;var bigImages,biggestImage,smallestImage;return 1===images.length?images[0].source:(bigImages=images.filter(function(image){return image.width>minWidth&&image.height>minHeight}),(smallestImage=utils.min(bigImages,function(image){return image.width+image.height}))?smallestImage.source:(biggestImage=utils.max(images,function(image){return image.width+image.height}),biggestImage.source))}return function(data){return{id:data.id,folderId:null,name:data.name||"",mediaType:"picture",fileUrl:utils.normalizeUri(data.source),thumbnailUrl:utils.normalizeUri(findThumbnailUrl(data.images)),previewUrl:utils.normalizeUri(data.source),createdAt:data.created_time,tags:[],width:data.width,height:data.height}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_facebook_parsers_items=function(toItem){return function(res){var cursor;return res.data.paging&&res.data.paging.cursors&&(cursor=res.data.paging.cursors.after),res.data=(res.data.data||[]).map(toItem),res.paging={cursor:cursor||null,pageSize:null},res}}(bower_components_wixmp_manager_src_sources_facebook_mappers_item),bower_components_wixmp_manager_src_sources_facebook_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={album_id:folderId,limit:options.paging.pageSize||settings.itemsLimit,after:options.paging.cursor||null};return http.get(settings.apiUrl+"/photos",requestOptions,{withCredentials:!0,headers:options.headers||{}}).then(mapItemList)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_facebook_parsers_items,bower_components_wixmp_manager_src_sources_facebook_parsers_error),bower_components_wixmp_manager_src_sources_facebook_Facebook=function(settings,initFolders,initItems,decorators,eventsList){return function(){var folders=initFolders(settings),items=initItems(settings);this.name="facebook",this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items)}}(bower_components_wixmp_manager_src_sources_facebook_settings,bower_components_wixmp_manager_src_sources_facebook_folders,bower_components_wixmp_manager_src_sources_facebook_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_flickr_settings={apiUrl:"//pix.wix.com/services/flickr",foldersLimit:50,itemsLimit:50},bower_components_wixmp_manager_src_sources_flickr_mappers_folder=function(data){return{id:data.id,name:data.title._content,mediaType:"picture",thumbnailUrl:data.primary_photo_extras.url_m||data.primary_photo_extras.url_s||data.primary_photo_extras.url_t,parentId:null,filesCount:+data.photos+ +data.videos,createdAt:1e3*+data.date_create}},bower_components_wixmp_manager_src_sources_flickr_parsers_folders=function(toFolder){return function(res){return res.data=(res.data.photosets.photoset||[]).map(toFolder),res}}(bower_components_wixmp_manager_src_sources_flickr_mappers_folder),bower_components_wixmp_manager_src_sources_flickr_parsers_error=function(Promise){return function(response){return Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_flickr_folders=function(http,mapFolderList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={primary_photo_extras:"url_t,url_s,url_m,url_b,url_o",per_page:options.paging.pageSize||settings.foldersLimit,page:options.paging.cursor||null};return http.get(settings.apiUrl+"/albums",requestOptions,{withCredentials:!0,headers:options.headers||{}}).then(mapFolderList)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_flickr_parsers_folders,bower_components_wixmp_manager_src_sources_flickr_parsers_error),bower_components_wixmp_manager_src_sources_flickr_mappers_item=function(utils){function toThumbnails(photo){var thumbnail=photo.url_m||photo.url_s||photo.url_t,big=photo.url_b||thumbnail,original=photo.url_o||big;return{fileUrl:original,thumbnailUrl:thumbnail,previewUrl:big}}return function(data){var thumbnails=toThumbnails(data);return{id:data.id,name:data.title,folderId:null,mediaType:"picture",fileUrl:utils.normalizeUri(thumbnails.fileUrl),thumbnailUrl:utils.normalizeUri(thumbnails.thumbnailUrl),previewUrl:utils.normalizeUri(thumbnails.previewUrl),createdAt:null,tags:[],width:+(data.width_o||data.width_m||data.width_s||data.width_t),height:+(data.height_o||data.height_m||data.height_s||data.height_t)}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_flickr_parsers_items=function(toItem){return function(res){var cursor=res.data.photoset.page<res.data.photoset.pages?res.data.photoset.page+1:null,pageSize=+res.data.photoset.perpage;return res.data=(res.data.photoset.photo||[]).map(toItem),res.paging={cursor:cursor,pageSize:pageSize},res}}(bower_components_wixmp_manager_src_sources_flickr_mappers_item),bower_components_wixmp_manager_src_sources_flickr_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={extras:"url_t,url_s,url_m,url_b,url_o",set_id:folderId,per_page:options.paging.pageSize||settings.itemsLimit,page:options.paging.cursor||null};return http.get(settings.apiUrl+"/photoset",requestOptions,{withCredentials:!0,headers:options.headers||{}}).then(mapItemList)["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_flickr_parsers_items,bower_components_wixmp_manager_src_sources_flickr_parsers_error),bower_components_wixmp_manager_src_sources_flickr_Flickr=function(settings,initFolders,initItems,decorators,eventsList){return function(){var folders=initFolders(settings),items=initItems(settings);this.name="flickr",this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items)}}(bower_components_wixmp_manager_src_sources_flickr_settings,bower_components_wixmp_manager_src_sources_flickr_folders,bower_components_wixmp_manager_src_sources_flickr_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_flickr_search_settings={apiUrl:"//pix.wix.com/services/flickr/search",itemsLimit:50},bower_components_wixmp_manager_src_sources_flickr_search_mappers_item=function(utils){function toThumbnails(photo){var thumbnail=photo.url_m||photo.url_s||photo.url_t,big=photo.url_b||thumbnail,original=photo.url_o||big;return{fileUrl:original,thumbnailUrl:thumbnail,previewUrl:big}}return function(data){var thumbnails=toThumbnails(data);return{id:data.id,name:data.title,folderId:null,mediaType:"picture",fileUrl:utils.normalizeUri(thumbnails.fileUrl),thumbnailUrl:utils.normalizeUri(thumbnails.thumbnailUrl),previewUrl:utils.normalizeUri(thumbnails.previewUrl),createdAt:null,tags:[],width:+(data.width_o||data.width_m||data.width_s||data.width_t),height:+(data.height_o||data.height_m||data.height_s||data.height_t)}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_flickr_search_parsers_items=function(toItem){return function(res){var cursor=res.data.photos.page<res.data.photos.pages?res.data.photos.page+1:null,pageSize=+res.data.photos.perpage;return res.data=(res.data.photos.photo||[]).map(toItem),res.paging={cursor:cursor,pageSize:pageSize},res}}(bower_components_wixmp_manager_src_sources_flickr_search_mappers_item),bower_components_wixmp_manager_src_sources_flickr_search_parsers_error=function(Promise){return function(response){return Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_flickr_search_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function search(folderId,query,options){options=options||{},options.paging=options.paging||{};var requestOptions={extras:"url_t,url_s,url_m,url_b,url_o",q:query,per_page:options.paging.pageSize||settings.itemsLimit,page:options.paging.cursor||null};return http.get(settings.apiUrl,requestOptions,{withCredentials:!1,headers:options.headers||{}}).then(mapItemList)["catch"](failHandler)}return{search:search}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_flickr_search_parsers_items,bower_components_wixmp_manager_src_sources_flickr_search_parsers_error),bower_components_wixmp_manager_src_sources_flickr_search_FlickrSearch=function(settings,initItems,decorators,eventsList){return function(){var items=initItems(settings);this.name="flickrSearch",this.items=decorators.addEvents(this,eventsList.ITEMS,items)}}(bower_components_wixmp_manager_src_sources_flickr_search_settings,bower_components_wixmp_manager_src_sources_flickr_search_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_google_search_settings={apiUrl:"//pix.wix.com/services/gcs/images",itemsLimit:50},bower_components_wixmp_manager_src_sources_google_search_mappers_item=function(utils){return function(data){return{id:data.link,name:(data.title||"").replace(/<\/?[a-z]+.*?>/gi,""),folderId:null,mediaType:"picture",fileUrl:utils.normalizeUri(data.link),thumbnailUrl:utils.normalizeUri(data.image.thumbnailLink||data.link),previewUrl:utils.normalizeUri(data.link),createdAt:null,tags:[],width:+data.image.width,height:+data.image.height}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_google_search_parsers_items=function(toItem){return function(res){var cursor=null,pageSize=null;return res.data.queries&&res.data.queries.nextPage&&res.data.queries.nextPage[0]&&(cursor=res.data.queries.nextPage[0].startIndex,pageSize=res.data.queries.nextPage[0].count),res.data=(res.data.items||[]).map(toItem),res.paging={cursor:cursor,pageSize:pageSize},res}}(bower_components_wixmp_manager_src_sources_google_search_mappers_item),bower_components_wixmp_manager_src_sources_google_search_parsers_error=function(Promise){return function(response){return Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_google_search_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function search(folderId,query,options){options=options||{},options.paging=options.paging||{};var requestOptions={q:query,count:options.paging.pageSize||settings.itemsLimit,start:options.paging.cursor||null};return options.excludeQuery&&(requestOptions.filter=options.excludeQuery),http.get(settings.apiUrl,requestOptions,{withCredentials:!1,headers:options.headers||{}}).then(mapItemList)["catch"](failHandler)}return{search:search}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_google_search_parsers_items,bower_components_wixmp_manager_src_sources_google_search_parsers_error),bower_components_wixmp_manager_src_sources_google_search_GoogleSearch=function(settings,initItems,decorators,eventsList){return function(){var items=initItems(settings);this.name="googleSearch",this.items=decorators.addEvents(this,eventsList.ITEMS,items)}}(bower_components_wixmp_manager_src_sources_google_search_settings,bower_components_wixmp_manager_src_sources_google_search_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_collection_settings={apiUrl:"//collections.wixstatic.com/collections",filesUrl:"//static.wixstatic.com",collectionId:"68c4b99f-d5b7-4583-b1d1-e00e31605678",imageOperationsApi:"vangogh",itemsLimit:50},bower_components_wixmp_manager_src_sources_collection_mappers_folder=function(utils){return function(data){return{id:data.id,parentId:data.public_properties.parent_id||null,name:data.title,mediaType:data.type,filesCount:data.public_properties.files_count,thumbnailUrl:data.public_properties.thumbnail_url?utils.normalizeUri(data.public_properties.thumbnail_url):null,createdAt:data.date_created}}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_sources_collection_parsers_selector=function(entities,parentId,isFolder){return entities.filter(function(entity){return isFolder?!entity.public_properties.file_url&&(parentId?entity.public_properties.parent_id===parentId:!entity.public_properties.parent_id):entity.public_properties.file_url&&(parentId?entity.public_properties.folder_id===parentId:!entity.public_properties.folder_id)})},bower_components_wixmp_manager_src_sources_collection_parsers_folders=function(toFolder,select){return function(res,folderId,currentPaging){var foldersData=select(res.data.collection.items,folderId,!0),paging={cursor:currentPaging.cursor+currentPaging.pageSize,pageSize:foldersData.length-currentPaging.cursor};return res.data=foldersData.map(function(data){var folder=toFolder(data,res.data.collection.items);return folder.filesCount=folder.filesCount||select(res.data.collection.items,folder.id,!1).length,folder}),paging.pageSize>0&&(res.paging=paging),res}}(bower_components_wixmp_manager_src_sources_collection_mappers_folder,bower_components_wixmp_manager_src_sources_collection_parsers_selector),bower_components_wixmp_manager_src_sources_collection_parsers_error=function(Promise){return function(response){return Promise.reject(response)}}(bluebird_extended),bower_components_wixmp_manager_src_sources_collection_folders=function(http,mapFolderList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){return options=options||{},options.paging=options.paging||{},options.paging.cursor=options.paging.cursor||0,options.paging.pageSize=options.paging.pageSize||settings.itemsLimit,http.get(settings.apiUrl+"/"+settings.collectionId+".json",{},{withCredentials:!1,headers:options.headers||{}}).then(function(res){return mapFolderList(res,folderId,options.paging)})["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_collection_parsers_folders,bower_components_wixmp_manager_src_sources_collection_parsers_error),bower_components_wixmp_manager_src_sources_collection_mappers_item=function(mappers,utils,imagesGenerators){return function(data,settings,thumbnailSizes){var normalizeUri=utils.normalizeUri,item={id:data.id,folderId:data.public_properties.folder_id||null,name:data.title,mediaType:data.type,fileUrl:data.public_properties.file_url?normalizeUri(data.public_properties.file_url):null,thumbnailUrl:data.public_properties.thumbnail_url?normalizeUri(data.public_properties.thumbnail_url):null,createdAt:data.date_created,tags:utils.splitTags(data.tags),width:data.public_properties.width||null,height:data.public_properties.height||null},sizes=utils.extend({},settings.thumbnailSizes,thumbnailSizes);return utils.extend(item,imagesGenerators.insertSizes(item,sizes,settings)),data.public_properties.thumbnail_url&&(item.thumbnailUrl=normalizeUri(data.public_properties.thumbnail_url)),Object.keys(sizes).forEach(function(thumbName){item[thumbName+"Url"]||(item[thumbName+"Url"]=item.thumbnailUrl)}),Object.keys(item).forEach(function(prop){void 0===item[prop]&&delete item[prop]}),item}}(bower_components_wixmp_manager_src_utils_mappers,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_utils_images_generators),bower_components_wixmp_manager_src_sources_collection_parsers_items=function(toItem,select){return function(res,folderId,currentPaging,settings,thumbnailSizes){var itemsData=select(res.data.collection.items,folderId,!1),paging={cursor:currentPaging.cursor+currentPaging.pageSize,pageSize:itemsData.length-currentPaging.cursor};return res.data=itemsData.map(function(data){return toItem(data,settings,thumbnailSizes)}),paging.pageSize>0&&(res.paging=paging),res}}(bower_components_wixmp_manager_src_sources_collection_mappers_item,bower_components_wixmp_manager_src_sources_collection_parsers_selector),bower_components_wixmp_manager_src_sources_collection_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){return options=options||{},options.paging=options.paging||{},options.paging.cursor=options.paging.cursor||0,options.paging.pageSize=options.paging.pageSize||settings.itemsLimit,http.get(settings.apiUrl+"/"+settings.collectionId+".json",{},{withCredentials:!1,headers:options.headers||{}}).then(function(res){return mapItemList(res,folderId,options.paging,settings,options.thumbnails)})["catch"](failHandler)}return{list:list}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_sources_collection_parsers_items,bower_components_wixmp_manager_src_sources_collection_parsers_error),bower_components_wixmp_manager_src_sources_collection_Collection=function(defaultSettings,initFolders,initItems,decorators,utils,eventsList){return function(userSettings){var settings=utils.extend({},defaultSettings,userSettings),folders=initFolders(settings),items=initItems(settings);this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items),this.name="collection"}}(bower_components_wixmp_manager_src_sources_collection_settings,bower_components_wixmp_manager_src_sources_collection_folders,bower_components_wixmp_manager_src_sources_collection_items,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_events_list),bower_components_wixmp_manager_src_sources_list=function(Private,Picasa,Drive,Dropbox,Instagram,Facebook,Flickr,FlickrSearch,GoogleSearch,Collection){var sources={PRIVATE:Private,PICASA:Picasa,DRIVE:Drive,DROPBOX:Dropbox,INSTAGRAM:Instagram,FACEBOOK:Facebook,FLICKR:Flickr,FLICKR_SEARCH:FlickrSearch,GOOGLE_SEARCH:GoogleSearch,COLLECTION:Collection};return sources}(bower_components_wixmp_manager_src_sources_private_Private,bower_components_wixmp_manager_src_sources_picasa_Picasa,bower_components_wixmp_manager_src_sources_drive_Drive,bower_components_wixmp_manager_src_sources_dropbox_Dropbox,bower_components_wixmp_manager_src_sources_instagram_Instagram,bower_components_wixmp_manager_src_sources_facebook_Facebook,bower_components_wixmp_manager_src_sources_flickr_Flickr,bower_components_wixmp_manager_src_sources_flickr_search_FlickrSearch,bower_components_wixmp_manager_src_sources_google_search_GoogleSearch,bower_components_wixmp_manager_src_sources_collection_Collection),bower_components_wixmp_manager_src_events_events=function(notifier,list,utils){function defineNonEnumerableProperty(name,value){Object.defineProperty(events,name,{enumerable:!1,value:value})}var events=utils.merge(list);return defineNonEnumerableProperty("on",notifier.addListener),defineNonEnumerableProperty("off",notifier.removeListener),events}(bower_components_wixmp_manager_src_events_notifier,bower_components_wixmp_manager_src_events_list,bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_connector_connector_settings={PICASA:{connectUrl:"//pix.wix.com/services/google/connect",disconnectUrl:"//pix.wix.com/services/google/disconnect",parameterName:"goglact"},DRIVE:{connectUrl:"//pix.wix.com/services/gdrive/connect",disconnectUrl:"//pix.wix.com/services/gdrive/disconnect",parameterName:"gdrvact"},DROPBOX:{connectUrl:"//pix.wix.com/services/dropbox/connect",disconnectUrl:"//pix.wix.com/services/dropbox/disconnect",parameterName:"dbact"},INSTAGRAM:{connectUrl:"//pix.wix.com/services/instagram/connect",disconnectUrl:"//pix.wix.com/services/instagram/disconnect",parameterName:"instact"},FACEBOOK:{connectUrl:"//pix.wix.com/services/facebook/connect",disconnectUrl:"//pix.wix.com/services/facebook/disconnect",parameterName:"fbact"},FLICKR:{connectUrl:"//pix.wix.com/services/flickr/connect",disconnectUrl:"//pix.wix.com/services/flickr/disconnect",parameterName:"flact"}},bower_components_wixmp_manager_src_connector_connector=function(Promise,connectorSettings,http,utils,mappers){return function(adapterName,userSettings){function getParameterName(){return settings.parameterName}function isConnected(){return!!localStorage.getItem(settings.parameterName)}function disconnect(){return localStorage.removeItem(settings.parameterName),http.get(settings.disconnectUrl,null,{withCredentials:!0})}function connect(){var promise;return window.open(settings.connectUrl+"?return_url="+userSettings.redirectUrl,"connector","width=950,height=550"),promise=new Promise(function(resolve,reject){window.connectService=function(data){var token,status;token=utils.getParameterByName(data,getParameterName()),status=utils.getParameterByName(data,"status"),!token||status&&"FAIL"===status?reject(mappers.toError({code:401,message:"Not Authorized"})):resolve(token)}}),promise.then(function(token){localStorage.setItem(settings.parameterName,token)},function(reason){return reason}),promise}var settings=connectorSettings[adapterName];if("object"!=typeof settings)throw new Error("Invalid source");return{isConnected:isConnected,disconnect:disconnect,connect:connect}}}(bluebird_extended,bower_components_wixmp_manager_src_connector_connector_settings,bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_utils_mappers),bower_components_wixmp_manager_src_services_bi_events_ids={severity:{info:10,warning:20,error:30,fatal:40},BIEventsIds:{responseTime:"110",uploadSpeed:"142",uploadQueueStarted:"303",uploadQueueFinished:"304"},BIAdaptersIds:{"private":"01","public":"02",facebook:"03",flickr:"04",instagram:"05",picasa:"06",flickrSearch:"07",googleSearch:"08"},BIAdaptersRequestsIds:{"folders.list":"01","folder.create":"02","folder.rename":"03","folder.remove":"04","items.list":"11","item.upload":"12","item.uploadByUrl":"13","item.update":"14","item.remove":"15","items.search":"17"}},bower_components_wixmp_manager_src_services_bi_send_request=function(utils){function getBaseHost(){return/\.wixpress\.com/i.test(document.location.host)||/local\./i.test(document.location.host)?"//frog.wixpress.com":"//frog.wix.com"}return function(url,data){var biImage=document.createElement("img");biImage.setAttribute("src",getBaseHost()+url+"?"+utils.encodeParams(data)),biImage=null}}(bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_services_bi_benchmarks=function(BIEventIds,send){function getCurrentTime(){return(new Date).getTime()}function notifyResponseTime(adapter,eventName,data){var requestName=adapter.name+"("+eventName+")",responseTime=getCurrentTime()-data.startedAt;send("/mg",{evid:BIEventIds.BIEventsIds.responseTime,call_name:requestName||"",result:data.isSuccess?"success":"fail",response_speed:Math.floor((data.responseSize||0)/(responseTime/1e3)),response_time:responseTime||0,response_size:data.responseSize})}function benchmarkResponse(promise,params){var startedAt=getCurrentTime();
promise.then(function(result){notifyResponseTime(params.eventTarget,params.eventName,{startedAt:startedAt,responseSize:result.responseSize,isSuccess:!0})})["catch"](function(result){notifyResponseTime(params.eventTarget,params.eventName,{startedAt:startedAt,responseSize:result.responseSize,isSuccess:!1})})}function benchmarkUpload(promise,params){var startedAt=getCurrentTime(),fileSize=params.arguments[0].file.size;10240>fileSize||promise.then(function(){var responseTime=(getCurrentTime()-startedAt)/1e3;1>responseTime||send("/mg",{evid:BIEventIds.BIEventsIds.uploadSpeed,time_seconds:Math.floor(responseTime),size_bytes:fileSize,bytes_per_second:Math.floor(fileSize/responseTime)})})}return{response:benchmarkResponse,upload:benchmarkUpload}}(bower_components_wixmp_manager_src_services_bi_events_ids,bower_components_wixmp_manager_src_services_bi_send_request),bower_components_wixmp_manager_src_services_bi_errors=function(BIEventIds,send){var catalogIds={"default":0,"private":1,"public":2,bigstock:4,drive:5,dropbox:6,facebook:7,flickr:8,instagram:9,picasa:10};return function(adapterName,eventName,response,options){var httpCode=response.code||"000",adapterCode=BIEventIds.BIAdaptersIds[adapterName]||"00",requestCode=BIEventIds.BIAdaptersRequestsIds[eventName]||"00",errorDesc=adapterName+" "+eventName+": "+response.message,errorCode=adapterCode+requestCode+httpCode;return send("/trg",{src:25,evid:10,cat:catalogIds[adapterName]||catalogIds["default"],iss:1,sev:BIEventIds.severity.error,errc:errorCode||"0000000",ver:"MEDIA_GALLERY_VERSION",did:options.siteId||"",httpc:httpCode||"000",ts:options.requestTimeMs||"",dsc:errorDesc||""})}}(bower_components_wixmp_manager_src_services_bi_events_ids,bower_components_wixmp_manager_src_services_bi_send_request),bower_components_wixmp_manager_src_services_upload_file_to_upload=function(Promise){function canAbort(fileToUpload){return"waiting"===fileToUpload.status||"uploading"===fileToUpload.status&&Promise.prototype.cancellable}function abortEarly(fileToUpload){fileToUpload.deferred.promise["catch"](function(reason){fileToUpload.status="failed",fileToUpload.error=reason}),fileToUpload.deferred.promise.abort()}function initUpload(fileToUpload,data){fileToUpload.status="uploading",fileToUpload.uploadPromise=data.uploadFn(fileToUpload.source).progress(function(progress){fileToUpload.deferred.promise.notify(progress)}).then(function(res){fileToUpload.deferred.resolve(res)})["catch"](function(reason){fileToUpload.status="failed",fileToUpload.error=reason,fileToUpload.deferred.reject(reason)})}function createDeferred(){var deferred=Promise.defer();return deferred.promise["catch"](function(reason){console.log(reason)}),deferred}function map(data){return{source:data.source,status:"waiting",bytesLoaded:0,deferred:createDeferred(),isAborted:!1,error:{},upload:function(){return this.isAborted||initUpload(this,data),this.deferred.promise},abort:function(){return canAbort(this)?(this.isAborted=!0,"waiting"===this.status?void abortEarly(this):void this.uploadPromise.abort()):void 0},canRetry:function(){if(this.error instanceof Promise.CancellationError)return!0;var codesToRetry=[-201,401,403,408];return"failed"===this.status&&-1!==codesToRetry.indexOf(this.error.code)},signUpForRetry:function(){this.status="waiting",this.isAborted=!1,this.error={},this.deferred=createDeferred()},canAbort:function(){return canAbort(this)}}}return map}(bluebird_extended),bower_components_wixmp_manager_src_services_upload_upload_collection=function(Promise,fileToUploadMapper){function filterEvents(eventName){return function(event){return event.name===eventName}}function on(eventNames,callback){"string"==typeof eventNames&&(eventNames=[eventNames]),eventNames.forEach(function(eventName){if(!supportedEvents.indexOf(eventName))throw new Error("This event"+eventName+"is not supported by multiple file uploader");events.push({name:eventName,fn:callback})})}function emit(eventName,args){var __slice=[].slice;args=arguments.length>=2?__slice.call(arguments,1):[],events.filter(filterEvents(eventName)).forEach(function(event){event.fn.apply({event:eventName},args)})}function hasFilesToRetry(){return 0!==uploadQueue.filter(function(fileToUpload){return"waiting"===fileToUpload.status}).length}function hasRetryableFiles(){return uploadQueue.some(function(fileToUpload){return fileToUpload.canRetry()})}function dynamicPromiseReduce(itemsToUpload,callback){var currentItem=itemsToUpload[currentUploadingItemIdx];return currentItem&&"waiting"!==currentItem.status?(currentUploadingItemIdx++,dynamicPromiseReduce(itemsToUpload,callback)):currentItem||hasFilesToRetry()?!currentItem&&hasFilesToRetry()?(currentUploadingItemIdx=0,dynamicPromiseReduce(itemsToUpload,callback)):(callback(currentItem)["finally"](function(){currentUploadingItemIdx++,dynamicPromiseReduce(itemsToUpload,callback)}),uploadQueueDeferred.promise):(uploadIsInProgress=!1,currentUploadingItemIdx=0,uploadQueueDeferred.resolve(),uploadQueueDeferred.promise)}function getFileSize(fileToUpload){return fileToUpload.source.file?fileToUpload.source.file.size:1}function getBytesTotal(){return uploadQueue.reduce(function(sum,fileToUpload){return sum+getFileSize(fileToUpload)},0)}function calculateItemBytesLoaded(fileToUpload,progress){switch(progress.status){case"uploading":return progress.loaded<=getFileSize(fileToUpload)?progress.loaded:getFileSize(fileToUpload);case"succeeded":case"processing":return getFileSize(fileToUpload);case"failed":return 0;default:return 0}}function processItemProgress(fileToUpload){return function(progress){-1===["failed","succeeded"].indexOf(fileToUpload.status)?fileToUpload.status=progress.status:progress.status=fileToUpload.status,fileToUpload.bytesLoaded=progress.loaded>=getFileSize(fileToUpload)?getFileSize(fileToUpload):progress.loaded,progress.file=fileToUpload,emit("fileStatusChanged",{bytesTotalLoaded:currentUploadedTotal+calculateItemBytesLoaded(fileToUpload,progress),bytesTotal:getBytesTotal(),currentFileProgress:progress,currentFileQueueIdx:currentUploadingItemIdx})}}function uploadCurrentFile(fileToUpload){return fileToUpload.upload()}function signupUploadPromise(fileToUpload){var processCurrentItemProgress=processItemProgress(fileToUpload);fileToUpload.deferred.promise.progress(processCurrentItemProgress).then(function(result){fileToUpload.serverResponse=result,processCurrentItemProgress({status:"succeeded",total:getFileSize(fileToUpload),loaded:getFileSize(fileToUpload)}),currentUploadedTotal+=getFileSize(fileToUpload)})["catch"](function(reason){fileToUpload.serverResponse=reason,processCurrentItemProgress({status:"failed",total:getFileSize(fileToUpload),loaded:0})})}function startUploadQueue(){uploadQueueDeferred=Promise.defer(),emit("uploadQueueStarted",uploadQueue),dynamicPromiseReduce(uploadQueue,uploadCurrentFile)["finally"](function(){currentUploadingItemIdx=0,emit("uploadQueueFinished",uploadQueue)})}function clearQueue(){if(uploadIsInProgress)throw new Error("Upload queue can not be cleared while upload is running");uploadQueue.length=0,currentUploadedTotal=0}function upload(fileSources){fileSources=fileSources||[],uploadIsInProgress||hasRetryableFiles()||clearQueue();var mappedFiles=fileSources.map(fileToUploadMapper);return mappedFiles.forEach(function(fileToUpload){signupUploadPromise(fileToUpload);var nativeRetry=fileToUpload.signUpForRetry;fileToUpload.signUpForRetry=function(){nativeRetry.apply(this,arguments),signupUploadPromise(fileToUpload),uploadIsInProgress||(uploadIsInProgress=!0,startUploadQueue())},uploadQueue.push(fileToUpload)}),emit("queueChange",uploadQueue),uploadIsInProgress||(uploadIsInProgress=!0,startUploadQueue()),mappedFiles}var uploadQueueDeferred,uploadQueue=[],uploadIsInProgress=!1,currentUploadingItemIdx=0,currentUploadedTotal=0,supportedEvents=["queueChanged","fileStatusChanged","uploadQueueStarted","uploadQueueFinished"],events=[];return{on:on,upload:upload,clearQueue:clearQueue}}(bluebird_extended,bower_components_wixmp_manager_src_services_upload_file_to_upload),bower_components_wixmp_manager_src_services_bi_upload_queue=function(BIEventIds,send){function generateId(){for(var id="";id.length<32;)id+=Math.floor(1e16*Math.random());return[id.slice(0,8),id.slice(8,12),id.slice(12,16),id.slice(16,20),id.slice(20,32)].join("-")}function sendUploadStart(){currentUploadId=generateId(),send("/mg",{evid:BIEventIds.BIEventsIds.uploadQueueStarted,upload_queue_id:currentUploadId})}function sendUploadFinish(queue){send("/mg",{evid:BIEventIds.BIEventsIds.uploadQueueFinished,upload_queue_id:currentUploadId,files_count:queue.length})}var currentUploadId="";return{start:sendUploadStart,finish:sendUploadFinish}}(bower_components_wixmp_manager_src_services_bi_events_ids,bower_components_wixmp_manager_src_services_bi_send_request),bower_components_wixmp_manager_src_services_bi_bi=function(notifier,eventsList,benchmarks,sendError,Uploder,uploadQueue,utils){return function(isEnabled,options){function getCurrentTime(){return(new Date).getTime()}var biListener=function(promise,params){Array.isArray(promise)&&(promise=Promise.all(promise)),benchmarks.response(promise,params);var reportSuccess=function(){},requestStartTime=getCurrentTime(),reportError=function(response){var currentOptions=utils.extend({requestTimeMs:getCurrentTime()-requestStartTime},options);sendError(params.eventTarget.name,params.eventName,response,currentOptions)};return promise.then(reportSuccess,reportError)};Object.keys(eventsList).forEach(function(group){Object.keys(eventsList[group]).forEach(function(action){isEnabled===!0?notifier.addListener(eventsList[group][action],biListener):notifier.removeListener(eventsList[group][action],biListener)})}),isEnabled===!0?notifier.addListener(eventsList.ITEM.UPLOAD,benchmarks.upload):notifier.removeListener(eventsList.ITEM.UPLOAD,benchmarks.upload),isEnabled===!0&&(Uploder.on("uploadQueueStarted",uploadQueue.start),Uploder.on("uploadQueueFinished",uploadQueue.finish))}}(bower_components_wixmp_manager_src_events_notifier,bower_components_wixmp_manager_src_events_list,bower_components_wixmp_manager_src_services_bi_benchmarks,bower_components_wixmp_manager_src_services_bi_errors,bower_components_wixmp_manager_src_services_upload_upload_collection,bower_components_wixmp_manager_src_services_bi_upload_queue,bower_components_wixmp_manager_src_utils_utils),bower_components_wixmp_manager_src_wixmp=function(Source,sources,events,externalSourceConnector,enableBI,Uploader){return{Source:Source,sources:sources,events:events,bi:enableBI,connectExternalSource:externalSourceConnector,Uploader:Uploader}}(bower_components_wixmp_manager_src_sources_Source,bower_components_wixmp_manager_src_sources_list,bower_components_wixmp_manager_src_events_events,bower_components_wixmp_manager_src_connector_connector,bower_components_wixmp_manager_src_services_bi_bi,bower_components_wixmp_manager_src_services_upload_upload_collection),src_sources_bigstock_settings={apiUrl:"//pix.wix.com/services/bigstock"},src_sources_bigstock_mappers_folder=function(data){return{id:data.id,name:data.name,mediaType:"picture",parentId:null,filesCount:null,createdAt:null}},src_sources_bigstock_parsers_folders=function(toFolder){return function(res){return res.data=(res.data||[]).map(toFolder),res}}(src_sources_bigstock_mappers_folder),src_sources_bigstock_folders=function(http,mapFolderList,Promise){return function(){function list(){return Promise.resolve(folders)}var folders=mapFolderList({data:[{id:null,name:"All"},{id:"Abstract",name:"Abstract"},{id:"Animals",name:"Animals"},{id:"Architecture",name:"Architecture"},{id:"Backgrounds",name:"Backgrounds"},{id:"Business",name:"Business"},{id:"Communication",name:"Communication"},{id:"Computers",name:"Computers"},{id:"Conceptual",name:"Conceptual"},{id:"Editorial",name:"Editorial"},{id:"Education",name:"Education"},{id:"Food",name:"Food"},{id:"Health",name:"Health"},{id:"Holidays",name:"Holidays"},{id:"Industry",name:"Industry"},{id:"Internet",name:"Internet"},{id:"Landscapes",name:"Landscapes"},{id:"Maps",name:"Maps"},{id:"Miscellaneous",name:"Miscellaneous"},{id:"Musical",name:"Musical"},{id:"Nature",name:"Nature"},{id:"Objects",name:"Objects"},{id:"People",name:"People"},{id:"Places",name:"Places"},{id:"Sports",name:"Sports"},{id:"Transportation",name:"Transportation"}]});return{list:list}}}(bower_components_wixmp_manager_src_utils_http,src_sources_bigstock_parsers_folders,bluebird_extended),src_sources_bigstock_mappers_item=function(utils){return function(data){var size=utils.find(data.formats,function(format){return"l"===format.size_code});return size||(size=data.formats.pop()),{id:data.id,name:data.title,folderId:null,mediaType:"picture",fileUrl:null,thumbnailUrl:utils.normalizeUri(data.large_thumb.url),previewUrl:utils.normalizeUri(data.preview.url),createdAt:null,tags:[],width:size.width,height:size.height}}}(bower_components_wixmp_manager_src_utils_utils),src_sources_bigstock_parsers_items=function(toItem){return function(res){var data=res.data.data,cursor=data.paging&&data.paging.page<data.paging.total_pages?data.paging.page+1:null,pageSize=+data.paging.items_per_page;return res.data=(data.images||[]).map(toItem),res.paging={cursor:cursor,pageSize:pageSize},res}}(src_sources_bigstock_mappers_item),src_sources_bigstock_parsers_error=function(response){var code,data=response.data;return code=Array.isArray(data)?data[0].code||data[0]:data.code,response.data.message=code,Promise.reject(response)},src_sources_bigstock_items=function(http,mapItemList,toError){return function(settings){function failHandler(reason){return toError(reason)}function list(folderId,options){options=options||{},options.paging=options.paging||{},options.sort=options.sort||{};var requestOptions={limit:options.paging.pageSize||50,page:options.paging.cursor||null,order:options.sort.field||null,category:folderId||null,orientation:options.orientation||null};return http.get(settings.apiUrl+"/search",requestOptions,{headers:options.headers||{}}).then(mapItemList)["catch"](failHandler)}function search(folderId,query,options){options=options||{},options.paging=options.paging||{},options.sort=options.sort||{};var requestOptions={q:query||null,limit:options.paging.pageSize||50,page:options.paging.cursor||null,order:options.sort.field||null,category:folderId||null,orientation:options.orientation||null};return http.get(settings.apiUrl+"/search",requestOptions,{headers:options.headers||{}}).then(mapItemList)["catch"](failHandler)}return{list:list,search:search}}}(bower_components_wixmp_manager_src_utils_http,src_sources_bigstock_parsers_items,src_sources_bigstock_parsers_error),src_sources_bigstock_BigStock=function(defaultSettings,initFolders,initItems,utils,decorators,eventsList){return function(userSettings){var settings=utils.extend({},defaultSettings,userSettings),folders=initFolders(settings),items=initItems(settings);this.name="bigstock",this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items)}}(src_sources_bigstock_settings,src_sources_bigstock_folders,src_sources_bigstock_items,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),src_sources_public_mappers_folder=function(data,parentId){return{id:data.guid,name:data.title,mediaType:data.mediaType,parentId:parentId||null,filesCount:null,createdAt:null}},src_sources_public_parsers_folders=function(toFolder){return function(res){return res.data=(res.data.category.children||[]).map(toFolder),res}}(src_sources_public_mappers_folder),src_sources_public_parsers_error=function(Promise){return function(response){return response.data.message=response.message,Promise.reject(response)}}(bluebird_extended),src_sources_public_folders=function(utils,http,mapFolderList,toError){return function(settings){function list(folderId,options){options=options||{};var data={levels:1,language:options.language};return utils.isGuid(folderId)?data.guid=folderId:data.legacyKey=folderId,http.get(settings.apiUrl+"/categories",data,{withCredentials:!0,headers:options.headers||{}}).then(mapFolderList)["catch"](toError)}return{list:list}}}(bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_utils_http,src_sources_public_parsers_folders,src_sources_public_parsers_error),src_sources_public_mappers_item=function(utils,imagesGenerators){return function(itemData,settings,thumbnailSizes){var item={id:itemData.guid,name:itemData.title,mediaType:itemData.mediaType,fileName:itemData.fileName,fileUrl:itemData.fileUrl,createdAt:null,tags:[],width:itemData.width,height:itemData.height,fileOutput:itemData.fileOutput||null,fileInput:itemData.fileInput||null,vendor:itemData.vendor||null,reference:itemData.reference||null,creator:itemData.creator||null,externalId:itemData.externalId||null};if(itemData.thumbnailUrl&&itemData.fileUrl){var folderName=itemData.fileUrl.split("/")[0];item.thumbnailUrl=folderName+"/"+itemData.thumbnailUrl}item.videoPreviewUrl=imagesGenerators.getVideoPreviewUrl(item,settings);var sizes=utils.extend({},settings.thumbnailSizes,thumbnailSizes);return utils.extend(item,imagesGenerators.insertSizes(item,sizes,settings)),item}}(bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_utils_images_generators),src_sources_public_parsers_items=function(utils,toItem){return function(res,settings,thumbnailSizes){res.data.nextPage=res.data.nextPage||"";var cursor=utils.getParameterByName(res.data.nextPage,"pageNumber")||null,pageSize=utils.getParameterByName(res.data.nextPage,"pageSize")||null;return res.data=(res.data.items||[]).map(function(itemData){return toItem(itemData,settings,thumbnailSizes)}),res.paging={cursor:cursor,pageSize:pageSize},res}}(bower_components_wixmp_manager_src_utils_utils,src_sources_public_mappers_item),src_sources_public_items=function(http,utils,mapItemList,toError){return function(settings){function requestItems(action,requestOptions,thumbSizeData,headers){return http.get(settings.apiUrl+action,requestOptions,{withCredentials:!0,headers:headers||{}}).then(function(response){return mapItemList(response,settings,thumbSizeData)})["catch"](toError)}function list(folderId,options){options=options||{},options.paging=options.paging||{};var requestOptions={guid:folderId||null,language:options.language,pageSize:options.paging.pageSize||50,pageNumber:options.paging.cursor||1};return requestItems("/items",requestOptions,options.thumbnails,options.headers)}function search(folderId,query,options){options=options||{},options.paging=options.paging||{};var requestOptions={guid:folderId||null,language:options.language,searchString:query||"",pageSize:options.paging.pageSize||50,pageNumber:options.paging.cursor||1};return requestItems("/search",requestOptions,options.thumbnails,options.headers)}return{list:list,search:search}}}(bower_components_wixmp_manager_src_utils_http,bower_components_wixmp_manager_src_utils_utils,src_sources_public_parsers_items,src_sources_public_parsers_error),src_sources_public_settings={apiUrl:"//publicmedia.wix.com/public",imageOperationsApi:"vangogh",filesUrl:"//static.wixstatic.com",videoFilesUrl:"//video.wixstatic.com",thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"}},videoPreviewQuality:"480p"},src_sources_public_Public=function(initFolders,initItems,defaultSettings,utils,decorators,eventsList){return function(userSettings){var settings=utils.extend({},defaultSettings,userSettings),folders=initFolders(settings),items=initItems(settings);this.folders=decorators.addEvents(this,eventsList.FOLDERS,folders),this.items=decorators.addEvents(this,eventsList.ITEMS,items),this.name="public"}}(src_sources_public_folders,src_sources_public_items,src_sources_public_settings,bower_components_wixmp_manager_src_utils_utils,bower_components_wixmp_manager_src_sources_decorators,bower_components_wixmp_manager_src_events_list),wixmp=function(sdk,BigStock,Public){return sdk.sources.BIGSTOCK=BigStock,sdk.sources.PUBLIC=Public,sdk}(bower_components_wixmp_manager_src_wixmp,src_sources_bigstock_BigStock,src_sources_public_Public),window.wixmp=wixmp}(),function(){var logger,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};logger=new Logger("WindowMessenger"),this.WindowMessenger=function(){function WindowMessenger(targetWindow){if(this.targetWindow=targetWindow,this._eventHandler=bind(this._eventHandler,this),this.emit=bind(this.emit,this),this.off=bind(this.off,this),this.one=bind(this.one,this),this.on=bind(this.on,this),void 0===this.targetWindow)throw new Error("target window should be defined");this.observers=[],window.addEventListener("message",this._eventHandler,!1)}return WindowMessenger.prototype.on=function(event,fn){return this.observers.push({event:event,fn:fn})},WindowMessenger.prototype.one=function(event,fn){return this.observers.push({event:event,fn:fn,once:!0})},WindowMessenger.prototype.off=function(event,fn){var i,j,ref;for(i=j=ref=this.observers.length-1;j>=0;i=j+=-1)this.observers[i].event!==event||this.observers[i].fn!==fn&&"undefined"!=typeof fn||this.observers.splice(i,1)},WindowMessenger.prototype.emit=function(event,data){return logger.log("postMessage emitted",event,data),this.targetWindow.postMessage(JSON.stringify({event:event,data:data}),"*")},WindowMessenger.prototype._eventHandler=function(event){var data;if(event.source===this.targetWindow)return data=JSON.parse(event.data),logger.log("postMessage received",data),this.observers.filter(function(observer){return observer.event===data.event}).forEach(function(_this){return function(observer){return observer.fn.call(event,data.data),observer.once?_this.off(observer.event,observer.fn):void 0}}(this))},WindowMessenger}()}.call(this),function(){"use strict";this.app=angular.module("mediaGalleryApp",["templates","ngResource","ui.router","restangular","ngDialog","ui.bootstrap"])}.call(this),angular.module("templates",[]).run(["$templateCache",function($templateCache){"use strict";$templateCache.put("scripts/directives/breadcrumbs/breadcrumbs.html",'<div class="breadcrumbs"><div ng-repeat="(index, folder) in existedList()" ng-switch="index != existedList().length - 1" class="item"><button ng-click="action({folder: folder})" ng-switch-when="true">{{folder.name}}</button><span ng-switch-when="false">{{folder.name}}</span></div></div>'),$templateCache.put("scripts/directives/draggable/draggable-helper.html",'<div ng-show="count" ng-class="{folder: isFolder(entity)}" class="draggable-helper"><div covered-background="{{entity.thumbnailUrl}}" class="box"><div ng-bind="count" class="count"></div><div class="name">{{entity.name}}</div></div><div ng-show="count &gt;= 2" class="box two"></div><div ng-show="count &gt;= 3" class="box many"></div></div>'),$templateCache.put("scripts/directives/entities-grid/entities-grid.html",'<ul multi-select="entities" ng-hide="entities.length == 0" ng-class="adapterName" class="items"><li ng-repeat="entity in entities track by entity.id" bi-click="{eventName: \'itemSelect.click\', data: { target: entity.id }}" more-actions-tooltip="{}" multi-select-entity="entity" can-select-multiple="canSelectMultiple" ng-class="{selected: isSelected(entity), processing: entity._isProcessing, renaming: renameCtrl.isVisible(entity), folder: isFolder(entity), transcoding: entity.can.transcode() &amp;&amp; !entity.isTranscoded()}" ng-click="click({entity: entity})" ng-dblclick="doubleClick({entity: entity})" draggable="entity" can-drag="entity.can.move()" droppable="moveSelectedToFolder({folder: entity})" can-drop-entities="entity.can.moveItemIn()" class="item mt-{{entity.mediaType}}"><div ng-if="isFolder(entity)" class="folder-background"></div><div covered-background="{{entity.thumbnailUrl}}" load-visible-for=".entities-wrapper" load-if-changed="selectedLayoutId + entities.length" on-load-success="onThumbnailLoaded()" ng-class="{item: !isFolder(entity)}" class="image"></div><div ng-show="entity.can.transcode() &amp;&amp; !entity.isTranscoded()" ng-switch="entity.transcodingStatus" ng-class="entity.transcodingStatus.toLowerCase()" class="transcoding-status"><div class="title inprogress">{{ "private_media.transcoding" | translate }}</div><div class="spinner inprogress"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div><div class="title in-queue">{{ "private_media.transcoding" | translate }}:</div><div class="message in-queue">{{ "private_media.transcoding_in_queue" | translate }}</div><div class="title failed">{{ "private_media.transcoding_fails.title" | translate }}</div><div class="message failed">{{ "private_media.transcoding_fails.message" | translate }}</div></div><renamable-name entity="entity" rename-ctrl="renameCtrl" redraw-on-change="selectedLayoutId"></renamable-name><ul ng-hide="!entity.can.showImagePreview() &amp;&amp; !entity.can.showVideoPreview() &amp;&amp; !entity.can.makeFavorites() &amp;&amp; !entity.can.rename() &amp;&amp; !entity.can.remove() &amp;&amp; !entity.can.edit() &amp;&amp; !entity.can.getDownloadLink() &amp;&amp; !entity.can.restore() &amp;&amp; !entity.can.buy()" class="actions"><li ng-show="entity.can.showImagePreview() || entity.can.showVideoPreview()"><preview adapter-name="adapterName" folder-name="folderName(entity)" item="entity"></preview></li><li ng-show="entity.can.makeFavorites()"><button ng-class="{active: entity.isFavorites()}" deny-bubbling="mousedown" bi-click="{eventName: \'makeItemFavoritesButton.click\', data: {target: entity.id}}" ng-click="entity.isFavorites() ? entity.unmakeFavorites() : entity.makeFavorites()" tooltip-append-to-body="true" tooltip="{{\'private_media.make_favorites\' | translate}}" class="action favorites"></button></li><li ng-show="entity.can.rename()"><button bi-click="{eventName: \'renameButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" ng-click="renameCtrl.show(entity)" tooltip-append-to-body="true" tooltip="{{\'private_media.rename_item\' | translate}}" class="action rename"></button></li><li ng-show="entity.can.remove()"><button bi-click="{eventName: \'removeItemButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" ng-click="remove.one(entity)" tooltip-append-to-body="true" tooltip="{{ settings.hasTrash ? \'private_media.move_to_trash\' : \'private_media.remove_item\' | translate}}" class="action remove"></button></li><li ng-show="entity.can.edit()"><button bi-click="{eventName: \'editItemButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" ng-click="editItemInAviary(entity)" tooltip-append-to-body="true" tooltip="{{\'private_media.edit_item\' | translate}}" class="action edit"></button></li><li ng-show="entity.can.getDownloadLink()"><a bi-click="{eventName: \'downloadItemButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" download="{{entity.name}}" href="{{entity.getDownloadLink()}}" target="_blank" tooltip-append-to-body="true" tooltip="{{\'private_media.download_item\' | translate}}" class="action download"></a></li><li ng-show="entity.can.restore()"><button bi-click="{eventName: \'restoreItemButton.click\', data: {target: entity.id}}" ng-click="entity.restore();" deny-bubbling="mousedown" tooltip-append-to-body="true" tooltip="{{\'private_media.restore_item\' | translate}}" class="action restore"></button></li><li ng-if="entity.can.buy()"><button ng-click="selectAndSubmitItem({item: entity})" class="action price"><span ng-bind-html="price"></span></button></li></ul></li></ul>'),$templateCache.put("scripts/directives/folder-actions/folder-actions.html",'<a deny-bubbling="click" ng-show="folder.can.rename() || folder.can.remove()" popup="{contentClass: \'context-menu\', offsetLeft: 10, offsetTop: 18}" class="actions"></a><div class="context-menu menu"><button bi-click="{eventName: \'renameFolderButton.click\', data: {target: folder.id}}" ng-click="showRenaming()" ng-if="folder.can.rename()" class="rename-folder">{{"private_media.rename_folder" | translate}}</button><button bi-click="{eventName: \'removeFolderButton.click\', data: {target: folder.id}}" ng-click="remove.folder(folder)" ng-if="folder.can.remove()" class="remove-folder">{{"private_media.remove_folder" | translate}}</button></div>'),$templateCache.put("scripts/directives/more-actions-tooltip/show-more.html","<li class=\"show-more\"><button popup=\"{contentClass: 'context-menu', align: 'bottom center', offsetTop: 18, centeredTip: true, event: 'mouseover', parentSelector: options.actionsContainerSelector, parentActiveClass: 'more-actions-visible', containerClass: 'popup-container black'}\" class=\"action show-more\">more</button><ul class=\"context-menu menu more-actions\"></ul></li>"),$templateCache.put("scripts/directives/no-entities/no-entities.html",'<div ng-class="{search: isSearch(), &quot;all-folder&quot;: !selectedFolder, &quot;can-upload&quot;: canUpload, &quot;multiline-description&quot;: type != &quot;user-owned&quot; &amp;&amp; selectedFolder == allFolder}" class="no-entities {{\'no-\'+selectedFolder.mediaType}} {{type}}"><div ng-if="!isSearch()" ng-include="\'scripts/directives/no-entities/no-items-loaded.html\'"></div><div ng-if="isSearch()" ng-include="\'scripts/directives/no-entities/\' + searchTemplate"></div></div>'),$templateCache.put("scripts/directives/no-entities/no-items-loaded.html",'<h3 ng-if="canUpload">{{ \'no_items.header\' | translate : selectedFolder.name }}</h3><div ng-if="canUpload" class="description"><span ng-bind-html="\'no_items.text\' | unsafe"></span>&nbsp;<div file-select="uploadFiles({files: files})" class="upload-link"><button>&nbsp;{{ \'uploader.upload\' | translate}}</button><input id="files-input" accept="*" bi-click="{eventName: \'noItems.uploadButton.click\',data:{target:selectedFolder.id}}" multiple="true" name="file" type="file" title=""/></div></div><h3 ng-if="!canUpload">{{ \'no_items_in_readonly_folder.header\' | translate : selectedFolder.name }}</h3>'),$templateCache.put("scripts/directives/no-entities/no-search-results.html",'<!--h3--><!--  span(ng-if=\'selectedFolder\')--><!--    | {{ \'no_search_results_at_folder\' | translate : getSearchQuery() : selectedFolder.name }}--><!--  span(ng-if=\'!selectedFolder\')--><!--    | {{ \'no_search_results\' | translate : getSearchQuery() }}--><div ng-switch="selectedFolder == allFolder"><div ng-switch-when="false"><h3>{{ \'no_search_results.cant_find_at_folder\' | translate : getSearchQuery() : selectedFolder.name }}</h3><div ng-if="allFolder" class="description">{{ \'no_search_results.try_search_at_all\' | translate }}&nbsp;<button ng-click="selectFolder({folder: allFolder})">{{ allFolder.name }}</button></div><div ng-if="!allFolder" class="description">{{ \'no_search_results.use_different_term\' | translate }}</div></div><div ng-switch-when="true"><h3><span ng-bind-html="\'no_search_results.cant_find_at_all\' | unsafe : getSearchQuery()"></span></h3><div class="description"><div class="item">{{ \'no_search_results.check_spelling\' | translate }}</div><div class="item">{{ \'no_search_results.use_different_keywords\' | translate }}</div></div></div></div>'),$templateCache.put("scripts/directives/no-entities/no-user-owned-search-results.html","<!--h3--><!--  span(ng-if='selectedFolder')--><!--    | {{ 'no_search_results_at_folder' | translate : getSearchQuery() : selectedFolder.name }}--><!--  span(ng-if='!selectedFolder')--><!--    | {{ 'no_search_results' | translate : getSearchQuery() }}--><div ng-switch=\"selectedFolder == allFolder\"><div ng-switch-when=\"false\"><h3>{{ 'no_search_results.user_owned.cant_find_at_folder' | translate : getSearchQuery() : selectedFolder.name }}</h3><div ng-if=\"allFolder\" class=\"description\">{{ 'no_search_results.user_owned.try_search_at_all' | translate }}&nbsp;<button ng-click=\"selectFolder({folder: allFolder})\">{{ allFolder.name }}</button></div><div ng-if=\"!allFolder\" class=\"description\">{{ 'no_search_results.user_owned.use_different_term' | translate }}</div></div><div ng-switch-when=\"true\"><h3>{{ 'no_search_results.user_owned.cant_find_at_all' | translate : getSearchQuery() }}</h3><div class=\"description\">{{ 'no_search_results.user_owned.use_different_term' | translate }}</div></div></div>"),
$templateCache.put("scripts/directives/preview/popup-content.html",'<div ng-class="adapterName" class="popup-content item-preview"><div class="cut"><img ng-show="item.can.showImagePreview()" ng-class="item.mediaType" ng-src="{{item.previewUrl}}"/><div style="width: 320px;" ng-show="item.can.showVideoPreview()" ng-class="item.mediaType"><video style="width: 100%; height: 100%;" ng-attr-poster="{{item.previewUrl}}" preload="none" autoplay="autoplay" loop="loop" muted="muted"><source ng-repeat="videoPreviewUrl in videoSrc" ng-src="{{videoPreviewUrl}}"/></video></div></div><div class="image-data-labels"><p class="name"><span class="label">{{\'item_preview_label.name\' | translate}}</span></p><p ng-show="item.width" class="size"><span class="label">{{\'item_preview_label.size\' | translate}}</span></p><p ng-show="folderName" class="folder-name"><span class="label">{{\'item_preview_label.folder_name\' | translate}}</span></p><p ng-show="item.labels" class="folder-name"><span class="label">{{\'item_preview_label.labels\' | translate}}</span></p></div><div class="image-data-values"><p class="name"><span>{{item.name}}</span></p><p ng-show="item.width" class="size"><span>{{item.width}}x{{item.height}}</span></p><p ng-show="folderName" class="folder-name"><span>{{folderName}}</span></p><p ng-show="item.labels" class="folder-name"><span>{{item.labels.join(\', \')}}</span></p></div></div>'),$templateCache.put("scripts/directives/preview/preview.html","<div popup=\"{event: 'mouseover', activeClass: 'active', containerClass: 'popup-container item-preview-container', parentSelector: 'li.item', template: 'scripts/directives/preview/popup-content.html'}\" class=\"action item-preview\"></div>"),$templateCache.put("scripts/directives/renamable-name/renamable-name.html",'<div class="name"><div subfolder="entity" subfolder-long-name="entity" redraw-on-change="redrawOnChange" ng-bind="entity.name.toString()" ng-hide="renameCtrl.isVisible(entity)" class="name-inner"></div><input ng-show="renameCtrl.isVisible(entity)" focus-me="renameCtrl.isVisible(entity)" maxlength="256" ng-blur="renameCtrl.runOrHide(entity, renameCtrl.newName)" ng-model="renameCtrl.newName" on-enter="renameCtrl.run(entity, renameCtrl.newName);" on-esc="renameCtrl.hide()" deny-bubbling="dblclick"/></div>'),$templateCache.put("scripts/directives/spinner/spinner.html",'<svg width="90px" height="90px" viewbox="0 0 66 66" xmlns="http://www.w3.org/2000/svg" class="spinner"><circle fill="none" stroke-width="2" stroke-linecap="round" cx="33" cy="33" r="30" class="path"></circle></svg>'),$templateCache.put("scripts/directives/upload-button/upload-button.html",'<div file-select="uploadFiles({files: files})" ng-show="canUpload &amp;&amp; !canConnectExternal" class="upload-button"><input id="files-input" accept="*" bi-click="{eventName: \'uploadButton.click\', data: {}}" multiple="true" name="file" type="file" title=""/><button>{{ \'uploader.upload\' | translate}}</button></div><div ng-show="canUpload &amp;&amp; canConnectExternal" file-select="uploadFiles({files: files})" popup="{align: \'bottom left\', offsetTop: 32, offsetLeft: \'100%\', event: \'mouseover\', containerClass: \'popup-container upload-popup-container\', fadeOut: 300}" class="upload-button with-popup"><input id="files-input" accept="*" bi-click="{eventName: \'uploadButton.click\', data: {}}" multiple="true" name="file" type="file" title=""/><button>{{ \'uploader.add\' | translate}}</button><div class="upload-popup popup-content"><div file-select="uploadFiles({files: files})" deny-bubbling="click" class="button"><input id="files-input" accept="*" bi-click="{eventName: \'uploadButton.click\', data: {}}" multiple="true" name="file" type="file" deny-bubbling="click" title=""/><button>{{ \'uploader.upload\' | translate}}</button></div><div class="external-services">{{ \'uploader.connect_external_service\' | translate}}<div class="list"><button ng-repeat="service in externalServices" ng-class="service.id" ng-click="connectExternal(service)" deny-bubbling="click" class="service"></button></div></div></div></div>'),$templateCache.put("scripts/pages/_base/base.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div drag-highlight="" can-upload="adapter.can.item.upload()" items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow()"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div drop-files="$upload.addFiles(files, $folders.selectedFolder)" entities="$nestedEntities.list" can-upload="adapter.can.item.upload()" ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" select-all="" delete-by-key="" when-scrolled-to-bottom="$nestedEntities.more()" droppable="$nestedEntities.moveSelectedToFolder(getSelectedFolder())" can-drop-entities="getSelectedFolder().can.moveItemIn()" class="entities-wrapper"><breadcrumbs list="selectedFoldersPath" action="selectFolderOrNested(folder)" ng-if="settings.hasSubfolders || $nestedEntities.list.length"></breadcrumbs><no-entities ng-class="{\'no-entities-placeholder\':!$searchQuery.query}" selected-folder="getSelectedFolder()" search-query="$searchQuery.query" upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="getSelectedFolder().can.uploadIn()" ng-show="!$nestedEntities.isLoading &amp;&amp; $nestedEntities.list.length == 0" select-folder="$folders.selectFolder(folder)" all-folder="getAllFolder()" type="user-owned"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><div ng-class="{processing: $nestedEntities.$createFolder.isProcessing(true)}" ng-show="$nestedEntities.$createFolder.isVisible(true) || $nestedEntities.$createFolder.isProcessing(true)" class="add-subfolder-input">Subfolder name:<input focus-me="$nestedEntities.$createFolder.isVisible(true)" maxlength="256" ng-blur="$nestedEntities.$createFolder.hide()" ng-model="$nestedEntities.$createFolder.newName" on-enter="$nestedEntities.$createFolder.run($nestedEntities.$createFolder.newName)" on-esc="$nestedEntities.$createFolder.hide()"/></div><entities-grid adapter-name="adapter.name" folder-name-by-id="getFolderNameById(id)" entities="$nestedEntities.list" reset-scroll="getSelectedFolder()" double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="getSelectedFolder()" move-selected-to-folder="$nestedEntities.moveSelectedToFolder(folder)" rename-ctrl="$nestedEntities.$rename" can-select-multiple="true" remove="$remove" on-all-thumbnails-loaded="measureImagesLoadSpeed()" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/_partials/confirmation.html",'<div class="header">{{confirmTitle}}</div><div ng-bind-html="confirmMessage" class="text"></div><div class="buttons"><div class="cancel"><button ng-click="closeThisDialog()">{{confirmNo}}</button></div><div class="confirm"><button ng-click="confirm(); closeThisDialog();">{{confirmYes}}</button></div></div>'),$templateCache.put("scripts/pages/_partials/folders.html",'<div><div ng-class="{\'offset-bottom\': adapter.can.folder.create()}" ng-if="$folders.list.length" droppable="$folders.moveSelectedToFolder(getUnsorted())" can-drop-entities="getUnsorted().can.moveItemIn()" class="folders"><ul><li ng-repeat="folder in $folders.list | orderBy:$folders.sortOrder" bi-click="{eventName: \'folderSelect.click\', data: { target: folder.id }}" ng-class="{current: $folders.selectedFolder.id == folder.id, processing: folder._isProcessing, renaming: $folders.$rename.isVisible(folder), \'all-folder\': getAllFolder() == folder || folder.id == null || folder.type == \'allMedia\' || folder.type == \'unsorted\'}" ng-click="$folders.selectFolder(folder);filter.parent_folder_id = folder.folder_id" droppable="$folders.moveSelectedToFolder(folder)" can-drop-entities="folder.can.moveItemIn()" draggable="folder" select-entity="folder" can-drag="folder.can.move()" drop-files="$upload.addFiles(files, folder)" drag-highlight="" can-upload="adapter.can.item.upload()" data-id="{{folder.id}}" class="{{settings.mediaType}}{{folder.type ? &quot; &quot; + folder.type : &quot;&quot;}}"><renamable-name entity="folder" rename-ctrl="$folders.$rename"></renamable-name><folder-actions folder="folder" show-renaming="$folders.$rename.show(folder)" remove="$remove"></folder-actions></li><li ng-class="{processing: $folders.$createFolder.isProcessing(true)}" ng-show="$folders.$createFolder.isVisible(true) || $folders.$createFolder.isProcessing(true)" class="add-folder-input"><input focus-me="$folders.$createFolder.isVisible(true)" maxlength="256" ng-blur="$folders.$createFolder.runOrHide(null, $folders.$createFolder.newName)" ng-model="$folders.$createFolder.newName" on-enter="$folders.$createFolder.run($folders.$createFolder.newName)" on-esc="$folders.$createFolder.hide()"/></li></ul></div><button ng-show="adapter.can.folder.create()" bi-click="{eventName: \'newFolderButton.click\', data: {}}" ng-click="$folders.$createFolder.show(true)" class="add-folder">{{\'private_media.create_folder\' | translate}}</button></div>'),$templateCache.put("scripts/pages/_partials/footer.html",'<div class="submit"><button bi-click="{eventName: \'chooseButton.click\', data: {}}" ng-class="{disabled: !canSubmitItems()}" ng-click="submitItems()" ng-show="settings.submitItems" title="{{submitItemsTooltip()}}">{{footerSubmitTranslationKey | translate}}</button></div><div ng-if="$upload.getFilesQueue().length" ng-class="{\'has-failed\': $upload.hasFailedFiles(), \'in-progress\': $upload.hasInProgress(), maximize: $upload.popupIsVisible, minimize: !$upload.popupIsVisible}" ng-click="$upload.showPopup()" class="upload-status"><div class="title">{{$upload.hasInProgress() ? \'uploader.uploading\' : \'uploader.uploaded\' | translate}}&nbsp;<span class="numbers">({{$upload.succeededFilesCount()}}/{{$upload.allFilesCount()}} <span ng-switch="$upload.allFilesCount() &gt; 1"><span ng-switch-when="true">{{\'uploader.files\' | translate}})</span><span ng-switch-when="false">{{\'uploader.file\' | translate}})</span></span></span></div><div ng-show="$upload.hasInProgress()" class="progress-bar"><div ng-style="{\'width\': $upload.totalProgressPercent + \'%\'}" class="progress"></div></div><div ng-show="$upload.failedFilesCount() &gt; 0" class="fails"><span ng-if="$upload.failedFilesCount() - $upload.cancelledFilesCount() &gt; 0" class="failed-count">{{$upload.failedFilesCount() - $upload.cancelledFilesCount()}} <span ng-switch="$upload.failedFilesCount() - $upload.cancelledFilesCount() &gt; 1"><span ng-switch-when="true">{{\'uploader.errors\' | translate}}</span><span ng-switch-when="false">{{\'uploader.error\' | translate}}</span></span></span></div><button ng-click="$upload.showPopup()" class="show-upload-popup">{{\'uploader.footer.view_details\' | translate}}</button></div><div ng-show="selectedEntitiesCount()" ng-switch="selectedEntitiesCount() &gt; 1" class="selected-items-size"><span ng-switch-when="true">{{\'many_selected_items\' | translate:selectedEntitiesCount()}}</span><span ng-switch-when="false">{{\'one_selected_item\' | translate:selectedEntitiesCount()}}</span></div>'),$templateCache.put("scripts/pages/_partials/group-actions.html",'<ul><li ng-show="settings.hasSubfolders &amp;&amp; adapter.can.folder.create() &amp;&amp; $folders.selectedFolder.id &amp;&amp; $folders.selectedFolder.parentId"><div class="add-subfolder"><button ng-click="$nestedEntities.$createFolder.show(true)">{{\'private_media.create_subfolder\' | translate}}</button></div></li><li ng-show="adapter.can.items.remove() &amp;&amp; selectedEntitiesCount() &amp;&amp; !$nestedEntities.isLoading &amp;&amp; $nestedEntities.list.length" class="remove-item"><div class="delete"><button ng-click="$remove.selected($nestedEntities)">{{\'private_media.remove_items\' | translate}}</button></div></li><li ng-show="$nestedEntities.$orientation" class="orientation-switch-wrapper"><button ng-class="{ current : $nestedEntities.$orientation.selected == orientation }" ng-click="$nestedEntities.$orientation.select(orientation)" ng-repeat="orientation in $nestedEntities.$orientation.list" title="{{\'orientation.\' + orientation.name | translate}}" class="action orientation {{orientation.name}}"><i></i></button></li><li ng-show="$nestedEntities.sortOrder"><div popup="{containerClass: \'popup-container dropdown\', contentClass:\'sort-options\',  align: \'bottom center\', offsetTop: 22, centeredTip: true}" class="action change-sort-order">{{\'sort_order.title\' | translate}} {{$nestedEntities.sortOrder.selected.name}}</div><div class="sort-options menu centered-tip"><div ng-repeat="sortOption in $nestedEntities.sortOrder.list"><button ng-class="{current: sortOption == $nestedEntities.sortOrder.selected}" ng-click="$nestedEntities.sortOrder.select(sortOption)">{{sortOption.name}}</button></div></div></li><li ng-show="adapter.items.search" class="search"><form><input ng-class="{fail: !$nestedEntities.isLoading &amp;&amp; $nestedEntities.list.length == 0 &amp;&amp; $searchQuery.query &amp;&amp; $searchQuery.currentQuery == $searchQuery.query}" ng-model="$searchQuery.currentQuery" on-enter="$searchQuery.query = $searchQuery.currentQuery; $nestedEntities.load()" placeholder="{{\'search\' | translate}}" type="text"/><input ng-click="$searchQuery.currentQuery = \'\'; $searchQuery.query = \'\'; $nestedEntities.load()" ng-show="$searchQuery.currentQuery &amp;&amp; $searchQuery.currentQuery == $searchQuery.query" type="reset" value="x"/><input ng-click="$searchQuery.query = $searchQuery.currentQuery; $nestedEntities.load()" ng-show="$searchQuery.currentQuery != $searchQuery.query" type="submit" value="→"/></form></li><li ng-show="$layouts &amp;&amp; !$services.isAllDisconnected()"><div popup="{containerClass: \'popup-container dropdown\', contentClass: \'layout-options\', align: \'bottom center\', offsetTop: 22, centeredTip: true}" class="action switch-grid"><button ng-class="$layouts.selected.id" class="selected">switch</button><div class="layout-options menu"><ul><li ng-repeat="layout in $layouts.list"><button ng-class="{current: $layouts.selected.id == layout.id}" ng-click="$layouts.select(layout)" class="{{layout.id}}">{{layout.name}}</button></li></ul></div></div></li></ul>'),$templateCache.put("scripts/pages/_partials/help-popup.html",'<div ng-show="$help.popupIsVisible" class="inner-popup-underlay"></div><div id="help" ng-if="$help.popupIsVisible" class="inner-popup"><div class="popup-header"><h2>{{"uploader.header" | translate}}<button ng-click="$help.hidePopup()" class="close">×</button></h2></div><div class="popup-content"><iframe ng-src="{{$help.url}}"></iframe></div></div>'),$templateCache.put("scripts/pages/_partials/import.html",'<div ng-show="isImporting" class="import"><div class="loading"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>{{ importingCount == 1 ? \'external_media.importing_single.header\' : \'external_media.importing.header\' | translate}}</div><div ng-style="{width: (getImportingProgress() * 100) + \'%\'}" class="progress"></div></div>'),$templateCache.put("scripts/pages/_partials/loaders.html",'<div ng-if="$folders.isLoading" class="loading folders"><spinner></spinner></div><div ng-if="($folders.selectedFolder || !$folders) &amp;&amp; !$nestedEntities.list.length &amp;&amp; $nestedEntities.isLoading" class="loading items"><spinner></spinner></div><div ng-if="($folders.selectedFolder || !$folders) &amp;&amp; $nestedEntities.list.length &amp;&amp; $nestedEntities.isLoading" class="loading items more"><spinner></spinner></div>'),$templateCache.put("scripts/pages/_partials/notifications.html",'<ul ng-show="$notifications.list.length &gt; 0"><li ng-repeat="notification in $notifications.list track by notification.id" class="{{notification.type}}"><span>{{notification.message}}</span><button ng-click="$notifications.expire(notification)" class="expire-notification">×</button></li></ul>'),$templateCache.put("scripts/pages/_partials/tabs.html",'<ul ng-show="settings.showTabs"><li><button bi-click="{eventName: \'tabSelect.click\', data: {target: tabId}}" ng-class="{active: isActiveTab(tabs[tabId])}" ng-repeat="tabId in settings.tabsList" ng-show="tabs[tabId].canShow()" ui-sref="{{tabs[tabId].state}}">{{tabs[tabId].translationKey | translate}}</button></li></ul>'),$templateCache.put("scripts/pages/_partials/upload-message.html",'<div ng-show="!!$upload &amp;&amp; descriptionTranslationKey" title="{{descriptionTranslationKey | translate:$upload.getFileSizeLimit()}}" class="upload-message">{{descriptionTranslationKey | translate:$upload.getFileSizeLimit()}}</div>'),$templateCache.put("scripts/pages/_partials/upload-popup.html",'<div ng-show="$upload.popupIsVisible" ng-click="$upload.hidePopup()" class="inner-popup-underlay"></div><div id="uploader" ng-if="$upload.getFilesQueue().length &amp;&amp; ($upload.isMinimization || $upload.popupIsVisible)" drop-files="$upload.addFiles(files, adapter.name == \'private\' ? $folders.selectedFolder : null)" can-upload="adapter.can.item.upload()" ng-class="{\'has-failed\': $upload.hasFailedFiles(), \'in-progress\': $upload.hasInProgress(), minimize: $upload.isMinimization}" class="inner-popup"><div class="popup-header"><h2>{{$upload.hasInProgress() ? \'uploader.uploading\' : \'uploader.uploaded\' | translate}}<span class="numbers">&nbsp;({{$upload.succeededFilesCount()}}/{{$upload.allFilesCount()}} <span ng-switch="$upload.allFilesCount() &gt; 1"><span ng-switch-when="true">{{\'uploader.files\' | translate}})</span><span ng-switch-when="false">{{\'uploader.file\' | translate}})</span></span></span><span ng-if="$upload.failedFilesCount() - $upload.cancelledFilesCount() &gt; 0" class="fails">&nbsp;-&nbsp;<span class="failed-count">{{$upload.failedFilesCount() - $upload.cancelledFilesCount()}} <span ng-switch="$upload.failedFilesCount() - $upload.cancelledFilesCount() &gt; 1"><span ng-switch-when="true">{{\'uploader.errors\' | translate}}</span><span ng-switch-when="false">{{\'uploader.error\' | translate}}</span></span></span></span><div ng-click="$upload.hidePopup()" class="close">×</div></h2><div ng-show="$upload.hasInProgress()" class="progress-bar"><div ng-style="{\'width\': $upload.totalProgressPercent + \'%\'}" class="progress"></div></div><div class="message">{{\'uploader.popup_message\' | translate}}</div></div><div class="popup-content"><div class="uploads-list"><ul><li ng-class="{cancelled: $upload.isCancelled(fileToUpload)}" ng-repeat="fileToUpload in $upload.getFilesQueue()" class="{{fileToUpload.status}}"><div ng-click="fileToUpload.abort()" ng-show="$upload.canCancelUpload(fileToUpload) &amp;&amp; fileToUpload.canAbort()" class="cancel-file">×</div><div ng-show="fileToUpload.status == \'succeeded\'" class="success">&check;</div><div ng-click="fileToUpload.signUpForRetry()" ng-show="!$upload.isInProgress(fileToUpload) &amp;&amp; fileToUpload.canRetry() &amp;&amp; !$upload.isFolder(fileToUpload)" class="retry">&nbsp;{{"uploader.retry" | translate}}</div><div thumb="fileToUpload.source.file" thumb-doc="fileToUpload.source.file" media-type="fileToUpload.source.mediaType" class="item-preview {{fileToUpload.source.mediaType}}"><div ng-show="fileToUpload.status == \'uploading\'" class="progress-number">{{ (fileToUpload.bytesLoaded/fileToUpload.source.file.size) * 100 | number : 0 }}%</div><div ng-show="fileToUpload.status == \'processing\'" class="progress-processing"></div><div ng-show="$upload.isInProgress(fileToUpload) &amp;&amp; !$upload.isWaiting(fileToUpload)" ng-style="{width: ((fileToUpload.bytesLoaded/fileToUpload.source.file.size) * 100 | number : 0) + \'%\'}" class="progress"></div></div><div class="item-wrapper"><div class="item-inner"><div title="{{fileToUpload.source.file.name.length &gt; 40 ? fileToUpload.source.file.name : &quot;&quot;}} " class="item-name">{{fileToUpload.source.file.name}}</div><div ng-switch="fileToUpload.status == \'failed\'" class="item-description"><div ng-switch-when="false" class="item-size"><span ng-bind="$upload.getReadableFileSize(fileToUpload.bytesLoaded)"></span></div><div ng-switch-when="false" ng-show="fileToUpload.source.folderName.length &lt; 30" class="item-folder"><span ng-show="$upload.isInProgress(fileToUpload)">&nbsp;{{\'uploader.of\' | translate}}&nbsp;<span ng-bind="$upload.getReadableFileSize(fileToUpload.source.file.size)"></span></span>&nbsp;<span class="item-folder-description">{{"uploader.uploaded_to_folder" | translate : fileToUpload.source.folderName}}</span></div><div ng-switch-when="false" ng-show="fileToUpload.source.folderName.length &gt; 30" title="{{\'uploader.uploaded_to_folder\' | translate : fileToUpload.source.folderName}}" class="item-folder"><span ng-show="$upload.isInProgress(fileToUpload)">&nbsp;{{\'uploader.of\' | translate}}&nbsp;<span ng-bind="$upload.getReadableFileSize(fileToUpload.source.file.size)"></span></span>&nbsp;</div><div ng-switch-when="true" class="item-folder"><span title="{{$upload.translateError(fileToUpload)}}" class="item-folder-description">{{$upload.translateError(fileToUpload)}}</span></div></div></div></div></li></ul></div></div><div class="popup-footer"><div ng-click="$upload.hidePopup()" class="close">{{"uploader.hide" | translate}}</div><div ng-click="$upload.confirmAbortAll()" ng-show="$upload.hasInProgress() &amp;&amp; $upload.hasAbortable()" class="cancel-upload">{{"uploader.cancel_all" | translate}}</div><div ng-click="$upload.retryAll()" ng-show="$upload.hasRetryable() &amp;&amp; !$upload.hasInProgress()" class="retry-all">{{"uploader.retry_all" | translate}}</div></div></div>'),$templateCache.put("scripts/pages/_partials/window-header.html",'<h1>{{\'header\' | translate}}<button bi-click="{ eventName: \'closeButton.click\', data: {} }" ng-click="closeWindow()" class="close">×</button><button bi-click="{ eventName: \'helpButton.click\', data: {} }" ng-click="$help.showPopup()" class="help">| ?</button></h1><div ng-include="\'scripts/pages/_partials/help-popup.html\'"></div>'),$templateCache.put("scripts/pages/app.html",'<link ng-href="{{settings.cssUrl}}" ng-if="settings.cssUrl" rel="stylesheet"/><div ui-view="" class="window-wrapper {{settings.windowStyle}}{{settings.showTabs ? \'\' : \' without-tabs\'}}"></div>'),$templateCache.put("scripts/pages/empty/empty.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow()"></upload-button></div></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/external-search/_partials/intro.html",'<div ng-hide="$searchQuery.query" class="start-work"><h3>{{ \'external_search.start_work.header\' | translate }}</h3><div class="description">{{ \'external_search.start_work.description\' | translate }}</div><div class="arrow"></div></div>'),$templateCache.put("scripts/pages/external-search/_partials/services-list.html",'<div class="folders"><ul><li ng-class="{current: $services.selected == service}" ng-repeat="service in $services.list"><button ng-class="service.id" ng-click="$services.select(service)" class="name service">{{service.name}}</button></li></ul></div>'),$templateCache.put("scripts/pages/external-search/external-search.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div items-grid-resize="$layouts.selected.itemWidth + $services.selected.id" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files)" can-upload="tabs.private.canShow()"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div class="sidebar"><div ng-include="\'scripts/pages/external-search/_partials/services-list.html\'" class="sidebar-inner"></div></div><div ng-class="$layouts.selected.id" when-scrolled-to-bottom="$nestedEntities.more()" class="entities-wrapper"><breadcrumbs list="[$services.selected]"></breadcrumbs><no-entities search-query="$searchQuery.query" upload-files="$upload.addFiles(files)" can-upload="adapter.can.item.upload()" ng-show="$nestedEntities.list.length == 0"></no-entities><div ng-include="\'scripts/pages/external-search/_partials/intro.html\'"></div><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid adapter-name="adapter.name" entities="$nestedEntities.list" ng-if="$searchQuery.query" double-click="selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" can-select-multiple="true" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div><div ng-include="\'scripts/pages/_partials/import.html\'"></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/external/_partials/connect-service.html",'<div class="services-intro"><div class="image"></div><h2>{{\'external_media.no_services.header1\' | translate}}</h2><h3>{{\'external_media.no_services.service_header2\' | translate : $services.selected.name}}</h3><button bi-click="{eventName: \'socialService.connectButton.click\', data: { target: $services.selected.id}}" ng-click="$services.connect($services.selected)" class="connect-service {{$services.selected.id}}">{{\'external_media.no_services.connect\' | translate : $services.selected.name}}</button></div>'),$templateCache.put("scripts/pages/external/_partials/intro.html",'<div class="services-intro-wrapper"><div class="services-intro large"><h2>{{\'external_media.no_services.header1\' | translate}}</h2><h3>{{\'external_media.no_services.header2\' | translate}}</h3><div ng-class="{\'one-child\':$services.disconnectedList().length == 1}" class="services"><button ng-repeat="service in $services.disconnectedList()" bi-click="{eventName: \'socialService.connectButton.click\', data: { target: service.id}}" ng-click="$services.connect(service)" class="{{service.id}}">{{service.name}}</button></div></div></div>'),$templateCache.put("scripts/pages/external/_partials/services.html",'<div class="folders"><ul class="services"><li ng-class="{current: $services.selected.id == service.id}" ng-repeat="service in $services.list"><button ng-click="$services.select(service)" class="name service {{service.id}}">{{service.name}}</button><div popup="{contentClass: \'context-menu\', offsetLeft: 10, offsetTop: 18}" class="actions"><div ng-switch="$services.isConnected(service)" class="context-menu context-menu menu"><button ng-click="$services.disconnect(service)" ng-switch-when="true" class="disconnect">{{"external_media.services_list.disconnect" | translate}}</button><button ng-click="$services.connect(service)" ng-switch-when="false" class="connect">{{"external_media.services_list.connect" | translate}}</button></div></div></li></ul></div>'),$templateCache.put("scripts/pages/external/external.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div>{{$services.selected.name}}<div items-grid-resize="$layouts.selected.itemWidth + $services.selected.id" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow()"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div ng-hide="$services.isAllDisconnected()" class="sidebar"><div ng-include="\'scripts/pages/external/_partials/services.html\'" class="sidebar-inner"></div></div><div ng-if="$services.selected &amp;&amp; !$services.isAllDisconnected()" ng-class="$layouts.selected.id" when-scrolled-to-bottom="getSelectedFolder() ? $nestedEntities.more() : null" select-all="" class="entities-wrapper"><breadcrumbs list="breadcrumbsList()" action="selectFolderOrService(folder)" ng-if="($services.selected &amp;&amp; $services.isConnected($services.selected)) || $folders.list.length"></breadcrumbs><div ng-show="$nestedEntities.list.length == 0 &amp;&amp; $services.isConnected($services.selected) &amp;&amp; !isLoading" class="no-entities no-picture"><h3>{{ \'no_social_items_in_folder\' | translate : getSelectedFolder().name }}</h3></div><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid ng-show="$services.isConnected($services.selected)" adapter-name="adapter.name" folder-name-by-id="$folders.nameById(id) || $nestedEntities.nameById(id)" entities="$nestedEntities.list" reset-scroll="getSelectedFolder()" click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : &quot;&quot; " double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="getSelectedFolder()" move-selected-to-folder="$nestedEntities.moveSelectedToFolder(folder)" rename-ctrl="$nestedEntities.$rename" can-select-multiple="true" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div><div ng-if="!$services.isConnected($services.selected)" ng-include="\'scripts/pages/external/_partials/connect-service.html\'"></div></div><div ng-if="$services.isAllDisconnected()" ng-include="\'scripts/pages/external/_partials/intro.html\'"></div><div ng-include="\'scripts/pages/_partials/import.html\'"></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/photo-stock/photo-stock.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow()"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div ng-include="\'scripts/pages/public/_partials/parent-folders.html\'" class="parent-folders"></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" when-scrolled-to-bottom="$nestedEntities.more()" class="entities-wrapper"><breadcrumbs list="[$folders.selectedFolder]" ng-if="$nestedEntities.list.length || settings.hasSubfolders"></breadcrumbs><no-entities selected-folder="$folders.selectedFolder" search-query="$searchQuery.query" upload-files="$upload.addFiles(files)" can-upload="adapter.can.items.upload()" ng-show="$nestedEntities.list.length == 0" all-folder="getAllFolder()" select-folder="$folders.selectFolder(folder)"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid adapter-name="adapter.name" folder-name-by-id="$folders.nameById(id)" entities="$nestedEntities.list" reset-scroll="$folders.selectedFolder" select-and-submit-item="selectAndSubmitItem(item)" double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="$folders.selectedFolder" can-select-multiple="false" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),
$templateCache.put("scripts/pages/public/_partials/parent-folders.html",'<ul><li ng-class="{current: $parentFolders.selectedFolder.id == folder.id}" ng-repeat="folder in $parentFolders.list"><button ng-click="$parentFolders.selectFolder(folder)">{{folder.name}}</button></li></ul>'),$templateCache.put("scripts/pages/public/public.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow()"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div ng-include="\'scripts/pages/public/_partials/parent-folders.html\'" class="parent-folders"></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" when-scrolled-to-bottom="$nestedEntities.more()" class="entities-wrapper"><breadcrumbs list="[$parentFolders.selectedFolder, $folders.selectedFolder]" action="$folders.selectFolder($folders.list[0])" ng-if="$nestedEntities.list.length || settings.hasSubfolders"></breadcrumbs><no-entities selected-folder="$folders.selectedFolder" search-query="$searchQuery.query" upload-files="$upload.addFiles(files)" can-upload="adapter.can.items.upload()" ng-show="$nestedEntities.list.length == 0" select-folder="$folders.selectFolder(folder)" all-folder="getAllFolder()"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid adapter-name="adapter.name" folder-name-by-id="$folders.nameById(id)" entities="$nestedEntities.list" reset-scroll="$folders.selectedFolder" double-click="selectAndSubmitItem(entity)" selected-folder="$folders.selectedFolder" selected-layout-id="$layouts.selected.id" can-select-multiple="true" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>')}]),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.tooltip","ui.bootstrap.position","ui.bootstrap.bindHtml"]),angular.module("ui.bootstrap.tpls",["template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html"]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function snake_case(name){var regexp=/[A-Z]/g,separator="-";return name.replace(regexp,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}var defaultOptions={placement:"top",animation:!0,popupDelay:0},triggerMap={mouseenter:"mouseleave",click:"click",focus:"blur"},globalOptions={};this.options=function(value){angular.extend(globalOptions,value)},this.setTriggers=function(triggers){angular.extend(triggerMap,triggers)},this.$get=["$window","$compile","$timeout","$document","$position","$interpolate",function($window,$compile,$timeout,$document,$position,$interpolate){return function(type,prefix,defaultTriggerShow){function getTriggers(trigger){var show=trigger||options.trigger||defaultTriggerShow,hide=triggerMap[show]||show;return{show:show,hide:hide}}var options=angular.extend({},defaultOptions,globalOptions),directiveName=snake_case(type),startSym=$interpolate.startSymbol(),endSym=$interpolate.endSymbol(),template="<div "+directiveName+'-popup title="'+startSym+"title"+endSym+'" content="'+startSym+"content"+endSym+'" placement="'+startSym+"placement"+endSym+'" animation="animation" is-open="isOpen"></div>';return{restrict:"EA",compile:function(tElem,tAttrs){var tooltipLinker=$compile(template);return function(scope,element,attrs){function toggleTooltipBind(){ttScope.isOpen?hideTooltipBind():showTooltipBind()}function showTooltipBind(){hasEnableExp&&!scope.$eval(attrs[prefix+"Enable"])||(prepareTooltip(),ttScope.popupDelay?popupTimeout||(popupTimeout=$timeout(show,ttScope.popupDelay,!1),popupTimeout.then(function(reposition){reposition()})):show()())}function hideTooltipBind(){scope.$apply(function(){hide()})}function show(){return popupTimeout=null,transitionTimeout&&($timeout.cancel(transitionTimeout),transitionTimeout=null),ttScope.content?(createTooltip(),tooltip.css({top:0,left:0,display:"block"}),ttScope.$digest(),positionTooltip(),ttScope.isOpen=!0,ttScope.$digest(),positionTooltip):angular.noop}function hide(){ttScope.isOpen=!1,$timeout.cancel(popupTimeout),popupTimeout=null,ttScope.animation?transitionTimeout||(transitionTimeout=$timeout(removeTooltip,500)):removeTooltip()}function createTooltip(){tooltip&&removeTooltip(),tooltipLinkedScope=ttScope.$new(),tooltip=tooltipLinker(tooltipLinkedScope,function(tooltip){appendToBody?$document.find("body").append(tooltip):element.after(tooltip)})}function removeTooltip(){transitionTimeout=null,tooltip&&(tooltip.remove(),tooltip=null),tooltipLinkedScope&&(tooltipLinkedScope.$destroy(),tooltipLinkedScope=null)}function prepareTooltip(){prepPlacement(),prepPopupDelay()}function prepPlacement(){var val=attrs[prefix+"Placement"];ttScope.placement=angular.isDefined(val)?val:options.placement}function prepPopupDelay(){var val=attrs[prefix+"PopupDelay"],delay=parseInt(val,10);ttScope.popupDelay=isNaN(delay)?options.popupDelay:delay}function prepTriggers(){var val=attrs[prefix+"Trigger"];unregisterTriggers(),triggers=getTriggers(val),triggers.show===triggers.hide?element.bind(triggers.show,toggleTooltipBind):(element.bind(triggers.show,showTooltipBind),element.bind(triggers.hide,hideTooltipBind))}var tooltip,tooltipLinkedScope,transitionTimeout,popupTimeout,appendToBody=angular.isDefined(options.appendToBody)?options.appendToBody:!1,triggers=getTriggers(void 0),hasEnableExp=angular.isDefined(attrs[prefix+"Enable"]),ttScope=scope.$new(!0),positionTooltip=function(){var ttPosition=$position.positionElements(element,tooltip,ttScope.placement,appendToBody);ttPosition.top+="px",ttPosition.left+="px",tooltip.css(ttPosition)};ttScope.isOpen=!1,attrs.$observe(type,function(val){ttScope.content=val,!val&&ttScope.isOpen&&hide()}),attrs.$observe(prefix+"Title",function(val){ttScope.title=val});var unregisterTriggers=function(){element.unbind(triggers.show,showTooltipBind),element.unbind(triggers.hide,hideTooltipBind)};prepTriggers();var animation=scope.$eval(attrs[prefix+"Animation"]);ttScope.animation=angular.isDefined(animation)?!!animation:options.animation;var appendToBodyVal=scope.$eval(attrs[prefix+"AppendToBody"]);appendToBody=angular.isDefined(appendToBodyVal)?appendToBodyVal:appendToBody,appendToBody&&scope.$on("$locationChangeSuccess",function(){ttScope.isOpen&&hide()}),scope.$on("$destroy",function(){$timeout.cancel(transitionTimeout),$timeout.cancel(popupTimeout),unregisterTriggers(),removeTooltip(),ttScope=null})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function($tooltip){return $tooltip("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(scope,element,attr){element.addClass("ng-binding").data("$binding",attr.bindHtmlUnsafe),scope.$watch(attr.bindHtmlUnsafe,function(value){element.html(value||"")})}}),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),function(exports){"use strict";function createCollection(proto,objectOnly){function Collection(a){return this&&this.constructor===Collection?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=objectOnly,void(a&&init.call(this,a))):new Collection(a)}return objectOnly||defineProperty(proto,"size",{get:sharedSize}),proto.constructor=Collection,Collection.prototype=proto,Collection}function init(a){this.add?a.forEach(this.add,this):a.forEach(function(a){this.set(a[0],a[1])},this)}function sharedDelete(key){return this.has(key)&&(this._keys.splice(i,1),this._values.splice(i,1),this._itp.forEach(function(p){i<p[0]&&p[0]--})),i>-1}function sharedGet(key){return this.has(key)?this._values[i]:void 0}function has(list,key){if(this.objectOnly&&key!==Object(key))throw new TypeError("Invalid value used as weak collection key");if(key!=key||0===key)for(i=list.length;i--&&!is(list[i],key););else i=list.indexOf(key);return i>-1}function setHas(value){return has.call(this,this._values,value)}function mapHas(value){return has.call(this,this._keys,value)}function sharedSet(key,value){return this.has(key)?this._values[i]=value:this._values[this._keys.push(key)-1]=value,this}function sharedAdd(value){return this.has(value)||this._values.push(value),this}function sharedClear(){this._values.length=0}function sharedKeys(){return sharedIterator(this._itp,this._keys)}function sharedValues(){return sharedIterator(this._itp,this._values)}function mapEntries(){return sharedIterator(this._itp,this._keys,this._values)}function setEntries(){return sharedIterator(this._itp,this._values,this._values)}function sharedIterator(itp,array,array2){var p=[0],done=!1;return itp.push(p),{next:function(){var v,k=p[0];return!done&&k<array.length?(v=array2?[array[k],array2[k]]:array[k],p[0]++):(done=!0,itp.splice(itp.indexOf(p),1)),{done:done,value:v}}}}function sharedSize(){return this._values.length}function sharedForEach(callback,context){for(var it=this.entries();;){var r=it.next();if(r.done)break;callback.call(context,r.value[1],r.value[0],this)}}var i,defineProperty=Object.defineProperty,is=function(a,b){return isNaN(a)?isNaN(b):a===b};"undefined"==typeof WeakMap&&(exports.WeakMap=createCollection({"delete":sharedDelete,clear:sharedClear,get:sharedGet,has:mapHas,set:sharedSet},!0)),"undefined"==typeof Map&&(exports.Map=createCollection({"delete":sharedDelete,has:mapHas,get:sharedGet,set:sharedSet,keys:sharedKeys,values:sharedValues,entries:mapEntries,forEach:sharedForEach,clear:sharedClear})),"undefined"==typeof Set&&(exports.Set=createCollection({has:setHas,add:sharedAdd,"delete":sharedDelete,clear:sharedClear,keys:sharedValues,values:sharedValues,entries:setEntries,forEach:sharedForEach})),"undefined"==typeof WeakSet&&(exports.WeakSet=createCollection({"delete":sharedDelete,add:sharedAdd,clear:sharedClear,has:setHas},!0))}("undefined"!=typeof exports&&"undefined"!=typeof global?global:window),UUID.generate=function(){var rand=UUID._gri,hex=UUID._ha;return hex(rand(32),8)+"-"+hex(rand(16),4)+"-"+hex(16384|rand(12),4)+"-"+hex(32768|rand(14),4)+"-"+hex(rand(48),12)},UUID._gri=function(x){return 0>x?NaN:30>=x?0|Math.random()*(1<<x):53>=x?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<x-30))*(1<<30):NaN},UUID._ha=function(num,length){for(var str=num.toString(16),i=length-str.length,z="0";i>0;i>>>=1,z+=z)1&i&&(str=z+str);return str},function(){this.app.directive("draggable",function($compile,$templateCache,SelectedEntities,Folder,settings){return{scope:{entity:"=draggable",canDrag:"="},link:function(scope,el,attrs){var $el,canNotDragItem,enableDrag,helper,template;if(scope.canDrag)return template=$templateCache.get("scripts/directives/draggable/draggable-helper.html"),helper=function(){return scope.count=SelectedEntities.size||1,$compile(template)(scope)},scope.isFolder=function(entity){return entity instanceof Folder},canNotDragItem=function(){return"single"===settings.selectionType&&!SelectedEntities.has(scope.entity)&&SelectedEntities.size>0},$el=$(el),enableDrag=function(){return $el.draggable("instance")&&$el.draggable("destroy"),$el.draggable({revert:"invalid",helper:helper,delay:100,appendTo:"body",cursorAt:{left:57,top:57},addClasses:!0,zIndex:1e4,start:function(){return canNotDragItem()?!1:el.addClass("ui-dragging")},stop:function(){return el.removeClass("ui-dragging")}})},$el.mouseover(enableDrag),$el.mousedown(enableDrag)}}})}.call(this),function(){app.directive("folderActions",function(){return{restrict:"E",scope:{folder:"=",showRenaming:"&",remove:"="},templateUrl:"scripts/directives/folder-actions/folder-actions.html"}})}.call(this),function(){app.directive("preview",function($sce){return{restrict:"E",replace:!0,templateUrl:"scripts/directives/preview/preview.html",scope:{item:"=",folderName:"=",adapterName:"="},link:function(scope){return scope.isRetina=window.devicePixelRatio>1,scope.videoSrc=[],"video"===scope.item.mediaType?_.forEach(scope.item.videoPreviewUrl,function(videoUrl){return scope.videoSrc.push($sce.trustAsResourceUrl(videoUrl))}):void 0}}})}.call(this),function(){this.app.directive("entitiesGrid",function(SelectedEntities,Notifications,i18n,Aviary,bigstockPrice,$sce,Folder){return{restrict:"E",templateUrl:"scripts/directives/entities-grid/entities-grid.html",scope:{entities:"=",folderNameById:"&",selectedFolder:"=",adapterName:"=",renameCtrl:"=",moveSelectedToFolder:"&",click:"&",doubleClick:"&",selectAndSubmitItem:"&",onAllThumbnailsLoaded:"&",canSelectMultiple:"=",selectedLayoutId:"=",remove:"="},link:function(scope){return"bigstock"===scope.adapterName&&(scope.price=$sce.trustAsHtml(i18n.translate("photo_stock.big_stock.buy_short")),bigstockPrice().then(function(response){return scope.price=$sce.trustAsHtml(""+response.currencySymbol+response.priceValue)})),scope.isSelected=function(entity){return SelectedEntities.has(entity)},scope.isFolder=function(entity){return entity instanceof Folder},scope.folderName=function(item){return"function"==typeof scope.folderNameById?scope.folderNameById({id:item.folderId}):void 0},scope.onThumbnailLoaded=_.debounce(function(){return"function"==typeof scope.onAllThumbnailsLoaded?scope.onAllThumbnailsLoaded():void 0},1e3),scope.editItemInAviary=function(item){return Aviary.upload(item.name,null!=item?item.originalUrl:void 0,scope.selectedFolder)},scope.rename=function(newName,entity){return 0===$.trim(newName).length?Notifications.send(i18n.translate("errors.rename_item_failed.empty_name")):$.trim(newName).length>256?Notifications.send(i18n.translate("errors.rename_item_failed.long_name")):entity.rename(newName)}}}})}.call(this),function(){app.directive("moreActionsTooltip",function(settings,$compile,$templateCache,$parse){return{restrict:"A",link:function(scope,element,attrs){var actionsContainer,defaultOptions,getActionsWidth,hiddenActionsContainer,hideActions,oldActionsWidth,oldContainerWidth,restoreHiddenActions,showMore,showMoreTemplate;if(settings.hasFavorites)return showMoreTemplate=$templateCache.get("scripts/directives/more-actions-tooltip/show-more.html"),defaultOptions={drawOnEvent:"mouseover",actionsContainerSelector:".actions"},scope.options=_.assign({},defaultOptions,$parse(attrs.popup)(scope)),actionsContainer=element.find(scope.options.actionsContainerSelector),showMore=$compile(showMoreTemplate)(scope),hiddenActionsContainer=showMore.find(".more-actions"),oldActionsWidth=0,oldContainerWidth=0,getActionsWidth=function(){var actions;return actions=actionsContainer.children(":not(.ng-hide)"),_.reduce(actions,function(memo,el){return memo+$(el).outerWidth()},0)},restoreHiddenActions=function(hiddenActions){return(null!=hiddenActions?hiddenActions.length:void 0)?actionsContainer.append(hiddenActions):void 0},hideActions=function(){var lastAction,results;for(results=[];getActionsWidth()>actionsContainer.width()&&0!==actionsContainer.children(":not(.show-more, .ng-hide)").length;)lastAction=actionsContainer.children(":not(.show-more, .ng-hide)").last(),hiddenActionsContainer.prepend(lastAction),actionsContainer.children(".show-more").length?results.push(actionsContainer.children(".show-more").show()):results.push(actionsContainer.append(showMore));return results},element.on(scope.options.drawOnEvent,function(){return oldActionsWidth!==getActionsWidth()||oldContainerWidth!==actionsContainer.width()?(actionsContainer.children(".show-more").hide(),restoreHiddenActions(hiddenActionsContainer.children()),hideActions(),oldContainerWidth=actionsContainer.width(),oldActionsWidth=getActionsWidth()):void 0})}}})}.call(this),function(){app.directive("spinner",function(){return{restrict:"E",templateUrl:"scripts/directives/spinner/spinner.html",link:function(scope,el,attr){var $path,$svg,animateColor,animateRotation,animateStroke,applyAnimation,ref,setColor2,setColor3,setColor4;return $svg=$(el).find(".spinner"),$path=$(el).find(".path"),applyAnimation=function(val,tween){return"strokeDashoffset"===tween.prop&&$(this).css("stroke-dashoffset",val),"transformRotate"===tween.prop?$(this).css("transform","rotate("+val+"deg)"):void 0},animateRotation=function(){return $svg.css({"transform-rotate":0}),$svg.animate({"transform-rotate":270},{step:applyAnimation,duration:1400,complete:animateRotation})},animateStroke=function(){return $path.animate({"transform-rotate":135,"stroke-dashoffset":46.75},{step:applyAnimation,duration:700,complete:function(){return $path.animate({"transform-rotate":450,"stroke-dashoffset":187},{step:applyAnimation,duration:700,complete:animateStroke})}})},animateColor=function(){return $path.css({stroke:"#3899ec"}),setTimeout(setColor2,1400)},setColor2=function(){return $path.css({stroke:"#42c5bf"}),setTimeout(setColor3,1400)},setColor3=function(){return $path.css({stroke:"#6ccc65"}),setTimeout(setColor4,1400)},setColor4=function(){return $path.css({stroke:"#79b6f0"}),setTimeout(animateColor,1400)},/MSIE|Trident/i.test(null!=(ref=window.navigator)?ref.userAgent:void 0)?($svg.css({"z-index":1e3}),$svg.css({animation:"none"}),$path.css({animation:"none"}),animateStroke(),animateRotation(),animateColor()):void 0}}})}.call(this),function(){this.app.directive("uploadButton",function(tabs,settings,i18n,serviceRedirectUrl,$state,path,$q){return{restrict:"E",scope:{uploadFiles:"&",canUpload:"="},templateUrl:"scripts/directives/upload-button/upload-button.html",link:function(scope){var externalAdapterSettings,uploadFiles;return externalAdapterSettings={redirectUrl:serviceRedirectUrl()},scope.externalServices=_.map(tabs.external.getAdapters(),function(adapter){var connector,connectorId;return connectorId=_.snakeCase(adapter.name).toUpperCase(),connector=wixmp.connectExternalSource(connectorId,externalAdapterSettings),{id:adapter.name,name:i18n.translate("external_media."+adapter.name),connect:connector.connect,isConnected:connector.isConnected}}),scope.canConnectExternal="picture"===settings.mediaType&&settings.canShowUploadButtonPopup,scope.connectExternal=function(service){var promise;return promise=service.isConnected()?$q.when():service.connect(),promise.then(function(){return path.setFull("external/"+service.id),$state.go("app.external",{},{reload:!0})})},uploadFiles=scope.uploadFiles,scope.uploadFiles=_.throttle(uploadFiles)}}})}.call(this),function(){this.app.directive("noEntities",function(htmlEncode){return{restrict:"E",templateUrl:"scripts/directives/no-entities/no-entities.html",scope:{selectedFolder:"=",canUpload:"=",uploadFiles:"&",searchQuery:"=",type:"@",allFolder:"=",selectFolder:"&"},link:function(scope){return scope.getSearchQuery=function(){return htmlEncode(scope.searchQuery)},scope.isSearch=function(){return!!scope.searchQuery},scope.searchTemplate="user-owned"===scope.type?"no-user-owned-search-results.html":"no-search-results.html"}}})}.call(this),function(){app.directive("breadcrumbs",function(){return{restrict:"E",templateUrl:"scripts/directives/breadcrumbs/breadcrumbs.html",scope:{list:"&",action:"&"},link:function(scope,el,attr){return scope.existedList=function(){return _.filter(scope.list(),function(folder){return!!folder})}}}})}.call(this),function(){this.app.directive("renamableName",function(){return{restrict:"E",scope:{entity:"=",renameCtrl:"=",redrawOnChange:"="},link:function(scope){return scope.newName=scope.entity.name},templateUrl:"scripts/directives/renamable-name/renamable-name.html"}})}.call(this),function(){this.app.directive("subfolderLongName",["$timeout","$window","$parse","Folder",function($timeout,$window,$parse,Folder){return{restrict:"A",scope:{subfolder:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",redrawOnChange:"="},compile:function(elem,attr,linker){return function(scope,element,attributes){var buildEllipsis,drawNameTooltip,isOverflowed;scope.subfolder instanceof Folder&&(buildEllipsis=function(){var appendString,bindArray,bindArrayStartingLength,ellipsisSymbol,i,initialMaxHeight,splitter;if(splitter="","undefined"!=typeof scope.subfolder&&(bindArray=scope.subfolder.name.split(splitter),i=0,ellipsisSymbol="undefined"!=typeof attributes.ellipsisSymbol?attributes.ellipsisSymbol:"&hellip;",appendString="undefined"!=typeof scope.ellipsisAppend&&""!==scope.ellipsisAppend?ellipsisSymbol+"<span>"+scope.ellipsisAppend+"</span>":ellipsisSymbol,attributes.isTruncated=!1,element.html(scope.subfolder.name),isOverflowed(element))){for(drawNameTooltip(element,scope.subfolder.name),bindArrayStartingLength=bindArray.length,initialMaxHeight=element[0].clientHeight,element.html(scope.subfolder.name+appendString);bindArrayStartingLength>i;){if(bindArray.pop(),element.html(bindArray.join(splitter)+appendString),element[0].scrollHeight<initialMaxHeight||isOverflowed(element)===!1){attributes.isTruncated=!0;break}i++}ellipsisSymbol!==appendString&&"undefined"!=typeof scope.ellipsisAppendClick&&""!==scope.ellipsisAppendClick&&element.find("span").bind("click",function(e){scope.$apply(scope.ellipsisAppendClick)})}},drawNameTooltip=function(element,name){var subfolder,tooltip;return subfolder=element.parents(".item.folder"),$(".subfolder-name-tooltip",subfolder).length?void 0:(tooltip=angular.element('<div class="subfolder-name-tooltip ng-hide">'+name+"</div>"),subfolder.append(tooltip),$(".name",subfolder).on("mouseenter",function(){return tooltip.removeClass("ng-hide")}),subfolder.on("mouseleave",function(){return tooltip.addClass("ng-hide")}))},isOverflowed=function(thisElement){return thisElement[0].scrollHeight>thisElement[0].clientHeight||thisElement[0].scrollWidth>thisElement[0].clientWidth},attributes.lastWindowResizeTime=0,attributes.lastWindowResizeWidth=0,attributes.lastWindowResizeHeight=0,attributes.lastWindowTimeoutEvent=null,attributes.isTruncated=!1,scope.$watch("ngBind",function(){buildEllipsis()}),scope.$watch("ellipsisAppend",function(){buildEllipsis()}),scope.$watch("redrawOnChange",function(){buildEllipsis()}),angular.element($window).bind("resize",function(){$timeout.cancel(attributes.lastWindowTimeoutEvent),attributes.lastWindowTimeoutEvent=$timeout(function(){attributes.lastWindowResizeWidth===window.innerWidth&&attributes.lastWindowResizeHeight===window.innerHeight||buildEllipsis(),attributes.lastWindowResizeWidth=window.innerWidth,attributes.lastWindowResizeHeight=window.innerHeight},75)}))}}}}])}.call(this),function(){app.directive("autoscroll",function(){return{restrict:"A",link:function(scope,element,attrs){return setTimeout(function(){return element[0].scrollTop="bottom"===attrs.autoscroll?element[0].scrollHeight-element[0].clientHeight:0},200)}}})}.call(this),function(){app.directive("focusMe",function($timeout){return function(scope,element,attrs){return scope.$watch(attrs.focusMe,function(value){return value?$timeout(function(){return element[0].focus()}):void 0})}})}.call(this),function(){app.directive("thumbDoc",function($parse,supportedDocsTypes){return{link:function(scope,element,attributes){var extension,file,fileSpecificBGImage,mediaType;return mediaType=$parse(attributes.mediaType)(scope),"document"===mediaType&&(file=$parse(attributes.thumbDoc)(scope),extension=_.last(file.name.split(".")),_.contains(supportedDocsTypes,extension))?(fileSpecificBGImage="images/thumbnails/document-"+extension+".svg",element.css({"background-image":"url("+fileSpecificBGImage+")","background-size":"cover"})):void 0}}}),app.directive("thumb",function($parse){return{link:function(scope,element,attributes){var file,mediaType,setImageAsBackground;return mediaType=$parse(attributes.mediaType)(scope),"document"!==mediaType?(file=$parse(attributes.thumb)(scope),setImageAsBackground=function(img){return element.append(img),element.css({"background-image":"none"})},file&&/image/i.test(file.type)?loadImage(file,setImageAsBackground,{maxWidth:element.innerWidth(),maxHeight:element.innerHeight(),crop:!0}):void 0):void 0}}})}.call(this),function(){app.directive("denyBubbling",function(){return{restrict:"A",link:function(scope,element,attrs){var eventName;return eventName=attrs.denyBubbling||"click",$(element).on(eventName,function(event){return event.cancelBubble=!0,"function"==typeof event.stopPropagation?event.stopPropagation():void 0})}}})}.call(this),function(){app.directive("onEnter",function(){return{restrict:"A",link:function(scope,element,attrs){return element.on("keydown",function(e){return 13===e.keyCode?scope.$apply(attrs.onEnter):void 0})}}})}.call(this),function(){app.directive("autoEnterDelayed",function(){return{restrict:"A",link:function(scope,element,attrs){return element.on("keydown",_.debounce(function(){return scope.$apply(attrs.onEnter)},800))}}})}.call(this),function(){app.directive("onEsc",function(){return{restrict:"A",link:function(scope,element,attrs){return element.on("keyup",function(e){return e.stopPropagation(),27===e.keyCode?scope.$apply(attrs.onEsc):void 0})}}})}.call(this),function(){app.directive("onClickOutside",function(){return{restrict:"A",link:function(scope,element,attrs){return element.on("focus",function(event){return $(document).off(".hideInput"),$(document).on("mousedown.hideInput",function(event){return event.target!==element[0]&&scope.$apply(attrs.onClickOutside),$(document).off(".hideInput")})})}}})}.call(this),function(){app.directive("multiSelect",function(SelectedEntities){return{controller:function($scope,$attrs,$parse){var lastSelectedItem;return lastSelectedItem=null,this.selectRange=function(entity){var endPosition,entities,i,j,ref,ref1,startPosition;if($scope.canSelectMultiple===!1)return this.selectSingle(entity);for(entities=$parse($attrs.multiSelect)($scope),startPosition=entities.indexOf(lastSelectedItem||entity),endPosition=entities.indexOf(entity),SelectedEntities.clear(),i=j=ref=startPosition,ref1=endPosition;ref1>=ref?ref1>=j:j>=ref1;i=ref1>=ref?++j:--j)SelectedEntities.add(entities[i]);return!0},this.addSingle=function(entity){return $scope.canSelectMultiple===!1?this.selectSingle(entity):SelectedEntities.has(entity)&&1===SelectedEntities.size?!1:(SelectedEntities.add(entity),lastSelectedItem=entity,!0)},this.selectSingle=function(entity){return SelectedEntities.has(entity)&&1===SelectedEntities.size?SelectedEntities.clear():(SelectedEntities.clear(),SelectedEntities.add(entity),lastSelectedItem=entity,!0)},this.unselectSingle=function(entity){return lastSelectedItem=null,SelectedEntities["delete"](entity)},this.invertSingle=function(entity){var method;return method=SelectedEntities.has(entity)?"unselectSingle":"addSingle",this[method](entity)},this}}}),app.directive("selectEntity",function(settings,SelectedEntities,$parse){return{link:function(scope,element,attrs){var entity;return entity=$parse(attrs.selectEntity)(scope),element.on("mousedown",function(event){return event.stopPropagation(),entity.can.select()?(SelectedEntities.clear(),SelectedEntities.add(entity),scope.$apply()):void 0}),element.on("mouseup",function(event){return SelectedEntities.clear(),scope.$apply()})}}}),app.directive("multiSelectEntity",function(settings,SelectedEntities,$parse){return{require:"?^multiSelect",link:function(scope,element,attrs,multiSelect){var entity,preventMouseUp;return preventMouseUp=!0,entity=$parse(attrs.multiSelectEntity)(scope),element.on("mousedown",function(event){var canDoScopeApply,isCtrl,isShift;return preventMouseUp=!1,canDoScopeApply=!1,isShift=event.shiftKey,isCtrl=event.metaKey||event.ctrlKey,event.stopPropagation(),entity.can.select()?(isShift?(multiSelect.selectRange(entity),preventMouseUp=!0,canDoScopeApply=!0):isCtrl?SelectedEntities.has(entity)||(multiSelect.addSingle(entity),
preventMouseUp=!0,canDoScopeApply=!0):0===SelectedEntities.size?(multiSelect.selectSingle(entity),preventMouseUp=!0,canDoScopeApply=!0):SelectedEntities.size>0&&"single"!==settings.selectionType&&!SelectedEntities.has(entity)&&(multiSelect.addSingle(entity),preventMouseUp=!0,canDoScopeApply=!0),canDoScopeApply?scope.$apply():void 0):void 0}),element.on("mouseup",function(event){var canDoScopeApply,isCtrl,isShift;if(!preventMouseUp&&(preventMouseUp=!0,isShift=event.shiftKey,isCtrl=event.metaKey||event.ctrlKey,canDoScopeApply=!1,!isShift&&(entity=$parse(attrs.multiSelectEntity)(scope),entity.can.select())))return isCtrl?SelectedEntities.has(entity)&&(multiSelect.unselectSingle(entity,!0),canDoScopeApply=!0):("single"===settings.selectionType?multiSelect.selectSingle(entity):multiSelect.invertSingle(entity,!0),canDoScopeApply=!0),canDoScopeApply?scope.$apply():void 0})}}}),app.directive("selectAll",function(SelectedEntities){return{scope:{entities:"="},link:function(scope,element){var ctrlOrCmdIsActiveInEvent,keyCodeIsForAlpha,targetIsNotInput;return targetIsNotInput=function(target){return"INPUT"!==target.tagName&&"TEXTAREA"!==target.tagName},keyCodeIsForAlpha=function(keyCode){return 65===keyCode},ctrlOrCmdIsActiveInEvent=function(event){return event.metaKey||event.ctrlKey},$(document).on("keydown",function(event){return targetIsNotInput(event.target)&&keyCodeIsForAlpha(event.keyCode)&&ctrlOrCmdIsActiveInEvent(event)?(SelectedEntities.clear(),scope.$apply(function(){return _.forEach(scope.entities,function(entity){return SelectedEntities.add(entity)})}),event.preventDefault(),event.stopPropagation(),!1):void 0}),element.on("mousedown",function(event){return event.target!==element[0]?(SelectedEntities.clear(),scope.$apply()):void 0})}}})}.call(this),function(){this.app.directive("biClick",function($parse,biUiEvents){return{restrict:"A",link:function(scope,el,attrs){return el.bind("click",function(){var options,params;return params=$parse(attrs.biClick)(scope),options=params.data,biUiEvents(params.eventName,options)})}}})}.call(this),function(){this.app.directive("whenScrolledToBottom",function(){return function(scope,element,attrs){var $element,applyOnScrollBottom,callAction,getContentHeight;return $element=$(element),callAction=_.throttle(function(){return scope.$apply(attrs.whenScrolledToBottom)},100),applyOnScrollBottom=function(){return $element.scrollTop()>0&&$element.scrollTop()>=element.prop("scrollHeight")-2*$element.height()?callAction():void 0},$element.on("scroll",applyOnScrollBottom),$element.on("mousemove",applyOnScrollBottom),getContentHeight=function(element){var contentHeight;return contentHeight=0,element.children().each(function(i,el){return contentHeight+=el.offsetHeight}),contentHeight},$element.on("mousewheel DOMMouseScroll",function(){return 0===$element.scrollTop()&&getContentHeight(element)<element.prop("scrollHeight")?callAction():void 0})}})}.call(this),function(){var isVisibleAt,loadImage,loadedImagesCount;loadedImagesCount=0,loadImage=function(url,callback,errorCallback){var image;return image=new Image,image.onload=function(){return callback(image),loadedImagesCount++,10===loadedImagesCount?appLoadNotifiers.first10ImagesLoaded():void 0},image.onerror=errorCallback,image.src=url,image},isVisibleAt=function(el,container){var offsetTop;return offsetTop=el.offset().top-container.offset().top,offsetTop>-el.outerHeight()&&offsetTop<=container.height()},this.app.directive("coveredBackground",function(){return{restrict:"A",scope:{coveredBackground:"@",loadIfChanged:"=",loadVisibleFor:"@",scrollDebounce:"@",onLoadSuccess:"&"},link:function(scope,element){var container,isLoaded,isLoading,setBackgroundSize,showImage,showOnEvent;return isLoaded=!1,isLoading=!1,scope.scrollDebounce||(scope.scrollDebounce=1500),setBackgroundSize=function(image){var backgroundSize;return backgroundSize=(image.width>=element.innerWidth()||image.height>=element.innerHeight())&&!/\.svg$/i.test(image.src)?"cover":"auto",element.css("background-size",backgroundSize)},showImage=function(url){return isLoaded||isLoading?void 0:(isLoading=!0,loadImage(url,function(image){return element.css("background-image","url("+url+")"),setBackgroundSize(image),isLoaded=!0,isLoading=!1,scope.onLoadSuccess()},function(){return isLoading=!1}))},container=element.parents(scope.loadVisibleFor).first(),showOnEvent=_.throttle(function(){return!scope.loadVisibleFor||isVisibleAt(element,container)?(isLoaded=!1,showImage(scope.coveredBackground)):void 0},scope.scrollDebounce),scope.$watch("coveredBackground",showOnEvent),scope.$watch("loadIfChanged",function(){return isLoaded||isLoading?void 0:showOnEvent()}),scope.loadVisibleFor?(container.scroll(function(){return isLoaded||isLoading?void 0:showOnEvent()}),$(window).resize(function(){return isLoaded||isLoading?void 0:showOnEvent()})):void 0}}})}.call(this),function(){var hideFns;hideFns=[],app.directive("popup",function($compile,$parse,$templateCache){var defaultOptions;return defaultOptions={event:"click",offsetTop:0,offsetLeft:0,pinTo:"element",pinToSelector:null,align:"bottom right",activeClass:"popup-opened",containerClass:"popup-container",contentClass:"popup-content",parentSelector:null,parentActiveClass:"active",centeredTip:!1,template:null,disable:!1,fadeOut:0},{restrict:"A",link:function(scope,el,attrs){var MARGIN_TOP,compileTemplate,options;return MARGIN_TOP=25,compileTemplate=function(templateId){return $compile($templateCache.get(templateId))(scope)},options=_.assign({},defaultOptions,$parse(attrs.popup)(scope)),options.disable?void 0:el.on(options.event,function(evt){var activeElementWidth,adjustPopupPosition,align,autoHide,calculateAlign,calculatePosition,containerEl,containerHeight,containerWidth,contentEl,contentInside,handlePopup,injectToDOM,position;return options.template&&el.html(compileTemplate(options.template)),el.hasClass(options.activeClass)?void 0:(_.forEach(hideFns,function(hide){return hide()}),containerWidth=0,containerHeight=0,activeElementWidth=0,contentInside=!!el.find("."+options.contentClass).length,contentEl=el.find(contentInside?"."+options.contentClass:"+ ."+options.contentClass),containerEl=angular.element("<div class='"+options.containerClass+"'></div>").append(contentEl),position={},align={vertical:_.intersection(options.align.split(" "),["top","bottom"])[0],horizontal:_.intersection(options.align.split(" "),["left","right","center"])[0]},injectToDOM=function(){return el.addClass(options.activeClass),options.parentSelector&&el.closest(options.parentSelector).addClass(options.parentActiveClass),options.centeredTip&&containerEl.addClass("centered-tip"),$("body").append(containerEl)},autoHide=function(){var delay,hideFn;return delay=300,hideFn=function(){var revertBlock;return el.off("mouseleave.popup"),el.off("mouseenter.popup"),el.off("click.popup"),containerEl.off("mousemove.popup"),containerEl.off("mouseenter.popup"),containerEl.off("click.popup"),$(window).off("resize.popup"),$(window).off("click.popup"),$(window).off("mousemove.popup"),_.remove(hideFns,function(fn){return fn===hideFn}),revertBlock=function(){return el.removeClass(options.activeClass),options.parentSelector&&el.closest(options.parentSelector).removeClass(options.parentActiveClass),contentInside?el.append(contentEl):el.parent().append(contentEl),containerEl.remove()},options.fadeOut?(containerEl.css({opacity:1}),containerEl.animate({opacity:0},options.fadeOut,revertBlock)):revertBlock()},hideFns.push(hideFn),containerEl.on("click.popup",hideFn),$(window).on("resize.popup",hideFn),setTimeout(function(){return $(window).on("click.popup",hideFn,100)}),el.one("mouseleave.popup",function(){var timeout;return containerEl.on("mousemove.popup",function(){return!1}),timeout=null,$(window).on("mousemove.popup",_.throttle(function(){var clearTimeout,hideContainer;return el.off("mouseenter.popup"),containerEl.off("mouseenter.popup"),clearTimeout=function(){return timeout?window.clearTimeout(timeout):void 0},hideContainer=function(){return clearTimeout(),timeout=window.setTimeout(hideFn,delay)},containerEl.on("mousemove.popup",function(){return clearTimeout()}),el.on("mouseenter.popup",function(){return clearTimeout()}),hideContainer()},300))})},adjustPopupPosition=function(){var windowHeight;return windowHeight=angular.element(window).height(),containerHeight+position.top+MARGIN_TOP>windowHeight?(position.top=windowHeight-containerHeight-MARGIN_TOP,containerEl.addClass("popup-no-arrow")):void 0},calculatePosition=function(){return position="mouse"===options.pinTo?{top:evt.clientY,left:evt.clientX}:(options.pinToSelector&&el.find(options.pinToSelector)||el).offset(),position.top+=options.offsetTop+$(window).scrollTop(),position.left+=$(window).scrollLeft(),position.left+=/-?[0-9]+%/.test(options.offsetLeft)?parseFloat(options.offsetLeft)*activeElementWidth/100:options.offsetLeft,"left"===align.horizontal&&(position.left-=containerWidth),"top"===align.vertical&&(position.top-=containerHeight),"center"===align.horizontal?position.left+=activeElementWidth/2-containerWidth/2:void 0},calculateAlign=function(){var horizontalAlign,possibleHorizontal,possibleVertical,verticalAlign,windowHeight;return windowHeight=angular.element(window).height(),possibleVertical=[],position.top+containerHeight<=windowHeight&&possibleVertical.push("bottom"),position.top-containerHeight>=0&&possibleVertical.push("top"),possibleHorizontal=[],position.left+containerWidth<=angular.element(window).width()&&possibleHorizontal.push("right"),position.left-containerWidth>=0&&possibleHorizontal.push("left"),"center"===align.horizontal&&position.left+activeElementWidth/2-containerWidth/2<=angular.element(window).width()&&possibleHorizontal.push("center"),verticalAlign=_.find(possibleVertical,function(possibleAlign){return possibleAlign===align.vertical}),horizontalAlign=_.find(possibleHorizontal,function(possibleAlign){return possibleAlign===align.horizontal}),align={vertical:verticalAlign||possibleVertical[0]||align.vertical||"bottom",horizontal:horizontalAlign||possibleHorizontal[0]||align.horizontal||"right"}},handlePopup=function(){return containerWidth=containerEl.outerWidth(),containerHeight=containerEl.outerHeight(),activeElementWidth=el.outerWidth(),calculatePosition(),calculateAlign(),calculatePosition(),adjustPopupPosition(),containerEl.addClass(align.vertical+" "+align.horizontal).css({top:position.top,left:position.left}),options.fadeOut?containerEl.css({opacity:1}):void 0},injectToDOM(),autoHide(),el.hasClass("item-preview")?(containerEl.hide(),contentEl.find("img").on("load",function(){return containerEl.show(),handlePopup()})):handlePopup())})}}})}.call(this),function(){this.app.directive("resetScroll",function(){return function(scope,el,attrs){return scope.$watch(attrs.resetScroll,function(){return $(el).scrollTop(0)},!0)}})}.call(this),function(){this.app.directive("dragHighlight",function($parse){return function(scope,element,attrs){var canUpload,dragEnterTarget,dragLeaveTarget,target;return canUpload=$parse(attrs.canUpload),target=attrs.dragHighlight?$(attr.dragHighlight):element,target=element,dragEnterTarget=null,dragLeaveTarget=null,target.on("dragenter",function(e){return e.stopPropagation(),e.preventDefault(),canUpload(scope)?(dragEnterTarget=e.target,element.hasClass("drag")?void 0:element.addClass("drag")):void 0}),target.on("drop",function(e){return element.removeClass("drag")}),target.on("dragstop",function(e){return e.stopPropagation(),e.preventDefault(),canUpload(scope)?(dragEnterTarget=null,dragLeaveTarget=null,element.removeClass("drag")):void 0}),target.on("dragleave",function(e){return e.stopPropagation(),e.preventDefault(),canUpload(scope)?(dragLeaveTarget=e.target,dragEnterTarget===dragLeaveTarget?element.removeClass("drag"):void 0):void 0})}})}.call(this),function(){this.app.directive("dropFiles",function($parse){return function(scope,element,attrs){var canUpload,dragOver,mapMultipart,upload;return upload=$parse(attrs.dropFiles),canUpload=$parse(attrs.canUpload),dragOver=function(e){return e.stopPropagation(),e.preventDefault()},mapMultipart=function(files){return _.map(files,function(file){return{file:file,name:file.name,size:file.size}})},$(element)[0].addEventListener("dragover",dragOver,!1),$(element).on("drop",function(e){var mappedFiles,ref;if(canUpload(scope)&&null!=(null!=(ref=e.originalEvent.dataTransfer)?ref.files:void 0))return e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.files.length?(mappedFiles=mapMultipart(e.originalEvent.dataTransfer.files),upload(scope,{files:mappedFiles})):void 0})}})}.call(this),function(){var hasParent,hoverClassName,lastOverElement;lastOverElement=null,hoverClassName="drop-hover",hasParent=function(element,parentElement){var parentToSearch;return parentToSearch=$(parentElement)[0],_.some($(element).parents(),function(parentEl){return parentEl===parentToSearch})},this.app.directive("droppable",function($parse){return function(scope,element,attrs){return $(document).on("drop",function(){return element.removeClass(hoverClassName)}),$(element).droppable({addClasses:!0,hoverClass:hoverClassName,greedy:!0,tolerance:"pointer",accept:function(draggableElement){return draggableElement[0]!==element[0]&&!hasParent(draggableElement,element)},over:function(){return $parse(attrs.canDropEntities)(scope)||element.removeClass(hoverClassName),lastOverElement&&lastOverElement!==element&&!element.parents("[droppable]").length&&element.removeClass(hoverClassName),lastOverElement=element,setTimeout(function(){return lastOverElement=null},10)},drop:function(event,ui){var fn;if($parse(attrs.canDropEntities)(scope)&&!hasParent(event.toElement,element)&&event.toElement!==element[0])return fn=$parse(attrs.droppable),scope.$apply(function(){return fn(scope)})}})}})}.call(this),function(){this.app.directive("fileSelect",function($parse){return function(scope,element,attrs){var bindOnChange,input,mapInput,mapMultipart,parseFileName,upload;return upload=$parse(attrs.fileSelect),input=function(){return $(element).find('input[type="file"]')},parseFileName=function(path){return _.last(path.split("\\"))},mapMultipart=function(files){return _.map(files,function(file){return{file:file,name:file.name,size:file.size}})},mapInput=function(input,form,iframe){var fileToUpload;return fileToUpload={form:form,iframe:iframe,input:input,name:parseFileName(input.val()),size:1e3},[fileToUpload]},bindOnChange=function(e){var clone,form,iframe,mappedFiles;return e.target.files?(mappedFiles=mapMultipart(e.target.files,e.target),input().replaceWith(input().clone(!0,!0))):(input=$(e.target),form=$(angular.element("<form/>")),clone=input.clone(!0,!0),iframe=$(angular.element('<iframe name="iframeTransport'+Date.now()+'"/>')),form.insertAfter(input),form.append(input).append(iframe),clone.insertBefore(form),form.addClass("form-in-progress"),mappedFiles=mapInput(input,form,iframe)),upload(scope,{files:mappedFiles})},input().on("change",bindOnChange)}})}.call(this),function(){window.containerWidth=null,this.app.directive("itemsGridResize",function($parse){return{link:function(scope,element,attr){var adjustGrid,applyAdjusment,getContainerWidth,getItemsOffset,options;return getContainerWidth=function(){return $("entities-grid").width()&&(window.containerWidth=$("entities-grid").width()),window.containerWidth},options={gridSize:$parse(attr.itemsGridResize)(scope),initialSidebarWidth:200,freeze:!0},applyAdjusment=function(offset){var sidebarOffset;return sidebarOffset=options.initialSidebarWidth+offset,$(".entities-wrapper").css({left:sidebarOffset+1}),$(".sidebar").css({width:sidebarOffset})},getItemsOffset=function(){var itemsContainerWidth;return itemsContainerWidth=Math.floor(getContainerWidth()/(options.gridSize+16))*(options.gridSize+16),getContainerWidth()-itemsContainerWidth},adjustGrid=function(){return applyAdjusment(0),options.freeze?void 0:applyAdjusment(Math.floor(getItemsOffset()/2))},scope.$watch(attr.itemsGridResize,function(gridSize){return gridSize?(options.gridSize=gridSize,options.freeze=!1):options.freeze=!0,adjustGrid()}),window.onresize=function(){return options.freeze?void 0:adjustGrid()}}}})}.call(this),function(){app.directive("deleteByKey",function(){return{link:function(scope){var canRemove,pressBackspace,pressDelete;return pressBackspace=function(keyCode){return 8===keyCode},pressDelete=function(keyCode){return 46===keyCode},canRemove=function(){return scope.selectedEntitiesCount()&&pressBackspace(event.keyCode||pressDelete(event.keyCode))},$(document).off("keydown.deleteByKey"),$(document).on("keydown.deleteByKey",function(event){return canRemove()&&"INPUT"!==event.target.tagName?(event.stopPropagation(),event.preventDefault(),scope.$remove.selected(scope.$nestedEntities)):void 0})}}})}.call(this),function(){this.app.factory("NotificationsCtrlPartial",function(events,Notifications,i18n){return function(){return this.list=Notifications.get(),this.expire=function(notification){return Notifications.expire(notification.id)},events.on(events.FOLDERS.LIST,function(promise){return promise["catch"](function(){return Notifications.send(i18n.translate("errors.get_folders_failed"))})}),events.on(events.ITEMS.LIST,function(promise){return promise["catch"](function(){return Notifications.send(i18n.translate("errors.get_items_failed"))})}),events.on(events.ITEMS.SEARCH,function(promise,event){return promise["catch"](function(error){return"bigstock"!==event.eventTarget.name||503!==error.code?Notifications.send(i18n.translate("errors.search_items_failed")):void 0})}),events.on(events.ITEMS.SEARCH_BY_TAG,function(promise){return promise["catch"](function(){return Notifications.send(i18n.translate("errors.get_items_by_tag_failed"))})}),events.on(events.FOLDER.CREATE,function(promise){return promise["catch"](function(reason){return Notifications.send(i18n.translate("errors.create_folder_failed",reason))})}),events.on(events.FOLDER.RENAME,function(promise){return promise["catch"](function(reason){return Notifications.send(i18n.translate("errors.rename_folder_failed",reason))})}),events.on(events.FOLDERS.REMOVE,function(promises){return _.forEach(promises,function(promise){return promise["catch"](function(reason){return Notifications.send(i18n.translate("errors.remove_folder_failed"))})})}),events.on(events.ITEM.RENAME,function(promise){return promise["catch"](function(reason){return Notifications.send(i18n.translate("errors.rename_item_failed",reason))})}),events.on(events.ITEMS.REMOVE,function(promises){return _.forEach(promises,function(promise){return promise["catch"](function(reason){return Notifications.send(i18n.translate("errors.remove_item_failed"))})})}),events.on(events.ITEM.MOVE,function(promise){return promise["catch"](function(reason){return Notifications.send(i18n.translate("errors.move_item_failed",reason))})}),events.on(events.ITEM.MAKE_FAVORITES,function(promise){return promise["catch"](function(reason){return Notifications.send(i18n.translate("errors.make_item_favorites_failed",reason))})}),this}})}.call(this),function(){this.app.directive("fileSize",function($parse){return function(scope,el,attr){return console.log($parse(attr.fileSize)(scope))}}),this.app.factory("UploadCtrlPartial",function($state,$rootScope,settings,i18n,getFileSizeLimit,editorConnection,$timeout,confirm,biReport){return _.memoize(function(adapter){var fileSizes,getCancelledFiles,getFailedFiles,getSucceededFiles,isFirstOpen,minimizationTimeout,redirectToPrivate,safeApply,updateProgress;return this.popupIsVisible=!1,this.totalProgressPercent=0,this.queue=[],this.getFilesQueue=function(_this){return function(){return _.filter(_this.queue,function(data){return data.source.file&&data.source.mediaType===settings.mediaType})}}(this),this.getFileSizeLimit=function(){return Math.floor(getFileSizeLimit(settings.mediaType)/1048576)},this.isFolder=function(fileToUpload){var ref,ref1,ref2,ref3;return""===(null!=(ref=fileToUpload.source)&&null!=(ref1=ref.file)?ref1.type:void 0)&&(null!=(ref2=fileToUpload.source)&&null!=(ref3=ref2.file)?ref3.size:void 0)<1e4},this.translateError=function(fileToUpload){var error,errorCode,key,message,ref,ref1,ref2;return this.isFolder(fileToUpload)?i18n.translate("uploader.upload_folder_error"):fileToUpload.error instanceof Promise.CancellationError?i18n.translate("error.upload.cancelled"):(error=fileToUpload.error||{},key="uploader."+(null!=(ref=error.data)&&null!=(ref1=ref.error_info)?ref1.key:void 0),i18n.isTranslatable(key)?i18n.translate(key,error.data.error_info.args||[]):(message="uploader.failed",errorCode=error.code||error.status,_.contains([500,406],+errorCode)&&null!=(null!=(ref2=error.data)?ref2.error_description:void 0)?i18n.translate("uploader.request_fail",[error.data.error_description.replace(/for .*$/i,"")]):(key="error.upload."+errorCode,i18n.isTranslatable(key)&&(message=key),i18n.translate(message))))},this.isMinimization=!1,minimizationTimeout=null,this.showPopup=function(_this){return function(){return _this.popupIsVisible=!0,minimizationTimeout&&$timeout.cancel(minimizationTimeout),_this.isMinimization=!1}}(this),this.hidePopup=function(_this){return function(){_this.isMinimization=!0,minimizationTimeout&&$timeout.cancel(minimizationTimeout),minimizationTimeout=$timeout(function(){return _this.isMinimization=!1,$rootScope.$apply()},550),_this.popupIsVisible=!1}}(this),getSucceededFiles=function(_this){return function(){return _.filter(_this.getFilesQueue(),function(fileToUpload){return"succeeded"===fileToUpload.status})}}(this),getFailedFiles=function(_this){return function(){return _.filter(_this.getFilesQueue(),function(fileToUpload){return"failed"===fileToUpload.status})}}(this),getCancelledFiles=function(_this){return function(){return _.filter(_this.getFilesQueue(),_this.isCancelled)}}(this),this.allFilesCount=function(){return this.getFilesQueue().length},this.succeededFilesCount=function(){return getSucceededFiles().length},this.failedFilesCount=function(){return getFailedFiles().length},this.cancelledFilesCount=function(){return getCancelledFiles().length},this.hasInProgress=function(){return!!_.find(this.getFilesQueue(),function(_this){return function(fileToUpload){return _this.isInProgress(fileToUpload)}}(this))},this.hasFailedFiles=function(){return!!_.find(this.getFilesQueue(),function(fileToUpload){return"failed"===fileToUpload.status})},this.hasAbortable=function(){return!!_.find(this.getFilesQueue(),function(fileToUpload){return fileToUpload.canAbort()})},this.hasRetryable=function(){return!!_.find(this.getFilesQueue(),function(_this){return function(fileToUpload){return fileToUpload.canRetry()&&!_this.isFolder(fileToUpload)}}(this))},this.isInProgress=function(fileToUpload){return _.contains(["waiting","uploading","processing"],fileToUpload.status)},this.isWaiting=function(fileToUpload){return"waiting"===(null!=fileToUpload?fileToUpload.status:void 0)},this.isCancelled=function(fileToUpload){return"failed"===fileToUpload.status&&fileToUpload.error instanceof Promise.CancellationError},this.canCancelUpload=function(fileToUpload){return this.isInProgress(fileToUpload)||this.isWaiting(fileToUpload)},safeApply=_.debounce(function(){return $rootScope.$$phase?void 0:$rootScope.$apply()},50),redirectToPrivate=function(){return"app.private"!==$state.current.name?$state.go("app.private"):void 0},isFirstOpen=!0,editorConnection.on("settings",function(){return isFirstOpen=!0}),this.addFiles=function(_this){return function(files,folder){var defaultFolder;return redirectToPrivate(),_this.showPopup(),isFirstOpen=!1,defaultFolder={id:null,name:i18n.translate("private_media.all_media")},folder&&folder.can.uploadIn()||(folder=defaultFolder),wixmp.Uploader.upload(_.map(files,function(file){var base,base1,data;return data={uploadFn:adapter.item.upload,source:_.assign(file,{folderId:folder.id,folderName:folder.name,mediaType:settings.mediaType})},"video"!==settings.mediaType&&"secure_video"!==settings.mediaType||""===settings.videoEncodingProfile||((base=data.source).encodingOptions||(base.encodingOptions={}),data.source.encodingOptions.profile_name=settings.videoEncodingProfile),settings.useFastTranscoding&&((base1=data.source).encodingOptions||(base1.encodingOptions={}),data.source.encodingOptions.fast_transcode=!0),data})),safeApply()}}(this),this.confirmAbortAll=function(){var options;return options={queue:this.getFilesQueue(),confirmTitle:i18n.translate("uploader.cancel_all_confirmation.title"),confirmMessage:i18n.translate("uploader.cancel_all_confirmation.message"),confirmYes:i18n.translate("uploader.cancel_all_confirmation.yes"),confirmNo:i18n.translate("uploader.cancel_all_confirmation.no"),confirm:function(){return _.forEach(options.queue,function(fileToUpload){return fileToUpload.abort()})}},confirm(options),!1},this.retryAll=function(){return _.forEach(this.getFilesQueue(),function(fileToUpload){return fileToUpload.canRetry()?fileToUpload.signUpForRetry():void 0})},fileSizes=["bytes","kilobytes","megabytes","gigabytes","terabytes"],this.getReadableFileSize=function(fileSize){var i,il;for(i=0,il=fileSizes.length;il>i&&(fileSize/=1024,i++,!(1>fileSize/1024)););return fileSize.toFixed(0)+i18n.translate("uploader."+fileSizes[i])},updateProgress=function(_this){return function(){var bytesTotal,bytesTotalLoaded,files;return files=_this.getFilesQueue(),bytesTotalLoaded=_.sum(_.map(files,function(fileToUpload){return fileToUpload.bytesLoaded})),bytesTotal=_.sum(_.map(files,function(fileToUpload){return fileToUpload.source.file.size})),_this.totalProgressPercent=Math.round(100*bytesTotalLoaded/bytesTotal)}}(this),wixmp.Uploader.on("fileStatusChanged",function(){return updateProgress(),safeApply()}),wixmp.Uploader.on("queueChange",function(_this){return function(queue){return _this.queue=queue,updateProgress()}}(this)),this})})}.call(this),function(){this.app.factory("HelpCtrlPartial",function($sce,i18n){return function(){return this.popupIsVisible=!1,this.showPopup=function(){return this.popupIsVisible=!0},this.hidePopup=function(){return this.popupIsVisible=!1},this.url=$sce.trustAsResourceUrl(i18n.translate("help_url")),this}})}.call(this),function(){this.app.factory("RemoveCtrlPartial",function(confirm,i18n,Folder){return function($scope){return this.selected=function(entities){var entitiesCount,options;return(entitiesCount=$scope.selectedEntitiesCount())?(options={confirmYes:i18n.translate("private_media.remove_confirmation.yes"),confirmNo:i18n.translate("private_media.remove_confirmation.no"),confirm:function(){return entities.removeSelected()}},entitiesCount>1?(options.confirmTitle=i18n.translate("private_media.remove_confirmation.items.title"),options.confirmMessage=i18n.translate("private_media.remove_confirmation.items.message")):(options.confirmTitle=i18n.translate("private_media.remove_confirmation.item.title"),options.confirmMessage=i18n.translate("private_media.remove_confirmation.item.message")),confirm(options),!1):void 0},this.one=function(entity){var options;return options={confirmYes:i18n.translate("private_media.remove_confirmation.yes"),confirmNo:i18n.translate("private_media.remove_confirmation.no"),confirm:function(){return entity.remove()}},entity instanceof Folder?(options.confirmTitle=i18n.translate("private_media.remove_confirmation.folder.title"),options.confirmMessage=i18n.translate("private_media.remove_confirmation.folder.message")):(options.confirmTitle=i18n.translate("private_media.remove_confirmation.item.title"),options.confirmMessage=i18n.translate("private_media.remove_confirmation.item.message")),confirm(options),!1},this.folder=function(folder){return confirm({confirmTitle:i18n.translate("private_media.remove_confirmation.folder.title"),confirmMessage:i18n.translate("private_media.remove_confirmation.folder.message"),confirmYes:i18n.translate("private_media.remove_confirmation.yes"),confirmNo:i18n.translate("private_media.remove_confirmation.no"),confirm:function(){return folder.remove()}}),!1},this}})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app",{url:"",templateUrl:"scripts/pages/app.html",controller:"appCtrl",resolve:{settings:function(Settings){return Settings.isLoaded},locales:function(LoadLocales,settings){return LoadLocales(settings).then(function(res){return _this.appLoadNotifiers.translationsLoaded(),res})}}})}}(this)),this.app.controller("appCtrl",function($q,$scope,$state,events,settings,editorConnection,submitItems,tabs,SelectedEntities,Notifications,i18n,NotificationsCtrlPartial,FilterCtrlPartial,UploadCtrlPartial,HelpCtrlPartial,RemoveCtrlPartial){var lookupScope;return $scope.settings=settings,$scope.tabs=tabs,$scope.selectedEntitiesCount=function(){return SelectedEntities.size},$scope.isActiveTab=function(tab){return $state.includes(tab.state)},$scope.closeWindow=function(){return editorConnection.emit("close")},$(document).on("keyup",function(e){return 27===e.keyCode?$scope.closeWindow():void 0}),$scope.$searchQuery={query:"",currentQuery:""},$scope.$layouts=new FilterCtrlPartial("layout-grid",[{id:"layout-grid",name:"grid",itemWidth:126},{id:"layout-grid-large",name:"large grid",itemWidth:220},{id:"layout-list",name:"list",itemWidth:null}]),$scope.$notifications=new NotificationsCtrlPartial,tabs["private"].canShow()&&($scope.$upload=new UploadCtrlPartial(tabs["private"].getAdapter())),$scope.$help=new HelpCtrlPartial,$scope.$remove=new RemoveCtrlPartial($scope),$scope.canSubmitItems=function(){return SelectedEntities.size>1&&"single"===settings.selectionType?!1:_.any(SelectedEntities.get(),function(item){var base;return!("function"==typeof(base=item.can).submit?base.submit():void 0)})?!1:SelectedEntities.size>0},$scope.submitItemsTooltip=function(){return $scope.canSubmitItems()?"":"single"===settings.selectionType?i18n.translate("selected_items.tooltip_error_empty"):i18n.translate("selected_items.tooltip_error_multiple")},$scope.descriptionTranslationKey="private_media.upload_restrictions_header_message",$scope.footerSubmitTranslationKey="footer.submit",lookupScope=function(scope,attrName){return null!=scope?scope[attrName]?scope[attrName]:lookupScope(scope.$parent,attrName):void 0},$scope.selectAndSubmitItem=function(item){var base;if(item.can.submit())return SelectedEntities.clear(),SelectedEntities.add(item),"function"==typeof(base=lookupScope(this,"submitItems"))?base():void 0},$scope.submitItems=function(){return $scope.canSubmitItems()?submitItems(_.filter(SelectedEntities.get(),function(item){return item.can.submit()})):void 0},$scope.$on("$stateChangeSuccess",function(){return SelectedEntities.clear()})})}.call(this),function(){"use strict";this.app.config(function($stateProvider){return $stateProvider.state("init",{url:"/init/{settings:.*}",controller:"initCtrl"})}),this.app.controller("initCtrl",function($scope,$stateParams,$state,Settings){var logger;return logger=new Logger("initCtrl"),logger.log("settings received",$stateParams.settings),Settings.reload(JSON.parse(decodeURIComponent($stateParams.settings)))})}.call(this),function(){"use strict";this.app.factory("favoritable",function(SelectedEntities){return function(controller,adapter,getParentFolder){var _events,makeFavoritesCount;return _events=adapter.events,makeFavoritesCount=0,_events.on(_events.ITEM.MAKE_FAVORITES,function(_this){return function(promise){return makeFavoritesCount++,promise.then(function(){return makeFavoritesCount--,makeFavoritesCount||"favorites"!==("function"==typeof getParentFolder?getParentFolder().type:void 0)?void 0:controller.load()})}}(this)),_events.on(_events.ITEM.UMMAKE_FAVORITES,function(_this){return function(promise){return promise.then(function(res){return"favorites"===("function"==typeof getParentFolder?getParentFolder().type:void 0)?(_.remove(controller.list,function(entity){var ref;return entity.id===(null!=(ref=res.data)?ref.id:void 0)}),SelectedEntities.clear()):void 0})}}(this))}})}.call(this),function(){"use strict";this.app.factory("folderCreatable",function(ActionCtrlPartial,Notifications,i18n){
return function(controller,adapter,getParentFolder){return controller.$createFolder=new ActionCtrlPartial(function(name){var ref;return 0===$.trim(name).length?Notifications.send(i18n.translate("errors.create_folder_failed.empty_name")):$.trim(name).length>256?Notifications.send(i18n.translate("errors.create_folder_failed.long_name")):adapter.folder.create(name,{parentId:"function"==typeof getParentFolder&&null!=(ref=getParentFolder())?ref.id:void 0})}),controller.$createFolder.show=_.flow(controller.$createFolder.show,function(_this){return function(){return controller.$createFolder.newName=""}}(this)),adapter.events.on(adapter.events.FOLDER.CREATE,function(_this){return function(promise){return promise.then(function(res){var parentId,ref,ref1,unsorted;if(!_.includes(["unsorted","allMedia","favorites","purchased"],"function"==typeof getParentFolder&&null!=(ref=getParentFolder())?ref.type:void 0))return parentId="function"==typeof getParentFolder&&null!=(ref1=getParentFolder())?ref1.id:void 0,parentId||(unsorted=_.find(controller.list,function(folder){return"unsorted"===folder.type}),parentId=null!=unsorted?unsorted.id:void 0),res.data.parentId!==parentId&&parentId?void 0:controller.list.unshift(res.data)})}}(this))}})}.call(this),function(){"use strict";this.app.factory("movable",function(SelectedEntities,Folder){return function(controller,adapter,getParentFolder){var _events,affectedFoldersIds,movingCount;return controller.moveSelectedToFolder=function(folder){return SelectedEntities.forEach(function(entity){var base;return("function"==typeof(base=entity.can).move?base.move():void 0)?entity instanceof Folder?folder.moveFolderIn(entity):folder.moveItemIn(entity):void 0}),SelectedEntities.clear()},movingCount=0,affectedFoldersIds=[],_events=adapter.events,_events.on([_events.ITEM.MOVE,_events.FOLDER.MOVE],function(_this){return function(promise,event){return affectedFoldersIds.push(event.arguments[0].parentId||event.arguments[0].folderId),affectedFoldersIds.push(event.arguments[1].parentId||event.arguments[1].folderId),movingCount++,promise.then(function(){var ref,unsorted;return movingCount--,movingCount?void 0:(unsorted=_.find(controller.list,function(folder){return"unsorted"===(null!=folder?folder.type:void 0)}),_.includes(affectedFoldersIds,("function"==typeof getParentFolder&&null!=(ref=getParentFolder())?ref.id:void 0)||(null!=unsorted?unsorted.id:void 0))&&controller.reload(),affectedFoldersIds.length=0)})}}(this))}})}.call(this),function(){"use strict";this.app.factory("removable",function(SelectedEntities,Folder,Item){return function(controller,adapter,getParentFolder){var _events;return controller.removeSelected=function(_this){return function(){var folders,foldersIds,items,itemsIds,ref;if(items=_.filter(SelectedEntities.get(),function(entity){return entity instanceof Item}),folders=_.filter(SelectedEntities.get(),function(entity){return entity instanceof Folder}),itemsIds=_.pluck(items,"id"),foldersIds=_.pluck(folders,"id"),"trash"===("function"==typeof getParentFolder&&null!=(ref=getParentFolder())?ref.type:void 0)){if(items.length&&adapter.items.trash.remove(itemsIds),folders.length)return adapter.folders.trash.remove(foldersIds)}else if(items.length&&adapter.items.remove(itemsIds),folders.length)return adapter.folders.remove(foldersIds)}}(this),_events=adapter.events,_events.on([_events.ITEMS.REMOVE,_events.ITEMS.TRASH.REMOVE,_events.ITEMS.TRASH.RESTORE,_events.FOLDERS.REMOVE,_events.FOLDERS.TRASH.REMOVE,_events.FOLDERS.TRASH.RESTORE],function(_this){return function(promises){return _.forEach(promises,function(promise){return promise.then(function(res){var ref;return _.remove(controller.list,function(entity){return entity.id===res.data.id}),SelectedEntities.clear(),(null!=(ref=controller.selectedFolder)?ref.id:void 0)===res.data.id&&"function"==typeof controller.selectFolder?controller.selectFolder(controller.list[0]):void 0})})}}(this))}})}.call(this),function(){"use strict";this.app.factory("renamable",function(ActionCtrlPartial,Notifications,Folder,i18n){return function(controller,adapter){return controller.$rename=new ActionCtrlPartial(function(entity,newName){var entityType;return entityType=entity instanceof Folder?"folder":"item",0===$.trim(newName).length?Notifications.send(i18n.translate("errors.rename_"+entityType+"_failed.empty_name")):$.trim(newName).length>256?Notifications.send(i18n.translate("errors.rename_"+entityType+"_failed.long_name")):entity.rename(newName)}),controller.$rename.show=_.flow(controller.$rename.show,function(entity){return controller.$rename.newName=entity.name})}})}.call(this),function(){"use strict";this.app.factory("transcodable",function(){return function(controller,adapter){var _events,transcodeItems,waitForTranscoding;return waitForTranscoding=function(){var ref;return null!=(ref=adapter.channel)?ref.open():void 0},transcodeItems=function(_this){return function(){var needTranscoding;return needTranscoding=_.filter(controller.list,function(entity){var base;return("function"==typeof(base=entity.can).transcode?base.transcode():void 0)&&!entity.isTranscoded()}),needTranscoding.length>0?waitForTranscoding():void 0}}(this),_events=adapter.events,_events.on([_events.ITEMS.LIST,_events.ITEMS.SEARCH,_events.ITEMS.TRASH.LIST],function(_this){return function(promise){return promise.then(transcodeItems)}}(this)),wixmp.Uploader.on("uploadQueueStarted",function(_this){return function(){return adapter.can.item.transcode()?waitForTranscoding():void 0}}(this))}})}.call(this),function(){"use strict";this.app.factory("updatable",function(){return function(controller,adapter){var _events;return _events=adapter.events,_events.on([_events.ITEM.UPDATE,_events.FOLDER.UPDATE],function(_this){return function(promise){return promise.then(function(res){var dataForUpdate,updatedEntity;return updatedEntity=_.find(controller.list,function(entity){return entity.id===res.data.id}),updatedEntity?(dataForUpdate={},_.each(res.data,function(val,key){return null!=val&&"id"!==key?dataForUpdate[key]=val:void 0}),_.assign(updatedEntity,dataForUpdate)):void 0})}}(this))}})}.call(this),function(){this.app.factory("ActionCtrlPartial",function($q,LoadingHelper,RejectError){return function(runAction){var currentEntity,currentProcessing,loader;return currentProcessing=void 0,currentEntity=void 0,loader=new LoadingHelper(this),this.isProcessing=function(entity){return currentProcessing===entity},this.isVisible=function(entity){return currentEntity===entity},this.hide=function(){return currentEntity=void 0},this.show=function(entity){return currentEntity=entity},this.runOrHide=function(entity,newName){var args;return args=_.filter(_.map(arguments)),newName?this.run.apply(this,args):this.hide.apply(this,args)},this.run=function(){return null==currentEntity?$q.reject(new RejectError(RejectError.noActionSubject,"ActionCtrl")):null!=currentProcessing?$q.reject(new RejectError(RejectError.alreadyLoading,"ActionCtrl")):loader.isDeniedByInterval()?$q.reject(new RejectError(RejectError.tooShortCallInterval,"ActionCtrl")):loader.attach($q.when(runAction.apply(this,arguments)).then(function(){return currentEntity=void 0,currentProcessing=void 0},function(){return currentProcessing=void 0}))},this}})}.call(this),function(){this.app.factory("EntitiesCtrlPartial",function(SelectedEntities,$q,LoadingHelper,RejectError,biUiEvents,editorConnection,Folder,Item){return function(adapter,$searchQuery,getParentFolder,loadEntities,searchEntities){var addEntitiesToScope,loadList,loadOrSearch,loader,oldParentFolder,search;return this.list=null,this.selectedFolder=null,this.isLoading=!1,loader=new LoadingHelper(this),oldParentFolder=null,addEntitiesToScope=function(_this){return function(list){return oldParentFolder===("function"==typeof getParentFolder?getParentFolder():void 0)?(_this.list||(_this.list=[]),_.forEach(list.data,function(entity){return _.findWhere(_this.list,{id:entity.id})?void 0:_this.list.push(entity)}),list):void 0}}(this),loadList=function(_this){return function(isFirstPage){var promise;return null==isFirstPage&&(isFirstPage=!0),null==loadEntities?$q.reject(new RejectError(RejectError.noMethod,"EntitiesCtrl.loadEntities")):(promise=$q.when(loadEntities(isFirstPage)),loader.attach(promise.then(addEntitiesToScope,function(){return _this.list||(_this.list=[])})))}}(this),search=function(_this){return function(isFirstPage){var promise;return null==isFirstPage&&(isFirstPage=!0),null==searchEntities?$q.reject(new RejectError(RejectError.noMethod,"EntitiesCtrl.searchEntities")):(promise=$q.when(searchEntities($searchQuery.query,isFirstPage)),loader.attach(promise.then(function(list){return addEntitiesToScope(list),biUiEvents("search.performed",{found:list.data.length,query:$searchQuery.query})},function(){return _this.list||(_this.list=[])})))}}(this),loadOrSearch=function(_this){return function(isFirstPage,isReload){var promise;return null==isFirstPage&&(isFirstPage=!0),null==isReload&&(isReload=!1),_this.isLoading?$q.reject(new RejectError(RejectError.alreadyLoading,"EntitiesCtrl")):loader.isDeniedByInterval()&&oldParentFolder===("function"==typeof getParentFolder?getParentFolder():void 0)?$q.reject(new RejectError(RejectError.tooShortCallInterval,"EntitiesCtrl")):(oldParentFolder="function"==typeof getParentFolder?getParentFolder():void 0,isFirstPage&&(SelectedEntities.clear(),_this.list=null,isReload||(_this.selectedFolder=null)),promise=$searchQuery.query&&searchEntities?search(isFirstPage):loadList(isFirstPage),isReload&&promise.then(function(data){return _this.selectedFolder?(_this.selectedFolder=_.find(_this.list,function(entity){return _this.selectedFolder.id===entity.id}),data):data}),promise)}}(this),this.nameById=function(_this){return function(id){var item;return item=_.find(_this.list,function(item){return item.id===id}),null!=item?item.name:void 0}}(this),this.load=function(_this){return function(){return loadOrSearch(!0)}}(this),this.more=function(_this){return function(){return loadOrSearch(!1)}}(this),this.reload=function(_this){return function(){return loadOrSearch(!0,!0)}}(this),this.selectFolder=function(_this){return function(folder){return $searchQuery.currentQuery||($searchQuery.query=""),_this.selectedFolder=folder}}(this),this.isFolder=function(_this){return function(entity){return entity instanceof Folder}}(this),editorConnection.on("reloadItems",this.load),this}})}.call(this),function(){this.app.factory("FilterCtrlPartial",function(){return function(defaultId,list){var defaultEntity;return this.selected=null,this.list=list,this.select=function(_this){return function(entity){return _this.selected=entity}}(this),defaultEntity=_.find(this.list,function(entity){return defaultId===entity.id}),this.select(defaultEntity||null),this}})}.call(this),function(){"use strict";this.app.factory("baseCtrl",function(settings,i18n,editorConnection,EntitiesCtrlPartial,FilterCtrlPartial,path,$q,Folder,paginatedItemsListLoader,paginatedItemsSearchLoader){return function($scope,adapter){var getDefaultFolder,getDefaultNestedFolder,getSortOptions,initializationPath,isChildFolderSelectedAtPath,isPathWasSet,loadEntities,loadFolders,loadItems,loadNestedFolders,makeFoldersFirst,searchItems,sortNestedFolders,updatePath;return $scope.adapter=adapter,initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath;return currentPath=[],_.forEach($scope.selectedFoldersPath,function(folder){return(null!=folder?folder.id:void 0)||(null!=folder?folder.virtualId:void 0)?(currentPath.push(folder.id||folder.virtualId),!0):!1}),path.set(currentPath)},$scope.selectedFoldersPath=[],isChildFolderSelectedAtPath=function(){return!!initializationPath[$scope.selectedFoldersPath.length]},getDefaultFolder=function(){var folderId;return folderId=initializationPath[0],folderId?_.find($scope.$folders.list,function(folder){return folder.id===folderId||null!=folder.virtualId&&folder.virtualId===folderId}):void 0},loadFolders=function(){return adapter.folders.list()["catch"](function(reason){return 401===reason.code?editorConnection.emit("notauthorized"):void 0})},$scope.$folders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,loadFolders),$scope.$folders.sortOrder=function(folder){return folder.isRoot?"0"+folder.name:"1"+folder.name},$scope.$folders.load=_.flow($scope.$folders.load,function(promise){return promise.then(function(res){var defaultFolder;return defaultFolder=isPathWasSet?$scope.$folders.list[0]:getDefaultFolder()||$scope.$folders.list[0],$scope.$folders.selectFolder(defaultFolder),res})}),$scope.$folders.selectFolder=_.flow($scope.$folders.selectFolder,function(){return $scope.selectedFoldersPath=[$scope.$folders.selectedFolder],updatePath(),$scope.$nestedEntities.load()}),$scope.selectFolderOrNested=function(folder){var isNested,position;return position=$scope.selectedFoldersPath.indexOf(folder),isNested=position>=1,$scope.selectedFoldersPath.length=position,isNested?$scope.$nestedEntities.selectFolder(folder):$scope.$folders.selectFolder(folder)},$scope.getSelectedFolder=function(){return _.last($scope.selectedFoldersPath)},getDefaultNestedFolder=function(){var folderId;return folderId=initializationPath[$scope.selectedFoldersPath.length],folderId?_.find($scope.$nestedEntities.list,function(folder){return folder.id===folderId||null!=folder.virtualId&&folder.virtualId===folderId}):void 0},sortNestedFolders=function(list){var sortOrder;return sortOrder=$scope.$nestedEntities.sortOrder.selected.data,list.data=_.sortBy(list.data,sortOrder.attrName),"desc"===sortOrder.direction&&list.data.reverse(),list},makeFoldersFirst=function(list){return list.data=_.sortBy(list.data,function(entity){return entity instanceof Folder?0:1}),list},getSortOptions=function(){return{sort:$scope.$nestedEntities.sortOrder.selected.data}},loadItems=paginatedItemsListLoader(adapter,$scope.getSelectedFolder,getSortOptions),searchItems=paginatedItemsSearchLoader(adapter,$scope.getSelectedFolder,getSortOptions),loadNestedFolders=function(){var ref;return null!=(ref=$scope.getSelectedFolder())?ref.foldersList().then(function(list){return!isPathWasSet&&getDefaultNestedFolder()&&$scope.$nestedEntities.selectFolder(getDefaultNestedFolder()),sortNestedFolders(list)}):void 0},loadEntities=function(isFirstPage){var deferred,list,promises,unresolvedCount;return promises=[],settings.hasSubfolders&&isFirstPage&&!_.includes(["unsorted","allMedia","favorites","purchased"],"function"==typeof $scope.getSelectedFolder?$scope.getSelectedFolder().type:void 0)&&promises.push(loadNestedFolders()),isChildFolderSelectedAtPath()||promises.push(loadItems(isFirstPage)),list={data:[]},deferred=$q.defer(),unresolvedCount=0,_.forEach(promises,function(promise){return unresolvedCount++,promise.then(function(currentList){return list.data=list.data.concat(currentList.data),currentList})["finally"](function(){return unresolvedCount--,unresolvedCount?void 0:deferred.resolve(makeFoldersFirst(list))})}),deferred.promise},$scope.$nestedEntities=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,$scope.getSelectedFolder,loadEntities,searchItems),$scope.$nestedEntities.selectFolder=_.flow($scope.$nestedEntities.selectFolder,function(folder){return $scope.selectedFoldersPath.push(folder),updatePath(),$scope.$nestedEntities.load()}),$scope.$nestedEntities.sortOrder=new FilterCtrlPartial("date_desc",[{id:"name_asc",name:i18n.translate("sort_order.name_asc"),data:{order:"name",attrName:"name",direction:"asc"}},{id:"name_desc",name:i18n.translate("sort_order.name_desc"),data:{order:"name",attrName:"name",direction:"desc"}},{id:"date_desc",name:i18n.translate("sort_order.date_desc"),data:{order:"date",attrName:"createdAt",direction:"desc"}},{id:"date_asc",name:i18n.translate("sort_order.date_asc"),data:{order:"date",attrName:"createdAt",direction:"asc"}}]),$scope.$nestedEntities.load=_.flow($scope.$nestedEntities.load,function(promise){return promise["catch"](function(reason){return 401===reason.code?editorConnection.emit("notauthorized"):void 0})}),$scope.$nestedEntities.sortOrder.select=_.flow($scope.$nestedEntities.sortOrder.select,function(){return $scope.$nestedEntities.load()}),function(){return $scope.$folders.load().then(function(){return isPathWasSet=!0})}}})}.call(this),function(){"use strict";this.app.config(function($stateProvider){return $stateProvider.state("app.empty",{url:"/empty",templateUrl:"scripts/pages/empty/empty.html",controller:"emptyCtrl"})}),this.app.controller("emptyCtrl",function(_this){return function(){return _this.appLoadNotifiers.emptyStateLoaded()}}(this))}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.private",{url:"/private",templateUrl:"scripts/pages/_base/base.html",controller:"privateCtrl",resolve:{notify:function(){return _this.appLoadNotifiers.tabSelected()},adapter:function(tabs){return tabs["private"].getAdapter()}}})}}(this)),this.app.controller("privateCtrl",function($scope,adapter,$state,SelectedEntities,settings,editorConnection,path,$q,Folder,Item,baseCtrl,updatable,transcodable,renamable,removable,movable,folderCreatable,favoritable,biMeasureImageLoadSpeed){var affectedWithUploadFoldersIds,canRefreshAfterUpload,clearSearchQuery,foldersNames,init,isSearch,isSomeFileUploaded,noFilesRemain;return init=baseCtrl($scope,adapter),$scope.measureImagesLoadSpeed=biMeasureImageLoadSpeed,foldersNames={},$scope.getFolderNameById=function(id){return foldersNames[id]},updatable($scope.$folders,adapter),renamable($scope.$folders,adapter),removable($scope.$folders,adapter,null),movable($scope.$folders,adapter,null),folderCreatable($scope.$folders,adapter,null),$scope.$folders.sortOrder=function(folder){return"allMedia"===folder.type?"0":"trash"===folder.type?"2":folder.isRoot?"1"+folder.name:"3"+folder.name},$scope.getAllFolder=function(){return _.findWhere($scope.$folders.list,{type:"allMedia"})},$scope.getUnsorted=function(){return _.find($scope.$folders.list,function(folder){return"unsorted"===folder.type})},updatable($scope.$nestedEntities,adapter),transcodable($scope.$nestedEntities,adapter),renamable($scope.$nestedEntities,adapter),removable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),movable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),folderCreatable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),favoritable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),canRefreshAfterUpload=function(){var ref,ref1;return(null!=(ref=$scope.getSelectedFolder())?ref.id:void 0)||"allMedia"===(null!=(ref1=$scope.getSelectedFolder())?ref1.type:void 0)},adapter.events.on(adapter.events.FOLDERS.LIST,function(promise){return promise.then(function(res){return _.forEach(res.data,function(folder){return foldersNames[folder.id]=folder.name})})}),adapter.events.on([adapter.events.FOLDER.UPDATE,adapter.events.FOLDER.CREATE],function(promise){return promise.then(function(res){return foldersNames[res.data.id]=res.data.name})}),isSomeFileUploaded=function(){return _.some($scope.$upload.queue,function(fileToUpload){return"succeeded"===fileToUpload.status})},noFilesRemain=function(){return _.all($scope.$upload.queue,function(fileToUpload){return"processing"!==fileToUpload.status&&"waiting"!==fileToUpload.status})},isSearch=function(){return!!$scope.$searchQuery.query},clearSearchQuery=function(){return $scope.$searchQuery.query="",$scope.$searchQuery.currentQuery=""},affectedWithUploadFoldersIds=[],wixmp.Uploader.on("uploadQueueFinished",function(){var ref,ref1;if(canRefreshAfterUpload()&&isSomeFileUploaded()&&(_.contains(affectedWithUploadFoldersIds,null!=(ref=$scope.getSelectedFolder())?ref.id:void 0)||"allMedia"===(null!=(ref1=$scope.getSelectedFolder())?ref1.type:void 0)))return isSearch()&&clearSearchQuery(),$scope.$nestedEntities.load().then(function(){return SelectedEntities.clear(),SelectedEntities.add(_.find($scope.$nestedEntities.list,function(entity){return entity instanceof Item}))})}),wixmp.Uploader.on("fileStatusChanged",function(_this){return function(progress){var item,itemData,ref,ref1;if("succeeded"===progress.currentFileProgress.status){if(itemData=$scope.$upload.queue[progress.currentFileQueueIdx].serverResponse.data,itemData.mediaType!==settings.mediaType)return;if(_.contains(affectedWithUploadFoldersIds,itemData.folderId)||affectedWithUploadFoldersIds.push(itemData.folderId),noFilesRemain())return;if(!canRefreshAfterUpload())return;if(item=new Item(adapter,itemData),isSearch())return clearSearchQuery(),$scope.$nestedEntities.load();if(item.folderId===(null!=(ref=$scope.getSelectedFolder())?ref.id:void 0)||"allMedia"===(null!=(ref1=$scope.getSelectedFolder())?ref1.type:void 0))return $scope.$nestedEntities.list.unshift(item)}}}(this)),wixmp.Uploader.on("uploadQueueStarted",function(){return _.contains(["video","secure_video"],settings.mediaType)?$scope.$upload.showPopup():void 0}),adapter.events.on(adapter.events.FOLDERS.TRASH.RESTORE,function(_this){return function(promises){return $q.all(promises)["finally"](function(){return $scope.$folders.reload()})}}(this)),adapter.events.on(adapter.events.FOLDERS.REMOVE,function(_this){return function(promises){return $q.all(promises)["finally"](function(){return 1===$scope.selectedFoldersPath.length&&"trash"===$scope.selectedFoldersPath[0].type?$scope.$nestedEntities.load():void 0})}}(this)),init()})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.public",{url:"/public",templateUrl:"scripts/pages/public/public.html",controller:"publicMediaCtrl",resolve:{notify:function(){return _this.appLoadNotifiers.tabSelected()},adapter:function(tabs){return tabs["public"].getAdapter()}}})}}(this)),this.app.controller("publicMediaCtrl",function($scope,adapter,$state,settings,path,EntitiesCtrlPartial,paginatedItemsListLoader,paginatedItemsSearchLoader,publicAllCategoriesIds){var getDefaultFolder,getDefaultParentFolder,getSelectedFolder,getSelectedParentFolder,initializationPath,isPathWasSet,loadFolders,loadItems,loadParentFolders,searchItems,updatePath;return $scope.adapter=adapter,initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath,ref,ref1;return currentPath=[],(null!=(ref=$scope.$parentFolders.selectedFolder)?ref.id:void 0)&&(currentPath.push($scope.$parentFolders.selectedFolder.id.split(":")[0]),(null!=(ref1=$scope.$folders.selectedFolder)?ref1.id:void 0)&&currentPath.push($scope.$folders.selectedFolder.id.split(":")[0])),path.set(currentPath)},getDefaultParentFolder=function(){var folderId,res;return folderId=initializationPath[0],folderId?(res=$scope.$parentFolders.list.filter(function(f){return f.id.split(":")[0]===folderId}),res[0]):void 0},loadParentFolders=function(){return adapter.folders.list(settings.publicMediaRoot)},$scope.$parentFolders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,loadParentFolders),$scope.$parentFolders.load=_.flow($scope.$parentFolders.load,function(promise){return promise.then(function(){return isPathWasSet?$scope.$parentFolders.selectFolder($scope.$parentFolders.list[0]):$scope.$parentFolders.selectFolder(getDefaultParentFolder()||$scope.$parentFolders.list[0])})}),$scope.$parentFolders.selectFolder=_.flow($scope.$parentFolders.selectFolder,function(){return updatePath(),$scope.$folders.load()}),$scope.$parentFolders.sortOrder=null,getDefaultFolder=function(){var folderId,res;return folderId=initializationPath[1],folderId?(res=$scope.$folders.list.filter(function(f){return f.id.split(":")[0]===folderId}),res[0]):void 0},getSelectedParentFolder=function(){return $scope.$parentFolders.selectedFolder},loadFolders=function(){return $scope.$parentFolders.selectedFolder.foldersList()},$scope.$folders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,getSelectedParentFolder,loadFolders),$scope.$folders.load=_.flow($scope.$folders.load,function(promise){return promise.then(function(){return isPathWasSet?$scope.$folders.selectFolder($scope.$folders.list[0]):$scope.$folders.selectFolder(getDefaultFolder()||$scope.$folders.list[0])})}),$scope.$folders.selectFolder=_.flow($scope.$folders.selectFolder,function(){return updatePath(),$scope.$nestedEntities.load()}),$scope.getAllFolder=function(){return _.find($scope.$folders.list,function(folder){return _.contains(publicAllCategoriesIds,""+folder.id.split(":")[0])})},getSelectedFolder=function(){return $scope.$folders.selectedFolder},loadItems=paginatedItemsListLoader(adapter,getSelectedFolder),searchItems=paginatedItemsSearchLoader(adapter,getSelectedFolder),$scope.$nestedEntities=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,getSelectedFolder,loadItems,searchItems),$scope.descriptionTranslationKey=void 0,$scope.$parentFolders.load().then(function(){return isPathWasSet=!0})})}.call(this),function(){"use strict";this.app.constant("publicAllCategoriesIds",["c2a37dfc-36cf-4bfd-b940-55bac7bdc9e6","bd176e29-5534-4d9f-87a6-a8177517ea4f","820351a1-729d-4bd1-856d-d578ca44f29e","ea934aee-5729-4c5e-aed1-ac25f5489914","cfad1a19-5cae-4d27-9cb7-fbf39ab6b644","2217cb59-e74f-4eac-b039-c5a61722d69a","9e839ab1-0fe5-4ffe-84c3-1ac80406ae66","8aa61c23-bff9-4426-ae8c-c1fd569764bf","d7b4efe4-a6ea-42df-80ac-1820c14fbe9a","b1dbbe33-cc31-4b23-b865-a81680f70976","8a78186b-a8d2-434a-91e1-8020f6bc9c87","a3269d65-3971-4557-9c4e-918b7a67edc9","d6b6b972-952c-4ab0-b46a-a6c05a0a94a5"])}.call(this),function(){"use strict";var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.external",{url:"/external",templateUrl:"scripts/pages/external/external.html",controller:"externalCtrl",resolve:{notify:function(){return _this.appLoadNotifiers.tabSelected()},adapters:function(tabs){return tabs.external.getAdapters()}}})}}(this)),this.app.controller("externalCtrl",function($scope,adapters,$q,submitItems,importItems,SelectedEntities,i18n,FilterCtrlPartial,EntitiesCtrlPartial,path,Folder,serviceRedirectUrl,paginatedItemsListLoader){var adaptersWithNestedSupport,getDefaultNestedFolder,getFirstConnectedService,getServiceFromPath,importedCount,initializationPath,isChildFolderSelectedAtPath,isPathWasSet,itemsPartialControllers,loadNestedFolders,makeFoldersFirst,ref,selectDefaultService,servicesList,setAdapter,sortNestedFolders,updatePath,userSettings;return initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath;return currentPath=[],$scope.$services.selected&&currentPath.push($scope.$services.selected.id),_.forEach($scope.selectedFoldersPath,function(folder){return(null!=folder?folder.id:void 0)||(null!=folder?folder.virtualId:void 0)?(currentPath.push(folder.id||folder.virtualId),!0):!1}),path.set(currentPath)},$scope.selectedFoldersPath=[],userSettings={redirectUrl:serviceRedirectUrl()},servicesList=_.map(adapters,function(adapter){var connectorId;return connectorId=_.snakeCase(adapter.name).toUpperCase(),{id:adapter.name,name:i18n.translate("external_media."+adapter.name),connector:wixmp.connectExternalSource(connectorId,userSettings)}}),$scope.$services=new FilterCtrlPartial(null,servicesList),getFirstConnectedService=function(){return _.find($scope.$services.list,$scope.$services.isConnected)},getServiceFromPath=function(){var serviceFromPath,serviceId;return serviceId=initializationPath[0],serviceId&&(serviceFromPath=_.find($scope.$services.list,function(service){return service.id===serviceId})),serviceFromPath},selectDefaultService=function(){return isPathWasSet?$scope.$services.select(getFirstConnectedService()||null):$scope.$services.select(getServiceFromPath()||getFirstConnectedService()||null)},setAdapter=function(service){return $scope.adapter=_.findWhere(adapters,{name:service.id}),$scope.$nestedEntities=itemsPartialControllers[service.id]},$scope.breadcrumbsList=function(){return"instagram"===$scope.$services.selected.id?[$scope.$services.selected]:[$scope.$services.selected].concat($scope.selectedFoldersPath)},$scope.$services.connect=function(service){return service.connector.connect().then(function(){return $scope.$services.select(service)})},$scope.$services.disconnect=function(service){return $scope.$services.isConnected(service)?($scope.$services.selected===service&&$scope.$services.select(null),service.connector.disconnect().then(selectDefaultService)):void 0},$scope.$services.isConnected=function(service){return null!=service?service.connector.isConnected():void 0},$scope.$services.isAllDisconnected=function(){return _.every($scope.$services.list,function(service){return!$scope.$services.isConnected(service)})},$scope.$services.isAllConnected=function(){return _.every($scope.$services.list,$scope.$services.isConnected)},$scope.$services.disconnectedList=function(){return _.filter($scope.$services.list,function(service){return!$scope.$services.isConnected(service)})},$scope.$services.select=_.flow($scope.$services.select,function(service){return service&&setAdapter(service),$scope.selectedFoldersPath=[],updatePath(),isPathWasSet=!0,$scope.$services.isConnected(service)?$scope.$nestedEntities.load().then(function(){return"instagram"===service.id?(console.log($scope.$services),$scope.$nestedEntities.selectFolder(_.find($scope.$nestedEntities.list,function(entity){return entity instanceof Folder}))):void 0}):void 0}),isChildFolderSelectedAtPath=function(){return!!getDefaultNestedFolder()},$scope.getSelectedFolder=function(){return _.last($scope.selectedFoldersPath)},getDefaultNestedFolder=function(){var folderId;return folderId=initializationPath[$scope.selectedFoldersPath.length],folderId?_.find($scope.$nestedEntities.list,function(folder){return folder.id===folderId||null!=folder.virtualId&&folder.virtualId===folderId}):void 0},sortNestedFolders=function(list){return list.data=_.sortBy(list.data,"name"),list},makeFoldersFirst=function(list){return list.data=_.sortBy(list.data,function(entity){return entity instanceof Folder?0:1}),list},loadNestedFolders=function(){var promise,ref;return promise=(null!=(ref=$scope.getSelectedFolder())?ref.foldersList():void 0)||$scope.adapter.folders.list(),promise.then(function(list){return!isPathWasSet&&getDefaultNestedFolder()&&$scope.$nestedEntities.selectFolder(getDefaultNestedFolder()),sortNestedFolders(list),$scope.$nestedEntities.list=null!=list?list.data:void 0})},$scope.selectFolderOrService=function(folder){var position;return position=$scope.selectedFoldersPath.indexOf(folder),position>=0&&($scope.selectedFoldersPath.length=position),folder instanceof Folder?$scope.$nestedEntities.selectFolder(folder):$scope.$services.select(folder)},itemsPartialControllers={},adaptersWithNestedSupport=["drive","dropbox"],_.forEach(adapters,function(adapter){var loadAllEntities,loadItems;return loadItems=paginatedItemsListLoader(adapter,$scope.getSelectedFolder),loadAllEntities=function(isFirstPage){var deferred,list,promises,ref,ref1,unresovedCount;return promises=[],isFirstPage&&(!$scope.getSelectedFolder()||(ref=adapter.name,indexOf.call(adaptersWithNestedSupport,ref)>=0))&&promises.push(loadNestedFolders()),($scope.getSelectedFolder()||(ref1=$scope.adapter.name,indexOf.call(adaptersWithNestedSupport,ref1)>=0))&&!isChildFolderSelectedAtPath()&&promises.push(loadItems(isFirstPage)),list={data:[]},deferred=$q.defer(),unresovedCount=0,_.forEach(promises,function(promise){return unresovedCount++,promise.then(function(currentList){return currentList.data&&(list.data=list.data.concat(currentList.data)),currentList})["finally"](function(){return unresovedCount--,unresovedCount?void 0:deferred.resolve(makeFoldersFirst(list))})}),deferred.promise},itemsPartialControllers[adapter.name]=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,$scope.getSelectedFolder,loadAllEntities),itemsPartialControllers[adapter.name].selectFolder=_.flow(itemsPartialControllers[adapter.name].selectFolder,function(folder){return $scope.selectedFoldersPath.push(folder),
updatePath(),itemsPartialControllers[adapter.name].load()}),itemsPartialControllers[adapter.name].load=_.flow(itemsPartialControllers[adapter.name].load,function(promise){return promise["catch"](function(reason){return 401===reason.code?editorConnection.emit("notauthorized"):void 0})}),itemsPartialControllers[adapter.name].load=_.flow(itemsPartialControllers[adapter.name].load,function(promise){return $scope.isLoading=!0,promise["finally"](function(){return $scope.isLoading=!1})})}),$scope.canSubmitItems=_.flow($scope.canSubmitItems,function(canSubmit){return canSubmit&&!$scope.isImporting}),importedCount=0,$scope.getImportingProgress=function(){return importedCount/SelectedEntities.get().length},$scope.importingCount=0,$scope.submitItems=function(){var importedItems,promises;if($scope.canSubmitItems())return importedItems=[],$scope.isImporting=!0,importedCount=0,promises=importItems(SelectedEntities.get(),$scope.adapter.name),$scope.importingCount=promises.length,_.forEach(promises,function(promise){return promise.then(function(item){return importedItems.push(item),importedCount++})}),$q.all(promises).then(function(){return $scope.isImporting=!1,submitItems(importedItems),$scope.importingCount=0},function(){return $scope.isImporting=!1,$scope.importingCount=0})},$scope.descriptionTranslationKey="social_images.upload_restrictions_header_message",_.forEach(adapters,function(adapter){return adapter.events.on([adapter.events.ITEMS.LIST,adapter.events.FOLDERS.LIST],function(promise){return $scope.adapter===adapter?promise["catch"](function(error){return 403===error.code||401===error.code?$scope.$services.disconnect($scope.$services.selected):void 0}):void 0})}),null!=(ref=selectDefaultService())?ref.then(function(){return isPathWasSet=!0}):void 0})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.externalSearch",{url:"/externalSearch",templateUrl:"scripts/pages/external-search/external-search.html",controller:"externalSearchCtrl",resolve:{notify:function(){return _this.appLoadNotifiers.tabSelected()},adapters:function(tabs){return tabs.externalSearch.getAdapters()}}})}}(this)),this.app.controller("externalSearchCtrl",function($scope,adapters,submitItems,importItems,SelectedEntities,i18n,FilterCtrlPartial,EntitiesCtrlPartial,path,paginatedItemsSearchLoader,$q){var defaultServiceId,getServiceFromPath,importedCount,initializationPath,itemsPartialControllers,servicesList,setAdapter,updatePath;return initializationPath=_.clone(path.get()),updatePath=function(){var currentPath;return currentPath=[],null!=$scope.$services.selected&&currentPath.push($scope.$services.selected.id),path.set(currentPath)},defaultServiceId=path.get()[1]||"googleSearch",servicesList=_.map(adapters,function(adapter){return{id:adapter.name,name:i18n.translate("external_search."+adapter.name)}}),$scope.$services=new FilterCtrlPartial(defaultServiceId,servicesList),setAdapter=function(service){return $scope.adapter=_.findWhere(adapters,{name:service.id}),$scope.$nestedEntities=itemsPartialControllers[service.id]},$scope.$services.select=_.flow($scope.$services.select,function(){return setAdapter($scope.$services.selected),$scope.$nestedEntities.load()}),itemsPartialControllers={},_.forEach(adapters,function(adapter){var searchItems;return searchItems=paginatedItemsSearchLoader(adapter),itemsPartialControllers[adapter.name]=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,null,searchItems)}),$scope.canSubmitItems=_.flow($scope.canSubmitItems,function(canSubmit){return canSubmit&&!$scope.isImporting}),importedCount=0,$scope.getImportingProgress=function(){return importedCount/SelectedEntities.get().length},$scope.submitItems=function(){var importedItems,promises;if(SelectedEntities.size)return importedItems=[],$scope.isImporting=!0,importedCount=0,promises=importItems(SelectedEntities.get(),$scope.adapter.name),_.forEach(promises,function(promise){return promise.then(function(item){return importedItems.push(item),importedCount++})}),$q.all(promises).then(function(){return $scope.isImporting=!1,submitItems(importedItems)},function(){return $scope.isImporting=!1})},getServiceFromPath=function(){var serviceFromPath,serviceId;return serviceId=initializationPath[0],serviceId&&(serviceFromPath=_.find($scope.$services.list,function(service){return service.id===serviceId})),serviceFromPath},$scope.$services.select(getServiceFromPath()||$scope.$services.list[0]),updatePath()})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.photoStock",{url:"/photoStock",templateUrl:"scripts/pages/photo-stock/photo-stock.html",controller:"photoStockCtrl",resolve:{notify:function(){return _this.appLoadNotifiers.tabSelected()},adapter:function(tabs){return tabs.photoStock.getAdapter()}}})}}(this)),this.app.controller("photoStockCtrl",function($scope,adapter,$state,SelectedEntities,bigStockPayment,submitItems,EntitiesCtrlPartial,FilterCtrlPartial,path,paginatedItemsListLoader,paginatedItemsSearchLoader,i18n){var getDefaultFolder,getFolders,getListOptions,getSelectedFolder,initializationPath,isPathWasSet,loadItems,searchItems,updatePath;return $scope.adapter=adapter,initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath,ref;return currentPath=[],(null!=(ref=$scope.$folders.selectedFolder)?ref.id:void 0)&&currentPath.push($scope.$folders.selectedFolder.id),path.set(currentPath)},getDefaultFolder=function(){var folderId;return folderId=initializationPath[0],folderId?_.findWhere($scope.$folders.list,{id:folderId}):void 0},getFolders=function(){return adapter.folders.list()},$scope.$folders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,getFolders),$scope.$folders.load=_.flow($scope.$folders.load,function(promise){return promise.then(function(){return _.forEach($scope.$folders.list,function(folder){var folderId;return folderId=folder.id,null===folder.id&&(folderId="All"),folder.name=i18n.translate("photo_stock.big_stock.folder."+folderId)}),isPathWasSet?$scope.$folders.selectFolder($scope.$folders.list[0]):$scope.$folders.selectFolder(getDefaultFolder()||$scope.$folders.list[0])})}),$scope.$folders.selectFolder=_.flow($scope.$folders.selectFolder,function(){return updatePath(),$scope.$nestedEntities.load()}),$scope.getAllFolder=function(){return _.find($scope.$folders.list,function(folder){return null===folder.id})},getSelectedFolder=function(){return $scope.$folders.selectedFolder},getListOptions=function(){return{hasIllustrations:!1,hasVectors:!1,isSafeSearch:!0,orientation:$scope.$nestedEntities.$orientation.selected?$scope.$nestedEntities.$orientation.selected.id:void 0}},loadItems=paginatedItemsListLoader(adapter,getSelectedFolder,getListOptions),searchItems=paginatedItemsSearchLoader(adapter,getSelectedFolder,getListOptions),$scope.$nestedEntities=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,getSelectedFolder,loadItems,searchItems),$scope.$nestedEntities.$orientation=new FilterCtrlPartial(null,[{name:"vertical",id:"v"},{name:"horizontal",id:"h"}]),$scope.$nestedEntities.$orientation.select=function(orientation){return $scope.$nestedEntities.$orientation.selected=$scope.$nestedEntities.$orientation.selected===orientation?null:orientation,$scope.$nestedEntities.load()},$scope.isBuying=!1,$scope.submitItems=function(){var item,items;return items=SelectedEntities.get(),items.length?(item=_.first(items),$scope.isBuying=!1,bigStockPayment.buyImage(item).then(function(){return $scope.isBuying=!0,bigStockPayment.getBoughtImage(item).then(function(boughtItem){return submitItems([boughtItem]),$scope.isBuying=!1},function(){return $scope.isBuying=!1})})):void 0},$scope.descriptionTranslationKey="bigstock_images.upload_restrictions_header_message",$scope.footerSubmitTranslationKey="photo_stock_tab.footer.submit",$scope.$folders.load().then(function(){return isPathWasSet=!0})})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.collection",{url:"/collection",templateUrl:"scripts/pages/_base/base.html",controller:"collectionCtrl",resolve:{notify:function(){return _this.appLoadNotifiers.tabSelected()},adapter:function(tabs){return tabs.collection.getAdapter()}}})}}(this)),this.app.controller("collectionCtrl",function($scope,adapter,baseCtrl){var init;return(init=baseCtrl($scope,adapter))()})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.settingsPassed",{url:"/settingsPassed",templateUrl:"scripts/pages/_base/base.html",controller:"settingsPassedCtrl",resolve:{notify:function(){return _this.appLoadNotifiers.tabSelected()},adapter:function(tabs){return tabs.settingsPassed.getAdapter()}}})}}(this)),this.app.controller("settingsPassedCtrl",function($scope,adapter,baseCtrl){var init;return(init=baseCtrl($scope,adapter))()})}.call(this),function(window){"use strict";var CanvasPrototype=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype,hasBlobConstructor=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,dataURLtoBlob=(hasBlobConstructor||BlobBuilder)&&window.atob&&window.ArrayBuffer&&window.Uint8Array&&function(dataURI){var byteString,arrayBuffer,intArray,i,mimeString,bb;for(byteString=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):decodeURIComponent(dataURI.split(",")[1]),arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),i=0;i<byteString.length;i+=1)intArray[i]=byteString.charCodeAt(i);return mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],hasBlobConstructor?new Blob([hasArrayBufferViewSupport?intArray:arrayBuffer],{type:mimeString}):(bb=new BlobBuilder,bb.append(arrayBuffer),bb.getBlob(mimeString))};window.HTMLCanvasElement&&!CanvasPrototype.toBlob&&(CanvasPrototype.mozGetAsFile?CanvasPrototype.toBlob=function(callback,type,quality){callback(quality&&CanvasPrototype.toDataURL&&dataURLtoBlob?dataURLtoBlob(this.toDataURL(type,quality)):this.mozGetAsFile("blob",type))}:CanvasPrototype.toDataURL&&dataURLtoBlob&&(CanvasPrototype.toBlob=function(callback,type,quality){callback(dataURLtoBlob(this.toDataURL(type,quality)))})),"function"==typeof define&&define.amd?define(function(){return dataURLtoBlob}):window.dataURLtoBlob=dataURLtoBlob}(this),!function(a){"use strict";var b=function(a,c,d){var e,f,g=document.createElement("img");if(g.onerror=c,g.onload=function(){!f||d&&d.noRevoke||b.revokeObjectURL(f),c&&c(b.scale(g,d))},b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a))e=f=b.createObjectURL(a),g._type=a.type;else{if("string"!=typeof a)return!1;e=a,d&&d.crossOrigin&&(g.crossOrigin=d.crossOrigin)}return e?(g.src=e,g):b.readFile(a,function(a){var b=a.target;b&&b.result?g.src=b.result:c&&c(a)})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.transformCoordinates=function(){},b.getTransformedOptions=function(a,b){var c,d,e,f,g=b.aspectRatio;if(!g)return b;c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.crop=!0,e=a.naturalWidth||a.width,f=a.naturalHeight||a.height,e/f>g?(c.maxWidth=f*g,c.maxHeight=f):(c.maxWidth=e,c.maxHeight=e/g),c},b.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},b.hasCanvasOption=function(a){return a.canvas||a.crop||a.aspectRatio},b.scale=function(a,c){c=c||{};var d,e,f,g,h,i,j,k,l,m=document.createElement("canvas"),n=a.getContext||b.hasCanvasOption(c)&&m.getContext,o=a.naturalWidth||a.width,p=a.naturalHeight||a.height,q=o,r=p,s=function(){var a=Math.max((f||q)/q,(g||r)/r);a>1&&(q*=a,r*=a)},t=function(){var a=Math.min((d||q)/q,(e||r)/r);1>a&&(q*=a,r*=a)};return n&&(c=b.getTransformedOptions(a,c),j=c.left||0,k=c.top||0,c.sourceWidth?(h=c.sourceWidth,void 0!==c.right&&void 0===c.left&&(j=o-h-c.right)):h=o-j-(c.right||0),c.sourceHeight?(i=c.sourceHeight,void 0!==c.bottom&&void 0===c.top&&(k=p-i-c.bottom)):i=p-k-(c.bottom||0),q=h,r=i),d=c.maxWidth,e=c.maxHeight,f=c.minWidth,g=c.minHeight,n&&d&&e&&c.crop?(q=d,r=e,l=h/i-d/e,0>l?(i=e*h/d,void 0===c.top&&void 0===c.bottom&&(k=(p-i)/2)):l>0&&(h=d*i/e,void 0===c.left&&void 0===c.right&&(j=(o-h)/2))):((c.contain||c.cover)&&(f=d=d||f,g=e=e||g),c.cover?(t(),s()):(s(),t())),n?(m.width=q,m.height=r,b.transformCoordinates(m,c),b.renderImageToCanvas(m,a,j,k,h,i,0,0,q,r)):(a.width=q,a.height=r,a)},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define(function(){return b}):a.loadImage=b}(this),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var b=a.renderImageToCanvas;a.detectSubsampling=function(a){var b,c;return a.width*a.height>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-a.width+1,0),0===c.getImageData(0,0,1,1).data[3]):!1},a.detectVerticalSquash=function(a,b){var c,d,e,f,g,h=a.naturalHeight||a.height,i=document.createElement("canvas"),j=i.getContext("2d");for(b&&(h/=2),i.width=1,i.height=h,j.drawImage(a,0,0),c=j.getImageData(0,0,1,h).data,d=0,e=h,f=h;f>d;)g=c[4*(f-1)+3],0===g?e=f:d=f,f=e+d>>1;return f/h||1},a.renderImageToCanvas=function(c,d,e,f,g,h,i,j,k,l){if("image/jpeg"===d._type){var m,n,o,p,q=c.getContext("2d"),r=document.createElement("canvas"),s=1024,t=r.getContext("2d");if(r.width=s,r.height=s,q.save(),m=a.detectSubsampling(d),m&&(e/=2,f/=2,g/=2,h/=2),n=a.detectVerticalSquash(d,m),m||1!==n){for(f*=n,k=Math.ceil(s*k/g),l=Math.ceil(s*l/h/n),j=0,p=0;h>p;){for(i=0,o=0;g>o;)t.clearRect(0,0,s,s),t.drawImage(d,e,f,g,h,-o,-p,g,h),q.drawImage(r,0,0,s,s,i,j,k,l),o+=s,i+=k;p+=s,j+=l}return q.restore(),c}}return b(c,d,e,f,g,h,i,j,k,l)}}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";var b=a.hasCanvasOption,c=a.transformCoordinates,d=a.getTransformedOptions;a.hasCanvasOption=function(c){return b.call(a,c)||c.orientation},a.transformCoordinates=function(b,d){c.call(a,b,d);var e=b.getContext("2d"),f=b.width,g=b.height,h=d.orientation;if(h&&!(h>8))switch(h>4&&(b.width=g,b.height=f),h){case 2:e.translate(f,0),e.scale(-1,1);break;case 3:e.translate(f,g),e.rotate(Math.PI);break;case 4:e.translate(0,g),e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI),e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI),e.translate(0,-g);break;case 7:e.rotate(.5*Math.PI),e.translate(f,-g),e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI),e.translate(-f,0)}},a.getTransformedOptions=function(b,c){var e,f,g=d.call(a,b,c),h=g.orientation;if(!h||h>8||1===h)return g;e={};for(f in g)g.hasOwnProperty(f)&&(e[f]=g[f]);switch(g.orientation){case 2:e.left=g.right,e.right=g.left;break;case 3:e.left=g.right,e.top=g.bottom,e.right=g.left,e.bottom=g.top;break;case 4:e.top=g.bottom,e.bottom=g.top;break;case 5:e.left=g.top,e.top=g.left,e.right=g.bottom,e.bottom=g.right;break;case 6:e.left=g.top,e.top=g.right,e.right=g.bottom,e.bottom=g.left;break;case 7:e.left=g.bottom,e.top=g.right,e.right=g.top,e.bottom=g.left;break;case 8:e.left=g.bottom,e.top=g.left,e.right=g.top,e.bottom=g.right}return g.orientation>4&&(e.maxWidth=g.maxHeight,e.maxHeight=g.maxWidth,e.minWidth=g.minHeight,e.minHeight=g.minWidth,e.sourceWidth=g.sourceHeight,e.sourceHeight=g.sourceWidth),e}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";var b=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);a.blobSlice=b&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},a.metaDataParsers={jpeg:{65505:[]}},a.parseMetaData=function(b,c,d){d=d||{};var e=this,f=d.maxMetaDataSize||262144,g={},h=!(window.DataView&&b&&b.size>=12&&"image/jpeg"===b.type&&a.blobSlice);(h||!a.readFile(a.blobSlice.call(b,0,f),function(b){if(b.target.error)return console.log(b.target.error),void c(g);var f,h,i,j,k=b.target.result,l=new DataView(k),m=2,n=l.byteLength-4,o=m;if(65496===l.getUint16(0)){for(;n>m&&(f=l.getUint16(m),f>=65504&&65519>=f||65534===f);){if(h=l.getUint16(m+2)+2,m+h>l.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(i=a.metaDataParsers.jpeg[f])for(j=0;j<i.length;j+=1)i[j].call(e,l,m,h,g,d);m+=h,o=m}!d.disableImageHead&&o>6&&(g.imageHead=k.slice?k.slice(0,o):new Uint8Array(k).subarray(0,o))}else console.log("Invalid JPEG file: Missing JPEG marker.");c(g)},"readAsArrayBuffer"))&&c(g)}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-meta"],a):a(window.loadImage)}(function(a){"use strict";a.ExifMap=function(){return this},a.ExifMap.prototype.map={Orientation:274},a.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},a.getExifThumbnail=function(a,b,c){var d,e,f;if(!c||b+c>a.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(d=[],e=0;c>e;e+=1)f=a.getUint8(b+e),d.push((16>f?"0":"")+f.toString(16));return"data:image/jpeg,%"+d.join("%")},a.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},a.exifTagTypes[7]=a.exifTagTypes[1],a.getExifValue=function(b,c,d,e,f,g){var h,i,j,k,l,m,n=a.exifTagTypes[e];if(!n)return void console.log("Invalid Exif data: Invalid tag type.");if(h=n.size*f,i=h>4?c+b.getUint32(d+8,g):d+8,i+h>b.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===f)return n.getValue(b,i,g);for(j=[],k=0;f>k;k+=1)j[k]=n.getValue(b,i+k*n.size,g);if(n.ascii){for(l="",k=0;k<j.length&&(m=j[k],"\x00"!==m);k+=1)l+=m;return l}return j},a.parseExifTag=function(b,c,d,e,f){var g=b.getUint16(d,e);f.exif[g]=a.getExifValue(b,c,d,b.getUint16(d+2,e),b.getUint32(d+4,e),e)},a.parseExifTags=function(a,b,c,d,e){var f,g,h;if(c+6>a.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(f=a.getUint16(c,d),g=c+2+12*f,g+4>a.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(h=0;f>h;h+=1)this.parseExifTag(a,b,c+2+12*h,d,e);return a.getUint32(g,d)},a.parseExifData=function(b,c,d,e,f){if(!f.disableExif){var g,h,i,j=c+10;if(1165519206===b.getUint32(c+4)){if(j+8>b.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==b.getUint16(c+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(b.getUint16(j)){case 18761:g=!0;break;case 19789:g=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==b.getUint16(j+2,g))return void console.log("Invalid Exif data: Missing TIFF marker.");h=b.getUint32(j+4,g),e.exif=new a.ExifMap,h=a.parseExifTags(b,j,j+h,g,e),h&&!f.disableExifThumbnail&&(i={exif:{}},h=a.parseExifTags(b,j,j+h,g,i),i.exif[513]&&(e.exif.Thumbnail=a.getExifThumbnail(b,j+i.exif[513],i.exif[514]))),e.exif[34665]&&!f.disableExifSub&&a.parseExifTags(b,j,j+e.exif[34665],g,e),e.exif[34853]&&!f.disableExifGps&&a.parseExifTags(b,j,j+e.exif[34853],g,e)}}},a.metaDataParsers.jpeg[65505].push(a.parseExifData)}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-exif"],a):a(window.loadImage)}(function(a){"use strict";a.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},a.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}},a.ExifMap.prototype.getText=function(a){var b=this.get(a);switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[a][b];case"ExifVersion":case"FlashpixVersion":return String.fromCharCode(b[0],b[1],b[2],b[3]);case"ComponentsConfiguration":return this.stringValues[a][b[0]]+this.stringValues[a][b[1]]+this.stringValues[a][b[2]]+this.stringValues[a][b[3]];case"GPSVersionID":return b[0]+"."+b[1]+"."+b[2]+"."+b[3]}return String(b)},function(a){var b,c=a.tags,d=a.map;for(b in c)c.hasOwnProperty(b)&&(d[c[b]]=b)}(a.ExifMap.prototype),a.ExifMap.prototype.getAll=function(){var a,b,c={};for(a in this)this.hasOwnProperty(a)&&(b=this.tags[a],b&&(c[b]=this.getText(b)));return c}}),function(){this.app.factory("confirm",function(ngDialog,$sce,i18n){return function(options){var dialog;return dialog=ngDialog.open({template:"scripts/pages/_partials/confirmation.html",controller:function($scope){return options.confirmMessage=$sce.trustAsHtml(options.confirmMessage),options.confirmTitle||(options.confirmTitle=i18n.translate("dialog.warn_title")),options.confirmYes||(options.confirmYes=i18n.translate("dialog.yes")),options.confirmNo||(options.confirmNo=i18n.translate("dialog.no")),_.assign($scope,options)},showClose:!0,closeByEscape:!0}),$(document).on("keyup.confirmation",function(event){return 13===event.keyCode?($(document).off(".confirmation"),"function"==typeof options.confirm&&options.confirm(),dialog.close()):void 0})}})}.call(this),function(){this.app.factory("path",function($state,tabs){var getSelectedTabId,tabsPaths;return tabsPaths={},getSelectedTabId=function(){var selectedTab;return selectedTab=_.find(tabs,function(tab){return $state.includes(tab.state)}),null!=selectedTab?selectedTab.id:void 0},{set:function(newPath){return tabsPaths[getSelectedTabId()]=newPath},get:function(){return tabsPaths[getSelectedTabId()]||[]},setFull:function(fullPath){var pathArray,tabId;return pathArray=fullPath.split("/"),tabId=pathArray[0],null!=tabId?tabsPaths[tabId]=pathArray.slice(1):void 0},getFull:function(){var path,tabId;return tabId=getSelectedTabId(),path=""+tabId,tabsPaths[tabId]&&(path+="/"+tabsPaths[tabId].join("/")),path}}})}.call(this),function(){"use strict";this.app.factory("SelectedEntities",function(){var set;return set=new Set,set.get=function(){var array;return array=[],this.forEach(function(el){return array.push(el)}),array},set})}.call(this),function(){this.app.factory("futureArrayFromPromise",function($q){return function(promise){var deferred,futureObj;return futureObj=[],deferred=$q.defer(),futureObj.$resolved=!1,futureObj.$promise=deferred.promise,promise.then(function(entities){return _.forEach(entities,function(e){return futureObj.push(e)}),futureObj.$resolved=!0,deferred.resolve(futureObj)},function(r){return futureObj.$resolved=!0,deferred.reject(r)}),futureObj}})}.call(this),function(){"use strict";this.app.constant("htmlEncode",function(html){return $("<div/>").text(html).html()})}.call(this),function(){var slice=[].slice;this.app.filter("unsafe",function(i18n,$sce){return function(){var args,input;return input=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],$sce.trustAsHtml(i18n.translate(input,args))}}),this.app.filter("translate",function(i18n){return function(){var args,input;return input=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],i18n.translate(input,args)}}),this.app.factory("LoadLocales",function($q,$http,$rootScope,i18n){return function(settings){var i18nPromise,loadTranslations;return loadTranslations=function(i18nCode){return $http.get("locales/media_gallery_"+i18nCode+".json",{withCredentials:!1}).then(function(response){return i18n.updateTranslations(response.data),i18n.setPrefix(settings.i18nPrefix),i18n.setLang(i18nCode)},function(reason){var d;return d=$q.defer(),d.reject({code:123,message:"Could not load translations"}),d.promise})},i18nPromise="en"===settings.i18nCode?loadTranslations("en"):loadTranslations(settings.i18nCode).then(null,function(){return loadTranslations("en")})}}),this.app.factory("i18n",function(localeOverride,settings){var areLoaded,getAllOverride,getFullKey,getLang,getLocalesValue,getSettingsValue,getTranslation,lang,prefix,prefixRegExp,setLang,setPrefix,translate,translations,updateTranslations;return prefix="",lang="en",translations={},prefixRegExp=/(.*?)_/,areLoaded=function(){return _.size(translations)},updateTranslations=function(newTranslations){return translations=newTranslations},getAllOverride=function(key){return localeOverride.all[key].replace(/%s/,lang)},getLocalesValue=function(key){var ref,ref1;return(null!=(ref=localeOverride[lang])?ref[key]:void 0)||(null!=(ref1=localeOverride.all)?ref1[key]:void 0)&&getAllOverride(key)||translations[key]},getSettingsValue=function(key){return settings.translations[key]},getTranslation=function(key,args,getValue){var value;return value=getValue(key),value.replace(/%{(\d+?)}/g,function(match,index){return args[index]})},getFullKey=function(key,getValue){var currentPrefix;for(currentPrefix=prefix;!getValue(currentPrefix+":"+key)&&prefixRegExp.test(currentPrefix);)currentPrefix=currentPrefix.replace(prefixRegExp,"");return getValue(currentPrefix+":"+key)?currentPrefix+":"+key:getValue(key)?key:void 0},translate=function(key,args,getValue){var fullKey;return fullKey=getFullKey(key,getValue),null!=fullKey?getTranslation(fullKey,args,getValue):getTranslation("no_translation",[key],getValue);
},setPrefix=function(value){return prefix=""+value},setLang=function(code){return lang=code},getLang=function(){return lang},{updateTranslations:updateTranslations,areLoaded:areLoaded,translate:function(key,args){return getFullKey(key,getSettingsValue)?translate(key,args,getSettingsValue):translate(key,args,getLocalesValue)},isTranslatable:function(key){return!!getFullKey(key,getSettingsValue)||!!getFullKey(key,getLocalesValue)},setPrefix:setPrefix,getLang:getLang,setLang:setLang}})}.call(this),function(){this.app.value("localeOverride",{all:{help_url:"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=4987f658-4243-4d84-8581-1a36f09e0f83","shape:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=da3604d7-39d0-4882-b80d-91d3f4c39f6d","document:help_url":"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=e637f635-94d3-4a01-854a-d18a666bd643","video:help_url":"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=b80afb39-4814-4e05-ae5c-e4e00ff6c949","music:help_url":"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195","secure_music:help_url":"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195"},en:{help_url:"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=4987f658-4243-4d84-8581-1a36f09e0f83","shape:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=da3604d7-39d0-4882-b80d-91d3f4c39f6d","document:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=e637f635-94d3-4a01-854a-d18a666bd643","video:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=b80afb39-4814-4e05-ae5c-e4e00ff6c949","music:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195","secure_music:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195"},hi:{help_url:"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=4987f658-4243-4d84-8581-1a36f09e0f83","shape:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=da3604d7-39d0-4882-b80d-91d3f4c39f6d","document:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=e637f635-94d3-4a01-854a-d18a666bd643","video:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=b80afb39-4814-4e05-ae5c-e4e00ff6c949","music:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195","secure_music:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195"}})}.call(this),function(){"use strict";this.app.factory("editorConnection",function(events){var editorConnection;return editorConnection=new WindowMessenger(window.parent),events.on(events.ITEMS.REMOVE,function(promises,event){return _.forEach(promises,function(promise){return promise.then(function(id){return editorConnection.emit("itemremove",{id:id,source:event.eventTarget.name})})})}),editorConnection})}.call(this),function(){"use strict";this.app.factory("importItems",function($q,tabs,settings){return function(items,adapterName){var adapter,importItem;return adapter=tabs["private"].getAdapter(),importItem=function(item,tag){var filesToUpload;return filesToUpload=wixmp.Uploader.upload([{uploadFn:adapter.item.uploadByUrl,source:{url:item.fileUrl,name:item.name||"Untitled",tags:["_social","_imported","_"+adapterName,tag],mediaType:settings.mediaType}}]),filesToUpload[0].deferred.promise.then(function(res){return res.data})},_.map(items,function(item){var tag;return tag="_"+adapterName+"_"+item.id,adapter.items.searchByTag(tag).then(function(result){var ref;return(null!=(ref=result.data)?ref.length:void 0)?result.data[0]:importItem(item,tag)},function(){return importItem(item,tag)})})}})}.call(this),function(){this.app.constant("uploadSizesLimits",{"default":15728640,document:15728640,picture:26214400,music:52428800,secureMusic:377487360,video:104857600,secureVideo:524288e3}),this.app.constant("uploadSizesLimitsHard",{"default":1572864e3,document:1572864e3,picture:262144e4,music:524288e4,secureMusic:37748736e3,video:1048576e5,secureVideo:524288e5}),this.app.factory("getFileSizeLimit",function(uploadSizesLimits){return function(mediaType){var customMediaTypes;return customMediaTypes={secure_music:"secureMusic"},uploadSizesLimits[mediaType]||uploadSizesLimits[customMediaTypes[mediaType]]||uploadSizesLimits["default"]}})}.call(this),function(){this.app.factory("Cache",function(Adapter,$q){return function(adapter){var addItems,data,dropFolderCache,getFolderKey,getFolders,getItems,setItems;return data={items:{},folders:{}},dropFolderCache=function(folderKey){return delete data.items[folderKey]},getFolderKey=function(folder){return(null!=folder?folder.id:void 0)||(null!=folder?folder.virtualId:void 0)||null},setItems=function(promise,futureItems,folder){return promise.then(function(items){return data.items[getFolderKey(folder)]=_.clone(items)})},addItems=function(promise,futureItems,folder){return promise.then(function(items){return data.items[getFolderKey(folder)]=_.union(data.items[getFolderKey(folder)],items)})},adapter.on("getFolders",function(promise,futureFolders,folder){return promise.then(function(folders){return data.folders[null!=folder?folder.id:void 0]=folders})}),adapter.on("getItems",setItems),adapter.on("getMoreItems",addItems),adapter.on("removeItem",function(promise,item){return promise.then(function(){return _.forEach(data.items,function(cachedFolderArray){return _.remove(cachedFolderArray,item)})})}),adapter.on("removeFolder",function(promise,folder){var folderKey;return folderKey=getFolderKey(folder),promise.then(function(){return dropFolderCache(folderKey),dropFolderCache("AllMedia")})}),adapter.on("uploadFile",function(promise){return promise.then(function(item){return item.folderId&&dropFolderCache(item.folderId),delete data.items.AllMedia})}),adapter.on("moveItem",function(promise,item,folder){return promise.then(function(){return dropFolderCache(item.folderId),dropFolderCache(getFolderKey(folder))})}),adapter.getItems&&(getItems=adapter.getItems,adapter.getItems=function(folder,options){var items;return null==options&&(options={}),options=_.defaults(options,{cache:!0}),items=data.items[getFolderKey(folder)],options.cache&&null!=items?_.assign(items,{$resolved:!0,$promise:$q.when(items)}):getItems.apply(this,arguments)}),adapter.getFolders&&(getFolders=adapter.getFolders,adapter.getFolders=function(folder){var folders;return(folders=data.folders[null!=folder?folder.id:void 0])?_.assign(folders,{$resolved:!0,$promise:$q.when(folders)}):getFolders.apply(this,arguments)}),adapter}})}.call(this),function(){this.app.factory("tabs",function(settings,wrapSource,supportedMediaTypes,supportedPublicMediaRoots,supportedExternalServices,uploadSizesLimitsHard,supportedExternalSearchServices,settingsPassedAdapter){var bigStockAdapter,canShowTab,collectionAdapter,externalAdapters,externalSearchAdapters,privateAdapter,publicAdapter,settingsPassedAdapterWrapped;return privateAdapter=null,publicAdapter=null,externalAdapters=null,externalSearchAdapters=null,bigStockAdapter=null,collectionAdapter=null,settingsPassedAdapterWrapped=null,canShowTab=function(tab){return _.includes(settings.tabsList,tab.id)},{"private":{id:"private",state:"app.private",translationKey:"private_media_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){return null!=privateAdapter?privateAdapter:privateAdapter=wrapSource(new wixmp.Source(wixmp.sources.PRIVATE,{apiUrl:settings.privateMediaRestAPI,filesUrl:settings.privateMediaRestFiles,videoFilesUrl:settings.privateMediaRestVideoFiles,imageOperationsApi:settings.imageOperationsApi,uploadLimits:uploadSizesLimitsHard}))}},"public":{id:"public",state:"app.public",translationKey:"public_media_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){return null!=publicAdapter?publicAdapter:publicAdapter=wrapSource(new wixmp.Source(wixmp.sources.PUBLIC,{apiUrl:settings.publicMediaRestAPI,filesUrl:settings.publicMediaRestFiles,imageOperationsApi:settings.imageOperationsApi}))}},photoStock:{id:"photoStock",state:"app.photoStock",translationKey:"photo_stock_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){return null!=bigStockAdapter?bigStockAdapter:bigStockAdapter=wrapSource(new wixmp.Source(wixmp.sources.BIGSTOCK,{apiUrl:settings.bigStockSearchAPI}))}},externalSearch:{id:"externalSearch",state:"app.externalSearch",translationKey:"external_free_images_tab",canShow:function(){return canShowTab(this)},getAdapters:function(){return null!=externalSearchAdapters?externalSearchAdapters:(externalSearchAdapters=[],_.each(settings.servicesList,function(serviceId){var id;return _.contains(supportedExternalSearchServices,serviceId)?(id=_.snakeCase(serviceId).toUpperCase(),externalSearchAdapters.push(wrapSource(new wixmp.Source(wixmp.sources[id])))):void 0}),externalSearchAdapters)}},external:{id:"external",state:"app.external",translationKey:"external_media_tab",canShow:function(){return canShowTab(this)},getAdapters:function(){return null!=externalAdapters?externalAdapters:(externalAdapters=[],_.each(settings.servicesList,function(serviceId){var id;return _.contains(supportedExternalServices,serviceId)?(id=_.snakeCase(serviceId).toUpperCase(),externalAdapters.push(wrapSource(new wixmp.Source(wixmp.sources[id])))):void 0}),externalAdapters)}},collection:{id:"collection",state:"app.collection",translationKey:"collection_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){return null!=collectionAdapter?collectionAdapter:collectionAdapter=wrapSource(new wixmp.Source(wixmp.sources.COLLECTION,{apiUrl:settings.collectionsAPI,collectionId:settings.collectionId,filesUrl:settings.privateMediaRestFiles,imageOperationsApi:settings.imageOperationsApi}))}},settingsPassed:{id:"settingsPassed",state:"app.settingsPassed",translationKey:"settings_passed_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){return null!=settingsPassedAdapterWrapped?settingsPassedAdapterWrapped:settingsPassedAdapterWrapped=wrapSource(settingsPassedAdapter)}},empty:{id:"empty",state:"app.empty",canShow:function(){return!0}}}})}.call(this),function(){this.app.factory("NormalizeUri",function(){return function(url){return new URI(url).normalize()._string}}),this.app.factory("UrlSanitizeInterceptor",function($q,NormalizeUri){return{request:function(config){var deferred;return deferred=$q.defer(),config.url=NormalizeUri(config.url),deferred.resolve(config),deferred.promise}}})}.call(this),function(){"use strict";var slice=[].slice;this.app.factory("Notifications",function($timeout,$rootScope,editorConnection){var expireNotification,notifications,purgeNotifications,safeApply,sendNotification;return safeApply=function(callback){return $rootScope.$$phase?callback():$rootScope.$apply(function(){return callback()})},notifications=[],sendNotification=function(message,timeout,type){var messageId;return null==timeout&&(timeout=5e3),null==type&&(type="error"),messageId=UUID.generate(),message={id:messageId,message:message,type:type},notifications.push(message),timeout&&$timeout(function(){return expireNotification(messageId)},timeout),$rootScope.$emit("UiNotificationReceived",notifications),messageId},expireNotification=function(id){return _.remove(notifications,function(notification){return notification.id===id}),$rootScope.$emit("UiNotificationExpired",notifications)},purgeNotifications=function(){return notifications.length=0,$rootScope.$emit("UiNotificationsPurged",notifications)},window.purge=purgeNotifications,{send:function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],safeApply(function(){return sendNotification.apply(null,args)})},expire:function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],safeApply(function(){return expireNotification.apply(null,args)})},get:function(){return safeApply(function(){return notifications})}}})}.call(this),function(){var slice=[].slice;this.app.factory("Aviary",function($rootScope,tabs,i18n,settings){var editor,emit,isJpeg,observers,onAviaryError,onAviarySave;return observers=[],emit=function(){var args,event;return event=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],_(observers).where({event:event}).each(function(observer){var ref;return(ref=observer.fn).call.apply(ref,[{name:name},observer.event].concat(slice.call(args))),observer})},editor=null,onAviarySave=function(imageId,newUrl){return!1},isJpeg=function(fileName){return-1!==["jpg","peg"].indexOf(fileName.toLowerCase().slice(-3))},onAviaryError=function(message){},{on:function(event,fn){return observers.push({event:event,fn:fn})},upload:function(imageName,url,folder){var callback,onAviarySaveButtonClick;return onAviarySaveButtonClick=function(imageId){var canvasElement,ref;return canvasElement=document.getElementById("avpw_canvas_element"),canvasElement.toBlob(function(blob){var ext,file,file_name,filesToUpload,parts;return-1===imageName.indexOf(".")?blob.name=imageName+"_edited":(parts=imageName.split("."),ext=parts.splice(-1).join(),file_name=parts.join("."),blob.name=file_name+"_edited."+ext,blob.size||(blob.size=0)),file={uploadFn:tabs["private"].getAdapter().item.upload,source:{file:blob,name:blob.name,size:blob.size,folderId:folder.id,folderName:folder.name,mediaType:settings.mediaType,tags:["edited"]}},filesToUpload=wixmp.Uploader.upload([file]),_.last(filesToUpload).deferred.promise.then(function(res){return editor.close(),res}),$rootScope.$apply()},null!=(ref=isJpeg(imageName))?ref:{"image/jpeg":"image/png"})},callback=function(){var image;return image=new Image,image.src=url,editor.launch({url:url,image:image,onSaveButtonClicked:onAviarySaveButtonClick})},editor?callback():editor=new window.Aviary.Feather({apiKey:"57b23071b",apiVersion:3,tools:"crop,orientation,enhance,effects,frames,brightness,contrast,saturation,warmth,focus,sharpness,draw,redeye,whiten,blemish,stickers,text",theme:"minimum",maxSize:1500,displayImageSize:!0,onSave:onAviarySave,onError:onAviaryError,language:i18n.getLang(),launchDelay:0,onLoad:callback})}}})}.call(this),function(){this.app.factory("bigStockPayment",function($q,$rootScope,tabs,settings){var getBoughtImage;return getBoughtImage=function(id,maxTryCount,tryCount){return null==maxTryCount&&(maxTryCount=5),null==tryCount&&(tryCount=0),tryCount++,tryCount>maxTryCount?$q.reject():tabs["private"].getAdapter().items.searchByTag("_bigstock_"+id).then(function(result){var items;return items=result.data,items.length?items[0]:getBoughtImage(id,maxTryCount,tryCount)},function(){return getBoughtImage(id,maxTryCount,tryCount)})},{buyImage:function(item){var deferred,popup;return deferred=$q.defer(),popup=window.open(settings.bigStockPaymentAPI+"/services/bigstock/start_purchase?image_id="+item.id+"&size_code=l","purchase","width=1000,height=550,scrollbars=1"),popup.blur(),window.focus(),getBoughtImage(item.id,1).then(function(){return popup.close(),deferred.resolve({success:!0})},function(){var isCompleted;return popup.focus(),isCompleted=!1,window.processPayment=function(data){return null==data&&(data={}),isCompleted?void 0:$rootScope.$apply(function(){return isCompleted=!0,"string"==typeof data&&(data=JSON.parse(data)),data.success?deferred.resolve(data):deferred.reject(data)})},window.addEventListener("message",function(event){return window.debug&&console.log(event),/premium\./i.test(event.origin)?window.processPayment(event.data):void 0},!1)}),deferred.promise},getBoughtImage:function(itemOrId){return getBoughtImage((null!=itemOrId?itemOrId.id:void 0)||itemOrId)}}})}.call(this),function(){"use strict";this.app.factory("submitItems",function(settings,editorConnection,path){var filterDomain,filterFileUrl;return filterDomain=function(string){var regexp;return regexp=/(http:\/\/[^\/]+\/)/i,string.replace(regexp,"")},filterFileUrl=function(fileUrl){return fileUrl.replace(/.*\//,"")},function(items){var result;return result={path:path.getFull(),items:_.map(items,function(item){var mapped,preview,ref;return mapped={mediaType:item.mediaType,fileName:filterFileUrl(item.fileUrl),uri:filterFileUrl(item.fileUrl),fileUrl:item.fileUrl,title:item.name},"picture"!==mapped.mediaType&&"swf"!==item.mediaType||(mapped.width=item.width,mapped.height=item.height),"secure_music"===item.mediaType&&(mapped.sampleUrl=item.sampleUrl),item.fileInput&&(mapped.fileInput=item.fileInput),item.fileOutput&&(mapped.fileOutput=item.fileOutput),item.labels&&(mapped.labels=item.labels),item.vendor&&(mapped.vendor=item.vendor),item.creator&&(mapped.creator=item.creator),item.reference&&(mapped.reference=item.reference),"secure_music"===item.mediaType&&(preview=_.find(null!=(ref=item.fileOutput)?ref.audio:void 0,function(audio){return"preview"===audio.tag}),mapped.previewFileName=null!=preview?preview.url.replace(/.*\//,""):void 0),"video"===item.mediaType&&(mapped.fileBaseUrl=item.fileUrl.split("/").slice(0,2).join("/")),_.forEach(settings.additionalItemAttributes,function(attrName){return null==mapped[attrName]?mapped[attrName]=/Url/i.test(attrName)?filterDomain(item[attrName]):item[attrName]:void 0}),mapped})},editorConnection.emit("items",result)}})}.call(this),function(){var extendDeep;extendDeep=function(obj,data){return _.assign(obj,data,function(value,newValue){return"object"!=typeof newValue||null===newValue||newValue instanceof Array?newValue:extendDeep(value||{},newValue)})},this.app.value("extendDeep",extendDeep)}.call(this),function(){this.app.factory("RejectError",function(){var RejectError;return RejectError=function(){function RejectError(data,caller){this.caller=caller,"string"==typeof data&&(data={message:data}),_.assign(this,data)}return RejectError.prototype.toString=function(){return null!=this.caller?this.caller+": "+this.message:this.message},RejectError}(),_.assign(RejectError,{alreadyLoading:{code:-400,message:"Already loading"},tooShortCallInterval:{code:-401,message:"Too short call interval"},cantLoadMore:{code:-402,message:"No entities for load more"},noMethod:{code:-403,message:"Method is undefined or misspelled"},invalidFileSize:{code:-404,message:"Invalid file size"},noActionSubject:{code:-405,message:"No action subject"}})})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};this.app.factory("LoadingHelper",function(){var LoadingHelper;return LoadingHelper=function(){function LoadingHelper(obj,options){this.obj=obj,this.attach=bind(this.attach,this),this.loadTimeout=null,_.assign(this.options,options),this.obj[this.options.attributeName]===!1}return LoadingHelper.prototype.options={minLoadInterval:1e3,attributeName:"isLoading"},LoadingHelper.prototype.isDeniedByInterval=function(){return null!=this.loadTimeout},LoadingHelper.prototype.attach=function(promise){return this.loadTimeout=setTimeout(function(_this){return function(){return _this.loadTimeout=null}}(this),this.options.minLoadInterval),this.obj[this.options.attributeName]=!0,promise["finally"](function(_this){return function(){return _this.obj[_this.options.attributeName]=!1}}(this))},LoadingHelper}()})}.call(this),function(){this.app.factory("serviceRedirectUrl",function($location){return function(){return $location.absUrl().replace($location.url(),"").replace(/\/[^\/]+?$/,"/service_connected.html")}})}.call(this),function(){this.app.constant("getThumbnailsSizes",function(){return window.devicePixelRatio>1.5?{thumbnail:{width:440,height:440,mode:"fill"},preview:{width:750,height:750,mode:"fit"}}:{thumbnail:{width:220,height:220,mode:"fill"},preview:{width:375,height:375,mode:"fit"}}})}.call(this),function(){this.app.value("nestedMethod",{get:function(obj,namespace){var method;return method=obj,_.forEach(namespace.split("."),function(ns){return method=method[ns],null==method?!1:void 0}),method},set:function(obj,namespace,method){var nsList,originalMethod;return originalMethod=obj,nsList=namespace.split("."),_.forEach(nsList,function(ns,index){return originalMethod[ns]||(originalMethod[ns]={}),index===nsList.length-1?originalMethod[ns]=method:originalMethod=originalMethod[ns]}),obj}})}.call(this),function(){this.app.factory("paginatedItemsListLoader",function(getThumbnailsSizes,$q,RejectError){return function(adapter,getParentFolder,getSortOptions){var getOptions,paging;return paging=null,getOptions=function(){return _.assign({thumbnails:getThumbnailsSizes(),paging:paging},"function"==typeof getSortOptions?getSortOptions():void 0)},function(isFirstPage){var parentFolder,promise;return isFirstPage||(null!=paging?paging.cursor:void 0)?(isFirstPage&&(paging=null),parentFolder="function"==typeof getParentFolder?getParentFolder():void 0,promise=parentFolder?getParentFolder().itemsList(getOptions()):adapter.items.list(null,getOptions()),promise.then(function(list){return paging=list.paging,list})):$q.reject(new RejectError(RejectError.cantLoadMore,"EntitiesCtrl"))}}})}.call(this),function(){this.app.factory("paginatedItemsSearchLoader",function(getThumbnailsSizes,$q,RejectError){return function(adapter,getParentFolder,getSortOptions){var getOptions,paging;return paging=null,getOptions=function(){return _.assign({thumbnails:getThumbnailsSizes(),paging:paging},"function"==typeof getSortOptions?getSortOptions():void 0)},function(query,isFirstPage){var parentFolder,promise;return isFirstPage||(null!=paging?paging.cursor:void 0)?(isFirstPage&&(paging=null),parentFolder="function"==typeof getParentFolder?getParentFolder():void 0,promise=parentFolder?getParentFolder().itemsSearch(query,getOptions()):adapter.items.search(null,query,getOptions()),promise.then(function(list){return paging=list.paging,list})):$q.reject(new RejectError(RejectError.cantLoadMore,"EntitiesCtrl"))}}})}.call(this),function(){this.app.value("supportedDocsTypes",["doc","docx","odp","odt","pdf","ppt","pptx","xls","xlsx"])}.call(this),function(){"use strict";this.app.constant("productionSettings",{baseHost:"wix.com",windowStyle:"fullscreen",showTabs:!0,submitItems:!0,selectionType:"multiple",mediaType:"picture",publicMediaRoot:"photos",i18nCode:"en",i18nPrefix:"",translations:{},cssUrl:"",hasPurchased:!1,hasFavorites:!1,hasSubfolders:!1,hasTrash:!1,canSubmitUntranscoded:!1,canShowUploadButtonPopup:!1,mp4PreviewsOnly:!0,useFastTranscoding:!1,mdode:"production",tabsList:["private","external","public","photoStock"],servicesList:["facebook","instagram","drive","flickr","picasa","flickrSearch","googleSearch"],additionalItemAttributes:[],path:"",collectionId:"",imageOperationsApi:"vanbrandt",privateMediaRestFiles:"//static.wixstatic.com",privateMediaRestVideoFiles:"//video.wixstatic.com",publicMediaRestFiles:"//static.wixstatic.com",publicMediaRestVideoFiles:"//video.wixstatic.com",privateMediaRestAPI:"https://files.wix.com",publicMediaRestAPI:"https://publicmedia.wix.com/public",bigStockPaymentAPI:"https://pix.wix.com",bigStockSearchAPI:"https://pix.wix.com/services/bigstock",bigStockPriceUrl:"/_api/wix/digitalGoodsPriceQuote?digitalGoodsSkuGuid=31396262-3737-3438-2d31-3131312d3434",collectionsAPI:"//collections.wixstatic.com/collections",videoEncodingProfile:"mp4-only"})}.call(this),function(){"use strict";this.app.constant("testSettings",{baseHost:"ten.wixpress.com",windowStyle:"fullscreen",showTabs:!0,submitItems:!0,selectionType:"multiple",mediaType:"picture",publicMediaRoot:"photos",i18nCode:"en",i18nPrefix:"",translations:{},cssUrl:"",hasPurchased:!1,hasFavorites:!1,hasSubfolders:!1,hasTrash:!1,canSubmitUntranscoded:!1,canShowUploadButtonPopup:!0,mp4PreviewsOnly:!0,useFastTranscoding:!1,mdode:"test",tabsList:["private","external","public","photoStock","externalSearch","collection"],servicesList:["facebook","instagram","dropbox","drive","flickr","picasa","flickrSearch","googleSearch"],additionalItemAttributes:[],path:"",collectionId:"",imageOperationsApi:"vangogh",privateMediaRestFiles:"//static.{baseHost}",privateMediaRestVideoFiles:"//video.{baseHost}",publicMediaRestFiles:"//static.{baseHost}",publicMediaRestVideoFiles:"//video-dev.{baseHost}",privateMediaRestAPI:"https://files.{baseHost}",publicMediaRestAPI:"https://publicmedia.{baseHost}/public",bigStockPaymentAPI:"https://pix.wix.com",bigStockSearchAPI:"https://pix.wix.com/services/bigstock",collectionsAPI:"//collections.wixstatic.com/collections",videoEncodingProfile:"mp4-only"})}.call(this),function(){"use strict";this.app.factory("getDefaultSettings",function(productionSettings,testSettings){var baseHostRule;return baseHostRule=/\{baseHost\}/i,function(baseHost){var defaultSettings;return null==baseHost&&(baseHost=""),defaultSettings=/\.wixpress\.com/i.test(baseHost)?testSettings:productionSettings,_.forEach(defaultSettings,function(value,key){return"string"==typeof value&&baseHostRule.test(value)&&(defaultSettings[key]=value.replace(baseHostRule,baseHost)),!0}),defaultSettings}})}.call(this),function(){this.app.constant("deprecatedSettings",["canShowTabs","canShowSelectButton","showSelectButton"])}.call(this),function(){"use strict";this.app.constant("supportedMediaTypes",["picture","watermark","document","ufont","site_icon","swf","music","video","secure_picture","secure_music","secure_video"])}.call(this),function(){"use strict";this.app.constant("supportedPublicMediaRoots",["backgrounds","clipart","file_icons","icons","photos","watermarks","shapes","social_icons","video"])}.call(this),function(){"use strict";this.app.constant("supportedExternalServices",["facebook","picasa","instagram","flickr","drive","dropbox"])}.call(this),function(){"use strict";this.app.constant("supportedExternalSearchServices",["googleSearch","flickrSearch"])}.call(this),function(){"use strict";this.app.value("settings",{}),this.app.factory("Settings",function(_this){return function($rootScope,$q,getDefaultSettings,editorConnection,$state,$stateParams,settings,tabs,path){var deferred,logger,prepare,redirectToPathOrFirstTab,reload;return logger=new Logger("Settings"),redirectToPathOrFirstTab=function(currentPath){var splittedPath,tabToShow;return splittedPath=currentPath.split("/"),tabToShow=tabs[splittedPath[0]],(null!=tabToShow?tabToShow.canShow():void 0)||(tabToShow=_.find(tabs,function(tab){return tab.canShow()})),tabToShow?($state.transitionTo(tabToShow.state,$stateParams,{reload:!0,inherit:!1,notify:!0,location:"replace"}),path.setFull(currentPath)):(console.error("Can not find any tab to show."),console.warn(settings))},prepare=function(newSettings){var defaultSettings,set;return defaultSettings=getDefaultSettings(newSettings.baseHost),set=_.assign(_.clone(defaultSettings),newSettings,function(defaultOption,currentOption){return _.isUndefined(currentOption)||_.isNull(currentOption)||""===currentOption?defaultOption:currentOption}),_.isString(set.tabsList)&&(set.tabsList=set.tabsList.split(",")),_.isString(set.servicesList)&&(set.servicesList=set.servicesList.split(",")),null!=newSettings.publicMediaFile&&(set.publicMediaRoot=newSettings.publicMediaFile),"default"===set.publicMediaRoot&&(set.publicMediaRoot=defaultSettings.publicMediaRoot),null!=newSettings.canShowTabs&&(set.showTabs=newSettings.canShowTabs),null!=newSettings.canShowSelectButton&&(set.submitItems=newSettings.canShowSelectButton),null!=newSettings.showSelectButton&&(set.submitItems=newSettings.showSelectButton),_.isString(newSettings.translations)&&newSettings.translations&&(set.translations=JSON.parse(newSettings.translations)),_.forEach(set,function(val,key){return"true"===val&&(set[key]=!0),"false"===val?set[key]=!1:void 0}),set},deferred=$q.defer(),reload=function(set){return logger.log("New settings received",set),_this.appLoadNotifiers.settingsReceivedFromProtocol(),set=prepare(set),_.forEach(set,function(value,key){return settings[key]=value,!0}),deferred.resolve(settings),logger.log("Settings was set",settings),redirectToPathOrFirstTab(settings.path)},editorConnection.on("settings",reload),editorConnection.on("empty",function(){return $state.go("app.empty")}),{reload:reload,isLoaded:deferred.promise}}}(this))}.call(this),function(){"use strict";this.app.constant("BIEventsIds",{uiEvent:134,imageLoadSpeed:143})}.call(this),function(){"use strict";this.app.service("biUiEvents",function(biReport,settings,path){return function(eventName,options){return options.eventName=eventName,options.mediaType=settings.mediaType,options.i18nCode=settings.i18nCode,options.publicMediaRoot=settings.publicMediaRoot,options.path||(options.path=path.getFull()),biReport("uiEvent",options)}})}.call(this),function(){"use strict";this.app.service("biReport",function(_this){return function(BIEventsIds){return function(eventName,data){var image;return data=_.assign({evid:BIEventsIds[eventName]},data),image=new Image,image.src=_this.BIURL+"/mg?"+$.param(data)}}}(this))}.call(this),function(){"use strict";this.app.service("biSubscribeUpload",function(biReport){var filesToUpload,getCurrentTime,send,uploadSessionId,uploadStartTime;return filesToUpload=[],uploadStartTime=0,uploadSessionId=null,getCurrentTime=function(){return(new Date).getTime()},send=function(eventName,options){var data;return data={usi:uploadSessionId,did:window.siteID||window.sessionID,src:26},biReport(eventName,_.assign(data,options))},function(){return wixmp.Uploader.on("uploadQueueStarted",function(queue){return uploadSessionId=UUID.generate(),uploadStartTime=getCurrentTime(),filesToUpload=_.filter(queue,function(file){return"waiting"===file.status}),send("uploadQueueStarted",{files:filesToUpload.length,mode:"html5"})}),wixmp.Uploader.on("uploadQueueFinished",function(){var eventName,failsCount,speed,successBytes,uploadingTimeSec;return uploadingTimeSec=(getCurrentTime()-uploadStartTime)/1e3,1>uploadingTimeSec||(successBytes=_.sum(filesToUpload,function(fileToUpload){return"failed"!==fileToUpload.status?fileToUpload.source.file.size:0}),10240>successBytes)?void 0:(failsCount=_.sum(filesToUpload,function(fileToUpload){return"failed"===fileToUpload.status?1:0}),eventName=failsCount>0?"uploadQueueFail":"uploadQueueSuccess",speed=Math.floor(successBytes/uploadingTimeSec),0>=speed&&(speed=-1),send(eventName,{files:filesToUpload.length,errors:failsCount,speedBytesPerSecond:speed}))})}})}.call(this),function(){this.app.factory("biMeasureImageLoadSpeed",function(biReport,$http,settings){return function(){return $http.get("//collections.wixstatic.com/collections/931f1bd1-2757-447f-a581-34517630a80c.json",{withCredentials:!1}).then(function(res){var canMeasure,minResponseTimeMs,promise,ref,ref1,ref2,ref3,runTestPercent,start;return runTestPercent=(null!=(ref=res.data.collection)&&null!=(ref1=ref.public_properties)?ref1.run_test_percent:void 0)||10,canMeasure="debug"===settings.mode||/local(\.|host)/i.test(document.location.host)||100*Math.random()<runTestPercent,minResponseTimeMs=(null!=(ref2=res.data.collection)&&null!=(ref3=ref2.public_properties)?ref3.min_response_time_ms:void 0)||10,canMeasure?(start=null,promise=new Promise(function(resolve){return start=resolve}),_.forEach(_.shuffle(res.data.collection.items),function(item){var headers,iframeUrl,ref4,sever,url;return(url=item.public_properties.url)?(headers=null!=(ref4=item.public_properties)?ref4.headers:void 0,sever=/^((https?:)?\/\/[^\/]+)/i.exec(url)[1],iframeUrl=item.public_properties.iframe_url||sever+"/image_load_speed_v3.html",promise=promise.then(function(){var $iframe,connection;return $iframe=$("<iframe>"),$iframe.css({display:"none"
}),$iframe.prop({src:iframeUrl}),$iframe.appendTo("body"),connection=new WindowMessenger($iframe[0].contentWindow),connection.on("loadSpeed.readyForRequest",function(){return connection.emit("loadSpeed.measure",{url:url,headers:headers})}),connection.on("loadSpeed.result",function(data){var biData,getHeaderValue,hasHeader,ref5,response_size,response_speed,response_time_ms;if(data.options.url===url&&!(data.responseTimeMS<minResponseTimeMs)&&data.isSuccess&&200===data.responseCode&&(headers=data.responseHeaders.toLowerCase(),response_size=(null!=(ref5=headers.match(/content-length: ([0-9]+)/))?ref5[1]:void 0)||0,response_time_ms=data.responseTimeMS||0,response_speed=response_time_ms&&1e3*response_size/response_time_ms||0,!(1>response_size)))return biData={file_name:url,origin:"",cdn:"none",is_cache_hit:"false",response_size:response_size,response_time_ms:Math.round(response_time_ms),response_speed:Math.round(response_speed),description:JSON.stringify(headers)},getHeaderValue=function(headerName){var ref6;return null!=(ref6=new RegExp(headerName+": ?([^\n\r]+)").exec(headers))?ref6[1]:void 0},hasHeader=function(header){return headers.indexOf(header)>=0},hasHeader("x-goog-")?biData.origin="google":(hasHeader("x-amz-")||hasHeader("x-amz-"))&&(biData.origin="amazon"),hasHeader("age")&&hasHeader("\nvia: 1.1 google")?(biData.cdn="google",biData.is_cache_hit=+getHeaderValue("age")>0?"true":"false"):hasHeader("x-akamai-request-id")?(biData.cdn="akamai",biData.is_cache_hit=/hit/.test(getHeaderValue("x-cache"))||/hit/.test(getHeaderValue("x-cache-remote"))?"true":"false"):hasHeader("via: 1.1 varnish")?(biData.cdn="fastly",biData.is_cache_hit="hit"===getHeaderValue("x-cache")?"true":"false"):/cloudfront/i.test(getHeaderValue("via"))&&(biData.cdn="cloudfront",biData.is_cache_hit=/hit/.test(getHeaderValue("x-cache"))?"true":"false"),biReport("imageLoadSpeed",biData)})})):void 0}),start(),promise):void 0})}})}.call(this),function(){this.app.factory("bigstockPrice",function($q,$http,settings){return function(){var price,priceUrl;return(price=void 0)?$q.when(price):(priceUrl=settings.bigStockPriceUrl,$http.get(priceUrl+"&locale="+settings.i18nCode,{withCredentials:!1}).then(function(response){return price=response.data}))}})}.call(this),function(){this.app.factory("settingsPassedAdapter",function(editorConnection){var getLoader;return getLoader=function(name){return function(){var args,requestId;return requestId=_.uniqueId(),args=Array.prototype.slice.call(arguments),new Promise(function(resolve,reject){var onReject,onResolve,unsubscribe;return unsubscribe=function(){return editorConnection.off("adapter."+name+".resolve",onResolve),editorConnection.off("adapter."+name+".reject",onReject)},onResolve=function(data){return data.requestId===requestId?(unsubscribe(),resolve(data)):void 0},onReject=function(data){return data.requestId===requestId?(unsubscribe(),reject(data)):void 0},editorConnection.on("adapter."+name+".resolve",onResolve),editorConnection.on("adapter."+name+".reject",onReject),editorConnection.emit("adapter."+name,{requestId:requestId,arguments:args})})}},{name:"settingsPassed",folders:{list:getLoader("foldersList")},items:{list:getLoader("itemsList")}}})}.call(this),function(){"use strict";this.app.factory("wrapSource",function(settings,events,digest,defaultOptions,virtualActions,nestedFoldersList,allMediaFolder,favoritesFolder,trashFolder,unsortedFolder,purchasedFolder,canDoAction,wrapItems,wrapFolders,extendDeep){return function(source){var adapter;return adapter=_.cloneDeep(source),extendDeep(adapter,events.integrateSource(source)),extendDeep(adapter,defaultOptions(adapter)),extendDeep(adapter,virtualActions(adapter)),extendDeep(adapter,digest(adapter)),extendDeep(adapter,canDoAction(adapter)),extendDeep(adapter,unsortedFolder(adapter)),settings.hasSubfolders&&extendDeep(adapter,nestedFoldersList(adapter)),extendDeep(adapter,allMediaFolder(adapter)),settings.hasPurchased&&extendDeep(adapter,purchasedFolder(adapter)),settings.hasFavorites&&extendDeep(adapter,favoritesFolder(adapter)),settings.hasSubfolders&&settings.hasTrash&&extendDeep(adapter,trashFolder(adapter)),extendDeep(adapter,wrapItems(adapter)),extendDeep(adapter,wrapFolders(adapter))}})}.call(this),function(){"use strict";this.app.factory("appLoad",function(_this){return function(events){return{integrate:function(){return events.on(events.FOLDERS.LIST,function(){return _this.appLoadNotifiers.foldersLoaded()}),events.on(events.FOLDERS.TRASH.LIST,function(){return _this.appLoadNotifiers.foldersLoaded()}),events.on(events.ITEMS.LIST,function(){return _this.appLoadNotifiers.itemsLoaded()}),events.on(events.ITEMS.SEARCH,function(){return _this.appLoadNotifiers.itemsLoaded()})}}}}(this))}.call(this),function(){"use strict";this.app.factory("canDoAction",function(settings){return function(adapter){return{can:{items:{list:function(){var ref;return null!=(ref=adapter.items)?ref.hasOwnProperty("list"):void 0},search:function(){var ref;return null!=(ref=adapter.items)?ref.hasOwnProperty("search"):void 0},remove:function(){var ref;return null!=(ref=adapter.items)?ref.hasOwnProperty("remove"):void 0},restore:function(){var ref,ref1;return settings.hasTrash&&(null!=(ref=adapter.items)&&null!=(ref1=ref.trash)?ref1.hasOwnProperty("restore"):void 0)},removeFromTrash:function(){var ref,ref1;return settings.hasTrash&&(null!=(ref=adapter.items)&&null!=(ref1=ref.trash)?ref1.hasOwnProperty("remove"):void 0)}},folders:{remove:function(){var ref;return null!=(ref=adapter.folders)?ref.hasOwnProperty("remove"):void 0},removeFromTrash:function(){var ref,ref1;return settings.hasTrash&&(null!=(ref=adapter.folders)&&null!=(ref1=ref.trash)?ref1.hasOwnProperty("remove"):void 0)},restore:function(){var ref,ref1;return settings.hasTrash&&(null!=(ref=adapter.folders)&&null!=(ref1=ref.trash)?ref1.hasOwnProperty("restore"):void 0)}},folder:{create:function(){var ref;return null!=(ref=adapter.folder)?ref.hasOwnProperty("create"):void 0},rename:function(){var ref;return null!=(ref=adapter.folder)?ref.hasOwnProperty("update"):void 0},move:function(){var ref;return settings.hasSubfolders&&(null!=(ref=adapter.folder)?ref.hasOwnProperty("update"):void 0)}},item:{upload:function(){var ref;return null!=(ref=adapter.item)?ref.hasOwnProperty("upload"):void 0},uploadByUrl:function(){var ref;return null!=(ref=adapter.item)?ref.hasOwnProperty("uploadByUrl"):void 0},rename:function(){var ref;return null!=(ref=adapter.item)?ref.hasOwnProperty("update"):void 0},move:function(){var ref;return null!=(ref=adapter.item)?ref.hasOwnProperty("update"):void 0},makeFavorites:function(){var ref;return settings.hasFavorites&&(null!=(ref=adapter.item)?ref.hasOwnProperty("makeFavorites"):void 0)},transcode:function(){return _.includes(["secure_music","video"],settings.mediaType)&&adapter.hasOwnProperty("channel")},getDownloadLink:function(){return"private"===adapter.name}}}}}})}.call(this),function(){"use strict";this.app.factory("digest",function($q,nestedMethod){return function(adapter){var addDigest,eventNames,getEventNames,methodsWithDigest;return getEventNames=function(obj,eventsNames){return null==eventsNames&&(eventsNames=[]),_.forEach(obj,function(eventName){return"string"==typeof eventName?eventsNames.push(eventName):getEventNames(eventName,eventsNames)}),eventsNames},addDigest=function(promise){return _.isArray(promise)?_.forEach(promise,function(promise){return $q.when(promise)}):$q.when(promise),promise},methodsWithDigest={},eventNames=getEventNames(adapter.events),_.forEach(eventNames,function(eventName){var method;return adapter.events.on(eventName,addDigest),method=nestedMethod.get(adapter,eventName),"function"==typeof method?nestedMethod.set(methodsWithDigest,eventName,function(){var promise;return promise=method.apply(this,arguments),addDigest(promise)}):void 0}),methodsWithDigest}})}.call(this),function(){"use strict";this.app.factory("events",function(_this){return function($q){var addListener,callListeners,eventsList,globalListeners,integrateSource,logEvent,logger;return wixmp.bi(!0,{siteId:siteId}),logger=new _this.Logger("EVENTS"),logEvent=function(promises,event){var promisesList;return logger.log(event.eventTarget.name+"."+event.eventName+" emited",event.arguments),promisesList=_.isArray(promises)?promises:[promises],_.forEach(promisesList,function(promise){return promise.then(function(res){return logger.log(event.eventTarget.name+"."+event.eventName+" succeed",res),res},function(res){return logger.log(event.eventTarget.name+"."+event.eventName+" failed",res),res})}),promises},globalListeners=[],eventsList=_.cloneDeep(wixmp.events),eventsList.FOLDER.RENAME="folder.rename",eventsList.FOLDER.MOVE="folder.move",eventsList.ITEM.RENAME="item.rename",eventsList.ITEM.MOVE="item.move",eventsList.ITEM.MAKE_FAVORITES="item.makeFavorites",eventsList.ITEM.UMMAKE_FAVORITES="item.unmakeFavorites",callListeners=function(listeners,promise,event,wrap){return null==wrap&&(wrap=!0),_.forEach(listeners,function(listener){return wrap?_.isArray(promise)?listener(_.map(promise,$q.when),_.clone(event)):listener($q.when(promise),_.clone(event)):listener(promise,event)})},addListener=function(listeners,eventsNames,fn){return _.isString(eventsNames)&&(eventsNames=[eventsNames]),_.forEach(eventsNames,function(eventName){return listeners[eventName]||(listeners[eventName]=[]),listeners[eventName].push(fn)})},integrateSource=function(source){var emit,emitOnAddTag,emitOnAttrChanged,emitOnRemoveTag,getEventNames,onCurrentSource,sourceInterceptors,sourceListeners;return sourceListeners=[],sourceInterceptors=[],onCurrentSource=function(eventName,fn){return wixmp.events.on(eventName,function(promise,event){return event.eventTarget===source?fn.apply(this,arguments):void 0})},emit=function(promise,event){return logEvent(promise,event),callListeners(sourceInterceptors[event.eventName],promise,event,!1),callListeners(sourceListeners[event.eventName],promise,event),callListeners(globalListeners[event.eventName],promise,event)},emitOnAttrChanged=function(attrName,newEventName,promise,event){var changes,newEvent,original;return original=event.arguments[0],changes=event.arguments[1],null!=changes[attrName]&&original[attrName]!==changes[attrName]?(newEvent=_.assign({},event,{eventName:newEventName}),emit.call(this,promise,newEvent)):void 0},emitOnAddTag=function(tagName,newEventName,promise,event){var changes,newEvent,originalData;return originalData=event.arguments[0],changes=event.arguments[1],!_.includes(originalData.tags||[],tagName)&&_.includes(changes.tags||[],tagName)?(newEvent=_.assign({},event,{eventName:newEventName}),emit.call(this,promise,newEvent)):void 0},emitOnRemoveTag=function(tagName,newEventName,promise,event){var changes,newEvent,originalData;return originalData=event.arguments[0],changes=event.arguments[1],_.includes(originalData.tags||[],tagName)&&!_.includes(changes.tags||[],tagName)?(newEvent=_.assign({},event,{eventName:newEventName}),emit.call(this,promise,newEvent)):void 0},getEventNames=function(obj,eventsNames){return null==eventsNames&&(eventsNames=[]),_.forEach(obj,function(eventName){return"string"==typeof eventName?eventsNames.push(eventName):getEventNames(eventName,eventsNames)}),eventsNames},_.forEach(getEventNames(wixmp.events),function(eventName){return onCurrentSource(eventName,emit)}),onCurrentSource(wixmp.events.FOLDER.UPDATE,_.partial(emitOnAttrChanged,"name",eventsList.FOLDER.RENAME)),onCurrentSource(wixmp.events.ITEM.UPDATE,_.partial(emitOnAttrChanged,"name",eventsList.ITEM.RENAME)),onCurrentSource(wixmp.events.FOLDER.UPDATE,_.partial(emitOnAttrChanged,"parentId",eventsList.FOLDER.MOVE)),onCurrentSource(wixmp.events.ITEM.UPDATE,_.partial(emitOnAttrChanged,"folderId",eventsList.ITEM.MOVE)),onCurrentSource(wixmp.events.ITEM.UPDATE,_.partial(emitOnAddTag,"_favorites",eventsList.ITEM.MAKE_FAVORITES)),onCurrentSource(wixmp.events.ITEM.UPDATE,_.partial(emitOnRemoveTag,"_favorites",eventsList.ITEM.UMMAKE_FAVORITES)),{events:_.assign({},eventsList,{on:_.partial(addListener,sourceListeners),intercept:_.partial(addListener,sourceInterceptors)})}},_.assign({},eventsList,{integrateSource:integrateSource,on:_.partial(addListener,globalListeners)})}}(this))}.call(this),function(){"use strict";this.app.factory("Folder",function(modelsMethodsWrappers,extendDeep,settings){var $$,Folder;return $$=modelsMethodsWrappers,Folder=function(){function Folder(adapter,data){var foldersList,foldersListAtTrash,itemsList,itemsListAtTrash,ref,ref1,remove,removeFromTrash;Object.defineProperty(this,"_isProcessing",{writable:!0,value:!1}),this.can={rename:function(_this){return function(){return!_this.isInTrash&&adapter.can.folder.rename()}}(this),moveItemIn:function(_this){return function(){return!_this.isInTrash&&adapter.can.item.move()}}(this),moveFolderIn:function(_this){return function(){return!_this.isInTrash&&adapter.can.folder.move()}}(this),uploadIn:function(_this){return function(){return!_this.isInTrash&&adapter.can.item.upload()}}(this),select:function(_this){return function(){return adapter.can.folder.move()}}(this),submit:function(_this){return function(){return!1}}(this),move:function(_this){return function(){return!_this.isInTrash&&adapter.can.folder.move()}}(this),restore:function(_this){return function(){return adapter.can.folders.restore()&&_this.isInTrash}}(this),remove:function(_this){return function(){return _this.isInTrash?adapter.can.folders.removeFromTrash():adapter.can.folders.remove()}}(this)},extendDeep(this,data),this.mediaType||(this.mediaType=settings.mediaType),null!=this.thumbnailUrl&&0!==this.filesCount||(this.thumbnailUrl="images/thumbnails/subfolder.svg"),this.rename||(this.rename=$$.partialIfExists(adapter,"folder.rename",this.id)),this.restore||(this.restore=$$.partialIfExists(adapter,"folders.trash.restore",[this.id])),remove=$$.partialIfExists(adapter,"folders.remove",[this.id]),removeFromTrash=$$.partialIfExists(adapter,"folders.trash.remove",[this.id]),this.remove||(this.remove=function(_this){return function(){return _this.isInTrash?removeFromTrash.apply(_this,arguments):remove.apply(_this,arguments)}}(this)),null!=(null!=(ref=adapter.item)?ref.move:void 0)&&(this.moveItemIn||(this.moveItemIn=function(_this){return function(item){return adapter.item.move(item,_this.id)}}(this))),null!=(null!=(ref1=adapter.folder)?ref1.move:void 0)&&(this.moveFolderIn||(this.moveFolderIn=function(_this){return function(folder){return adapter.folder.move(folder,_this.id)}}(this))),foldersList=$$.partialIfExists(adapter,"folders.list",this.id),foldersListAtTrash=$$.partialIfExists(adapter,"folders.trash.list",this.id),this.foldersList||(this.foldersList=function(_this){return function(){return _this.isInTrash?foldersListAtTrash.apply(_this,arguments):foldersList.apply(_this,arguments)}}(this)),itemsList=$$.partialIfExists(adapter,"items.list",this.id),itemsListAtTrash=$$.partialIfExists(adapter,"items.trash.list",this.id),this.itemsList||(this.itemsList=function(_this){return function(){return _this.isInTrash?itemsListAtTrash.apply(_this,arguments):itemsList.apply(_this,arguments)}}(this)),this.itemsSearch||(this.itemsSearch=$$.partialIfExists(adapter,"items.search",this.id)),_.forEach(["rename","remove"],function(_this){return function(actionName){return _this.can[actionName]=$$.disableAtProcessing(_this,_this.can[actionName])}}(this))}return Folder}()}),this.app.factory("wrapFolders",function(Folder,nestedMethod){return function(adapter){var folderCreate,foldersList,mapFolder,mapFoldersList,methods,ref,ref1,ref2,ref3,trashList;return mapFolder=function(res){return res.data=new Folder(adapter,res.data),res},mapFoldersList=function(list){return list.data=_.map(list.data,function(folderData){return new Folder(adapter,folderData)}),list},folderCreate=null!=(ref=adapter.folder)?ref.create:void 0,foldersList=null!=(ref1=adapter.folders)?ref1.list:void 0,trashList=null!=(ref2=adapter.folders)&&null!=(ref3=ref2.trash)?ref3.list:void 0,adapter.events.intercept([adapter.events.FOLDER.CREATE],function(promise){return promise.then(mapFolder)}),methods={},null!=folderCreate&&nestedMethod.set(methods,"folder.create",function(){return folderCreate.apply(this,arguments).then(mapFolder)}),null!=foldersList&&nestedMethod.set(methods,"folders.list",function(){return foldersList.apply(this,arguments).then(mapFoldersList)}),null!=trashList&&nestedMethod.set(methods,"folders.trash.list",function(){return trashList.apply(this,arguments).then(mapFoldersList)}),methods}})}.call(this),function(){"use strict";this.app.factory("Item",function(modelsMethodsWrappers,extendDeep,settings,NormalizeUri,itemThumbnailExtender){var $$,Item;return $$=modelsMethodsWrappers,Item=function(){function Item(adapter,data){var canBuy,canEdit,canGetDownloadLink,canShowImagePreview,canShowVideoPreview,canTranscode,isDownloadSupportedByApi,remove,removeFromTrash,untranscoded;Object.defineProperty(this,"_isProcessing",{writable:!0,value:!1}),isDownloadSupportedByApi=function(){return"rembrandt"!==settings.imageOperationsApi},canEdit=function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&isDownloadSupportedByApi()&&"private"===adapter.name&&_.includes(["picture","watermark","site_icon"],_this.mediaType)}}(this),canShowImagePreview=function(_this){return function(){return untranscoded()?!1:_.includes(["picture","watermark","site_icon","ufont","shape"],_this.mediaType)}}(this),canShowVideoPreview=function(_this){return function(){return untranscoded()?!1:_.includes(["video"],_this.mediaType)}}(this),canGetDownloadLink=function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&isDownloadSupportedByApi()&&adapter.can.item.getDownloadLink()&&!_.includes(["secure_music","video"],_this.mediaType)}}(this),canBuy=function(_this){return function(){return untranscoded()?!1:_.includes(["bigstock"],adapter.name)}}(this),untranscoded=function(_this){return function(){return _this.can.transcode()&&!_this.isTranscoded()}}(this),canTranscode=function(_this){return function(){return!_this.isInTrash&&adapter.can.item.transcode()&&null!=_this.transcodingStatus}}(this),this.can={rename:function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&adapter.can.item.rename()}}(this),move:function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&adapter.can.item.move()}}(this),makeFavorites:function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&settings.hasFavorites&&adapter.can.item.makeFavorites()}}(this),unmakeFavorites:function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&settings.hasFavorites&&adapter.can.item.makeFavorites()&&_this.isFavorites()}}(this),transcode:function(_this){return function(){return canTranscode()}}(this),submit:function(_this){return function(){return settings.submitItems&&!_this.isInTrash&&(canTranscode()?settings.canSubmitUntranscoded||"READY"===_this.transcodingStatus:!0)&&!_this._isProcessing}}(this),select:function(_this){return function(){return!0}}(this),restore:function(_this){return function(){return adapter.can.items.restore()&&!untranscoded()&&_this.isInTrash}}(this),remove:function(_this){return function(){return _this.isInTrash?adapter.can.items.removeFromTrash():adapter.can.items.remove()}}(this),edit:canEdit,showImagePreview:canShowImagePreview,showVideoPreview:canShowVideoPreview,getDownloadLink:canGetDownloadLink,buy:canBuy},extendDeep(this,data),this.mediaType||(this.mediaType=settings.mediaType),_.assign(this,itemThumbnailExtender(this));try{this.name=decodeURIComponent(this.name)}catch(undefined){}this.rename||(this.rename=$$.partialIfExists(adapter,"item.rename",this.id)),remove=$$.partialIfExists(adapter,"items.remove",[this.id]),removeFromTrash=$$.partialIfExists(adapter,"items.trash.remove",[this.id]),this.remove||(this.remove=function(_this){return function(){return _this.isInTrash?removeFromTrash.apply(_this,arguments):remove.apply(_this,arguments)}}(this)),this.restore||(this.restore=$$.partialIfExists(adapter,"items.trash.restore",[this.id])),this.makeFavorites||(this.makeFavorites=$$.partialIfExists(adapter,"item.makeFavorites",this)),this.unmakeFavorites||(this.unmakeFavorites=$$.partialIfExists(adapter,"item.unmakeFavorites",this)),this.getDownloadLink||(this.getDownloadLink=function(){var currentExtension,downloadName,getExtension,originalExtension;return getExtension=function(fileName){return/[^.]*$/.exec(fileName)[0]},originalExtension=getExtension(this.originalUrl),currentExtension=getExtension(this.name),downloadName=currentExtension===originalExtension?this.name:this.name+"."+originalExtension,NormalizeUri(settings.privateMediaRestFiles+"/"+this.fileUrl+"?dn="+downloadName)}),_.forEach(["rename","remove","move","edit","getDownloadLink"],function(_this){return function(actionName){return _this.can[actionName]=$$.disableAtProcessing(_this,_this.can[actionName])}}(this))}return Item.prototype.isFavorites=function(){return _.includes(this.tags,"_favorites")},Item.prototype.isTranscoded=function(){return"READY"===this.transcodingStatus},Item}()}),this.app.factory("wrapItems",function(Item,nestedMethod,itemThumbnailExtender){return function(adapter){var itemsList,itemsSearch,itemsSearchByTag,itemsTrashList,mapItem,mapItemsList,methods,ref,ref1,ref2,ref3,ref4,ref5,ref6,upload,uploadByUrl;return mapItem=function(res){return res.data=new Item(adapter,res.data),res},mapItemsList=function(res){return res.data=_.map(res.data,function(itemData){return new Item(adapter,itemData)}),res},adapter.events.intercept([adapter.events.ITEMS.UPLOAD,adapter.events.ITEMS.UPLOAD_BY_URL],function(promises){return _.map(promises,function(promise){return promise.then(mapItem)})}),adapter.events.intercept(adapter.events.ITEM.UPDATE,function(promise){return promise.then(function(res){return _.extend(res.data,itemThumbnailExtender(res.data)),res})}),upload=null!=(ref=adapter.item)?ref.upload:void 0,uploadByUrl=null!=(ref1=adapter.item)?ref1.uploadByUrl:void 0,itemsList=null!=(ref2=adapter.items)?ref2.list:void 0,itemsTrashList=null!=(ref3=adapter.items)&&null!=(ref4=ref3.trash)?ref4.list:void 0,itemsSearch=null!=(ref5=adapter.items)?ref5.search:void 0,itemsSearchByTag=null!=(ref6=adapter.items)?ref6.searchByTag:void 0,methods={},null!=upload&&nestedMethod.set(methods,"item.upload",function(){var promise,wrapped;return promise=upload.apply(this,arguments),wrapped=promise.then(mapItem),promise.progress(function(data){return wrapped.notify(data)}),wrapped}),null!=uploadByUrl&&nestedMethod.set(methods,"item.uploadByUrl",function(){return uploadByUrl.apply(this,arguments).then(mapItem)}),null!=itemsList&&nestedMethod.set(methods,"items.list",function(){return itemsList.apply(this,arguments).then(mapItemsList)}),null!=itemsTrashList&&nestedMethod.set(methods,"items.trash.list",function(){return itemsTrashList.apply(this,arguments).then(mapItemsList)}),null!=itemsSearch&&nestedMethod.set(methods,"items.search",function(){return itemsSearch.apply(this,arguments).then(mapItemsList)}),null!=itemsSearchByTag&&nestedMethod.set(methods,"items.searchByTag",function(){return itemsSearchByTag.apply(this,arguments).then(mapItemsList)}),methods}})}.call(this),function(){"use strict";this.app.factory("itemThumbnailExtender",function(settings,supportedDocsTypes){return function(item){var extension,extra,getDocumentExtension,ref;return getDocumentExtension=function(fileUrl){return fileUrl.split(".")<3?"":fileUrl.split(".").pop()},extra={},"swf"!==(ref=item.mediaType)&&"music"!==ref||(extra.thumbnailUrl="images/thumbnails/"+item.mediaType+".svg",extra.thumbnail2xUrl="images/thumbnails/"+item.mediaType+".svg"),"secure_music"===item.mediaType&&(extra.thumbnailUrl="images/thumbnails/music.svg",extra.thumbnail2xUrl="images/thumbnails/music.svg"),"document"===item.mediaType&&(extension=getDocumentExtension(item.fileUrl),_.contains(supportedDocsTypes,extension)&&(extra.thumbnailUrl="images/thumbnails/"+item.mediaType+"-"+extension+".svg",extra.thumbnail2xUrl="images/thumbnails/"+item.mediaType+"-"+extension+".svg")),"video"===item.mediaType&&(extra.fileOutput=item.fileOutput),"picture"===item.mediaType&&null===item.thumbnailUrl&&(extra.thumbnailUrl="images/thumbnails/Images.svg"),extra}})}.call(this),function(){var slice=[].slice;this.app.factory("modelsMethodsWrappers",function(nestedMethod){return{setProcessing:function(model,method){return function(){var promise;return model._isProcessing=!0,promise=method.apply(this,arguments),promise["finally"](function(){return model._isProcessing=!1})}},withModelUpdate:function(model,method){return function(){return method.apply(this,arguments).then(function(res){return _.assign(model,res.data)})}},disableAtProcessing:function(model,canAction){return function(){return!model._isProcessing&&canAction()}},partialIfExists:function(){var adapter,args,method,namespace;return adapter=arguments[0],namespace=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[],method=nestedMethod.get(adapter,namespace),null!=method?_.partial.apply(_,[method].concat(slice.call(args))):void 0}}})}.call(this),function(){"use strict";this.app.factory("virtualActions",function(){return function(adapter){var folderUpdate,itemUpdate,methods,ref,ref1;return folderUpdate=null!=(ref=adapter.folder)?ref.update:void 0,itemUpdate=null!=(ref1=adapter.item)?ref1.update:void 0,methods={},null!=folderUpdate&&(methods.folder={rename:function(folderId,newName){return folderUpdate({id:folderId},{name:newName})},move:function(folder,moveToFolderId){return folderUpdate({id:folder.id,parentId:folder.parentId},{parentId:moveToFolderId})}}),null!=itemUpdate&&(methods.item={rename:function(itemId,newName){return itemUpdate({id:itemId},{name:newName})},move:function(item,moveToFolderId){return itemUpdate({id:item.id,folderId:item.folderId},{folderId:moveToFolderId})},makeFavorites:function(item){var tagsArr;return tagsArr=Array.prototype.slice(item.tags||[]),tagsArr.push("_favorites"),tagsArr=_.uniq(tagsArr),itemUpdate({id:item.id,tags:item.tags},{tags:tagsArr})},unmakeFavorites:function(item){var tagsArr;return tagsArr=Array.prototype.slice(item.tags||[]),tagsArr=_.without(tagsArr,"_favorites"),itemUpdate({id:item.id,tags:item.tags},{tags:tagsArr})}}),methods}})}.call(this),function(){"use strict";this.app.factory("defaultOptions",function(settings,nestedMethod){return function(adapter){var extendArgument,language,mediaType,methods;return methods={},extendArgument=function(namespace,argumentIndex,geArg){var originalMethod;return(originalMethod=nestedMethod.get(adapter,namespace))?nestedMethod.set(methods,namespace,function(){var args;return args=Array.prototype.slice.call(arguments),_.isArray(args[argumentIndex])?args[argumentIndex]=_.map(args[argumentIndex],function(entity){return _.assign(geArg(),entity)}):args[argumentIndex]=_.assign(geArg(),args[argumentIndex]),originalMethod.apply(this,args)}):void 0},mediaType=function(){return{mediaType:settings.mediaType}},extendArgument("folders.list",1,mediaType),extendArgument("folders.trash.list",1,mediaType),extendArgument("folder.create",1,mediaType),extendArgument("items.list",1,mediaType),extendArgument("items.trash.list",1,mediaType),extendArgument("items.searchByTag",1,mediaType),extendArgument("items.search",2,mediaType),extendArgument("items.upload",0,mediaType),extendArgument("items.uploadByUrl",0,mediaType),"public"===adapter.name&&(language=function(){return{language:settings.i18nCode}},extendArgument("folders.list",1,language),extendArgument("items.list",1,language),extendArgument("items.search",2,language)),methods}})}.call(this),function(){"use strict";var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};this.app.factory("nestedFoldersList",function(nestedMethod){var filterResByParentId;return filterResByParentId=function(parentId,promise){return promise.then(function(res){var foldersIds,unsorted;return parentId||(unsorted=_.find(res.data,function(folder){return null===folder.parentId}),parentId=null!=unsorted?unsorted.id:void 0),parentId?res.data=_.filter(res.data,function(folder){return folder.parentId===parentId||folder===unsorted}):(foldersIds=_.pluck(res.data,"id"),_.remove(res.data,function(folder){return _.includes(foldersIds,folder.parentId)})),res})},function(adapter){var adaptersWithNestedSupport,foldersList,foldersTrashList,methods,ref,ref1,ref2,ref3;return adaptersWithNestedSupport=["private","drive","dropbox"],ref=adapter.name,indexOf.call(adaptersWithNestedSupport,ref)<0?{}:(adapter.events.intercept([adapter.events.FOLDERS.LIST],function(promise,event){var parentId;return parentId=event.arguments[0],filterResByParentId(parentId,promise)}),foldersList=null!=(ref1=adapter.folders)?ref1.list:void 0,foldersTrashList=null!=(ref2=adapter.folders)&&null!=(ref3=ref2.trash)?ref3.list:void 0,methods={},null!=foldersList&&nestedMethod.set(methods,"folders.list",function(parentId){var promise;return promise=foldersList.apply(this,arguments),filterResByParentId(parentId,promise)}),null!=foldersTrashList&&nestedMethod.set(methods,"folders.trash.list",function(parentId){var promise;return/^trash/i.test(parentId)&&(parentId=null),promise=foldersTrashList.apply(this,arguments),filterResByParentId(parentId,promise)}),methods)}})}.call(this),function(){this.app.factory("purchasedFolder",function(i18n,settings,$q,nestedMethod){return function(adapter){var foldersList,methods,ref;return"private"!==adapter.name?{}:(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.push({id:"purchased"+settings.mediaType,name:i18n.translate("private_media.purchased"),type:"purchased",isRoot:!0,mediaType:settings.mediaType,can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!1},moveFolderIn:function(){return!1},move:function(){return!1},uploadIn:function(){return!1}},foldersList:function(){return $q.when([])},itemsList:function(id,options){return null==options&&(options={}),adapter.items.searchByTag("_paid",options)}}),list)})}),methods)}})}.call(this),function(){this.app.factory("unsortedFolder",function(i18n,$q,nestedMethod,settings,Folder){var createUnsorted,makeUnsorted;return makeUnsorted=function(rootFolder,adapter){return rootFolder.name=i18n.translate(("private"===adapter.name?"private_media":adapter.name)+".unsorted"),rootFolder.isRoot=!0,rootFolder.type="unsorted",rootFolder.can={rename:function(){return!1},remove:function(){return!1},move:function(){return!1}},rootFolder.foldersList=function(){return $q.when([])},rootFolder},createUnsorted=function(adapter){var folder;return folder=new Folder(adapter,{id:null,virtualId:"unsorted_"+settings.mediaType,mediaType:settings.mediaType,parentId:null,createdAt:0}),makeUnsorted(folder,adapter)},function(adapter){var foldersList,methods,ref;return _.contains(["private","collection","settingsPassed"],adapter.name)?(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){var rootFolder;return parentId?list:(rootFolder=_.find(list.data,function(folder){return null===folder.parentId}),rootFolder&&"private"===adapter.name?(_.remove(list.data,rootFolder),list.data.unshift(makeUnsorted(rootFolder,adapter))):list.data.unshift(createUnsorted(adapter)),list)})}),methods):{}}})}.call(this),function(){this.app.factory("allMediaFolder",function(settings,Folder,i18n,$q,nestedMethod){var createAllMediaFolder;return createAllMediaFolder=function(adapter){return new Folder(adapter,{id:null,virtualId:"allMedia_"+settings.mediaType,mediaType:settings.mediaType,parentId:null,name:i18n.translate("private_media.all_media"),filesCount:0,createdAt:0,isRoot:!0,type:"allMedia",can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!1}},foldersList:function(){
return $q.when([])}})},function(adapter){var foldersList,methods,ref;return"private"!==adapter.name?{}:(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.unshift(createAllMediaFolder(adapter)),list)})}),methods)}})}.call(this),function(){this.app.factory("favoritesFolder",function(i18n,settings,$q,nestedMethod){return function(adapter){var foldersList,methods,ref;return"private"!==adapter.name?{}:(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.push({id:"favorites"+settings.mediaType,name:i18n.translate("private_media.favorites"),type:"favorites",isRoot:!0,mediaType:settings.mediaType,can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!0},moveFolderIn:function(){return!1},move:function(){return!1},uploadIn:function(){return!1}},foldersList:function(){return $q.when([])},itemsList:function(options){return null==options&&(options={}),adapter.items.searchByTag("_favorites",options)},moveItemIn:function(item){return adapter.item.makeFavorites(item)}}),list)})}),methods)}})}.call(this),function(){this.app.factory("trashFolder",function(i18n,settings,nestedMethod){return function(adapter){var foldersList,methods,ref,ref1;return"private"!==adapter.name||null==(null!=(ref=adapter.items)?ref.trash:void 0)?{}:(foldersList=null!=(ref1=adapter.folders)?ref1.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.push({id:"trash"+settings.mediaType,name:i18n.translate("private_media.trash"),type:"trash",isRoot:!0,mediaType:settings.mediaType,can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!0},move:function(){return!1},uploadIn:function(){return!1}},itemsList:function(options){return adapter.items.trash.list(null,options)},foldersList:function(options){return adapter.folders.trash.list(null,options)},moveItemIn:function(item){return item.remove()},moveFolderIn:function(folder){return folder.remove()}}),list)})}),methods)}})}.call(this),function(){this.appLoadNotifiers.appIsInitialized(),this.app.config(function(_this){return function($httpProvider,RestangularProvider){return $httpProvider.defaults.withCredentials=!0,$httpProvider.defaults.responseType="json",$httpProvider.interceptors.push("UrlSanitizeInterceptor"),RestangularProvider.setDefaultHeaders({"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}),RestangularProvider.setDefaultRequestParams("jsonp",{callback:"JSON_CALLBACK"}),RestangularProvider.setDefaultHttpFields({withCredentials:!0})}}(this)),this.appLoadNotifiers.componentsAreConfigured(),this.app.run(["editorConnection","appLoad","biSubscribeUpload",function(_this){return function(editorConnection,appLoad){return _this.appLoadNotifiers.appIsRunning(),appLoad.integrate(),editorConnection.emit("ready"),_this.appLoadNotifiers.sentReadyToProtocol()}}(this)])}.call(this);