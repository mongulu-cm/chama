define("popups/constants/closeButtons",[],function(){"use strict";return{ICON:"icon",ICON_TYPE:"wysiwyg.viewer.components.PopupCloseIconButton",TEXT:"text",TEXT_TYPE:"wysiwyg.viewer.components.PopupCloseTextButton"}}),define("popups/presets/closeButtons",["lodash","addPanelData","popups/constants/closeButtons"],function(a,b,c){"use strict";function e(d){var e=b.getSectionsByComponentType(c.ICON_TYPE,null,d),f=a.get(e,"0.props.items.0.structure");return f.layout=a.omit(f.layout,["x","y"]),f}function f(a,b){return b.addPanelStyleManager.getComponentThemeStyles(c.TEXT_TYPE,a.theme,a.components)}function g(b,d){var e=d.componentsDefaultData.getComponentDefault(c.TEXT_TYPE),g=a.first(f(b,d));return e.layout=e.panelLayout,e.style=g,delete e.panelLayout,e}var d={};return d[c.ICON_TYPE]=e,d[c.TEXT_TYPE]=g,d}),define("popups/actions/closeButtons",["lodash","util","popups/constants/closeButtons","popups/presets/closeButtons"],function(a,b,c,d){"use strict";function e(a,b){g(a,c.ICON_TYPE,{y:20,right:20},b)}function f(a,b){g(a,c.TEXT_TYPE,{center:0,bottom:20},b)}function g(a,b,c,e){var f=a.pages.popupPages.getCurrentPopup(),g=a.pages.popupPages.getCurrentMainContainer(),i=a.components.layout.get(g);i.width=Math.min(980,i.width);var j=h(d[b](a,e),i,c);a.components.add(g,j),a.history.add("added close "+b+" button to popup "+f.id)}function h(c,d,e){return a.defaults({layout:b.layoutUtils.convertAnyPositionToLeftTopPosition(a.assign({},c.layout,e),d)},c)}function i(a){k(a,c.ICON_TYPE)}function j(a){k(a,c.TEXT_TYPE)}function k(b,c){var d=b.pages.popupPages.getCurrentPopup(),e=b.components.get.byType(c,d);a.isEmpty(e)||(a.forEach(e,function(a){b.components.remove(a)}),b.history.add("removed close buttons from popup "+d.id))}return{addIconButton:e,addTextButton:f,removeIconButton:i,removeTextButton:j}}),define("popups/constants/openBehaviors",[],function(){"use strict";return{DESKTOP:1,MOBILE:2,DESKTOP_AND_MOBILE:3,FLAG_DESKTOP:"openInDesktop",FLAG_MOBILE:"openInMobile",ALL_PAGES:"masterPage",MASTER_PAGE:"masterPage",OPEN_DELAY_DEFAULT_VALUE:2,SITE_BEHAVIOR_TYPE:"site",LOAD_ACTION:"load",OPEN_POPUP_BEHAVIOR:"openPopup"}}),define("popups/queries/openBehaviors",["lodash","popups/constants/openBehaviors"],function(a,b){"use strict";function c(c,d){return a.isEmpty(c)?d.behaviors.getDefinition(b.OPEN_POPUP_BEHAVIOR):c[0]}function d(a,d){return c(a,d).params[b.FLAG_MOBILE]}function e(a,b){return c(a,b).params.delay}function f(a){var b=a.pages.popupPages.getCurrentPopupId();return a.pages.popupPages.getOpenBehaviorsForPopupWithId(b)}function g(c){return a.some(c,{pageId:b.MASTER_PAGE})}function h(b){return g(b)?!0:a.isEmpty(b)?!1:null}function i(b,c){return g(b)?c.pages.getPageIdList():a.map(b,"pageId")}return{isFirstPageVisitorLandsOn:h,isOpenInMobile:d,isMasterPageSelected:g,getCurrentOpenBehaviors:f,getSomeBehavior:c,getDelay:e,getDenormalizedSelectedPageIds:i}}),define("popups/mappers/behaviorsDefaults",["lodash","popups/queries/openBehaviors"],function(a,b){"use strict";return function(a){var c=b.getCurrentOpenBehaviors(a);return b.getSomeBehavior(c,a).params}}),define("popups/actions/openBehaviors",["lodash","popups/mappers/behaviorsDefaults","popups/constants/openBehaviors"],function(a,b,c){"use strict";function e(a){var c=b(a);f(a),m(a,a.pages.getPrimaryPageId(),a.pages.popupPages.getCurrentPopupId(),c)}function f(b){var c=b.pages.popupPages.getCurrentPopupId(),d=b.pages.popupPages.getOpenBehaviorsForPopupWithId(c);a.forEach(d,function(a){n(b,a.pageId,a.popupId)})}function g(e){var f=b(e),g=e.pages.popupPages.getCurrentPopupId(),h=e.pages.popupPages.getOpenBehaviorsForPopupWithId(g);a.some(h,d)||(a.forEach(h,function(a){n(e,a.pageId,a.popupId)}),m(e,c.MASTER_PAGE,g,f))}function h(c,e){var f=b(c),g=c.pages.popupPages.getCurrentPopupId(),h=c.pages.popupPages.getOpenBehaviorsForPopupWithId(g);a.some(h,d)||m(c,e,g,f)}function i(b,c){var e=b.pages.popupPages.getCurrentPopupId(),f=b.pages.popupPages.getOpenBehaviorsForPopupWithId(e),g=a.find(f,d);g?k(b,g,c):n(b,c,e)}function j(b,c){var d=b.pages.popupPages.getCurrentPopupId(),e=b.pages.popupPages.getOpenBehaviorsForPopupWithId(d);e.forEach(function(d){m(b,d.pageId,d.popupId,a.defaults({openInMobile:c},d.params))})}function k(b,d,e){var f=a.without(b.pages.getPageIdList(),e);n(b,c.MASTER_PAGE,d.popupId),f.forEach(function(a){m(b,a,d.popupId,d.params)})}function l(b,c){var d=b.pages.popupPages.getCurrentPopupId(),e=b.pages.popupPages.getOpenBehaviorsForPopupWithId(d);e.forEach(function(d){m(b,d.pageId,d.popupId,a.defaults({delay:c},d.params))})}function m(a,b,d,e){var f=a.components.get.byId(b),g=a.components.get.byId(d),h=a.actions.getDefinition(c.LOAD_ACTION),i=a.behaviors.getDefinition(c.OPEN_POPUP_BEHAVIOR);i.params=e,a.behaviors.update(f,h,g,i)}function n(a,b,d){var e=a.components.get.byId(b),f=a.components.get.byId(d),g=a.actions.getDefinition(c.LOAD_ACTION),h=a.behaviors.getDefinition(c.OPEN_POPUP_BEHAVIOR);a.behaviors.remove(e,g,f,h)}var d={pageId:c.MASTER_PAGE};return{assignOpenBehaviorOnlyToCurrentPage:e,removeOpenBehaviorFromAllPages:f,assignOpenBehaviorToAllPages:g,assignOpenBehaviorToPage:h,removeOpenBehaviorFromPage:i,changeOpenDelay:l,toggleLoadOnMobile:j}}),define("popups/queries/closeButtons",["lodash","popups/constants/closeButtons"],function(a,b){"use strict";function c(b,c,d){var e=d.components.get.byType(b,c);return!a.isEmpty(e)}return function(a,e){var f={};return f[b.ICON]=c(b.ICON_TYPE,a,e),f[b.TEXT]=c(b.TEXT_TYPE,a,e),{has:f}}}),define("popups/mappers/desktopPanel",["lodash","popups/queries/closeButtons","popups/queries/openBehaviors"],function(a,b,c){"use strict";return function(e){var f=e.pages.popupPages.getCurrentPopup(),g=e.pages.popupPages.getOpenBehaviorsForPopups(),h=a.filter(g,{popupId:f.id}),i=b(f,e);return{delay:c.getDelay(h,e),hasIconButton:i.has.icon,hasTextButton:i.has.text,isMasterPageSelected:c.isMasterPageSelected(h),selectedPageIds:a.map(h,"pageId")}}}),define("popups/mappers/mobilePanel",["popups/queries/openBehaviors"],function(a){"use strict";return function(c){var d=a.getCurrentOpenBehaviors(c);return{shouldOpenInMobile:a.isOpenInMobile(d,c)}}}),define("popups/mappers/pagesSelectorPanel",["popups/queries/openBehaviors"],function(a){"use strict";return function(c){var d=a.getCurrentOpenBehaviors(c);return{firstPageVisitorLandsOn:a.isFirstPageVisitorLandsOn(d),selectedPageIds:a.getDenormalizedSelectedPageIds(d,c)}}}),define("popups",["popups/actions/closeButtons","popups/actions/openBehaviors","popups/mappers/desktopPanel","popups/mappers/mobilePanel","popups/mappers/pagesSelectorPanel"],function(a,b,c,d,e){"use strict";return{actions:{closeButtons:a,openBehaviors:b},mappers:{desktopPanel:c,mobilePanel:d,pagesSelectorPanel:e}}});