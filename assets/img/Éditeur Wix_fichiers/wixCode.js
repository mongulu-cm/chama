define("wixCode/utils/wixCodeRemoteModelService",["lodash","RemoteModelInterface","utils"],function(a,b,c){"use strict";var d=function(d,e,f){var g=new b(void 0,f);return a.forEach(e,function(a){g.addComponent(a,c.widgetModel.getCompModel(d,a))},this),g},e=function(a,c){return new b(a,c)};return{generateRemoteModelInterface:d,createRemoteModelInterface:e}}),define("wixCode/widgets/RemoteWidgetHandlerProxy",["lodash","wixCode/utils/wixCodeRemoteModelService","core"],function(a,b,c){"use strict";function e(){for(;!a.isEmpty(this._messageQueue);){var b=this._messageQueue.shift();this._postMessageDelegate(this._wixCodeWidget,b)}this.hasQueuedMessages=!1}function f(a){this._postMessageDelegate&&this._wixCodeWidget.getIframe()?this.hasQueuedMessages?(this._messageQueue.push(a),e.call(this)):this._postMessageDelegate(this._wixCodeWidget,a):(this.hasQueuedMessages=!0,this._messageQueue.push(a))}function g(b,c,d,e){var f={data:"setCompData",props:"setCompProps",events:"addActionsAndBehaviors",layout:"updateCompLayout"};this._siteDAL[f[d]](c,e),a.isFunction(this._onUpdateCallback)&&this._onUpdateCallback()}function h(a,b,c){this._siteDAL=a.getDAL(),this._siteAPI=a,this._wixCodeWidget=b,this._postMessageDelegate=null,this._remoteModelInterfaces={},this._messageQueue=[],this._onUpdateCallback=c,this._initialized=!1,this._updatingWidget=!1}function i(b,c){return a.get(c,"pageId","").substr(1)||b.getSiteData().getMainPageId()}function j(a,b){return a.getSiteData().findDataOnMasterPageByPredicate(function(a){return a.pageUriSEO===b})}function k(a,b){return a.getSiteData().getDataByQuery(b,"masterPage")}function l(b){var c=a.get(b,"data.link");if(c&&("PageLink"===c.type||"AnchorLink"===c.type)){var d=i(this._siteAPI,c),e=j(this._siteAPI,d);if(c.pageId=e||k(this._siteAPI,d),this._siteAPI.getCurrentPageId()===c.pageId&&c.anchorDataId){var f=this.remoteModelInterface.getCompId(c.anchorDataId),g=this._siteDAL.getCompStructure(f).dataQuery;c.anchorDataId=this._siteAPI.getSiteData().getDataByQuery(g.substr(1),c.pageId.id)}}}var d={State:"stateChanged",Data:"dataChanged",Props:"propsChanged",Event:"registerEvent",Layout:"layoutChanged",Behavior:"executeBehavior"};return h.prototype.registerPostMessageDelegate=function(a){this._postMessageDelegate=a,e.call(this)},h.prototype.initWidgets=function(a,c,d){this.remoteModelInterface=b.generateRemoteModelInterface(this._siteDAL,c,g.bind(this)),this._initialized=!0;var e={intent:"WIX_CODE",type:"init_widgets",pageId:a,rmiArguments:{widgetInstanceId:d,widgetData:this.remoteModelInterface.toJson()}};this._sendOrQueueMessage(e)},h.prototype.stopWidget=function(a){var b={intent:"WIX_CODE",type:"terminate",widgetInstanceId:a};this._sendOrQueueMessage(b)},h.prototype.updateComponent=function(a){this._postMessageDelegate&&this._sendOrQueueMessage(a)},h.prototype.handleWidgetUpdate=function(a,b){if(this._initialized&&!this._updatingWidget){this.remoteModelInterface.updateModel(b);var c={intent:"WIX_CODE",type:"update",widgetInstanceId:a,updates:b};this._sendOrQueueMessage(c)}},h.prototype.onCommand=function(a,b){switch(this._updatingWidget=!0,a.command){case d.State:this.remoteModelInterface.setState(a.compName,a.data);break;case d.Data:l.call(this,a),this.remoteModelInterface.setData(a.compName,a.data);break;case d.Layout:this.remoteModelInterface.setLayout(a.compName,a.data);break;case d.Props:this.remoteModelInterface.setProps(a.compName,a.data);break;case d.Event:this.remoteModelInterface.registerEvent(a.widgetInstanceId,a.compName,a.data.action.name,a.data.behavior.params.callbackId);break;case d.Behavior:var e=a.data;c.behaviorHandlersFactory.getHandler(e.type).handle(e,this._siteAPI,b),this._onUpdateCallback&&this._onUpdateCallback()}this._updatingWidget=!1},h.prototype.handleEvent=function(a,b,c,d){var e;switch(b){case"runCode":e={intent:"WIX_CODE",type:"wix_code_run_user_function",widgetInstanceId:a,callbackId:c.callbackId,compName:c.compName,event:d}}this._sendOrQueueMessage(e)},h.prototype._sendOrQueueMessage=f,h}),define("wixCode/utils/wixCodeClientSpecMapService",["lodash"],function(a){"use strict";var b=function(b){return a.find(b,{type:"siteextension"})},c=function(a){return!!b(a)},d=function(c){return"wixCodeWidget_"+a.get(b(c),"applicationId")},e=function(c){return"wixCodeDataProvider_"+a.get(b(c),"applicationId")};return{getHandlerId:e,getWidgetInstanceId:d,hasWixCodeWidgetSpecs:c,getWixCodeSpec:b}}),define("wixCode/components/wixCodeWidget",["lodash","reactDOM","skins","core","wixCode/widgets/RemoteWidgetHandlerProxy","wixCode/utils/wixCodeClientSpecMapService","tpa","utils"],function(a,b,c,d,e,f,g,h){"use strict";function m(b,c){var d=a.get(c,["currentUrl","query",i]);if(!n(d))return b;var e=b.lastIndexOf("/"),f=b.substring(e+1);return b.replace(f,d)}function n(a){return/^\d+\.\d+\.\d+$/.test(a)}var i="WixCodeRuntimeSource",j=d.compRegistrar,k=d.compMixins,l=function(a){var b=a.wixCloudBaseDomain;return b&&"/"!==b.substr(-1)&&(b+="/"),b},o={mixins:[k.skinBasedComp,g.tpaMixins.tpaCompApi,g.tpaMixins.tpaUrlBuilder],getSkinProperties:function(){var b,a=this.buildUrl(this.getBaseUrl());return b=this.shouldClientSpecMapBeReloaded()?this.isClientSpecMapReloaded()?this._getSkinPropsWithIframe(a):{"":{},iframe:{}}:this._getSkinPropsWithIframe(a)},_getSkinPropsWithIframe:function(a){return{"":{},iframe:{src:a,key:a}}},componentWillMount:function(){var a=this.props.siteAPI.getSiteAspect("wixCodeWidgetAspect"),b=this.props.siteAPI.getSiteAspect("WidgetAspect"),c=this.props.siteAPI.getSiteData().getClientSpecMap(),d=f.getHandlerId(c),g=f.getWidgetInstanceId(c),h=new e(this.props.siteAPI,this,function(){a.updateSite()});b.registerWidgetHandler(d,h),b.registerWidgetInstance(g,d),a.registerToUrlPageChange(g,h)},getSantaPath:function(a){function d(a){return a.indexOf("localhost")>=0}var b=a.serviceTopology,c=d(a.santaBase)?b.scriptsLocationMap.santa:a.santaBase;return c=m(c,a),c.replace(b.scriptsDomainUrl,"")},getBaseUrl:function(){var a=this.getAppData(),b=a.extensionId,c=this.props.siteData.serviceTopology,d="//"+b+".",e=l(c),f=this.props.siteData.isDebugMode()?"index.debug.html":"index.html",g="static/wixcode/target/"+f,i=this.getSantaPath(this.props.siteData);return d+h.urlUtils.joinURL(e,"_static",i,g)},mutateIframeUrlQueryParam:function(){function a(){return void 0!==this.codeVersion?this.codeVersion:(this.codeVersion=this.props.siteData.publicModel.siteRevision,this.codeVersion)}return{codeVersion:a.call(this)}}};return j.register("wysiwyg.viewer.classes.wixCode.WixCodeWidget",o),o}),define("wixCode/utils/wixCodeWidgetCollector",["lodash","utils","wixCode/utils/wixCodeClientSpecMapService"],function(a,b,c){"use strict";function f(c,d){var f=d.getPageData(c).structure,g=b.dataUtils.getAllCompsInStructure(f,d.isMobileView());return a(g).map("id").difference(e).value()}function g(a,b){var e=d.MASTER_PAGE_ID,g=a.getSiteData(),h=g.getClientSpecMap();if(c.hasWixCodeWidgetSpecs(h)){var i=f(b,g),j=f(e,g),k=a.getSiteAspect("WidgetAspect"),l=c.getWidgetInstanceId(h),m=c.getHandlerId(h);k.updateWidgetComponents(l,m,b,i),k.updateWidgetComponents(l,m,e,j)}}var d=b.siteConstants,e=[d.PAGES_CONTAINER_ID,d.SITE_PAGES_ID],h={collectComponents:g};return h}),define("wixCode/aspects/WixCodeWidgetAspect",["lodash","core"],function(a,b){"use strict";function e(a){this._aspectSiteAPI=a}var c=function(a){return{componentType:"wysiwyg.viewer.classes.wixCode.WixCodeWidget",skin:"wysiwyg.viewer.skins.WixCodeWidgetSkin",type:"Component",id:a}},d=function(a,d,e){var f="wixCode_"+e.extensionId,g=c(f),h=b.componentPropsBuilder.getCompProps(g,a,null,d);return h.compData=e,b.compFactory.getCompClass(g.componentType)(h)};return e.prototype={getComponentStructures:function(){var b=this._aspectSiteAPI.getSiteData().getClientSpecMap(),d=this._getWixCodeWidgetsSpecs(b);return a.map(d,c)},getReactComponents:function(b){var c=this._aspectSiteAPI.getSiteData().getClientSpecMap(),e=this._aspectSiteAPI.getSiteAPI(),f=this._getWixCodeWidgetsSpecs(c);return a.map(f,a.partial(d,e,b))},_getWixCodeWidgetsSpecs:function(b){return a.filter(b,"type","siteextension")},updateSite:function(){this._aspectSiteAPI.forceUpdate()},registerToUrlPageChange:function(a,b){var c=this;this._aspectSiteAPI.registerToUrlPageChange(function(){var d=c._aspectSiteAPI.getSiteData();if("editor"!==d.renderFlags.componentViewMode){var e=c._aspectSiteAPI.getSiteData().getPrimaryPageId(),f=c._aspectSiteAPI.getSiteAspect("WidgetAspect"),g=f.getWidgetComponents(a,e);b.initWidgets(e,g,a)}})}},e}),define("wixCode/handlers/wixCodeHandlers",["lodash","utils"],function(a,b){"use strict";var c=function(c,d,e){var f=c.getSiteData(),g=b.menuUtils.getSiteMenu(f,!1),h=function(a){return{title:a.label||"",fullUrl:c.getPageUrlFor(a.link.pageId.id),url:"/"+a.link.pageId.pageUriSEO,visible:a.isVisible}},i=a.map(g,function(b){var c=h(b),d=b.items;return a.forEach(d,function(a){var b=h(a);c.childPages=c.subPages||[],c.childPages.push(b)}),c});e(i)};return{getSitePages:c}}),define("wixCode/aspects/WixCodePostMessageAspect",["lodash","tpa","wixCode/handlers/wixCodeHandlers","wixCode/utils/wixCodeClientSpecMapService"],function(a,b,c,d){"use strict";var e={"WIXֹֹֹ_CODE_MESSAGE":"WIX_CODE",WIX_CODE_SITE_API:"WIX_CODE_SITE_API"},f={CONSOLE:"console",IFRAME_READY:"wix_code_iframe_loaded",IFRAME_COMMAND:"wix_code_iframe_command"},g=function(a){return a===e.WIXֹֹֹ_CODE_MESSAGE},h=function(a){return a===e.WIX_CODE_SITE_API},i=function(){var a=this.getWidgetAspect(),b=this.siteAPI.getSiteData(),c=b.getClientSpecMap(),e=d.getHandlerId(c);return a.getWidgetHandler(e)},j=function(a){window.parent&&window.parent.postMessage(JSON.stringify(a),"*")},k=function(a,b){var c=i.call(this);switch(a.type){case f.IFRAME_READY:var e=this.siteAPI.getSiteData(),g=this.getWidgetAspect(),h=e.getClientSpecMap();if(e.isViewerMode()){var k=d.getWidgetInstanceId(h),l=e.getPrimaryPageId(),m=g.getWidgetComponents(k,l);c.initWidgets(l,m,k)}c.registerPostMessageDelegate(this.sendPostMessage);break;case f.IFRAME_COMMAND:c.onCommand(a,b);break;case f.CONSOLE:j(a)}},l=function(d,e){var f;try{a.isString(d.data)?f=JSON.parse(d.data):a.isObject(d.data)&&(f=d.data)}catch(i){return}if(f)if(g(f.intent))e.call(this,f,m(f,this.getWidgetHandler()));else if(h(f.intent)){var j=a.assign({},b.tpaHandlers,c);j[f.type]&&j[f.type].apply(this,[this.siteAPI,f,m(f,this.getWidgetHandler())])}},m=function(a,b){return function(c){try{b.updateComponent({intent:"WIX_CODE_RESPONSE",callbackId:a.callbackId,type:a.type,result:c})}catch(d){}}},n=function(a,b,c){a.postMessage||(a=a.contentWindow),a.postMessage(b,c||"*")},o=function(a){a.registerToMessage(this.handleMessage.bind(this)),this.siteAPI=a};return o.prototype={handleMessage:function(a,b){l.call(this,a,b||k)},sendPostMessage:function(a,b){var c=a.getIframe();if(!c)throw new Error("No iframe found in wixCode component",a);n(c,b)},getWidgetAspect:function(){return this.siteAPI.getSiteAPI().getSiteAspect("WidgetAspect")},getWidgetHandler:i},o}),define("wixCode/aspects/wixCodeAspectCollector",["core","wixCode/aspects/WixCodeWidgetAspect","wixCode/aspects/WixCodePostMessageAspect"],function(a,b,c){"use strict";var d=a.siteAspectsRegistry;d.registerSiteAspect("wixCodeWidgetAspect",b),d.registerSiteAspect("wixCodePostMessageAspect",c)}),define("wixCode/utils/kibanaReporter",["lodash","utils"],function(b,c){"use strict";function e(a,d){var e=b.clone(a);e=f(e);var g={protocol:"http:",hostname:"monitoringhub."+d,path:"/logstash/events/gost",query:e,hash:""},h=c.urlUtils.buildFullUrl(g),i=new window.Image(0,0);i.src=h}function f(a){var c=b.clone(a);c.message instanceof Error&&(c.message=c.message.stack),c.hasOwnProperty("message")&&!b.isString(c.message)&&(c.message=JSON.stringify(c.message));var d={message:512};return b.forEach(d,function(d,e){b.isString(a[e])&&(c[e]=c[e].substr(0,Math.min(c[e].length,d)))}),c}function g(){return{source:"wix-code-client",level:d.INFO,userActionId:c.guidUtils.getGUID()}}function h(a){if(!b.isString(a)||0===a.length)throw new Error("parameter `baseDomain` is invalid, received: "+a)}function i(a,c){h(c);var d=new Date,f=d.getTime(),i=b.assign({},g(),a,{timestamp:d.toJSON(),actionPosition:"start"});return e(i,c),function(a){var d=new Date,g=d.getTime(),h=(g-f)/1e3;a=b.assign({},i,a,{timestamp:d.toJSON(),duration:h,actionPosition:"end"}),e(a,c)}}var d={INFO:"info",ERROR:"error"};return{levels:d,trace:i}}),define("wixCode",["core","wixCode/components/wixCodeWidget","wixCode/utils/wixCodeWidgetCollector","wixCode/aspects/wixCodeAspectCollector","wixCode/utils/wixCodeClientSpecMapService","wixCode/utils/wixCodeRemoteModelService","wixCode/utils/kibanaReporter"],function(a,b,c,d,e,f,g){"use strict";return a.widgetCollectorRegistry.registerWidgetCollector(c),{wixCodeRemoteModelService:f,wixCodeWidget:b,wixCodeClientSpecMapService:e,log:g}});